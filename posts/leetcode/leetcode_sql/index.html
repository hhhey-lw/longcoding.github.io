<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>é«˜é¢‘SQL50é¢˜åˆ·é¢˜ç¬”è®° | LongCoding&#39;s Blog</title>
<meta name="keywords" content="SQL">
<meta name="description" content="é«˜é¢‘SQL50é¢˜
æŸ¥è¯¢
Where&amp;GroupBy&amp;HAVING
 1SELECT id, revenue  # æŸä¸ªç”¨æˆ·2021å¹´å¯èƒ½æœ‰å¤šé¡¹è®°å½•
 2FROM users
 3Where year = 2021
 4
 5SELECT id, SUM(revenue) 
 6FROM users
 7Where year = 2021  # 1. å…ˆç­›é€‰å‡ºæ­¤å¹´ä»½æ‰€æœ‰è®°å½•
 8Group By id        # 2. å†æ ¹æ®idåˆ†ç»„ 3. å¿…é¡»ç»“åˆSUM() æˆ–è€…å…¶ä»–èšåˆå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªæœ‰å¤šåˆ—ï¼Œéœ€è¦å¤„ç†ä¸ºå•å€¼ã€‚
 9
10SELECT id
11FROM users
12Where year = 2021          # 1. å…ˆç­›é€‰è®°å½•
13Group By id                # 2. åˆ†ç»„
14HAVING SUM(revenue) &gt; 1000  #  3. èšåˆåˆ†ç»„å­—æ®µè®°å½• å¹¶ åˆ¤æ–­
æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢
1# 1. NOT EXISTS
2SELECT `name` AS `Customers`
3FROM `Customers` AS c
4WHERE NOT EXISTS (
5    SELECT `customerId`
6    FROM `Orders` AS o
7    Where o.customerId = c.id    
8)

 1# 2. Left Join 
 2# example
 3SELECT c.id AS id, c.name, o.id AS oid
 4FROM customers AS c LEFT JOIN orders AS o
 5on c.id = o.customerId 
 6
 7SELECT `name` as `Customers`
 8FROM customers AS c LEFT JOIN orders AS o
 9on c.id = o.customerId 
10WHERE o.id is NULL
è®¡ç®—ç‰¹æ®Šå¥–é‡‘
ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ å¥‡æ•° å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ &#39;M&#39; å¼€å¤´ï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ 100% ï¼Œå¦åˆ™å¥–é‡‘ä¸º 0 ã€‚">
<meta name="author" content="LongWei">
<link rel="canonical" href="http://longcoding.top/posts/leetcode/leetcode_sql/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="http://longcoding.top/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://longcoding.top/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://longcoding.top/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://longcoding.top/apple-touch-icon.png">
<link rel="mask-icon" href="http://longcoding.top/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://longcoding.top/posts/leetcode/leetcode_sql/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://longcoding.top/posts/leetcode/leetcode_sql/">
  <meta property="og:site_name" content="LongCoding&#39;s Blog">
  <meta property="og:title" content="é«˜é¢‘SQL50é¢˜åˆ·é¢˜ç¬”è®°">
  <meta property="og:description" content="é«˜é¢‘SQL50é¢˜ æŸ¥è¯¢ Where&amp;GroupBy&amp;HAVING 1SELECT id, revenue # æŸä¸ªç”¨æˆ·2021å¹´å¯èƒ½æœ‰å¤šé¡¹è®°å½• 2FROM users 3Where year = 2021 4 5SELECT id, SUM(revenue) 6FROM users 7Where year = 2021 # 1. å…ˆç­›é€‰å‡ºæ­¤å¹´ä»½æ‰€æœ‰è®°å½• 8Group By id # 2. å†æ ¹æ®idåˆ†ç»„ 3. å¿…é¡»ç»“åˆSUM() æˆ–è€…å…¶ä»–èšåˆå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªæœ‰å¤šåˆ—ï¼Œéœ€è¦å¤„ç†ä¸ºå•å€¼ã€‚ 9 10SELECT id 11FROM users 12Where year = 2021 # 1. å…ˆç­›é€‰è®°å½• 13Group By id # 2. åˆ†ç»„ 14HAVING SUM(revenue) &gt; 1000 # 3. èšåˆåˆ†ç»„å­—æ®µè®°å½• å¹¶ åˆ¤æ–­ æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢ 1# 1. NOT EXISTS 2SELECT `name` AS `Customers` 3FROM `Customers` AS c 4WHERE NOT EXISTS ( 5 SELECT `customerId` 6 FROM `Orders` AS o 7 Where o.customerId = c.id 8) 1# 2. Left Join 2# example 3SELECT c.id AS id, c.name, o.id AS oid 4FROM customers AS c LEFT JOIN orders AS o 5on c.id = o.customerId 6 7SELECT `name` as `Customers` 8FROM customers AS c LEFT JOIN orders AS o 9on c.id = o.customerId 10WHERE o.id is NULL è®¡ç®—ç‰¹æ®Šå¥–é‡‘ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ å¥‡æ•° å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ &#39;M&#39; å¼€å¤´ï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ 100% ï¼Œå¦åˆ™å¥–é‡‘ä¸º 0 ã€‚">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-24T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-11-24T00:00:00+00:00">
    <meta property="article:tag" content="SQL">
      <meta property="og:image" content="http://longcoding.top/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://longcoding.top/papermod-cover.png">
<meta name="twitter:title" content="é«˜é¢‘SQL50é¢˜åˆ·é¢˜ç¬”è®°">
<meta name="twitter:description" content="é«˜é¢‘SQL50é¢˜
æŸ¥è¯¢
Where&amp;GroupBy&amp;HAVING
 1SELECT id, revenue  # æŸä¸ªç”¨æˆ·2021å¹´å¯èƒ½æœ‰å¤šé¡¹è®°å½•
 2FROM users
 3Where year = 2021
 4
 5SELECT id, SUM(revenue) 
 6FROM users
 7Where year = 2021  # 1. å…ˆç­›é€‰å‡ºæ­¤å¹´ä»½æ‰€æœ‰è®°å½•
 8Group By id        # 2. å†æ ¹æ®idåˆ†ç»„ 3. å¿…é¡»ç»“åˆSUM() æˆ–è€…å…¶ä»–èšåˆå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªæœ‰å¤šåˆ—ï¼Œéœ€è¦å¤„ç†ä¸ºå•å€¼ã€‚
 9
10SELECT id
11FROM users
12Where year = 2021          # 1. å…ˆç­›é€‰è®°å½•
13Group By id                # 2. åˆ†ç»„
14HAVING SUM(revenue) &gt; 1000  #  3. èšåˆåˆ†ç»„å­—æ®µè®°å½• å¹¶ åˆ¤æ–­
æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢
1# 1. NOT EXISTS
2SELECT `name` AS `Customers`
3FROM `Customers` AS c
4WHERE NOT EXISTS (
5    SELECT `customerId`
6    FROM `Orders` AS o
7    Where o.customerId = c.id    
8)

 1# 2. Left Join 
 2# example
 3SELECT c.id AS id, c.name, o.id AS oid
 4FROM customers AS c LEFT JOIN orders AS o
 5on c.id = o.customerId 
 6
 7SELECT `name` as `Customers`
 8FROM customers AS c LEFT JOIN orders AS o
 9on c.id = o.customerId 
10WHERE o.id is NULL
è®¡ç®—ç‰¹æ®Šå¥–é‡‘
ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ å¥‡æ•° å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ &#39;M&#39; å¼€å¤´ï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ 100% ï¼Œå¦åˆ™å¥–é‡‘ä¸º 0 ã€‚">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://longcoding.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "é«˜é¢‘SQL50é¢˜åˆ·é¢˜ç¬”è®°",
      "item": "http://longcoding.top/posts/leetcode/leetcode_sql/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "é«˜é¢‘SQL50é¢˜åˆ·é¢˜ç¬”è®°",
  "name": "é«˜é¢‘SQL50é¢˜åˆ·é¢˜ç¬”è®°",
  "description": "é«˜é¢‘SQL50é¢˜ æŸ¥è¯¢ Where\u0026amp;GroupBy\u0026amp;HAVING 1SELECT id, revenue # æŸä¸ªç”¨æˆ·2021å¹´å¯èƒ½æœ‰å¤šé¡¹è®°å½• 2FROM users 3Where year = 2021 4 5SELECT id, SUM(revenue) 6FROM users 7Where year = 2021 # 1. å…ˆç­›é€‰å‡ºæ­¤å¹´ä»½æ‰€æœ‰è®°å½• 8Group By id # 2. å†æ ¹æ®idåˆ†ç»„ 3. å¿…é¡»ç»“åˆSUM() æˆ–è€…å…¶ä»–èšåˆå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªæœ‰å¤šåˆ—ï¼Œéœ€è¦å¤„ç†ä¸ºå•å€¼ã€‚ 9 10SELECT id 11FROM users 12Where year = 2021 # 1. å…ˆç­›é€‰è®°å½• 13Group By id # 2. åˆ†ç»„ 14HAVING SUM(revenue) \u0026gt; 1000 # 3. èšåˆåˆ†ç»„å­—æ®µè®°å½• å¹¶ åˆ¤æ–­ æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢ 1# 1. NOT EXISTS 2SELECT `name` AS `Customers` 3FROM `Customers` AS c 4WHERE NOT EXISTS ( 5 SELECT `customerId` 6 FROM `Orders` AS o 7 Where o.customerId = c.id 8) 1# 2. Left Join 2# example 3SELECT c.id AS id, c.name, o.id AS oid 4FROM customers AS c LEFT JOIN orders AS o 5on c.id = o.customerId 6 7SELECT `name` as `Customers` 8FROM customers AS c LEFT JOIN orders AS o 9on c.id = o.customerId 10WHERE o.id is NULL è®¡ç®—ç‰¹æ®Šå¥–é‡‘ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ å¥‡æ•° å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ 'M' å¼€å¤´ï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ 100% ï¼Œå¦åˆ™å¥–é‡‘ä¸º 0 ã€‚\n",
  "keywords": [
    "SQL"
  ],
  "articleBody": "é«˜é¢‘SQL50é¢˜ æŸ¥è¯¢ Where\u0026GroupBy\u0026HAVING 1SELECT id, revenue # æŸä¸ªç”¨æˆ·2021å¹´å¯èƒ½æœ‰å¤šé¡¹è®°å½• 2FROM users 3Where year = 2021 4 5SELECT id, SUM(revenue) 6FROM users 7Where year = 2021 # 1. å…ˆç­›é€‰å‡ºæ­¤å¹´ä»½æ‰€æœ‰è®°å½• 8Group By id # 2. å†æ ¹æ®idåˆ†ç»„ 3. å¿…é¡»ç»“åˆSUM() æˆ–è€…å…¶ä»–èšåˆå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªæœ‰å¤šåˆ—ï¼Œéœ€è¦å¤„ç†ä¸ºå•å€¼ã€‚ 9 10SELECT id 11FROM users 12Where year = 2021 # 1. å…ˆç­›é€‰è®°å½• 13Group By id # 2. åˆ†ç»„ 14HAVING SUM(revenue) \u003e 1000 # 3. èšåˆåˆ†ç»„å­—æ®µè®°å½• å¹¶ åˆ¤æ–­ æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢ 1# 1. NOT EXISTS 2SELECT `name` AS `Customers` 3FROM `Customers` AS c 4WHERE NOT EXISTS ( 5 SELECT `customerId` 6 FROM `Orders` AS o 7 Where o.customerId = c.id 8) 1# 2. Left Join 2# example 3SELECT c.id AS id, c.name, o.id AS oid 4FROM customers AS c LEFT JOIN orders AS o 5on c.id = o.customerId 6 7SELECT `name` as `Customers` 8FROM customers AS c LEFT JOIN orders AS o 9on c.id = o.customerId 10WHERE o.id is NULL è®¡ç®—ç‰¹æ®Šå¥–é‡‘ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ å¥‡æ•° å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ 'M' å¼€å¤´ï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ 100% ï¼Œå¦åˆ™å¥–é‡‘ä¸º 0 ã€‚\nè¿”å›çš„ç»“æœæŒ‰ç…§ employee_id æ’åºã€‚\nIFç”¨æ³• IF(condition, True, False) AS alias\n1select `employee_id`, IF(name not like 'M%' and employee_id%2 = 1, salary, 0) AS `bonus` 2from Employees 3Order by employee_id ASC è´­ä¹°äº†äº§å“ A å’Œäº§å“ B å´æ²¡æœ‰è´­ä¹°äº§å“ C çš„é¡¾å®¢ Where ä¸­ å¤šé‡ åˆ¤æ–­\n1select customer_id, customer_name 2from Customers as c 3where exists ( 4 select o.customer_id 5 from Orders as o 6 where o.customer_id=c.customer_id and product_name = 'A' 7) and exists ( 8 select o.customer_id 9 from Orders as o 10 where o.customer_id=c.customer_id and product_name = 'B' 11) and not exists ( 12 select o.customer_id 13 from Orders as o 14 where o.customer_id=c.customer_id and product_name = 'C' 15) 16Order By c.customer_id ASC è¿è¡¨ï¼Œåˆ†ç»„åˆ¤æ–­\n1SELECT c.customer_id, c.customer_name 2FROM `Orders` as o left join `Customers` as c 3on o.customer_id = c.customer_id 4Group By o.customer_id 5HAVING SUM(product_name = 'A') \u003e 0 and SUM(product_name = 'B') \u003e 0 and SUM(product_name = 'C') = 0 6Order By c.customer_id ASC 1[o.id, o.customerId, o.product_name, c.customerId, c.name] 2 1 1 'A' 1 X 3 2 1 'B' 1 X 4 3 2 'A' 2 Y 5 4 2 'B' 2 Y 6 5 2 'C' 2 Y 7 8 Group By c.customerId 9 1 1 'A' 1 X 10 2 1 'B' 1 X 11 12 3 2 'A' 2 Y 13 4 2 'B' 2 Y 14 5 2 'C' 2 Y 15 16 SUM(express condition) ? condition # å¯¹äºStringæ˜¯ç»Ÿè®¡æ¡æ•° æ¯ä½å­¦ç”Ÿæˆç»©æœ€å¥½çš„ç§‘ç›® æ‰€æœ‰æœ‰ç›¸åŒç§‘ç›®æˆç»©ä¸€æ ·ï¼Œé€‰æ‹©ç§‘ç›®idå°çš„\n1+---------------+---------+ 2| Column Name | Type | 3+---------------+---------+ 4| student_id | int | 5| course_id | int | 6| grade | int | 7+---------------+---------+ # 1\n1# æŸ¥æŸå­¦ç”Ÿæˆç»©æœ€å¥½çš„é‚£äº›ç§‘ç›®ï¼Œå› ä¸ºå¯èƒ½æœ‰é‡å¤çš„ 2SELECT student_id, MAX(grade) AS grade 3From Enrollments 4Group By student_id # 2\n1# æŸ¥æŸå­¦ç”Ÿæœ€å¥½çš„é‚£äº›ç§‘ç›®ä¸­ courseIdæœ€å°çš„ 2SELECT student_id, MIN(courseId) AS course_id, grade 3From Enrollments 4# è¡Œ =\u003e æœ€å¥½çš„é‚£äº›ç§‘ç›® 5Where (student_id, grade) in ( 6\tSELECT student_id, MAX(grade) AS grade 7\tFrom Enrollments 8\tGroup By student_id 9) 10Group By student_id 11Order By student_id ASC è¿æ¥ Left Join\næ‹“å±•å·¦è¾¹ï¼Œå³ä½¿å³è¡¨æŸäº›è¡Œä¸å­˜åœ¨ï¼ˆä¼šå‡ºç°é‡å¤è¡Œï¼‰\n=\u003e **Right Join **åŒç†\n1SELECT * 2FROM `customers` as c 3LEFT JOIN orders as o 4ON c.id = o.customerId Inner Join =\u003e åªå±•ç¤ºå·¦å³è¡¨å‡æˆåŠŸå¯¹æ¥ä¸Šçš„è¡Œ\næ²¡æœ‰å–å‡ºçš„å•†å®¶ å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ, æŠ¥å‘Šæ‰€æœ‰åœ¨ 2020 å¹´åº¦æ²¡æœ‰ä»»ä½•å–å‡ºçš„å–å®¶çš„åå­—ã€‚\nè¿”å›ç»“æœæŒ‰ç…§ seller_name å‡åºæ’åˆ—ã€‚\n1SELECT seller_name 2FROM Seller 3WHERE seller_id not in ( 4 SELECT DISTINCT Orders.seller_id 5 FROM Orders 6 WHERE Orders.sale_date like '2020%' 7) 8ORDER By seller_name ASC æ’åé å‰çš„æ—…è¡Œè€… è¿”å›çš„ç»“æœè¡¨å•ï¼Œä»¥ travelled_distance é™åºæ’åˆ— ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„ç”¨æˆ·æ—…è¡Œäº†ç›¸åŒçš„è·ç¦», é‚£ä¹ˆå†ä»¥ name å‡åºæ’åˆ— ã€‚\n1SELECT name, COALESCE(SUM(distance), 0) AS travelled_distance 2From Users Left join Rides 3On Rides.user_id = Users.id 4Group By Rides.user_id 5ORDER BY travelled_distance DESC, name ASC; # ä½¿ç”¨åˆ«åæ’åº 607. é”€å”®å‘˜ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ²¡æœ‰ä»»ä½•ä¸åä¸º â€œREDâ€ çš„å…¬å¸ç›¸å…³çš„è®¢å•çš„æ‰€æœ‰é”€å”®äººå‘˜çš„å§“åã€‚\n1SELECT name 2FROM SalesPerson 3WHERE sales_id not in ( 4 SELECT DISTINCT Orders.sales_id 5 FROM Orders LEFT JOIN Company 6 ON Orders.com_id = Company.com_id 7 WHERE name = 'RED' 8) è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼ è¾“å…¥ï¼š\rVariables è¡¨:\r+------+-------+\r| name | value |\r+------+-------+\r| x | 66 |\r| y | 77 |\r+------+-------+\rExpressions è¡¨:\r+--------------+----------+---------------+\r| left_operand | operator | right_operand |\r+--------------+----------+---------------+\r| x | \u003e | y |\r| x | \u003c | y |\r| x | = | y |\r| y | \u003e | x |\r| y | \u003c | x |\r| x | = | x |\r+--------------+----------+---------------+\rè¾“å‡º:\r+--------------+----------+---------------+-------+\r| left_operand | operator | right_operand | value |\r+--------------+----------+---------------+-------+\r| x | \u003e | y | false |\r| x | \u003c | y | true |\r| x | = | y | false |\r| y | \u003e | x | true |\r| y | \u003c | x | false |\r| x | = | x | true |\r+--------------+----------+---------------+-------+ 1SELECT e.left_operand, e.operator, e.right_operand, 2CASE e.operator 3 WHEN '\u003e' THEN IF(v1.value\u003ev2.value, 'true', 'false') 4 WHEN '\u003c' THEN IF(v1.value\u003cv2.value, 'true', 'false') 5 ELSE IF(v1.value=v2.value, 'true', 'false') 6END value 7 8FROM Expressions e 9LEFT JOIN Variables v1 ON e.left_operand = v1.name 10LEFT JOIN Variables v2 ON e.right_operand = v2.name è€ƒç‚¹ï¼šå¤šé‡è¿è¡¨ e.(â€¦)v1.(â€¦)v2.(â€¦)\næ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼\ncase [sign]\nâ€‹\twhen exp then result[if(exp, true, false)]\nâ€‹\twhen exp then result\nâ€‹\telse result\nend\næŸ¥è¯¢çƒé˜Ÿç§¯åˆ† åˆ†åˆ«æŸ¥è¯¢ä¸»é˜Ÿå¾—åˆ†å’Œå®¢é˜Ÿå¾—åˆ†ã€‚å†è¿›è¡Œæ±‡æ€»ç»Ÿè®¡\nIFNULL(SUM(num_points), 0) # IFNULL(Origin, NULL-value)\n1SELECT t.team_id, t.team_name, IFNULL(SUM(num_points), 0) as num_points 2FROM Teams AS t 3LEFT JOIN ( 4 SELECT host_team AS team_id, 5 CASE 6 WHEN host_goals \u003e guest_goals THEN 3 7 WHEN host_goals = guest_goals THEN 1 8 END AS num_points 9 FROM Matches 10 UNION ALL 11 SELECT guest_team AS team_id, 12 CASE 13 WHEN guest_goals \u003e host_goals THEN 3 14 WHEN host_goals = guest_goals THEN 1 15 END AS num_points 16 FROM Matches 17) AS m ON t.team_id = m.team_id 18Group By t.team_id 19Order BY num_points DESC, t.team_id ASC # 1. LEFT JOIN å°†ç›¸å…³çš„å³è¡¨è¡¥å……è‡³å·¦è¡¨ ï¼è‹¥1vNåˆ™äº§ç”Ÿé‡å¤è®°å½•(èšåˆè¯¥è®°å½•)\n# 2. UNION(ALL) ä¸¤å¼ è¡¨éœ€å­—æ®µç›¸åŒï¼Œä¸Šä¸‹æ‹¼æ¥ä¸ºä¸€å¼ è¡¨ï¼ŒALLåˆ™ä¿ç•™é‡å¤è®°å½•\n# 3. case ç©ºæ¡ä»¶\nâ€‹\twhen ? then x\nâ€‹\tâ€¦\nâ€‹\tELSE y\nâ€‹\tend\nèšåˆå‡½æ•° 2020æœ€åä¸€æ¬¡ç™»å½• 1SELECT MAX(Feild) # \u003c= åªè¦ç»„å†…æœ€å¤§çš„è®°å½• 2\tMin(Feild) # \u003c= åªè¦ç»„å†…æœ€å°çš„è®°å½• 3... 4 5Group By ä»“åº“ç»ç† 1SELECT Warehouse.name AS warehouse_name, 2SUM(units*Products.Width*Products.Length*Products.Height) AS volume # èšåˆç»„å†…æ•°æ® 3FROM Warehouse 4LEFT JOIN Products ON Warehouse.product_id = Products.product_id # è¡¥é½ä¿¡æ¯ 5Group By Warehouse.name # åˆ†ç»„ è®¢å•æœ€å¤šçš„å®¢æˆ· 1SELECT customer_number 2FROM Orders 3GROUP BY customer_number 4ORDER BY COUNT(*) DESC # å¯¹ç»„è¿›è¡Œæ’åº 5LIMIT 1 # Topä½ç½® 6 7 8SELECT o.customer_number 9FROM ( 10\tSELECT customer_number, COUNT(*) AS count_number 11\tFROM Orders 12\tGROUP BY customer_number 13) o 14ORDER BY o.count_number DESC 15LIMIT 1 æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´ å¤šæ¬¡åˆ†ç»„ \u0026 èšåˆ\n1SELECT `day`, emp_id, SUM(out_time-in_time) 2FROM Employees 3GROUP BY emp_id, event_day åŠæ—¶é£Ÿç‰©é…é€ è€ƒç‚¹ï¼šè®¡ç®—å…¬å¼\n#1 ROUND(X*100, 2) 33.33\n#2 SUM(IF(X, 1, 0)) / COUNT(ID)\næŒ‰åˆ—æ“ä½œ\n1SELECT ROUND((SUM(IF(order_date = customer_pref_delivery_date, 1, 0)))/COUNT(delivery_id)*100, 2) AS immediate_percentage 2FROM Delivery è‹¹æœå’Œæ¡”å­ 1SELECT sale_date, 2(SUM(IF(fruit='apples', sold_num, 0)) - SUM(IF(fruit='oranges', sold_num, 0))) AS diff 3FROM Sales 4Group By sale_date â­ åˆ†åˆ«èšåˆç»„å†…ä¸åŒæ¡ä»¶çš„è®°å½•\nä¸¤ä¸ªäººçš„é€šè¯è®°å½• è€ƒç‚¹ï¼Œå¤šæ¬¡åˆ†ç»„è¿›è¡Œèšåˆç»Ÿè®¡ã€‚\né¢˜å¹²ä¸­ï¼Œå‘¼å«ä¸æ¥æ”¶ä¸åˆ†ã€‚\n1SELECT from_id AS person1, to_id AS person2, COUNT(*) AS call_count,SUM(duration) AS total_duration 2 3FROM ( 4 5 SELECT IF(from_id \u003c to_id, from_id, to_id) AS from_id, IF(from_id \u003c to_id, to_id, from_id) AS to_id, duration 6 7 FROM Calls 8 9) AS c 10 11Group BY from_id, to_id æ’åºå’Œåˆ†ç»„ é“¶è¡Œè´¦æˆ·æ¦‚è¦ II ç¼–å†™è§£å†³æ–¹æ¡ˆ, æŠ¥å‘Šä½™é¢é«˜äº 10000 çš„æ‰€æœ‰ç”¨æˆ·çš„åå­—å’Œä½™é¢. è´¦æˆ·çš„ä½™é¢ç­‰äºåŒ…å«è¯¥è´¦æˆ·çš„æ‰€æœ‰äº¤æ˜“çš„æ€»å’Œ\n1SELECT name, balance 2FROM Users 3LEFT JOIN ( 4 SELECT account, SUM(amount) AS balance 5 FROM Transactions 6 Group BY account) AS trans On Users.account = trans.account 7Where balance \u003e 10000 æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®± ç¼–å†™è§£å†³æ–¹æ¡ˆæ¥æŠ¥å‘Šæ‰€æœ‰é‡å¤çš„ç”µå­é‚®ä»¶\n1SELECT email AS Email 2FROM Person 3Group By email 4HAVING count(*) \u003e 1 åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼” ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡ºåˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”çš„ id å¯¹ (actor_id, director_id)\n1SELECT actor_id, director_id 2FROM ActorDirector 3GROUP BY actor_id, director_id 4HAVING COUNT(*) \u003e= 3 æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡\n67æœˆï¼Œæ¯ä¸ªæœˆå‡æ¶ˆè´¹è‡³å°‘100çš„ç”¨æˆ·\n1SELECT o.customer_id, name 2FROM () AS o 3LEFT JOIN Customers ON o.customer_id = Customers.customer_id 4 5 6# å…¶ä¸­ 7SELECT customer_id, order_date, (quantity*price) AS cost 8FROM Orders 9LEFT JOIN Product ON Orders.product_id = Product.product_id 10WHERE month(order_date) in (6,7) 11Group BY customer_id 12HAVING SUM(IF(month(order_date) = 6, cost, 0)) \u003e= 100 and 13 SUM(IF(month(order_date) = 7, cost, 0)) \u003e= 100 å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶ åˆ†æ­¥å®ç°ï¼š\n1ï¸âƒ£ å°†å‘¼å«\\æ¥å¬è”åˆ\n2ï¸âƒ£ å°†å¯¹åº”äººå‘˜åŠå…¶å›½å®¶å‡†å¤‡å¥½\n3ï¸âƒ£ å†æ¬¡è¿æ¥ï¼Œå¹¶æŒ‰å›½å®¶åˆ†ç»„ä¸”èšåˆ(HAVINGè¿›è¡Œæ¡ä»¶ç­›é€‰)\n1SELECT name as country 2FROM 3( 4 SELECT caller_id AS call_id, duration FROM Calls 5 UNION ALL 6 SELECT callee_id AS call_id, duration FROM Calls 7) a 8LEFT JOIN 9( 10 SELECT id, Country.name 11 FROM Person 12 LEFT JOIN Country on SUBSTR(phone_number, 1, 3) = country_code 13) b 14ON a.call_id = b.id 15Group BY name 16HAVING AVG(duration) \u003e (SELECT AVG(duration) FROM Calls) é«˜çº§æŸ¥è¯¢å’Œè¿æ¥ HAVING å­å¥ç”¨æ¥å¯¹ èšåˆç»“æœ è¿›è¡Œè¿‡æ»¤ï¼Œè€Œ HAVING å­å¥æ— æ³•ç›´æ¥ä½¿ç”¨éèšåˆåˆ—\né¡µé¢æ¨è ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œå‘user_id = 1 çš„ç”¨æˆ·ï¼Œæ¨èå…¶æœ‹å‹ä»¬å–œæ¬¢çš„é¡µé¢ã€‚ä¸è¦æ¨èè¯¥ç”¨æˆ·å·²ç»å–œæ¬¢çš„é¡µé¢ã€‚\nå…ˆfindä»–çš„æ‰€æœ‰æœ‹å‹ã€‚ ä»–-\u003eæœ‹å‹ and æœ‹å‹ -\u003e\n1SELECT DISTINCT page_id as recommended_page 2FROM (SELECT user2_id as user_id 3 FROM Friendship 4 WHERE user1_id = 1 5 UNION 6 SELECT user1_id as user_id 7 FROM Friendship 8 WHERE user2_id = 1) AS fs 9LEFT JOIN Likes ls ON fs.user_id = ls.user_id 10WHERE page_id not in ( 11 SELECT page_id 12 FROM Likes 13 WHERE user_id = 1 14) 15ORDER BY recommended_page ASC æ ‘èŠ‚ç‚¹ CASE â€¦ END æŒ‰åˆ—æ¥ï¼Œæ¯æ¬¡å¤„ç†åˆ—çš„ä¸€ä¸ªå…ƒç´ \n1SELECT id AS `id`, 2CASE 3 WHEN id = 1 THEN \"Root\" 4 WHEN id in (SELECT atree.p_id FROM tree atree) THEN \"Inner\" 5 ELSE \"Leaf\" 6END AS type 7FROM Tree æ¸¸æˆç©æ³•åˆ†æ III ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶æŠ¥å‘Šæ¯ç»„ç©å®¶å’Œæ—¥æœŸï¼Œä»¥åŠç©å®¶åˆ° ç›®å‰ä¸ºæ­¢ ç©äº†å¤šå°‘æ¸¸æˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç©å®¶åœ¨è¯¥æ—¥æœŸä¹‹å‰æ‰€ç©çš„æ¸¸æˆæ€»æ•°ã€‚è¯¦ç»†æƒ…å†µè¯·æŸ¥çœ‹ç¤ºä¾‹ã€‚\nåˆ©ç”¨ç¬›å¡å°”ç§¯ï¼Œ è‡ªå·±è·Ÿè‡ªå·±æ‰€æœ‰çš„è®°å½•è¿›è¡Œè¿æ¥ã€‚æš´åŠ›éå†\n1SELECT a1.player_id, a1.event_date, SUM(a2.games_played) AS games_played_so_far 2FROM Activity a1, Activity a2 # ç¬›å¡å„¿ç§¯ï¼Œo(n) x o(n) = o(n^2) æ¡çºªå½• 3WHERE a1.player_id = a2.player_id and a1.event_date \u003e= a2.event_date # åªè¦è‡ªå·±å’Œè‡ªå·±è¿›è¡Œè¿æ¥çš„è®°å½• 4GROUP BY a1.player_id, a1.event_date å¤§æ»¡è´¯æ•°é‡ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ¯ä¸€ä¸ªçƒå‘˜èµ¢å¾—å¤§æ»¡è´¯æ¯”èµ›çš„æ¬¡æ•°ã€‚ç»“æœä¸åŒ…å«æ²¡æœ‰èµ¢å¾—æ¯”èµ›çš„çƒå‘˜çš„ID ã€‚\næ€è·¯ï¼š è¡Œ -\u003e åˆ— å†èšåˆ\nPlayers è¡¨ï¼š\r+-----------+-------------+\r| player_id | player_name |\r+-----------+-------------+\r| 1 | Nadal |\r| 2 | Federer |\r| 3 | Novak |\r+-----------+-------------+\rChampionships è¡¨ï¼š\r+------+-----------+---------+---------+---------+\r| year | Wimbledon | Fr_open | US_open | Au_open |\r+------+-----------+---------+---------+---------+\r| 2018 | 1 | 1 | 1 | 1 |\r| 2019 | 1 | 1 | 2 | 2 |\r| 2020 | 2 | 1 | 2 | 2 |\r+------+-----------+---------+---------+---------+\rè¾“å‡ºï¼š\r+-----------+-------------+-------------------+\r| player_id | player_name | grand_slams_count |\r+-----------+-------------+-------------------+\r| 2 | Federer | 5 |\r| 1 | Nadal | 7 |\r+-----------+-------------+-------------------+ 1SELECT res.player_id, ps.player_name, res.grand_slams_count 2FROM ( 3 SELECT player_id, COUNT(*) AS grand_slams_count 4 FROM ( 5 SELECT Wimbledon player_id 6 FROM Championships 7 UNION ALL 8 SELECT Fr_open player_id 9 FROM Championships 10 UNION ALL 11 SELECT US_open player_id 12 FROM Championships 13 UNION ALL 14 SELECT Au_open player_id 15 FROM Championships 16 ) AS rec 17 GROUP BY rec.player_id 18) AS res 19LEFT JOIN Players AS ps ON res.player_id = ps.player_id åº”è¯¥è¢«ç¦æ­¢çš„ Leetflex è´¦æˆ· ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŸ¥æ‰¾é‚£äº›åº”è¯¥è¢«ç¦æ­¢çš„Leetflexå¸æˆ·ç¼–å· account_id ã€‚ å¦‚æœæŸä¸ªå¸æˆ·åœ¨æŸä¸€æ—¶åˆ»ä»ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œåœ°å€ç™»å½•äº†ï¼Œåˆ™è¿™ä¸ªå¸æˆ·åº”è¯¥è¢«ç¦æ­¢ã€‚\nLogInfo table:\r+------------+------------+---------------------+---------------------+\r| account_id | ip_address | login | logout |\r+------------+------------+---------------------+---------------------+\r| 1 | 1 | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 |\r| 1 | 2 | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 |\r| 2 | 6 | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 |\r| 2 | 7 | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 |\r| 3 | 9 | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 |\r| 3 | 13 | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |\r| 4 | 10 | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 |\r| 4 | 11 | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |\r+------------+------------+---------------------+---------------------+ 1AND ((a.login between b.login and b.logout) OR (a.logout between b.login and b.logout)) GROUP BY åˆ†ç»„\nHAVING ä½œç”¨äºç»„ï¼ŒæŒ‘é€‰æŒ‡å®šçš„ç»„\nå­æŸ¥è¯¢ å„éƒ¨é—¨æœ€é«˜æ”¶å…¥çš„å‘˜å·¥ (å¯èƒ½æœ‰å¤šä¸ª) 1SELECT d.name AS Department, e1.name AS Employee, e1.salary AS Salary 2FROM Employee e1 3LEFT JOIN Department d ON e1.departmentId = d.id 4WHERE e1.salary = ( 5 SELECT MAX(salary) 6 FROM Employee e2 7 GROUP BY e2.departmentId 8 HAVING e2.departmentId = e1.departmentId 9) æ•ˆç‡ä¸é«˜ï¼ï¼ï¼\nä¼˜åŒ–ï¼š\n1SELECT d.name AS Department, e1.name AS Employee, e1.salary AS Salary 2FROM Employee e1 3LEFT JOIN Department d ON e1.departmentId = d.id 4WHERE (e1.departmentId,e1.salary) in ( 5 SELECT e2.departmentId, MAX(salary) 6 FROM Employee e2 7 GROUP BY e2.departmentId 8) ç”Ÿæˆä¸´æ—¶è¡¨ï¼ˆé¿å…å­æŸ¥è¯¢ é‡å¤çš„æ‰§è¡Œï¼‰\n1WITH MaxSalaries AS ( 2 SELECT departmentId, MAX(salary) AS max_salary 3 FROM Employee 4 GROUP BY departmentId 5) æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å• å¯èƒ½æœ‰å¤šä¸ª\n1With LatestDate AS ( 2 SELECT product_id, MAX(order_date) AS order_date 3 FROM Orders 4 GROUP BY product_id 5) 6 7 8SELECT p.product_name, o.product_id, o.order_id, o.order_date 9FROM Orders AS o 10LEFT JOIN LatestDate AS ld ON o.product_id = ld.product_id 11LEFT JOIN Products AS p ON o.product_id = p.product_id 12WHERE o.order_date = ld.order_date 13ORDER BY p.product_name ASC, o.product_id ASC, o.order_id ASC æœ€è¿‘çš„ä¸‰ç¬”è®¢å• å­¦ä¹ ï¼Œ å¯åˆ†ç»„æ‰“indexæ ‡è®°ï¼Œæ ‡è®°æŒ‰ç…§ORDERé¡ºåº\n1ROW_NUMBER() OVER ( 2\tPARTITION BY ? 3 ORDER BY ? 4) 1WITH ORDER_INFO AS ( 2 SELECT c.name, c.customer_id, o.order_id, o.order_date, 3 ROW_NUMBER() OVER ( 4 PARTITION BY o.customer_id 5 ORDER BY o.order_date DESC 6 ) AS row_num 7 FROM Orders AS o 8 LEFT JOIN Customers AS c ON o.customer_id = c.customer_id 9) 10 11SELECT name AS customer_name, customer_id, order_id, order_date 12FROM ORDER_INFO AS o 13WHERE o.row_num \u003c= 3 14ORDER BY customer_name ASC, customer_id ASC, order_date DESC å…ˆç”Ÿæˆä¸´æ—¶è¡¨ï¼Œé¿å…é‡å¤ç”Ÿæˆå­æŸ¥è¯¢\næ¯å¤©çš„æœ€å¤§é‡‘é¢ å…ˆç­›é€‰å‡ºæ¯å¤©çš„æœ€å¤§é‡‘é¢ï¼Œå†æ‰§è¡Œåç»­çš„åˆ¤æ–­\n1WITH MAX_AMOUNT AS ( 2 SELECT DATE(`day`) AS `day`, MAX(amount) max_amount 3 FROM Transactions AS t 4 GROUP BY DATE(`day`) 5) 6 7 8SELECT transaction_id 9FROM Transactions AS t 10LEFT JOIN MAX_AMOUNT AS ma ON DATE(t.day) = ma.day 11WHERE (DATE(t.day), t.amount) = (ma.day, ma.max_amount) 12ORDER BY transaction_id ASC ç›´æ¥ç»™æ¯å¤©çš„ è®¢å•ï¼ŒæŒ‰ç…§é‡‘é¢ï¼Œ æ‰“indexæ ‡è®°\nâ— RANK ç›¸åŒå€¼ä¼šè·å¾—ç›¸åŒçš„æ’å\n1RANK() OVER ( 2) è€Œ ROW_NUMBERï¼Œidxä¸¥æ ¼é€’å¢\n1WITH Temp AS ( 2 SELECT transaction_id, `day`, amount, 3 rank() OVER ( 4 PARTITION BY DATE(`day`) 5 ORDER BY amount DESC 6 ) AS idx 7 FROM Transactions AS t 8) 9 10SELECT transaction_id 11FROM Temp as t 12WHERE idx = 1 13ORDER BY transaction_id ASC çª—å£å‡½æ•°å’Œå…¬å…±è¡¨è¡¨è¾¾å¼ é¡¹ç›®å‘˜å·¥ III æ‰¾å‡ºæ¯ä¸ªé¡¹ç›® ç»éªŒæœ€ä¸°å¯Œçš„å‘˜å·¥(å¯èƒ½æœ‰å¤šä¸ª)\nç›´æ¥1. åˆ†é¡¹ç›® 2. é¡¹ç›®å†…æŒ‰ç»éªŒç¨‹åº¦è¿›è¡ŒRANK 3. å†ç­›é€‰\n1WITH Temp AS ( 2 SELECT p.project_id, p.employee_id, 3 RANK() OVER ( 4 PARTITION BY p.project_id 5 ORDER BY e.experience_years DESC 6 ) AS idx 7 FROM Project AS p 8 LEFT JOIN Employee as e ON p.employee_id = e.employee_id 9) 10 11 12SELECT project_id, employee_id 13FROM Temp 14WHERE idx = 1 æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“ ä¸»SQL GROUP BY ä¹‹åï¼Œä¸ RANK() çš„æ“ä½œ\n1SELECT 2 customer_id, 3 product_id, 4 COUNT(*) AS order_count, 5 RANK() OVER (ORDER BY COUNT(*) DESC) AS RK 6FROM Orders 7GROUP BY customer_id, product_id; ç»“æœï¼š\næ·»åŠ  PARTITION BY customer_id è¿›è¡Œéš”ç¦»\n1SELECT 2 customer_id, 3 product_id, 4 COUNT(*) AS order_count, 5 RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS RK 6FROM Orders 7GROUP BY customer_id, product_id; ç»“æœï¼š\n=\u003e ç»“è®ºã€‚ 1. å…ˆæ‰§è¡Œä¸»SQLçš„GROUP BYï¼Œè¿›è¡Œåˆ†åŒºï¼Œå†RANK(), RANK()æŒ‰ç…§ ORDER BY(å¿…é¡»èšåˆä¸ºå•è¡Œ)è¿›è¡Œæ’åºï¼Œ åˆ©ç”¨PARTITIONè¿›è¡Œæ’åºéš”ç¦»ã€‚\nç­”æ¡ˆ\n1WITH Temp AS ( 2 SELECT 3 customer_id, 4 product_id, 5 COUNT(*) AS order_count, 6 RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS RK 7 FROM Orders 8 GROUP BY customer_id, product_id 9) 10 11SELECT t.customer_id, t.product_id, p.product_name 12FROM Temp AS t 13LEFT JOIN Products AS p ON t.product_id = p.product_id 14WHERE RK = 1 # æœ€é«˜çš„ NO.1 è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ LEAD(column, offset, defualt) OVER (PARTITION BY â€¦ ORDER BY â€¦) æ‰¾åé¢çš„è¡Œã€‚å…¶ä¸­LEADè¡¨ç¤ºå¼•é¢†ã€‚\nLAG(â€¦) æ‰¾å‰é¢çš„è¡Œï¼Œ æ»å\n1SELECT user_id, MAX(DATEDIFF(after_day, visit_date)) AS biggest_window 2FROM ( 3 SELECT user_id, visit_date, 4 LEAD(visit_date, 1, '2021-1-1') OVER (PARTITION BY user_id ORDER BY visit_date ASC) AS after_day 5 FROM UserVisits AS uv 6) AS t 7GROUP BY user_id è€ƒç‚¹ï¼šè¡Œä¹‹é—´çš„å·®å€¼\nCTE Common Table Expression\nå‘å…¬å¸ CEO æ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº æŸ¥è¯¢æ ‘çŠ¶ç»“æ„èŠ‚ç‚¹ åˆ—è½¬è¡Œ\nä¾æ¬¡æš´åŠ›æšä¸¾\n1SELECT employee_id 2FROM ( 3 SELECT employee_id 4 FROM Employees 5 WHERE manager_id = 1 and employee_id != 1 6 UNION 7 SELECT employee_id 8 FROM Employees 9 WHERE manager_id in ( 10 SELECT employee_id 11 FROM (SELECT employee_id 12 FROM Employees 13 WHERE manager_id = 1 and employee_id != 1) AS e1 14 ) 15 UNION 16 SELECT employee_id 17 FROM Employees 18 WHERE manager_id in ( 19 SELECT employee_id 20 FROM (SELECT employee_id 21 FROM Employees 22 WHERE manager_id in ( 23 SELECT employee_id 24 FROM (SELECT employee_id 25 FROM Employees 26 WHERE manager_id = 1 and employee_id != 1) AS e2 27 )) e3 28 ) 29) AS e å¤ªä½æ•ˆäº†ï¼ï¼ï¼ SBæ“ä½œï¼Œç–¯ç‹‚è¿ç»­æŸ¥è¯¢\nä¼˜åŒ–\n1SELECT employee_id 2FROM ( 3 SELECT employee_id 4 FROM Employees 5 WHERE manager_id = 1 and employee_id != 1 # âœ”ï¸ 6 UNION 7 8 SELECT employee_id 9 FROM Employees 10 WHERE manager_id in ( 11 SELECT employee_id 12 FROM Employees 13 WHERE manager_id = 1 and employee_id != 1 14 ) 15 UNION 16 17 SELECT employee_id 18 FROM Employees 19 WHERE manager_id in ( 20 SELECT employee_id 21 FROM Employees 22 WHERE manager_id in ( 23 SELECT employee_id 24 FROM Employees 25 WHERE manager_id = 1 and employee_id != 1 26 ) 27 ) 28) AS e åˆ©ç”¨è¿æ¥æ¥è®¡ç®—\n1SELECT DISTINCT e4.employee_id 2FROM Employees e1 3LEFT JOIN Employees e2 ON e1.employee_id = e2.manager_id 4LEFT JOIN Employees e3 ON e2.employee_id = e3.manager_id 5LEFT JOIN Employees e4 ON e3.employee_id = e4.manager_id 6WHERE e1.employee_id = 1 and e4.employee_id != 1 11 Boss =\u003e { 2 1 Boss =\u003e { 3 1 Boss =\u003e { 4 1 Boss 5 2 Bob 6 77 Robert 7 } 8 2 Bob =\u003e 4 Daniel 9 77 Robert =\u003e null 10 } 11 2 Bob =\u003e 4 Daniel =\u003e null 12 77 Robert =\u003e null =\u003e null 13} å¯»æ‰¾è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸä½ç½® æ€è·¯ï¼š\n1data: 1,2,3,7,8,10 2idx : 1,2,3,4,5, 6 3diff: 0,0,0,3,3, 4 \u003c= GROUP BY diff =\u003e MIN(idx) AS Start_ID, MAX(idx) AS End_ID 1WITH Temp AS ( 2 SELECT log_id, 3 ROW_NUMBER() OVER (ORDER BY log_id ASC) AS idx 4 FROM Logs 5) 6 7SELECT MIN(log_id) AS start_id, MAX(log_id) AS end_id 8FROM ( 9 SELECT log_id, (log_id-idx ) AS diff 10 FROM Temp 11) AS t 12GROUP BY diff æŸ¥æ‰¾å¤„äºæˆç»©ä¸­æ¸¸çš„å­¦ç”Ÿ å‚åŠ çš„è€ƒè¯•ï¼Œæ²¡æœ‰ä¸€ç§‘æ˜¯æœ€é«˜åˆ†æˆ–è€…æœ€ä½åˆ†ã€‚ç§‘ç§‘ä¸­ç­‰\né€»è¾‘ï¼š 1. åˆ¤æ–­æ¯ä¸€ç§‘ï¼Œå†ç»Ÿè®¡æ‰€æœ‰ç§‘ç›®\n1WITH MAXMIN AS ( 2 SELECT exam_id, MIN(score) min_score, MAX(score) max_score 3 FROM Exam 4 GROUP BY exam_id 5) 6 7 8SELECT s.student_id, s.student_name 9FROM ( 10 SELECT e.exam_id, e.student_id, 11 CASE 12 WHEN score != min_score and score != max_score THEN 1 13 ELSE 0 14 END AS is_medium 15 FROM Exam AS e 16 LEFT JOIN MAXMIN m ON e.exam_id = m.exam_id 17) AS t 18LEFT JOIN Student AS s ON t.student_id = s.student_id 19GROUP BY t.student_id 20HAVING SUM(t.is_medium) = COUNT(t.is_medium) 21ORDER BY student_id ASC åè¿‡æ¥ï¼š å°†å°–å­ç”Ÿå’Œå«åº•ç”Ÿæ’é™¤åœ¨å¤–å³å¯\nå¯»æ‰¾æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¯¹ 1with recursive all_subtask(task_id, subtask_id) as ( 2 SELECT task_id, subtasks_count 3\tFROM Tasks 4 UNION ALL 5\t6 SELECT task_id, subtask_id-1 7\tFROM all_subtask 8\twhere subtask_id-1 \u003e 0 9) 10 11 12SELECT task_id, subtask_id 13From all_subtask 14WHERE (task_id, subtask_id) not in (SELECT task_id, subtask_id FROM Executed) 1with recursive TableName(param1, param2) AS ( 2\tSELECT param1, param2 // åŸºç¡€ç»“æœ 3\tFROM BaseTable 4 UNION ALL 5 // ä¸‹é¢å¼å­ä¼šè¢«é‡å¤é€’å½’ 6 SELECT param1, param2-1 // æ–°çš„ç»“æœ 7 FROM TableName // ä¸Šä¸€è½®çš„ç»“æœ 8 where param2-1 \u003e 0 // é€’å½’ç»ˆæ­¢æ¡ä»¶ 9) ",
  "wordCount" : "2965",
  "inLanguage": "en",
  "image": "http://longcoding.top/papermod-cover.png","datePublished": "2024-11-24T00:00:00Z",
  "dateModified": "2024-11-24T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "LongWei"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://longcoding.top/posts/leetcode/leetcode_sql/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "LongCoding's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://longcoding.top/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://longcoding.top/" accesskey="h" title="ğ“›ğ“¸ğ“·ğ“°ğ“’ğ“¸ğ“­ğ“²ğ“·ğ“°&#39;ğ“¼ ğ“‘ğ“µğ“¸ğ“° (Alt + H)">
                <img src="http://longcoding.top/android-icon-48x48.png" alt="" aria-label="logo"
                    height="30">ğ“›ğ“¸ğ“·ğ“°ğ“’ğ“¸ğ“­ğ“²ğ“·ğ“°&#39;ğ“¼ ğ“‘ğ“µğ“¸ğ“°</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://longcoding.top/index.html" title="ğŸ¡ Home">
                    <span>ğŸ¡ Home</span>
                </a>
            </li>
            <li>
                <a href="http://longcoding.top/archives/" title="ğŸ“ƒ Archives">
                    <span>ğŸ“ƒ Archives</span>
                </a>
            </li>
            <li>
                <a href="http://longcoding.top/tags/" title="ğŸ“‘ Tags">
                    <span>ğŸ“‘ Tags</span>
                </a>
            </li>
            <li>
                <a href="http://longcoding.top/categories/" title="ğŸ—’ï¸ Categories">
                    <span>ğŸ—’ï¸ Categories</span>
                </a>
            </li>
            <li>
                <a href="http://longcoding.top/search/" title="ğŸ” Search">
                    <span>ğŸ” Search</span>
                </a>
            </li>
            <li>
                <a href="http://longcoding.top/about/" title="ğŸ‘¨ğŸ»â€ğŸ“ About Me">
                    <span>ğŸ‘¨ğŸ»â€ğŸ“ About Me</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://longcoding.top/">Home</a>&nbsp;Â»&nbsp;<a href="http://longcoding.top/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      é«˜é¢‘SQL50é¢˜åˆ·é¢˜ç¬”è®°
    </h1>
    <div class="post-meta"><span title='2024-11-24 00:00:00 +0000 UTC'>November 24, 2024</span>&nbsp;Â·&nbsp;14 min&nbsp;Â·&nbsp;2965 words&nbsp;Â·&nbsp;LongWei

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e9%ab%98%e9%a2%91sql50%e9%a2%98" aria-label="é«˜é¢‘SQL50é¢˜">é«˜é¢‘SQL50é¢˜</a><ul>
                        
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2" aria-label="æŸ¥è¯¢">æŸ¥è¯¢</a><ul>
                        
                <li>
                    <a href="#wheregroupbyhaving" aria-label="Where&amp;GroupBy&amp;HAVING">Where&amp;GroupBy&amp;HAVING</a></li>
                <li>
                    <a href="#%e6%9f%a5%e6%89%be%e6%b2%a1%e4%b9%b0%e8%bf%87%e4%b8%9c%e8%a5%bf%e7%9a%84%e9%a1%be%e5%ae%a2" aria-label="æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢">æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢</a></li>
                <li>
                    <a href="#%e8%ae%a1%e7%ae%97%e7%89%b9%e6%ae%8a%e5%a5%96%e9%87%91" aria-label="è®¡ç®—ç‰¹æ®Šå¥–é‡‘">è®¡ç®—ç‰¹æ®Šå¥–é‡‘</a></li>
                <li>
                    <a href="#%e8%b4%ad%e4%b9%b0%e4%ba%86%e4%ba%a7%e5%93%81-a-%e5%92%8c%e4%ba%a7%e5%93%81-b-%e5%8d%b4%e6%b2%a1%e6%9c%89%e8%b4%ad%e4%b9%b0%e4%ba%a7%e5%93%81-c-%e7%9a%84%e9%a1%be%e5%ae%a2" aria-label="è´­ä¹°äº†äº§å“ A å’Œäº§å“ B å´æ²¡æœ‰è´­ä¹°äº§å“ C çš„é¡¾å®¢">è´­ä¹°äº†äº§å“ A å’Œäº§å“ B å´æ²¡æœ‰è´­ä¹°äº§å“ C çš„é¡¾å®¢</a></li>
                <li>
                    <a href="#%e6%af%8f%e4%bd%8d%e5%ad%a6%e7%94%9f%e6%88%90%e7%bb%a9%e6%9c%80%e5%a5%bd%e7%9a%84%e7%a7%91%e7%9b%ae" aria-label="æ¯ä½å­¦ç”Ÿæˆç»©æœ€å¥½çš„ç§‘ç›®">æ¯ä½å­¦ç”Ÿæˆç»©æœ€å¥½çš„ç§‘ç›®</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%bf%9e%e6%8e%a5" aria-label="è¿æ¥">è¿æ¥</a><ul>
                        
                <li>
                    <a href="#%e6%b2%a1%e6%9c%89%e5%8d%96%e5%87%ba%e7%9a%84%e5%95%86%e5%ae%b6" aria-label="æ²¡æœ‰å–å‡ºçš„å•†å®¶">æ²¡æœ‰å–å‡ºçš„å•†å®¶</a></li>
                <li>
                    <a href="#%e6%8e%92%e5%90%8d%e9%9d%a0%e5%89%8d%e7%9a%84%e6%97%85%e8%a1%8c%e8%80%85" aria-label="æ’åé å‰çš„æ—…è¡Œè€…">æ’åé å‰çš„æ—…è¡Œè€…</a></li>
                <li>
                    <a href="#607-%e9%94%80%e5%94%ae%e5%91%98" aria-label="607. é”€å”®å‘˜">607. é”€å”®å‘˜</a></li>
                <li>
                    <a href="#%e8%ae%a1%e7%ae%97%e5%b8%83%e5%b0%94%e8%a1%a8%e8%be%be%e5%bc%8f%e7%9a%84%e5%80%bc" aria-label="è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼">è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼</a></li>
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e7%90%83%e9%98%9f%e7%a7%af%e5%88%86" aria-label="æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†">æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%81%9a%e5%90%88%e5%87%bd%e6%95%b0" aria-label="èšåˆå‡½æ•°">èšåˆå‡½æ•°</a><ul>
                        
                <li>
                    <a href="#2020%e6%9c%80%e5%90%8e%e4%b8%80%e6%ac%a1%e7%99%bb%e5%bd%95" aria-label="2020æœ€åä¸€æ¬¡ç™»å½•">2020æœ€åä¸€æ¬¡ç™»å½•</a></li>
                <li>
                    <a href="#%e4%bb%93%e5%ba%93%e7%bb%8f%e7%90%86" aria-label="ä»“åº“ç»ç†">ä»“åº“ç»ç†</a></li>
                <li>
                    <a href="#%e8%ae%a2%e5%8d%95%e6%9c%80%e5%a4%9a%e7%9a%84%e5%ae%a2%e6%88%b7" aria-label="è®¢å•æœ€å¤šçš„å®¢æˆ·">è®¢å•æœ€å¤šçš„å®¢æˆ·</a></li>
                <li>
                    <a href="#%e6%9f%a5%e6%89%be%e6%af%8f%e4%b8%aa%e5%91%98%e5%b7%a5%e8%8a%b1%e8%b4%b9%e7%9a%84%e6%80%bb%e6%97%b6%e9%97%b4" aria-label="æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´">æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´</a></li>
                <li>
                    <a href="#%e5%8f%8a%e6%97%b6%e9%a3%9f%e7%89%a9%e9%85%8d%e9%80%81" aria-label="åŠæ—¶é£Ÿç‰©é…é€">åŠæ—¶é£Ÿç‰©é…é€</a></li>
                <li>
                    <a href="#%e8%8b%b9%e6%9e%9c%e5%92%8c%e6%a1%94%e5%ad%90" aria-label="è‹¹æœå’Œæ¡”å­">è‹¹æœå’Œæ¡”å­</a></li>
                <li>
                    <a href="#%e4%b8%a4%e4%b8%aa%e4%ba%ba%e7%9a%84%e9%80%9a%e8%af%9d%e8%ae%b0%e5%bd%95" aria-label="ä¸¤ä¸ªäººçš„é€šè¯è®°å½•">ä¸¤ä¸ªäººçš„é€šè¯è®°å½•</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8e%92%e5%ba%8f%e5%92%8c%e5%88%86%e7%bb%84" aria-label="æ’åºå’Œåˆ†ç»„">æ’åºå’Œåˆ†ç»„</a><ul>
                        
                <li>
                    <a href="#%e9%93%b6%e8%a1%8c%e8%b4%a6%e6%88%b7%e6%a6%82%e8%a6%81-ii" aria-label="é“¶è¡Œè´¦æˆ·æ¦‚è¦ II">é“¶è¡Œè´¦æˆ·æ¦‚è¦ II</a></li>
                <li>
                    <a href="#%e6%9f%a5%e6%89%be%e9%87%8d%e5%a4%8d%e7%9a%84%e7%94%b5%e5%ad%90%e9%82%ae%e7%ae%b1" aria-label="æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±">æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±</a></li>
                <li>
                    <a href="#%e5%90%88%e4%bd%9c%e8%bf%87%e8%87%b3%e5%b0%91%e4%b8%89%e6%ac%a1%e7%9a%84%e6%bc%94%e5%91%98%e5%92%8c%e5%af%bc%e6%bc%94" aria-label="åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”">åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”</a></li>
                <li>
                    <a href="#%e5%8f%af%e4%bb%a5%e6%94%be%e5%bf%83%e6%8a%95%e8%b5%84%e7%9a%84%e5%9b%bd%e5%ae%b6" aria-label="å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶">å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%ab%98%e7%ba%a7%e6%9f%a5%e8%af%a2%e5%92%8c%e8%bf%9e%e6%8e%a5" aria-label="é«˜çº§æŸ¥è¯¢å’Œè¿æ¥">é«˜çº§æŸ¥è¯¢å’Œè¿æ¥</a><ul>
                        
                <li>
                    <a href="#%e9%a1%b5%e9%9d%a2%e6%8e%a8%e8%8d%90" aria-label="é¡µé¢æ¨è">é¡µé¢æ¨è</a></li>
                <li>
                    <a href="#%e6%a0%91%e8%8a%82%e7%82%b9" aria-label="æ ‘èŠ‚ç‚¹">æ ‘èŠ‚ç‚¹</a></li>
                <li>
                    <a href="#%e6%b8%b8%e6%88%8f%e7%8e%a9%e6%b3%95%e5%88%86%e6%9e%90-iii" aria-label="æ¸¸æˆç©æ³•åˆ†æ III">æ¸¸æˆç©æ³•åˆ†æ III</a></li>
                <li>
                    <a href="#%e5%a4%a7%e6%bb%a1%e8%b4%af%e6%95%b0%e9%87%8f" aria-label="å¤§æ»¡è´¯æ•°é‡">å¤§æ»¡è´¯æ•°é‡</a></li>
                <li>
                    <a href="#%e5%ba%94%e8%af%a5%e8%a2%ab%e7%a6%81%e6%ad%a2%e7%9a%84-leetflex-%e8%b4%a6%e6%88%b7" aria-label=" åº”è¯¥è¢«ç¦æ­¢çš„ Leetflex è´¦æˆ·"> åº”è¯¥è¢«ç¦æ­¢çš„ Leetflex è´¦æˆ·</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%90%e6%9f%a5%e8%af%a2" aria-label="å­æŸ¥è¯¢">å­æŸ¥è¯¢</a><ul>
                        
                <li>
                    <a href="#%e5%90%84%e9%83%a8%e9%97%a8%e6%9c%80%e9%ab%98%e6%94%b6%e5%85%a5%e7%9a%84%e5%91%98%e5%b7%a5-%e5%8f%af%e8%83%bd%e6%9c%89%e5%a4%9a%e4%b8%aa" aria-label="å„éƒ¨é—¨æœ€é«˜æ”¶å…¥çš„å‘˜å·¥ (å¯èƒ½æœ‰å¤šä¸ª)">å„éƒ¨é—¨æœ€é«˜æ”¶å…¥çš„å‘˜å·¥ (å¯èƒ½æœ‰å¤šä¸ª)</a></li>
                <li>
                    <a href="#%e6%af%8f%e4%bb%b6%e5%95%86%e5%93%81%e7%9a%84%e6%9c%80%e6%96%b0%e8%ae%a2%e5%8d%95" aria-label="æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•">æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•</a></li>
                <li>
                    <a href="#%e6%9c%80%e8%bf%91%e7%9a%84%e4%b8%89%e7%ac%94%e8%ae%a2%e5%8d%95" aria-label="æœ€è¿‘çš„ä¸‰ç¬”è®¢å•">æœ€è¿‘çš„ä¸‰ç¬”è®¢å•</a></li>
                <li>
                    <a href="#%e6%af%8f%e5%a4%a9%e7%9a%84%e6%9c%80%e5%a4%a7%e9%87%91%e9%a2%9d" aria-label="æ¯å¤©çš„æœ€å¤§é‡‘é¢">æ¯å¤©çš„æœ€å¤§é‡‘é¢</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%aa%97%e5%8f%a3%e5%87%bd%e6%95%b0%e5%92%8c%e5%85%ac%e5%85%b1%e8%a1%a8%e8%a1%a8%e8%be%be%e5%bc%8f" aria-label="çª—å£å‡½æ•°å’Œå…¬å…±è¡¨è¡¨è¾¾å¼">çª—å£å‡½æ•°å’Œå…¬å…±è¡¨è¡¨è¾¾å¼</a><ul>
                        
                <li>
                    <a href="#%e9%a1%b9%e7%9b%ae%e5%91%98%e5%b7%a5-iii" aria-label=" é¡¹ç›®å‘˜å·¥ III"> é¡¹ç›®å‘˜å·¥ III</a></li>
                <li>
                    <a href="#%e6%af%8f%e4%bd%8d%e9%a1%be%e5%ae%a2%e6%9c%80%e7%bb%8f%e5%b8%b8%e8%ae%a2%e8%b4%ad%e7%9a%84%e5%95%86%e5%93%81" aria-label="æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“">æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“</a></li>
                <li>
                    <a href="#%e8%ae%bf%e9%97%ae%e6%97%a5%e6%9c%9f%e4%b9%8b%e9%97%b4%e6%9c%80%e5%a4%a7%e7%9a%84%e7%a9%ba%e6%a1%a3%e6%9c%9f" aria-label="è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ">è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ</a></li>
                <li>
                    <a href="#%e5%90%91%e5%85%ac%e5%8f%b8-ceo-%e6%b1%87%e6%8a%a5%e5%b7%a5%e4%bd%9c%e7%9a%84%e6%89%80%e6%9c%89%e4%ba%ba" aria-label="å‘å…¬å¸ CEO æ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº">å‘å…¬å¸ CEO æ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº</a></li>
                <li>
                    <a href="#%e5%af%bb%e6%89%be%e8%bf%9e%e7%bb%ad%e5%8c%ba%e9%97%b4%e7%9a%84%e5%bc%80%e5%a7%8b%e5%92%8c%e7%bb%93%e6%9d%9f%e4%bd%8d%e7%bd%ae" aria-label="å¯»æ‰¾è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸä½ç½®">å¯»æ‰¾è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸä½ç½®</a></li>
                <li>
                    <a href="#%e6%9f%a5%e6%89%be%e5%a4%84%e4%ba%8e%e6%88%90%e7%bb%a9%e4%b8%ad%e6%b8%b8%e7%9a%84%e5%ad%a6%e7%94%9f" aria-label="æŸ¥æ‰¾å¤„äºæˆç»©ä¸­æ¸¸çš„å­¦ç”Ÿ">æŸ¥æ‰¾å¤„äºæˆç»©ä¸­æ¸¸çš„å­¦ç”Ÿ</a></li>
                <li>
                    <a href="#%e5%af%bb%e6%89%be%e6%b2%a1%e6%9c%89%e8%a2%ab%e6%89%a7%e8%a1%8c%e7%9a%84%e4%bb%bb%e5%8a%a1%e5%af%b9" aria-label="å¯»æ‰¾æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¯¹">å¯»æ‰¾æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¯¹</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="é«˜é¢‘sql50é¢˜">é«˜é¢‘SQL50é¢˜<a hidden class="anchor" aria-hidden="true" href="#é«˜é¢‘sql50é¢˜">#</a></h2>
<h3 id="æŸ¥è¯¢">æŸ¥è¯¢<a hidden class="anchor" aria-hidden="true" href="#æŸ¥è¯¢">#</a></h3>
<h4 id="wheregroupbyhaving">Where&amp;GroupBy&amp;HAVING<a hidden class="anchor" aria-hidden="true" href="#wheregroupbyhaving">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="w">  </span><span class="c1"># æŸä¸ªç”¨æˆ·2021å¹´å¯èƒ½æœ‰å¤šé¡¹è®°å½•
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="k">Where</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2021</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">revenue</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="k">Where</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2021</span><span class="w">  </span><span class="c1"># 1. å…ˆç­›é€‰å‡ºæ­¤å¹´ä»½æ‰€æœ‰è®°å½•
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">id</span><span class="w">        </span><span class="c1"># 2. å†æ ¹æ®idåˆ†ç»„ 3. å¿…é¡»ç»“åˆSUM() æˆ–è€…å…¶ä»–èšåˆå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªæœ‰å¤šåˆ—ï¼Œéœ€è¦å¤„ç†ä¸ºå•å€¼ã€‚
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">Where</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2021</span><span class="w">          </span><span class="c1"># 1. å…ˆç­›é€‰è®°å½•
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">id</span><span class="w">                </span><span class="c1"># 2. åˆ†ç»„
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="k">HAVING</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">revenue</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w">  </span><span class="c1">#  3. èšåˆåˆ†ç»„å­—æ®µè®°å½• å¹¶ åˆ¤æ–­
</span></span></span></code></pre></div><h4 id="æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢">æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢<a hidden class="anchor" aria-hidden="true" href="#æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 1. NOT EXISTS
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">Customers</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">Customers</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">customerId</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">Orders</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="k">Where</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="w">    
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><img src="http://sthda9dn6.hd-bkt.clouddn.com/FlT4eqfOPSYMmcNCB5mh_bpamx5B" alt="Image" style="float:left; margin-right: 10px;" />
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># 2. Left Join 
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># example
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">oid</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customerId</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="n">Customers</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customerId</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="no">NULL</span><span class="w">
</span></span></span></code></pre></div><h4 id="è®¡ç®—ç‰¹æ®Šå¥–é‡‘"><a href="https://leetcode.cn/problems/calculate-special-bonus/">è®¡ç®—ç‰¹æ®Šå¥–é‡‘</a><a hidden class="anchor" aria-hidden="true" href="#è®¡ç®—ç‰¹æ®Šå¥–é‡‘">#</a></h4>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ <strong>å¥‡æ•°</strong> å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ <code>'M'</code> <strong>å¼€å¤´</strong>ï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ <code>100%</code> ï¼Œå¦åˆ™å¥–é‡‘ä¸º <code>0</code> ã€‚</p>
<p>è¿”å›çš„ç»“æœæŒ‰ç…§ <code>employee_id</code> æ’åºã€‚</p>
<p>IFç”¨æ³•  IF(condition, True, False) AS alias</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">select</span><span class="w"> </span><span class="o">`</span><span class="n">employee_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;M%&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">employee_id</span><span class="o">%</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">bonus</span><span class="o">`</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">Employees</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">Order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><h4 id="è´­ä¹°äº†äº§å“-a-å’Œäº§å“-b-å´æ²¡æœ‰è´­ä¹°äº§å“-c-çš„é¡¾å®¢"><a href="https://leetcode.cn/problems/customers-who-bought-products-a-and-b-but-not-c/">è´­ä¹°äº†äº§å“ A å’Œäº§å“ B å´æ²¡æœ‰è´­ä¹°äº§å“ C çš„é¡¾å®¢</a><a hidden class="anchor" aria-hidden="true" href="#è´­ä¹°äº†äº§å“-a-å’Œäº§å“-b-å´æ²¡æœ‰è´­ä¹°äº§å“-c-çš„é¡¾å®¢">#</a></h4>
<p>Where ä¸­ å¤šé‡ åˆ¤æ–­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">Customers</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="n">c</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="o">=</span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="o">=</span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="o">=</span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"></span><span class="k">Order</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w">  </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><p>è¿è¡¨ï¼Œåˆ†ç»„åˆ¤æ–­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customer_name</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">Orders</span><span class="o">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">Customers</span><span class="o">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="k">Order</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customerId</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customerId</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">name</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="mi">1</span><span class="w">            </span><span class="s1">&#39;A&#39;</span><span class="w">              </span><span class="mi">1</span><span class="w">           </span><span class="n">X</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"> </span><span class="mi">2</span><span class="w">       </span><span class="mi">1</span><span class="w">            </span><span class="s1">&#39;B&#39;</span><span class="w">              </span><span class="mi">1</span><span class="w">           </span><span class="n">X</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"> </span><span class="mi">3</span><span class="w">       </span><span class="mi">2</span><span class="w">            </span><span class="s1">&#39;A&#39;</span><span class="w">              </span><span class="mi">2</span><span class="w">           </span><span class="n">Y</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"> </span><span class="mi">4</span><span class="w">       </span><span class="mi">2</span><span class="w">            </span><span class="s1">&#39;B&#39;</span><span class="w">              </span><span class="mi">2</span><span class="w">           </span><span class="n">Y</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"> </span><span class="mi">5</span><span class="w">       </span><span class="mi">2</span><span class="w">            </span><span class="s1">&#39;C&#39;</span><span class="w">              </span><span class="mi">2</span><span class="w">           </span><span class="n">Y</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"> </span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customerId</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="mi">1</span><span class="w">            </span><span class="s1">&#39;A&#39;</span><span class="w">              </span><span class="mi">1</span><span class="w">           </span><span class="n">X</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"> </span><span class="mi">2</span><span class="w">       </span><span class="mi">1</span><span class="w">            </span><span class="s1">&#39;B&#39;</span><span class="w">              </span><span class="mi">1</span><span class="w">           </span><span class="n">X</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"> </span><span class="mi">3</span><span class="w">       </span><span class="mi">2</span><span class="w">            </span><span class="s1">&#39;A&#39;</span><span class="w">              </span><span class="mi">2</span><span class="w">           </span><span class="n">Y</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"> </span><span class="mi">4</span><span class="w">       </span><span class="mi">2</span><span class="w">            </span><span class="s1">&#39;B&#39;</span><span class="w">              </span><span class="mi">2</span><span class="w">           </span><span class="n">Y</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"> </span><span class="mi">5</span><span class="w">       </span><span class="mi">2</span><span class="w">            </span><span class="s1">&#39;C&#39;</span><span class="w">              </span><span class="mi">2</span><span class="w">           </span><span class="n">Y</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">express</span><span class="w"> </span><span class="k">condition</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">condition</span><span class="w"> </span><span class="c1"># å¯¹äºStringæ˜¯ç»Ÿè®¡æ¡æ•°
</span></span></span></code></pre></div><h4 id="æ¯ä½å­¦ç”Ÿæˆç»©æœ€å¥½çš„ç§‘ç›®">æ¯ä½å­¦ç”Ÿæˆç»©æœ€å¥½çš„ç§‘ç›®<a hidden class="anchor" aria-hidden="true" href="#æ¯ä½å­¦ç”Ÿæˆç»©æœ€å¥½çš„ç§‘ç›®">#</a></h4>
<p>æ‰€æœ‰æœ‰ç›¸åŒç§‘ç›®æˆç»©ä¸€æ ·ï¼Œé€‰æ‹©ç§‘ç›®idå°çš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">+---------------+---------+</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="k">Column</span><span class="w"> </span><span class="n">Name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Type</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+---------------+---------+</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">student_id</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">int</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">course_id</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="kt">int</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">grade</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="kt">int</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+---------------+---------+</span><span class="w">
</span></span></span></code></pre></div><p># 1</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># æŸ¥æŸå­¦ç”Ÿæˆç»©æœ€å¥½çš„é‚£äº›ç§‘ç›®ï¼Œå› ä¸ºå¯èƒ½æœ‰é‡å¤çš„
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">grade</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">grade</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">From</span><span class="w"> </span><span class="n">Enrollments</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">student_id</span><span class="w">
</span></span></span></code></pre></div><p># 2</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># æŸ¥æŸå­¦ç”Ÿæœ€å¥½çš„é‚£äº›ç§‘ç›®ä¸­ courseIdæœ€å°çš„
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="nf">MIN</span><span class="p">(</span><span class="n">courseId</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">course_id</span><span class="p">,</span><span class="w"> </span><span class="n">grade</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="k">From</span><span class="w"> </span><span class="n">Enrollments</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="c1"># è¡Œ =&gt; æœ€å¥½çš„é‚£äº›ç§‘ç›®
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="k">Where</span><span class="w"> </span><span class="p">(</span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="n">grade</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">grade</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">grade</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">	</span><span class="k">From</span><span class="w"> </span><span class="n">Enrollments</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">	</span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">student_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">       
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">student_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">Order</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">student_id</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><h3 id="è¿æ¥">è¿æ¥<a hidden class="anchor" aria-hidden="true" href="#è¿æ¥">#</a></h3>
<p><strong>Left Join</strong></p>
<p>æ‹“å±•å·¦è¾¹ï¼Œå³ä½¿å³è¡¨æŸäº›è¡Œä¸å­˜åœ¨ï¼ˆä¼šå‡ºç°é‡å¤è¡Œï¼‰</p>
<p>=&gt; **Right Join **åŒç†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">customers</span><span class="o">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customerId</span><span class="w">
</span></span></span></code></pre></div><p><img alt="image-20241119220005030" loading="lazy" src="http://sthda9dn6.hd-bkt.clouddn.com/FpSCM4lwemQYDfDXFZaf_m9G1knV"></p>
<p><strong>Inner Join</strong> =&gt; åªå±•ç¤ºå·¦å³è¡¨å‡æˆåŠŸå¯¹æ¥ä¸Šçš„è¡Œ</p>
<h4 id="æ²¡æœ‰å–å‡ºçš„å•†å®¶">æ²¡æœ‰å–å‡ºçš„å•†å®¶<a hidden class="anchor" aria-hidden="true" href="#æ²¡æœ‰å–å‡ºçš„å•†å®¶">#</a></h4>
<p>å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ, æŠ¥å‘Šæ‰€æœ‰åœ¨ <code>2020</code> å¹´åº¦æ²¡æœ‰ä»»ä½•å–å‡ºçš„å–å®¶çš„åå­—ã€‚</p>
<p>è¿”å›ç»“æœæŒ‰ç…§ <code>seller_name</code> <strong>å‡åºæ’åˆ—ã€‚</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">seller_name</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Seller</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">seller_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">seller_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w">  
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">sale_date</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;2020%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">seller_name</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><h4 id="æ’åé å‰çš„æ—…è¡Œè€…"><a href="https://leetcode.cn/problems/top-travellers/">æ’åé å‰çš„æ—…è¡Œè€…</a><a hidden class="anchor" aria-hidden="true" href="#æ’åé å‰çš„æ—…è¡Œè€…">#</a></h4>
<p>è¿”å›çš„ç»“æœè¡¨å•ï¼Œä»¥ <code>travelled_distance</code> <strong>é™åºæ’åˆ—</strong> ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„ç”¨æˆ·æ—…è¡Œäº†ç›¸åŒçš„è·ç¦», é‚£ä¹ˆå†ä»¥ <code>name</code> <strong>å‡åºæ’åˆ—</strong> ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nf">COALESCE</span><span class="p">(</span><span class="nf">SUM</span><span class="p">(</span><span class="n">distance</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">travelled_distance</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">From</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="k">Left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">Rides</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">On</span><span class="w"> </span><span class="n">Rides</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Users</span><span class="p">.</span><span class="n">id</span><span class="w">  
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">Rides</span><span class="p">.</span><span class="n">user_id</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">travelled_distance</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span><span class="w">  </span><span class="c1"># ä½¿ç”¨åˆ«åæ’åº
</span></span></span></code></pre></div><h4 id="607-é”€å”®å‘˜"><a href="https://leetcode.cn/problems/sales-person/">607. é”€å”®å‘˜</a><a hidden class="anchor" aria-hidden="true" href="#607-é”€å”®å‘˜">#</a></h4>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ²¡æœ‰ä»»ä½•ä¸åä¸º <strong>â€œREDâ€</strong> çš„å…¬å¸ç›¸å…³çš„è®¢å•çš„æ‰€æœ‰é”€å”®äººå‘˜çš„å§“åã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">SalesPerson</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">sales_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">sales_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Company</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">com_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Company</span><span class="p">.</span><span class="n">com_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RED&#39;</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h4 id="è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼"><a href="https://leetcode.cn/problems/evaluate-boolean-expression/">è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼</a><a hidden class="anchor" aria-hidden="true" href="#è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼">#</a></h4>
<pre tabindex="0"><code>è¾“å…¥ï¼š
Variables è¡¨:
+------+-------+
| name | value |
+------+-------+
| x    | 66    |
| y    | 77    |
+------+-------+

Expressions è¡¨:
+--------------+----------+---------------+
| left_operand | operator | right_operand |
+--------------+----------+---------------+
| x            | &gt;        | y             |
| x            | &lt;        | y             |
| x            | =        | y             |
| y            | &gt;        | x             |
| y            | &lt;        | x             |
| x            | =        | x             |
+--------------+----------+---------------+

è¾“å‡º:
+--------------+----------+---------------+-------+
| left_operand | operator | right_operand | value |
+--------------+----------+---------------+-------+
| x            | &gt;        | y             | false |
| x            | &lt;        | y             | true  |
| x            | =        | y             | false |
| y            | &gt;        | x             | true  |
| y            | &lt;        | x             | false |
| x            | =        | x             | true  |
+--------------+----------+---------------+-------+
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">left_operand</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">operator</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">right_operand</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">CASE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">operator</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;&gt;&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">v1</span><span class="p">.</span><span class="n">value</span><span class="o">&gt;</span><span class="n">v2</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;&lt;&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">v1</span><span class="p">.</span><span class="n">value</span><span class="o">&lt;</span><span class="n">v2</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">v1</span><span class="p">.</span><span class="n">value</span><span class="o">=</span><span class="n">v2</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Expressions</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Variables</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">left_operand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v1</span><span class="p">.</span><span class="n">name</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Variables</span><span class="w"> </span><span class="n">v2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">right_operand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v2</span><span class="p">.</span><span class="n">name</span><span class="w"> 
</span></span></span></code></pre></div><p>è€ƒç‚¹ï¼šå¤šé‡è¿è¡¨ e.(&hellip;)v1.(&hellip;)v2.(&hellip;)</p>
<p>æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼</p>
<p>case [sign]</p>
<p>â€‹	when exp then result[if(exp, true, false)]</p>
<p>â€‹	when exp then result</p>
<p>â€‹	else result</p>
<p>end</p>
<hr>
<h4 id="æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†"><a href="https://leetcode.cn/problems/team-scores-in-football-tournament/">æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†</a><a hidden class="anchor" aria-hidden="true" href="#æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†">#</a></h4>
<p>åˆ†åˆ«æŸ¥è¯¢ä¸»é˜Ÿå¾—åˆ†å’Œå®¢é˜Ÿå¾—åˆ†ã€‚å†è¿›è¡Œæ±‡æ€»ç»Ÿè®¡</p>
<p>IFNULL(SUM(num_points), 0)  # IFNULL(Origin, NULL-value)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">team_id</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">team_name</span><span class="p">,</span><span class="w"> </span><span class="nf">IFNULL</span><span class="p">(</span><span class="nf">SUM</span><span class="p">(</span><span class="n">num_points</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">num_points</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Teams</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">host_team</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">team_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">host_goals</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">guest_goals</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">host_goals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guest_goals</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="n">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_points</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Matches</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">guest_team</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">team_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">guest_goals</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">host_goals</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">host_goals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guest_goals</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span><span class="n">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_points</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Matches</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">team_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">team_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">team_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="k">Order</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">num_points</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">team_id</span><span class="w"> </span><span class="k">ASC</span><span class="w"> 
</span></span></span></code></pre></div><p># 1. LEFT JOIN å°†ç›¸å…³çš„å³è¡¨è¡¥å……è‡³å·¦è¡¨ ï¼è‹¥1vNåˆ™äº§ç”Ÿé‡å¤è®°å½•(èšåˆè¯¥è®°å½•)</p>
<p># 2. UNION(ALL) ä¸¤å¼ è¡¨éœ€å­—æ®µç›¸åŒï¼Œä¸Šä¸‹æ‹¼æ¥ä¸ºä¸€å¼ è¡¨ï¼ŒALLåˆ™ä¿ç•™é‡å¤è®°å½•</p>
<p># 3. case ç©ºæ¡ä»¶</p>
<p>â€‹	     when ? then x</p>
<p>â€‹		&hellip;</p>
<p>â€‹		ELSE y</p>
<p>â€‹		end</p>
<h3 id="èšåˆå‡½æ•°">èšåˆå‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#èšåˆå‡½æ•°">#</a></h3>
<hr>
<h4 id="2020æœ€åä¸€æ¬¡ç™»å½•">2020æœ€åä¸€æ¬¡ç™»å½•<a hidden class="anchor" aria-hidden="true" href="#2020æœ€åä¸€æ¬¡ç™»å½•">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">Feild</span><span class="p">)</span><span class="w">  </span><span class="c1"># &lt;= åªè¦ç»„å†…æœ€å¤§çš„è®°å½•
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span><span class="w">	   </span><span class="nf">Min</span><span class="p">(</span><span class="n">Feild</span><span class="p">)</span><span class="w">  </span><span class="c1"># &lt;= åªè¦ç»„å†…æœ€å°çš„è®°å½•
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w">
</span></span></span></code></pre></div><h4 id="ä»“åº“ç»ç†"><a href="https://leetcode.cn/problems/warehouse-manager/">ä»“åº“ç»ç†</a><a hidden class="anchor" aria-hidden="true" href="#ä»“åº“ç»ç†">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">Warehouse</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">warehouse_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="nf">SUM</span><span class="p">(</span><span class="n">units</span><span class="o">*</span><span class="n">Products</span><span class="p">.</span><span class="n">Width</span><span class="o">*</span><span class="n">Products</span><span class="p">.</span><span class="n">Length</span><span class="o">*</span><span class="n">Products</span><span class="p">.</span><span class="n">Height</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">volume</span><span class="w">   </span><span class="c1"># èšåˆç»„å†…æ•°æ®
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Warehouse</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Products</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Warehouse</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Products</span><span class="p">.</span><span class="n">product_id</span><span class="w">  </span><span class="c1"># è¡¥é½ä¿¡æ¯
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">Warehouse</span><span class="p">.</span><span class="n">name</span><span class="w">                                           </span><span class="c1"># åˆ†ç»„
</span></span></span></code></pre></div><h4 id="è®¢å•æœ€å¤šçš„å®¢æˆ·">è®¢å•æœ€å¤šçš„å®¢æˆ·<a hidden class="anchor" aria-hidden="true" href="#è®¢å•æœ€å¤šçš„å®¢æˆ·">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_number</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_number</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="w">  </span><span class="c1"># å¯¹ç»„è¿›è¡Œæ’åº
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="w">                 </span><span class="c1"># Topä½ç½®
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_number</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_number</span><span class="p">,</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_number</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">	</span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">	</span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_number</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">count_number</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></div><h4 id="æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´"><a href="https://leetcode.cn/problems/find-total-time-spent-by-each-employee/">æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´</a><a hidden class="anchor" aria-hidden="true" href="#æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´">#</a></h4>
<p>å¤šæ¬¡åˆ†ç»„ &amp; èšåˆ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">day</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">emp_id</span><span class="p">,</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">out_time</span><span class="o">-</span><span class="n">in_time</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">emp_id</span><span class="p">,</span><span class="w"> </span><span class="n">event_day</span><span class="w"> 
</span></span></span></code></pre></div><h4 id="åŠæ—¶é£Ÿç‰©é…é€">åŠæ—¶é£Ÿç‰©é…é€<a hidden class="anchor" aria-hidden="true" href="#åŠæ—¶é£Ÿç‰©é…é€">#</a></h4>
<p>è€ƒç‚¹ï¼šè®¡ç®—å…¬å¼</p>
<p>#1  ROUND(X*100, 2)   33.33</p>
<p>#2  SUM(IF(X, 1, 0)) / COUNT(ID)</p>
<p><strong>æŒ‰åˆ—æ“ä½œ</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="nf">ROUND</span><span class="p">((</span><span class="nf">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">order_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer_pref_delivery_date</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="o">/</span><span class="nf">COUNT</span><span class="p">(</span><span class="n">delivery_id</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">immediate_percentage</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Delivery</span><span class="w">
</span></span></span></code></pre></div><h4 id="è‹¹æœå’Œæ¡”å­">è‹¹æœå’Œæ¡”å­<a hidden class="anchor" aria-hidden="true" href="#è‹¹æœå’Œæ¡”å­">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">sale_date</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="p">(</span><span class="nf">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="s1">&#39;apples&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sold_num</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="s1">&#39;oranges&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sold_num</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">diff</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">sale_date</span><span class="w">
</span></span></span></code></pre></div><p>â­ åˆ†åˆ«èšåˆç»„å†…ä¸åŒæ¡ä»¶çš„è®°å½•</p>
<h4 id="ä¸¤ä¸ªäººçš„é€šè¯è®°å½•">ä¸¤ä¸ªäººçš„é€šè¯è®°å½•<a hidden class="anchor" aria-hidden="true" href="#ä¸¤ä¸ªäººçš„é€šè¯è®°å½•">#</a></h4>
<p>è€ƒç‚¹ï¼Œå¤šæ¬¡åˆ†ç»„è¿›è¡Œèšåˆç»Ÿè®¡ã€‚</p>
<p>é¢˜å¹²ä¸­ï¼Œå‘¼å«ä¸æ¥æ”¶ä¸åˆ†ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">from_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">person1</span><span class="p">,</span><span class="w"> </span><span class="n">to_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">person2</span><span class="p">,</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">call_count</span><span class="p">,</span><span class="nf">SUM</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_duration</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">from_id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">to_id</span><span class="p">,</span><span class="w"> </span><span class="n">from_id</span><span class="p">,</span><span class="w"> </span><span class="n">to_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">from_id</span><span class="p">,</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">from_id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">to_id</span><span class="p">,</span><span class="w"> </span><span class="n">to_id</span><span class="p">,</span><span class="w"> </span><span class="n">from_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">to_id</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">Calls</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">from_id</span><span class="p">,</span><span class="w"> </span><span class="n">to_id</span><span class="w">
</span></span></span></code></pre></div><h3 id="æ’åºå’Œåˆ†ç»„">æ’åºå’Œåˆ†ç»„<a hidden class="anchor" aria-hidden="true" href="#æ’åºå’Œåˆ†ç»„">#</a></h3>
<h4 id="é“¶è¡Œè´¦æˆ·æ¦‚è¦-ii"><a href="https://leetcode.cn/problems/bank-account-summary-ii/">é“¶è¡Œè´¦æˆ·æ¦‚è¦ II</a><a hidden class="anchor" aria-hidden="true" href="#é“¶è¡Œè´¦æˆ·æ¦‚è¦-ii">#</a></h4>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆ, æŠ¥å‘Šä½™é¢é«˜äº 10000 çš„æ‰€æœ‰ç”¨æˆ·çš„åå­—å’Œä½™é¢. è´¦æˆ·çš„ä½™é¢ç­‰äºåŒ…å«è¯¥è´¦æˆ·çš„æ‰€æœ‰äº¤æ˜“çš„æ€»å’Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Users</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">account</span><span class="p">,</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">balance</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="k">Group</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">account</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">trans</span><span class="w"> </span><span class="k">On</span><span class="w"> </span><span class="n">Users</span><span class="p">.</span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans</span><span class="p">.</span><span class="n">account</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="k">Where</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="w">
</span></span></span></code></pre></div><h4 id="æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±"><a href="https://leetcode.cn/problems/duplicate-emails/">æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±</a><a hidden class="anchor" aria-hidden="true" href="#æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±">#</a></h4>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæ¥æŠ¥å‘Šæ‰€æœ‰é‡å¤çš„ç”µå­é‚®ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Email</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">By</span><span class="w"> </span><span class="n">email</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></div><h4 id="åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”"><a href="https://leetcode.cn/problems/actors-and-directors-who-cooperated-at-least-three-times/">åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”</a><a hidden class="anchor" aria-hidden="true" href="#åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”">#</a></h4>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡ºåˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”çš„ id å¯¹ <code>(actor_id, director_id)</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">actor_id</span><span class="p">,</span><span class="w"> </span><span class="n">director_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">ActorDirector</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">actor_id</span><span class="p">,</span><span class="w"> </span><span class="n">director_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span></code></pre></div><p>æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡</p>
<p>67æœˆï¼Œæ¯ä¸ªæœˆå‡æ¶ˆè´¹è‡³å°‘100çš„ç”¨æˆ·</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Customers</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Customers</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="c1"># å…¶ä¸­
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">quantity</span><span class="o">*</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Product</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">month</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="nf">month</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">       </span><span class="nf">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="nf">month</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w">
</span></span></span></code></pre></div><h4 id="å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶">å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶<a hidden class="anchor" aria-hidden="true" href="#å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶">#</a></h4>
<p>åˆ†æ­¥å®ç°ï¼š</p>
<p>1ï¸âƒ£ å°†å‘¼å«\æ¥å¬è”åˆ</p>
<p>2ï¸âƒ£ å°†å¯¹åº”äººå‘˜åŠå…¶å›½å®¶å‡†å¤‡å¥½</p>
<p>3ï¸âƒ£ å†æ¬¡è¿æ¥ï¼Œå¹¶æŒ‰å›½å®¶åˆ†ç»„ä¸”èšåˆ(HAVINGè¿›è¡Œæ¡ä»¶ç­›é€‰)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">country</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">caller_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">call_id</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Calls</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">callee_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">call_id</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Calls</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">Country</span><span class="p">.</span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="nf">SUBSTR</span><span class="p">(</span><span class="n">phone_number</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country_code</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">call_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="k">Group</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="nf">AVG</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">AVG</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Calls</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h3 id="é«˜çº§æŸ¥è¯¢å’Œè¿æ¥">é«˜çº§æŸ¥è¯¢å’Œè¿æ¥<a hidden class="anchor" aria-hidden="true" href="#é«˜çº§æŸ¥è¯¢å’Œè¿æ¥">#</a></h3>
<p><code>HAVING</code> å­å¥ç”¨æ¥å¯¹ <strong>èšåˆç»“æœ</strong> è¿›è¡Œè¿‡æ»¤ï¼Œè€Œ <code>HAVING</code> å­å¥æ— æ³•ç›´æ¥ä½¿ç”¨éèšåˆåˆ—</p>
<h4 id="é¡µé¢æ¨è">é¡µé¢æ¨è<a hidden class="anchor" aria-hidden="true" href="#é¡µé¢æ¨è">#</a></h4>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œå‘<code>user_id</code> = 1 çš„ç”¨æˆ·ï¼Œæ¨èå…¶æœ‹å‹ä»¬å–œæ¬¢çš„é¡µé¢ã€‚ä¸è¦æ¨èè¯¥ç”¨æˆ·å·²ç»å–œæ¬¢çš„é¡µé¢ã€‚</p>
<p>å…ˆfindä»–çš„æ‰€æœ‰æœ‹å‹ã€‚ ä»–-&gt;æœ‹å‹ and æœ‹å‹ -&gt;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">page_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recommended_page</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">user2_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Friendship</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user1_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">user1_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Friendship</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user2_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">fs</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Likes</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ls</span><span class="p">.</span><span class="n">user_id</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">page_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">page_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Likes</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">recommended_page</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><h4 id="æ ‘èŠ‚ç‚¹"><a href="https://leetcode.cn/problems/tree-node/">æ ‘èŠ‚ç‚¹</a><a hidden class="anchor" aria-hidden="true" href="#æ ‘èŠ‚ç‚¹">#</a></h4>
<p>CASE &hellip; END  æŒ‰åˆ—æ¥ï¼Œæ¯æ¬¡å¤„ç†åˆ—çš„ä¸€ä¸ªå…ƒç´ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s2">&#34;Root&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">atree</span><span class="p">.</span><span class="n">p_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="n">atree</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s2">&#34;Inner&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="s2">&#34;Leaf&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">type</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Tree</span><span class="w"> 
</span></span></span></code></pre></div><h4 id="æ¸¸æˆç©æ³•åˆ†æ-iii"><a href="https://leetcode.cn/problems/game-play-analysis-iii/">æ¸¸æˆç©æ³•åˆ†æ III</a><a hidden class="anchor" aria-hidden="true" href="#æ¸¸æˆç©æ³•åˆ†æ-iii">#</a></h4>
<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶æŠ¥å‘Šæ¯ç»„ç©å®¶å’Œæ—¥æœŸï¼Œä»¥åŠç©å®¶åˆ° <strong>ç›®å‰ä¸ºæ­¢</strong> ç©äº†å¤šå°‘æ¸¸æˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç©å®¶åœ¨è¯¥æ—¥æœŸä¹‹å‰æ‰€ç©çš„æ¸¸æˆæ€»æ•°ã€‚è¯¦ç»†æƒ…å†µè¯·æŸ¥çœ‹ç¤ºä¾‹ã€‚</p>
<p>åˆ©ç”¨ç¬›å¡å°”ç§¯ï¼Œ è‡ªå·±è·Ÿè‡ªå·±æ‰€æœ‰çš„è®°å½•è¿›è¡Œè¿æ¥ã€‚æš´åŠ›éå†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">event_date</span><span class="p">,</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">a2</span><span class="p">.</span><span class="n">games_played</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">games_played_so_far</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="n">a2</span><span class="w">  </span><span class="c1"># ç¬›å¡å„¿ç§¯ï¼Œo(n) x o(n) = o(n^2) æ¡çºªå½•
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">player_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a2</span><span class="p">.</span><span class="n">player_id</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">event_date</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">a2</span><span class="p">.</span><span class="n">event_date</span><span class="w">   </span><span class="c1"># åªè¦è‡ªå·±å’Œè‡ªå·±è¿›è¡Œè¿æ¥çš„è®°å½•
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">event_date</span><span class="w">
</span></span></span></code></pre></div><h4 id="å¤§æ»¡è´¯æ•°é‡"><a href="https://leetcode.cn/problems/grand-slam-titles/">å¤§æ»¡è´¯æ•°é‡</a><a hidden class="anchor" aria-hidden="true" href="#å¤§æ»¡è´¯æ•°é‡">#</a></h4>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ¯ä¸€ä¸ªçƒå‘˜<strong>èµ¢</strong>å¾—å¤§æ»¡è´¯<strong>æ¯”èµ›çš„æ¬¡æ•°</strong>ã€‚ç»“æœä¸åŒ…å«æ²¡æœ‰èµ¢å¾—æ¯”èµ›çš„çƒå‘˜çš„ID ã€‚</p>
<p>æ€è·¯ï¼š è¡Œ -&gt; åˆ— å†èšåˆ</p>
<pre tabindex="0"><code>Players è¡¨ï¼š
+-----------+-------------+
| player_id | player_name |
+-----------+-------------+
| 1         | Nadal       |
| 2         | Federer     |
| 3         | Novak       |
+-----------+-------------+
Championships è¡¨ï¼š
+------+-----------+---------+---------+---------+
| year | Wimbledon | Fr_open | US_open | Au_open |
+------+-----------+---------+---------+---------+
| 2018 | 1         | 1       | 1       | 1       |
| 2019 | 1         | 1       | 2       | 2       |
| 2020 | 2         | 1       | 2       | 2       |
+------+-----------+---------+---------+---------+
è¾“å‡ºï¼š
+-----------+-------------+-------------------+
| player_id | player_name | grand_slams_count |
+-----------+-------------+-------------------+
| 2         | Federer     | 5                 |
| 1         | Nadal       | 7                 |
+-----------+-------------+-------------------+
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="n">player_name</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">grand_slams_count</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">grand_slams_count</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Wimbledon</span><span class="w"> </span><span class="n">player_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Championships</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Fr_open</span><span class="w"> </span><span class="n">player_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Championships</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">US_open</span><span class="w"> </span><span class="n">player_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Championships</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Au_open</span><span class="w"> </span><span class="n">player_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Championships</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rec</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">rec</span><span class="p">.</span><span class="n">player_id</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">res</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Players</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">player_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="n">player_id</span><span class="w">
</span></span></span></code></pre></div><h4 id="åº”è¯¥è¢«ç¦æ­¢çš„-leetflex-è´¦æˆ·"><a href="https://leetcode.cn/problems/leetflex-banned-accounts/"> åº”è¯¥è¢«ç¦æ­¢çš„ Leetflex è´¦æˆ·</a><a hidden class="anchor" aria-hidden="true" href="#åº”è¯¥è¢«ç¦æ­¢çš„-leetflex-è´¦æˆ·">#</a></h4>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŸ¥æ‰¾é‚£äº›åº”è¯¥è¢«ç¦æ­¢çš„Leetflexå¸æˆ·ç¼–å· <code>account_id</code> ã€‚ å¦‚æœæŸä¸ªå¸æˆ·åœ¨æŸä¸€æ—¶åˆ»ä»ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œåœ°å€ç™»å½•äº†ï¼Œåˆ™è¿™ä¸ªå¸æˆ·åº”è¯¥è¢«ç¦æ­¢ã€‚</p>
<pre tabindex="0"><code>LogInfo table:
+------------+------------+---------------------+---------------------+
| account_id | ip_address | login               | logout              |
+------------+------------+---------------------+---------------------+
| 1          | 1          | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 |
| 1          | 2          | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 |
| 2          | 6          | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 |
| 2          | 7          | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 |
| 3          | 9          | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 |
| 3          | 13         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |
| 4          | 10         | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 |
| 4          | 11         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |
+------------+------------+---------------------+---------------------+
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">AND</span><span class="w"> </span><span class="p">((</span><span class="n">a</span><span class="p">.</span><span class="n">login</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">login</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">logout</span><span class="p">)</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">logout</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">login</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">logout</span><span class="p">))</span><span class="w">
</span></span></span></code></pre></div><p><strong>GROUP BY åˆ†ç»„</strong></p>
<p><strong>HAVING ä½œç”¨äºç»„ï¼ŒæŒ‘é€‰æŒ‡å®šçš„ç»„</strong></p>
<h3 id="å­æŸ¥è¯¢">å­æŸ¥è¯¢<a hidden class="anchor" aria-hidden="true" href="#å­æŸ¥è¯¢">#</a></h3>
<h4 id="å„éƒ¨é—¨æœ€é«˜æ”¶å…¥çš„å‘˜å·¥-å¯èƒ½æœ‰å¤šä¸ª">å„éƒ¨é—¨æœ€é«˜æ”¶å…¥çš„å‘˜å·¥ (å¯èƒ½æœ‰å¤šä¸ª)<a hidden class="anchor" aria-hidden="true" href="#å„éƒ¨é—¨æœ€é«˜æ”¶å…¥çš„å‘˜å·¥-å¯èƒ½æœ‰å¤šä¸ª">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Department</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Employee</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">salary</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Salary</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="n">e1</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Department</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">departmentId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="n">e2</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">departmentId</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">departmentId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">departmentId</span><span class="w">
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>æ•ˆç‡ä¸é«˜ï¼ï¼ï¼</p>
<p>ä¼˜åŒ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Department</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Employee</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">salary</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Salary</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="n">e1</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Department</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">departmentId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">departmentId</span><span class="p">,</span><span class="n">e1</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">departmentId</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="n">e2</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">departmentId</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p><img alt="image-20241123202209491" loading="lazy" src="http://sthda9dn6.hd-bkt.clouddn.com/Fic8qb3rJO4MKNDEcSJxAHSLTfx8"></p>
<p>ç”Ÿæˆä¸´æ—¶è¡¨ï¼ˆé¿å…å­æŸ¥è¯¢ é‡å¤çš„æ‰§è¡Œï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">MaxSalaries</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">departmentId</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">max_salary</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">departmentId</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h4 id="æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•"><a href="https://leetcode.cn/problems/the-most-recent-orders-for-each-product/">æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•</a><a hidden class="anchor" aria-hidden="true" href="#æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•">#</a></h4>
<p>å¯èƒ½æœ‰å¤šä¸ª</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">With</span><span class="w"> </span><span class="n">LatestDate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_date</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">LatestDate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ld</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ld</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ld</span><span class="p">.</span><span class="n">order_date</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_name</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><h4 id="æœ€è¿‘çš„ä¸‰ç¬”è®¢å•">æœ€è¿‘çš„ä¸‰ç¬”è®¢å•<a hidden class="anchor" aria-hidden="true" href="#æœ€è¿‘çš„ä¸‰ç¬”è®¢å•">#</a></h4>
<p>å­¦ä¹ ï¼Œ å¯åˆ†ç»„æ‰“indexæ ‡è®°ï¼Œæ ‡è®°æŒ‰ç…§ORDERé¡ºåº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="nf">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">	</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p><img alt="image-20241123210524866" loading="lazy" src="http://sthda9dn6.hd-bkt.clouddn.com/FuHsPK9Jy0sbdBP2KV1F8HIHvJwm"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">ORDER_INFO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nf">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">row_num</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_date</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">ORDER_INFO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">row_num</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></div><p>å…ˆç”Ÿæˆä¸´æ—¶è¡¨ï¼Œé¿å…é‡å¤ç”Ÿæˆå­æŸ¥è¯¢</p>
<h4 id="æ¯å¤©çš„æœ€å¤§é‡‘é¢">æ¯å¤©çš„æœ€å¤§é‡‘é¢<a hidden class="anchor" aria-hidden="true" href="#æ¯å¤©çš„æœ€å¤§é‡‘é¢">#</a></h4>
<p>å…ˆç­›é€‰å‡ºæ¯å¤©çš„æœ€å¤§é‡‘é¢ï¼Œå†æ‰§è¡Œåç»­çš„åˆ¤æ–­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">MAX_AMOUNT</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="kt">DATE</span><span class="p">(</span><span class="o">`</span><span class="n">day</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">day</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">max_amount</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">DATE</span><span class="p">(</span><span class="o">`</span><span class="n">day</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">transaction_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">MAX_AMOUNT</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ma</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="kt">DATE</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">day</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ma</span><span class="p">.</span><span class="n">day</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="kt">DATE</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">day</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ma</span><span class="p">.</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">ma</span><span class="p">.</span><span class="n">max_amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">transaction_id</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><p>ç›´æ¥ç»™æ¯å¤©çš„ è®¢å•ï¼ŒæŒ‰ç…§é‡‘é¢ï¼Œ æ‰“indexæ ‡è®°</p>
<p>â— RANK ç›¸åŒå€¼ä¼šè·å¾—ç›¸åŒçš„æ’å</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="nf">RANK</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> 
</span></span></span></code></pre></div><p>è€Œ ROW_NUMBERï¼Œidxä¸¥æ ¼é€’å¢</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">Temp</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">transaction_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">day</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nf">rank</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">DATE</span><span class="p">(</span><span class="o">`</span><span class="n">day</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">idx</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">transaction_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Temp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">transaction_id</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><hr>
<h3 id="çª—å£å‡½æ•°å’Œå…¬å…±è¡¨è¡¨è¾¾å¼">çª—å£å‡½æ•°å’Œå…¬å…±è¡¨è¡¨è¾¾å¼<a hidden class="anchor" aria-hidden="true" href="#çª—å£å‡½æ•°å’Œå…¬å…±è¡¨è¡¨è¾¾å¼">#</a></h3>
<h4 id="é¡¹ç›®å‘˜å·¥-iii"><a href="https://leetcode.cn/problems/project-employees-iii/"> é¡¹ç›®å‘˜å·¥ III</a><a hidden class="anchor" aria-hidden="true" href="#é¡¹ç›®å‘˜å·¥-iii">#</a></h4>
<p>æ‰¾å‡ºæ¯ä¸ªé¡¹ç›® <strong>ç»éªŒæœ€ä¸°å¯Œçš„å‘˜å·¥(å¯èƒ½æœ‰å¤šä¸ª)</strong></p>
<p>ç›´æ¥1. åˆ†é¡¹ç›® 2. é¡¹ç›®å†…æŒ‰ç»éªŒç¨‹åº¦è¿›è¡ŒRANK 3. å†ç­›é€‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">Temp</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nf">RANK</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">project_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">experience_years</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">idx</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Project</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Temp</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></div><h4 id="æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“"><a href="https://leetcode.cn/problems/the-most-frequently-ordered-products-for-each-customer/">æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“</a><a hidden class="anchor" aria-hidden="true" href="#æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“">#</a></h4>
<p><img alt="image-20241123220011980" loading="lazy" src="http://sthda9dn6.hd-bkt.clouddn.com/FrHfIlb60X2tBlwp4ZKyTO3Gjq_b"></p>
<p>ä¸»SQL GROUP BY ä¹‹åï¼Œä¸ RANK() çš„æ“ä½œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="n">product_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_count</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="nf">RANK</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RK</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>ç»“æœï¼š</p>
<p><img alt="image-20241123220106683" loading="lazy" src="http://sthda9dn6.hd-bkt.clouddn.com/Fr4AA3oRXuQHg-x2t0VztB5gF9kd"></p>
<p>æ·»åŠ  PARTITION BY customer_id è¿›è¡Œéš”ç¦»</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="n">product_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_count</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="nf">RANK</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RK</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>ç»“æœï¼š</p>
<p><img alt="image-20241123220202936" loading="lazy" src="http://sthda9dn6.hd-bkt.clouddn.com/FiZarXoCwCQwP7-J8FqBhWKmZPxb"></p>
<p>=&gt; ç»“è®ºã€‚ 1. å…ˆæ‰§è¡Œä¸»SQLçš„GROUP BYï¼Œè¿›è¡Œåˆ†åŒºï¼Œå†RANK(), RANK()æŒ‰ç…§ ORDER BY(å¿…é¡»èšåˆä¸ºå•è¡Œ)è¿›è¡Œæ’åºï¼Œ åˆ©ç”¨PARTITIONè¿›è¡Œæ’åºéš”ç¦»ã€‚</p>
<p>ç­”æ¡ˆ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">Temp</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">        </span><span class="n">product_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">        </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_count</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">        </span><span class="nf">RANK</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RK</span><span class="w">  
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_name</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Temp</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">RK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c1"># æœ€é«˜çš„ NO.1
</span></span></span></code></pre></div><hr>
<h4 id="è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ"><a href="https://leetcode.cn/problems/biggest-window-between-visits/">è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ</a><a hidden class="anchor" aria-hidden="true" href="#è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ">#</a></h4>
<p>LEAD(column, offset, defualt) OVER (PARTITION BY &hellip; ORDER BY &hellip;) æ‰¾åé¢çš„è¡Œã€‚å…¶ä¸­LEADè¡¨ç¤ºå¼•é¢†ã€‚</p>
<p>LAG(&hellip;)   æ‰¾å‰é¢çš„è¡Œï¼Œ æ»å</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="nf">DATEDIFF</span><span class="p">(</span><span class="n">after_day</span><span class="p">,</span><span class="w"> </span><span class="n">visit_date</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">biggest_window</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">visit_date</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nf">LEAD</span><span class="p">(</span><span class="n">visit_date</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2021-1-1&#39;</span><span class="p">)</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">visit_date</span><span class="w"> </span><span class="k">ASC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">after_day</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">UserVisits</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">uv</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span></code></pre></div><p>è€ƒç‚¹ï¼šè¡Œä¹‹é—´çš„å·®å€¼</p>
<hr>
<p><strong>CTE Common Table Expression</strong></p>
<h4 id="å‘å…¬å¸-ceo-æ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº"><a href="https://leetcode.cn/problems/all-people-report-to-the-given-manager/">å‘å…¬å¸ CEO æ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº</a><a hidden class="anchor" aria-hidden="true" href="#å‘å…¬å¸-ceo-æ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº">#</a></h4>
<p>æŸ¥è¯¢æ ‘çŠ¶ç»“æ„èŠ‚ç‚¹  åˆ—è½¬è¡Œ</p>
<p>ä¾æ¬¡æš´åŠ›æšä¸¾</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">              </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">              </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e1</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">            </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">                </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">                </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">                      </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">                      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e2</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">            </span><span class="p">))</span><span class="w"> </span><span class="n">e3</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span></code></pre></div><p>å¤ªä½æ•ˆäº†ï¼ï¼ï¼ SBæ“ä½œï¼Œç–¯ç‹‚è¿ç»­æŸ¥è¯¢</p>
<p>ä¼˜åŒ–</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c1"># âœ”ï¸
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">            </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span></code></pre></div><hr>
<p>åˆ©ç”¨è¿æ¥æ¥è®¡ç®—</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">e4</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w"> </span><span class="n">e1</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employees</span><span class="w"> </span><span class="n">e2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">manager_id</span><span class="w">  
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employees</span><span class="w"> </span><span class="n">e3</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e3</span><span class="p">.</span><span class="n">manager_id</span><span class="w">  
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employees</span><span class="w"> </span><span class="n">e4</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e3</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e4</span><span class="p">.</span><span class="n">manager_id</span><span class="w">  
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">e4</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">1</span><span class="w"> </span><span class="n">Boss</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    	</span><span class="n">1</span><span class="w"> </span><span class="n">Boss</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">                       </span><span class="n">1</span><span class="w"> </span><span class="n">Boss</span><span class="w">                 </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">                           					     </span><span class="n">1</span><span class="w"> </span><span class="n">Boss</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">                                                 </span><span class="n">2</span><span class="w"> </span><span class="n">Bob</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">       											 </span><span class="n">77</span><span class="w"> </span><span class="n">Robert</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">                       </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">                       </span><span class="n">2</span><span class="w"> </span><span class="n">Bob</span><span class="w">                  </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">4</span><span class="w"> </span><span class="n">Daniel</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        			   </span><span class="n">77</span><span class="w"> </span><span class="n">Robert</span><span class="w">              </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="n">2</span><span class="w"> </span><span class="n">Bob</span><span class="w">       </span><span class="o">=&gt;</span><span class="w">  </span><span class="n">4</span><span class="w"> </span><span class="n">Daniel</span><span class="w">              </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">null</span><span class="w">   
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="n">77</span><span class="w"> </span><span class="n">Robert</span><span class="w">   </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">null</span><span class="w">                   </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">null</span><span class="w">   
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="å¯»æ‰¾è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸä½ç½®">å¯»æ‰¾è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸä½ç½®<a hidden class="anchor" aria-hidden="true" href="#å¯»æ‰¾è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸä½ç½®">#</a></h4>
<p>æ€è·¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">data</span><span class="p">:</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="n">idx</span><span class="w"> </span><span class="p">:</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">diff</span><span class="p">:</span><span class="w">  </span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">   </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nf">MIN</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Start_ID</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">End_ID</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">Temp</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">log_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="nf">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="nf">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">log_id</span><span class="w"> </span><span class="k">ASC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">idx</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Logs</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MIN</span><span class="p">(</span><span class="n">log_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">start_id</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">log_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">end_id</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">log_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">log_id</span><span class="o">-</span><span class="n">idx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">diff</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Temp</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">diff</span><span class="w">
</span></span></span></code></pre></div><h4 id="æŸ¥æ‰¾å¤„äºæˆç»©ä¸­æ¸¸çš„å­¦ç”Ÿ">æŸ¥æ‰¾å¤„äºæˆç»©ä¸­æ¸¸çš„å­¦ç”Ÿ<a hidden class="anchor" aria-hidden="true" href="#æŸ¥æ‰¾å¤„äºæˆç»©ä¸­æ¸¸çš„å­¦ç”Ÿ">#</a></h4>
<p>å‚åŠ çš„è€ƒè¯•ï¼Œæ²¡æœ‰ä¸€ç§‘æ˜¯æœ€é«˜åˆ†æˆ–è€…æœ€ä½åˆ†ã€‚ç§‘ç§‘ä¸­ç­‰</p>
<p>é€»è¾‘ï¼š 1. åˆ¤æ–­æ¯ä¸€ç§‘ï¼Œå†ç»Ÿè®¡æ‰€æœ‰ç§‘ç›®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">MAXMIN</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">exam_id</span><span class="p">,</span><span class="w"> </span><span class="nf">MIN</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="n">min_score</span><span class="p">,</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="n">max_score</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Exam</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">exam_id</span><span class="w">  
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">  
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">student_name</span><span class="w">  
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">exam_id</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">student_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">min_score</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">max_score</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    </span><span class="n">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_medium</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Exam</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">MAXMIN</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">exam_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">exam_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Student</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">student_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">student_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">student_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">is_medium</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">is_medium</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">student_id</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><p>åè¿‡æ¥ï¼š å°†å°–å­ç”Ÿå’Œå«åº•ç”Ÿæ’é™¤åœ¨å¤–å³å¯</p>
<hr>
<h4 id="å¯»æ‰¾æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¯¹"><a href="https://leetcode.cn/problems/find-the-subtasks-that-did-not-execute/">å¯»æ‰¾æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¯¹</a><a hidden class="anchor" aria-hidden="true" href="#å¯»æ‰¾æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¯¹">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">recursive</span><span class="w"> </span><span class="nf">all_subtask</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span><span class="w"> </span><span class="n">subtask_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">task_id</span><span class="p">,</span><span class="w"> </span><span class="n">subtasks_count</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">		</span><span class="k">FROM</span><span class="w"> </span><span class="n">Tasks</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">		
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">task_id</span><span class="p">,</span><span class="w"> </span><span class="n">subtask_id</span><span class="o">-</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">		</span><span class="k">FROM</span><span class="w"> </span><span class="n">all_subtask</span><span class="w"> 
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">		</span><span class="k">where</span><span class="w"> </span><span class="n">subtask_id</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">task_id</span><span class="p">,</span><span class="w"> </span><span class="n">subtask_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="k">From</span><span class="w"> </span><span class="n">all_subtask</span><span class="w"> 
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span><span class="w"> </span><span class="n">subtask_id</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">task_id</span><span class="p">,</span><span class="w"> </span><span class="n">subtask_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Executed</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">recursive</span><span class="w"> </span><span class="nf">TableName</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span><span class="w"> </span><span class="n">param2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="n">param1</span><span class="p">,</span><span class="w"> </span><span class="n">param2</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">åŸºç¡€ç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">	</span><span class="k">FROM</span><span class="w"> </span><span class="n">BaseTable</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="err">ä¸‹é¢å¼å­ä¼šè¢«é‡å¤é€’å½’</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">param1</span><span class="p">,</span><span class="w"> </span><span class="n">param2</span><span class="o">-</span><span class="mi">1</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">æ–°çš„ç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">TableName</span><span class="w">         </span><span class="o">//</span><span class="w"> </span><span class="err">ä¸Šä¸€è½®çš„ç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">param2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">é€’å½’ç»ˆæ­¢æ¡ä»¶</span><span class="w">
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://longcoding.top/tags/sql/">SQL</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://longcoding.top/posts/jobs/java/">
    <span class="title">Â« Prev</span>
    <br>
    <span>Javaé¢è¯•é¢˜ç¬”è®°</span>
  </a>
  <a class="next" href="http://longcoding.top/posts/learning/minibaseline_learning/">
    <span class="title">Next Â»</span>
    <br>
    <span>DLåŸºå‡†æ¨¡å‹è®­ç»ƒä¼ªä»£ç </span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://longcoding.top/">LongCoding&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
