[{"content":"docker 1service docker start 2 3docker pull \u0026lt;é•œåƒåç§°\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt; 4 5docker rmi \u0026lt;é•œåƒåç§°æˆ–ID\u0026gt; 6 7docker images 8 9docker run [é€‰é¡¹] \u0026lt;é•œåƒåç§°\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt; 10 11docker start \u0026lt;å®¹å™¨åç§°æˆ–ID\u0026gt; 12 13docker ps 14 15docker exec -it \u0026lt;å®¹å™¨åç§°æˆ–ID\u0026gt; /bin/bash # execute -it:Interactive and Teletypewriter äº¤äº’å¼\u0026amp;ä¼ªç»ˆç«¯ Linux æ–‡ä»¶å’Œç›®å½•\n1ls -l # -l:è¯¦ç»†ä¿¡æ¯ 2cd 3pwd # å½“å‰ç›®å½• 4mkdir/vim 5rm/rmdir 6cp mv æ–‡ä»¶æƒé™\n1chmod # Change Mode # chmod u+rwx file.txt x:Execute 2chown ç³»ç»Ÿå‘½ä»¤\n1ps -ef # e:all -f full info 2ps -u $USER 3ps -ef | grep \u0026lt;info\u0026gt; # global regular expression print 4 5htop # æ˜¾ç¤ºç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ ç½‘ç»œç®¡ç†\n1ping 2ifconfig 3netstat # ç½‘ç»œè¿æ¥ä¿¡æ¯ å‹ç¼©è§£å‹\n1tar -czvf archive.tar.gz folder_name # å‹ç¼© 2tar -xzvf archive.tar.gz # è§£å‹ 3 4-c: # create åˆ›å»º 5-x: # extractè§£å‹ 6-z: # ä½¿ç”¨gzipå‹ç¼© 7-v: # verboseæ˜¾ç¤º[è¯¦ç»†]ä¿¡æ¯ 8-fï¼š# file æŒ‡å®šæ–‡ä»¶å æ‚é¡¹\n1history 2echo 3clear Git Git æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ”¯æŒå¤šäººåä½œå¼€å‘ã€‚\n1git init 2git clone --link 3git status 4æ·»åŠ æ–‡ä»¶ï¼šgit add file æˆ–è€… git add . 5æäº¤æ–‡ä»¶ï¼šgit commit -m \u0026#34;commit msg\u0026#34; 6git push 7git pull 8git log 9 10// branch åˆ†æ”¯ 11git branch \u0026lt;åˆ†æ”¯å\u0026gt; 12git checkout \u0026lt;åˆ†æ”¯å\u0026gt; // åˆ‡æ¢åˆ†æ”¯ 13git merge \u0026lt;åˆ†æ”¯å\u0026gt; 14-- æ‰‹åŠ¨ç¼–è¾‘å†²çªæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ git add æ ‡è®°å†²çªå·²è§£å†³ï¼Œæœ€åæäº¤æ›´æ”¹ã€‚ Shell æ¡ä»¶åˆ¤æ–­\n1#!/bin/bash 2if [ -f \u0026#34;file.txt\u0026#34; ]; then 3 echo \u0026#34;file.txt exists.\u0026#34; 4else 5 echo \u0026#34;file.txt not exists.\u0026#34; 6fi 7 8# -f æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ 9 10#!/bin/bash 11num=10 12if [ $num -gt 5 ]; then 13 echo \u0026#34;$num is greater than 5.\u0026#34; 14fi 15 16-gt # greater than å¾ªç¯\n1#!/bin/bash 2num=(1 2 3 4 5) 3for i in \u0026#34;${num[@]}\u0026#34;; do # æ˜¯ç”¨äºå¼•ç”¨æ•°ç»„ num ä¸­æ‰€æœ‰å…ƒç´ çš„æ–¹å¼ 4 echo \u0026#34;number: $i\u0026#34; 5done 6------------------------ 7#!/bin/bash 8if [ $# -eq 0 ]; then 9 echo \u0026#34;Usage: $0 \u0026lt;n1\u0026gt; \u0026lt;n2\u0026gt;\u0026#34; 10 exit 1 11fi 12 13for i in \u0026#34;$@\u0026#34;; do 14 echo \u0026#34;number: $i\u0026#34; 15done 16 17# $# è¡¨ç¤ºä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‘½ä»¤è¡Œå‚æ•°çš„æ•°é‡ $@ æ‰€æœ‰å‚æ•° 18=\u0026gt; ./script.sh 1 2 3 Where\n1#!/bin/bash 2count=1 3while [ $count -le 5 ]; do 4 echo \u0026#34;Count: $count\u0026#34; 5 count=$((count + 1)) 6done å‡½æ•°\n1#!/bin/bash 2greet() { 3 echo \u0026#34;Hello, $1!\u0026#34; 4} 5greet \u0026#34;Alice\u0026#34; 6greet \u0026#34;Bob\u0026#34; è¯»å†™æ–‡ä»¶\n1echo \u0026#34;Hello, File!\u0026#34; \u0026gt; output.txt # writeï¼š\u0026gt; è¦†ç›– \u0026gt;\u0026gt; è¿½åŠ  2 3while read line; do 4 echo \u0026#34;Line: $line\u0026#34; 5done \u0026lt; file.txt # è¯»æ–‡ä»¶ è¯»å–è¾“å…¥\n1echo \u0026#34;Enter your name:\u0026#34; 2read name # ç±»ä¼¼scanf æ§åˆ¶å°é˜»å¡ç­‰å¾… 3echo \u0026#34;Hello, $name!\u0026#34; 4 5read -s -p \u0026#34;Enter your password: \u0026#34; password 6echo \u0026#34;Password entered.\u0026#34; 7 8# s é™é»˜ï¼Œä¸æ˜¾ç¤ºä¿¡æ¯ pæ˜¾ç¤ºæç¤ºä¿¡æ¯ ","permalink":"http://longcoding.top/posts/learning/common_commands/","summary":"\u003ch3 id=\"docker\"\u003edocker\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003eservice docker start\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003edocker pull \u0026lt;é•œåƒåç§°\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003edocker rmi \u0026lt;é•œåƒåç§°æˆ–ID\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003edocker images\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003edocker run \u003cspan class=\"o\"\u003e[\u003c/span\u003eé€‰é¡¹\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u0026lt;é•œåƒåç§°\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003edocker start \u0026lt;å®¹å™¨åç§°æˆ–ID\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e12\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e13\u003c/span\u003e\u003cspan class=\"cl\"\u003edocker ps\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e14\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e15\u003c/span\u003e\u003cspan class=\"cl\"\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it \u0026lt;å®¹å™¨åç§°æˆ–ID\u0026gt; /bin/bash \u003cspan class=\"c1\"\u003e# execute -it:Interactive and Teletypewriter äº¤äº’å¼\u0026amp;ä¼ªç»ˆç«¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"linux\"\u003eLinux\u003c/h3\u003e\n\u003cp\u003eæ–‡ä»¶å’Œç›®å½•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003els -l \u003cspan class=\"c1\"\u003e# -l:è¯¦ç»†ä¿¡æ¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003epwd\u003c/span\u003e \u003cspan class=\"c1\"\u003e# å½“å‰ç›®å½•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003emkdir/vim\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e5\u003c/span\u003e\u003cspan class=\"cl\"\u003erm/rmdir\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e6\u003c/span\u003e\u003cspan class=\"cl\"\u003ecp mv\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ–‡ä»¶æƒé™\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003echmod  \u003cspan class=\"c1\"\u003e# Change Mode  # chmod u+rwx file.txt x:Execute\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003echown\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç³»ç»Ÿå‘½ä»¤\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003eps -ef  \u003cspan class=\"c1\"\u003e# e:all -f full info\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003eps -u \u003cspan class=\"nv\"\u003e$USER\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003eps -ef \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep \u0026lt;info\u0026gt;  \u003cspan class=\"c1\"\u003e# global regular expression print\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e5\u003c/span\u003e\u003cspan class=\"cl\"\u003ehtop  \u003cspan class=\"c1\"\u003e# æ˜¾ç¤ºç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç½‘ç»œç®¡ç†\u003c/p\u003e","title":"Linux\u0026Docker\u0026Shellå‘½ä»¤"},{"content":"6319 HashMap åŸç† æ•°æ®ç»“æ„ï¼šæ•°ç»„ + é“¾è¡¨ ï¼ˆJAVA8ä¹‹åï¼šæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼‰\næ•°æ®ç»“æ„\njdk1.7ï¼šæ•°ç»„+é“¾è¡¨ï¼Œæ•°ç»„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªé“¾è¡¨çš„è¡¨å¤´ï¼Œå½“å‘ç”Ÿå†²çªï¼Œå°†æ–°å…ƒç´ æ·»åŠ åœ¨å¤´éƒ¨(å¤´æ’æ³•) hashå†²çªï¼šå¤´æ’æ³•ï¼Œâ—æ‰©å®¹æ—¶å¯èƒ½é€ æˆç¯å½¢é“¾è¡¨ jdk1.8ï¼š å¼•å…¥çº¢é»‘æ ‘ï¼Œå½“é“¾è¡¨èŠ‚ç‚¹è¶…è¿‡8ä¸ªï¼Œé‚£ä¹ˆè¿™ä¸ªé“¾è¡¨ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚æŸ¥è¯¢æ—¶é—´ç”± O(n) ä¼˜åŒ–ä¸º O(logn)ã€‚å½“èŠ‚ç‚¹å°äº6ä¸ªï¼Œå†è½¬æ¢ä¸ºé“¾è¡¨ã€‚ hashå†²çªï¼šå°¾æ’æ³•ï¼Œé¿å…ç¯å½¢é“¾è¡¨â— æ‰©å®¹æœºåˆ¶ jdk1.7 æ‰©å®¹ï¼Œå…ƒç´ ä¼šé‡æ–°è®¡ç®—hashå€¼ï¼Œå¹¶åˆ†é…åˆ°æ–°çš„æ‰©å®¹æ•°ç»„ä¸­ã€‚â­æ¯”è¾ƒè€—æ—¶ æ‰©å®¹æ—¶ï¼Œå¤´æ’æ³•ï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå¯èƒ½é€ æˆç¯å½¢é“¾è¡¨ jdk1.8 æ‰©å®¹æ—¶ï¼Œåˆ©ç”¨äº†å…ƒç´ å“ˆå¸Œå€¼å’Œæ—§æ•°ç»„å®¹é‡å…³ç³»ï¼Œå‡å°‘äº†é‡æ–°è®¡ç®—çš„å“ˆå¸Œæ¬¡æ•° æ‰©å®¹æ—¶ï¼Œå°¾æ’æ³•ï¼Œé¿å…ç¯å½¢é“¾è¡¨ ä½¿ç”¨é”®çš„hashcode()è®¡ç®—hashå€¼ï¼Œç„¶å(n-1) \u0026amp; hashç¡®å®šæ•°ç»„ä¸­çš„ä½ç½®ã€‚\nn-1 =\u0026gt; 10000 - 1 = 01111 HashMapçš„åˆå§‹é»˜è®¤å®¹é‡ä¸º16ï¼Œè´Ÿè½½å› å­ä¸º0.75ã€‚å½“å­˜å‚¨çš„å…ƒç´ è¾¾åˆ°75%æ—¶ï¼Œè¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹ä¸ºåŸæ¥çš„2å€ç©ºé—´\næ‰©å±•çŸ¥è¯†ï¼š\nhashmapçš„çº¢é»‘æ ‘ä¼˜åŒ–ï¼š\nJAVA8å¼€å§‹ï¼Œä¸ºäº†ä¼˜åŒ–hashå†²çªæ—¶çš„æŸ¥æ‰¾æ€§èƒ½ã€‚ä½†é“¾è¡¨çš„é•¿åº¦è¶…è¿‡8æ—¶ï¼Œé“¾è¡¨ä¼šè½¬å˜ä¸ºçº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ æŸ¥æ‰¾æ—¶é—´ O(n) =\u0026gt; O(logn)ã€‚ å½“å…ƒç´ å°‘äº6ä¸ªï¼Œåˆ‡æ¢ä¸ºé“¾è¡¨ hashCode() å’Œ equals()çš„é‡è¦æ€§ï¼š\nhashCodeè®¡ç®—hashå€¼ï¼Œå†³å®šé”®çš„å­˜å‚¨ä½ç½®ã€‚ è€ŒhashCodeç›¸åŒ=\u0026gt;å†²çªã€‚ equals()æ¯”è¾ƒçš„å€¼ 1// HashMap Node class 2static class Entry\u0026lt;K,V\u0026gt; { 3 final K key; // é”® 4 V value; // å€¼ 5 final int hash; // è®¡ç®—åçš„å“ˆå¸Œå€¼ 6 Entry\u0026lt;K,V\u0026gt; next; // æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼ˆå½¢æˆé“¾è¡¨ï¼‰ 7} ä¸ºä»€ä¹ˆå¤´æ’æ³•\u0026amp;å¤šçº¿ç¨‹\u0026amp;æ‰©å®¹ä¼šé€ æˆç¯å½¢é“¾è¡¨?\n1void transfer(Entry[] newTable) { 2 Entry[] src = table; 3 int newCapacity = newTable.length; 4 for (int j = 0; j \u0026lt; src.length; j++) { // éå†æ—§è¡¨ 5 Entry\u0026lt;K,V\u0026gt; e = src[j]; // å–å‡ºå½“å‰æ¡¶çš„å¤´ç»“ç‚¹ 6 if (e != null) { // æ—§æ¡¶ä¸ä¸ºç©º 7 src[j] = null; // é‡Šæ”¾æ—§æ¡¶çš„å¼•ç”¨ï¼ˆé˜²æ­¢ GC è¯¯å›æ”¶ï¼‰ 8 do { 9 Entry\u0026lt;K,V\u0026gt; next = e.next; // è®°å½•ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ 10 int i = indexFor(e.hash, newCapacity); // è®¡ç®—æ–°ç´¢å¼•ï¼ˆçº¿ç¨‹1æš‚åœï¼‰ 11 e.next = newTable[i]; // å¤´æ’æ³•ï¼šå°† e è¿æ¥åˆ° newTable[i] ä¸Š 12 newTable[i] = e; // å°† e ä½œä¸º newTable[i] çš„æ–°å¤´ 13 e = next; // ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ 14 } while (e != null); // ç›´åˆ°æ—§é“¾è¡¨éå†å®Œ 15 } 16 } 17} 18 19old: [ ][ ][ ] old: [ ][ ][ ] 20 [1] [2] 21 [2] =\u0026gt; 22 23new: [ ][ ][ ] new: [ ][ ][ ] // å¤´æ’æ³•ï¼Œå°†èŠ‚ç‚¹è¿›è¡Œè½¬ç§» 24 [1] 25 26// ç¯çš„æƒ…å†µï¼ŒHashMapå¤šä¸ªçº¿ç¨‹å…±äº« 27Thread1: e -\u0026gt; [1][ ][ ] Thread2: [3][ ][ ] 28 next-\u0026gt; [2] æ‰©å®¹æˆåŠŸ [2] 29 [3] [1] 30 31æ‰§è¡Œ 32{ 33 e.next = newTable[i]; 34 newTable[i] = e; 35 e = next; 36} 37 38newTabel[0] =\u0026gt; [1]-\u0026gt;[3]-\u0026gt;[2]-\u0026gt;[1] 39 â¬†ï¸ â¬…ï¸ â¬…ï¸ 4948 HashMapï¼Œæœ‰å“ªäº›æå‡æ€§èƒ½çš„æŠ€å·§ï¼Ÿ åˆç†è®¾ç½®åˆå§‹å®¹é‡ï¼Œå‡å°‘resizeï¼Œå‡å°‘æ‰©å®¹æ“ä½œã€‚é»˜è®¤16\nè°ƒæ•´è´Ÿè½½å› å­ï¼ŒæŸ¥æ‰¾å¤šçš„è®¾ç½®å°ä¸€ç‚¹ï¼Œå‡å°‘å†²çªæƒ…å†µï¼Œå†²çªå°‘äº†(æŸ¥è¯¢æ•ˆç‡å°±é«˜äº†)ï¼Œä½†ä¼šæé«˜å†…å­˜å ç”¨æƒ…å†µï¼Œåä¹‹äº¦ç„¶ã€‚é»˜è®¤0.75\nç¡®ä¿hashCode(), å‡åŒ€çš„æ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼Œä»¥å‡å°‘hashå†²çªã€‚\næ‰©å±•ï¼š\nå½“å…ƒç´ æ•°é‡ \u0026gt; è£…å¡«å› å­ * æ•°ç»„å¤§å° =\u0026gt; è¿›è¡Œæ‰©å®¹ï¼Œæ–°æ•°ç»„ä¸ºå½“å‰çš„2å€ï¼Œå¹¶æŠŠå½“å‰hashä¸­çš„æ•°æ®é‡æ–°åˆ†é…åˆ°æ–°çš„hashmapä¸­ï¼› LinkedHashMapï¼Œæ‹‰é“¾æ³•ï¼Œèƒ½å¤Ÿä¿å­˜æ’å…¥é¡ºåº ä¿å­˜æœ‰åº =\u0026gt; TreeMap. éœ€è¦çº¿ç¨‹å®‰å…¨ =\u0026gt; ConcurrentHashMap 4947 Hashç¢°æ’ \u0026amp; è§£å†³ ä¸åŒkeyä½¿ç”¨hashcode()\u0026amp;n-1å¾—åˆ°ç›¸åŒçš„å‘ï¼Œç„¶åå†²çª\né“¾åœ°å€æ³•(æ‹‰é“¾æ³•) å¼€æ”¾åœ°å€æ³•ï¼Œé¡ºåºå¾€ä¸‹orå·¦å³æ¨ªè·³ çº¿æ€§æ¢æµ‹ å¹³æ–¹æ¢æµ‹ å†hashæ³•(åŒé‡hash) å‡ºç°ç¢°æ’åï¼Œä½¿ç”¨ç¬¬äºŒä¸ªhashå‡½æ•°è®¡ç®—æ–°çš„ç´¢å¼•ä½ç½®ï¼Œå‡å°‘ç¢°æ’çš„æ¦‚ç‡ã€‚ 4946 CopyOnWriteArrayList \u0026amp; Collections.synchronizeddList åŒºåˆ« CopyOnWriteArrayList æ˜¯çº¿ç¨‹å®‰å…¨çš„Listå®ç°ï¼Œç‰¹æ€§æ˜¯å†™æ—¶å¤åˆ¶\næ¯æ¬¡å¯¹Listçš„ä¿®æ”¹æ“ä½œ(add, remove, set)éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åº•å±‚æ•°ç»„ã€‚ è¯»æ“ä½œä¸éœ€è¦åŠ é”ï¼Œè€Œå†™æ“ä½œéœ€è¦åŠ é”\nä¼˜ç‚¹ï¼š\nè¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œä¼šåˆ›å»ºæ•°ç»„å‰¯æœ¬ =\u0026gt; è¯»å†™ä¸å†²çª â­è¯»æ“ä½œåœ¨å½“å‰æ•°ç»„ä¸Šæ‰§è¡Œï¼› å†™æ“ä½œ(add,set,remove)ä¼šåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œæ–°æ•°ç»„ä¸Šä¿®æ”¹å†æ›¿æ¢æ—§çš„(åŠ é”)ã€‚ ç¼ºç‚¹ï¼š\nå†™æ“ä½œå¼€é”€å¤§ï¼šæ¯æ¬¡å†™æ“ä½œéƒ½ä¼šåˆ›å»ºå¹¶å¤åˆ¶æ–°æ•°ç»„ï¼Œå¹¶ä¸”å°†æ•°æ®å¤åˆ¶åˆ°æ–°çš„æ•°ç»„ä¸­ï¼Œå†™é¢‘ç¹çš„åœºæ™¯ä¸‹æ€§èƒ½ä¼šæ¯”è¾ƒä½ å†…å­˜æ¶ˆè€—å¤§ ğŸ‰é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯\nCollections.synchronizeddList åŒ…è£…æ–¹æ³•ï¼Œå°†ä»»ä½•æ•°ç»„è½¬æ¢ä¸ºçº¿ç¨‹å®‰å…¨çš„ç‰ˆæœ¬ï¼Œä¼šå¯¹æ¯ä¸ªè®¿é—®æ–¹æ³•(get, set, add, remove)è¿›è¡ŒåŒæ­¥(åŠ é”)ï¼Œçº¿ç¨‹å®‰å…¨ã€‚\nä¼˜ç‚¹ï¼š\næ–¹ä¾¿ ç¼ºç‚¹ï¼š\nå¹¶å‘æ•ˆç‡ä½ ğŸ‰é€‚ç”¨äºç®€å•çš„å°†Listè½¬ä¸ºçº¿ç¨‹å®‰å…¨çš„ç‰ˆæœ¬ä½¿ç”¨ã€‚\n444 Javaä¸­æœ‰å“ªäº›é›†åˆç±»ï¼Ÿ Listæ¥å£\nArrayList LinkedList Vector åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œä¸”çº¿ç¨‹å®‰å…¨ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½æ·»åŠ äº†synchronized Setæ¥å£\nHashSet // å†²çªçš„é“¾è¡¨å…ƒç´ æ— åº LinkedHashSet // ç»§æ‰¿HashSetï¼Œåº•å±‚ç”±åŒå‘é“¾è¡¨å®ç°ï¼Œä¿è¯æ’å…¥é¡ºåº TreeSet // åŸºäºçº¢é»‘æ ‘, è‡ªåŠ¨æ’åºï¼Œæä¾›æ’åºåŠŸèƒ½ Queueæ¥å£\nPriorityQueueï¼Œ ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå†…éƒ¨å…ƒç´ æŒ‰çº§åˆ«æ’åºã€‚åªèƒ½æ¯”è¾ƒå™¨ LinkedListï¼Œå¯ä»¥ä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨ï¼ŒFIFO Mapæ¥å£\nHashMap LinkedHashMap TreeMap HashTableä¸æ¨èä½¿ç”¨ï¼Œçº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨ã€‚**æ—©æœŸçº¿ç¨‹å®‰å…¨çš„HashMapï¼Œé”çš„ç²’åº¦ä¸ºæ•´ä¸ªè¡¨ï¼Œè¿™æ ·å¹¶å‘èƒ½åŠ›ä¸é«˜ã€‚**åº•å±‚ä½¿ç”¨synchronizedå…³é”®å­—å®ç° ConcurrentHashMapï¼Œçº¿ç¨‹å®‰å…¨çš„hashmapã€‚ é«˜æ€§èƒ½çš„çº¿ç¨‹å®‰å…¨HashMap æä¾›æ›´ç»†ç²’åº¦çš„é” åˆ†æ®µé”å’ŒCASæ“ä½œ è¯»æ“ä½œä¸åŠ é” å†™æ“ä½œ =\u0026gt; CAS + synchronizedç»†ç²’åº¦é” 9179 ArrayListçš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ é»˜è®¤å®¹é‡10ï¼Œå½“å…ƒç´ æ•°é‡è¶…è¿‡å…¶å½“å‰å®¹é‡ï¼Œä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚ æ‰©å®¹å¤§å°ä¸ºåŸæ•°ç»„çš„1.5å€\n449 HashSet \u0026amp; HashMap HashSetå­˜å‚¨ä¸é‡å¤å…ƒç´  =\u0026gt; ä¸èƒ½å†²çªçš„HashMap\nHashMapï¼ŒK=\u0026gt;V, é”®å”¯ä¸€ï¼Œä½†ä¸åŒé”®çš„å€¼å¯ä»¥ç›¸åŒ\n451 HashMapçš„æ‰©å®¹æœºåˆ¶ è´Ÿè½½å› å­é»˜è®¤0.75, ä½†æ¯”ä¾‹è¶…è¿‡è´Ÿè½½å› å­ï¼Œè¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹ä¸ºåŸæ¥çš„2å€ã€‚\nå½“å‰hashmapä¸­çš„å…ƒç´ åœ¨æ–°hashmapçš„ä½ç½®æ€ä¹ˆè®¡ç®—ï¼Ÿ å°±æ˜¯hashCode() \u0026amp; (n-1) =\u0026gt; hashCode() \u0026amp; (2n-1)\nä¼˜åŒ–è¿‡ç¨‹\n1// example: 2 n:16= 1,0000 n-1: 0,1111 2^4 32n:32=10,0000 2n-1:01,1111 2^5 4 5// é€šè¿‡hashå€¼ \u0026amp; 2n-1: 6// åªè¦åˆ¤æ–­æœ€é«˜ä½æ˜¯å¦å³å¯ 7 8if ç¬¬5ä½== 0ï¼šthen 9 ä½ç½®ä¸å˜ï¼› 10else 11 ä½ç½®åç§»16ä½ 452 ä¸ºä»€ä¹ˆHashMapæ‰©å®¹é‡‡ç”¨2çš„næ¬¡æ–¹ï¼Ÿ è®¡ç®—æ•£åˆ—ä½ç½®å†³å®š=\u0026gt; hashcode \u0026amp; (n-1) å…¶ä¸­ n-1=01111.. å¯ä»¥å°†ä½ç½®æ˜ å°„åˆ°æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä¸Šï¼Œåˆ†å¸ƒå‡åŒ€ã€‚ ä½è¿ç®—æ¯”å–ä½™æ•ˆç‡é«˜\n457 Javaä¸­çš„LinkedhashMap åŸºäºHashMap \u0026amp; åŒå‘é“¾è¡¨ \u0026amp; é¢å¤–çš„é¡ºåºæŒ‡é’ˆ\nğŸ·ï¸ä½œç”¨ï¼šä¿æŒæ’å…¥é¡ºåºorè®¿é—®é¡ºåº\nğŸ’ å®šä¹‰å¦‚ä¸‹ï¼š\n1static class Entry\u0026lt;K,V\u0026gt; extends HashMap.Node\u0026lt;K,V\u0026gt; { 2 Entry\u0026lt;K,V\u0026gt; before, after; 3 Ectry(){...} // constructor 4} ğŸ·ï¸å›¾ç¤ºï¼š\næ„æƒ³=\u0026gt; ç”±äºå¯ä»¥æ ¹æ®æ’å…¥æ—¶é—´æ’åºï¼Œå› æ­¤å¯ä»¥æ¨¡æ‹ŸLRU(least recently used)ç®—æ³•ï¼Œè¿›è¡Œæ·˜æ±°æœ€ä¸å¸¸ç”¨çš„èŠ‚ç‚¹ã€‚\n461 ConcurrentHashMap ğŸ·ï¸èƒŒæ™¯ï¼šåœ¨å¤šçº¿ç¨‹å¹¶å‘æ¡ä»¶ä¸‹ï¼Œæ™®é€šçš„å…±äº«HashMapä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºæ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´æ•°æ®è¢«è¦†ç›–\u0026hellip;ï¼›\nğŸ·ï¸ä½œç”¨ï¼šé€šè¿‡åŒæ­¥æœºåˆ¶åŠ é”ï¼Œä½¿å¾—HashMapåœ¨èƒŒæ™¯ä¸‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸”è¿˜éœ€è¦ä¿è¯æ•ˆç‡ï¼›\nğŸ·ï¸å®šä¹‰ï¼š\nJDK1.7ä¹‹å‰ï¼Œé‡‡ç”¨åˆ†æ®µé”ï¼Œå³æ¯ä¸ªSegmentæ˜¯ç‹¬ç«‹çš„ï¼Œå°†é”çš„ç²’åº¦ä¸‹æ–¹ï¼Œæé«˜çº¿ç¨‹å¹¶å‘åº¦ åˆ©ç”¨æ•°ç»„+é“¾è¡¨å®ç° =\u0026gt; é”çš„ç²’åº¦æ˜¯segmentï¼›\nç¼ºç‚¹ï¼šsegmentä¸èƒ½æ‰©å®¹ï¼Œè€ŒHashMapä¼šæ‰©å®¹\nJDK1.8åï¼Œç§»é™¤Segmentï¼Œé”çš„ç²’åº¦æ›´åŠ ç»†åŒ–ï¼Œé”åªåœ¨é“¾è¡¨orçº¢é»‘æ ‘èŠ‚ç‚¹çº§åˆ«ä¸Šç«äº‰é”ã€‚é€šè¿‡CASè¿›è¡Œæ’å…¥æ“ä½œï¼Œåªæœ‰åœ¨æ›´æ–°é“¾è¡¨orçº¢é»‘æ ‘æ—¶æ‰ä½¿ç”¨synchronizedå…³é”®å­—åŠ é”ï¼Œå¹¶ä¸”åªé”ä½é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚ åŒæ­¥HashMapï¼Œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘å®ç°ï¼› ğŸ·ï¸æ·»åŠ èŠ‚ç‚¹è¿‡ç¨‹\nè®¡ç®—keyçš„hashåçš„ä¸‹æ ‡ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´  =\u0026gt; åˆ©ç”¨CASæ·»åŠ å…ƒç´ ï¼› å†²çª =\u0026gt; ç»™è¿™ä¸ªèŠ‚ç‚¹ä¸Šé”ä½¿ç”¨synchronizedã€‚è¿™æ ·å…¶ä»–çº¿ç¨‹å°±æ— æ³•è®¿é—®è¯¥èŠ‚ç‚¹ä»¥åŠä¹‹åçš„èŠ‚ç‚¹äº† ğŸ·ï¸é¢å¤–æ‰©å±•ï¼ˆä¸ºä»€ä¹ˆåˆ†ä¸ºCAS\u0026amp;Synchronizedå‘¢ï¼Ÿï¼‰\næ— é”æœºåˆ¶CASï¼Œèƒ½è¿›ä¸€æ­¥æé«˜å¹¶å‘æ€§èƒ½ï¼› å› æ­¤é¦–æ¬¡æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œåˆ©ç”¨CASå¾ˆOKï¼Œåˆ¤æ–­\u0026amp;æ’å…¥ è€Œåç»­å¯¹é“¾è¡¨çš„ä¿®æ”¹ï¼Œå¾ˆéš¾åŸå­åŒ–æ“ä½œorCASæ¯”è¾ƒäº¤æ¢ã€‚å› æ­¤ä½¿ç”¨Synchronizedï¼Œå®ç°äº’æ–¥ï¼Œä¸”è¯¥é”çš„ç²’åº¦å¾ˆå°ã€‚ 1// è‡ªæ—‹ï¼šå¦‚æœ CAS å¤±è´¥å°±é‡è¯• 2while (true) { 3 currentNode = bucket.get(); 4 5 if (currentNode == null) { 6 // å¦‚æœæ¡¶ä½ç½®ä¸ºç©ºï¼Œå°è¯•é€šè¿‡ CAS æ’å…¥æ–°èŠ‚ç‚¹ 7 if (bucket.compareAndSet(null, newNode)) { 8 return null; // æ’å…¥æˆåŠŸ 9 } 10 } else { 11 // å¦‚æœå½“å‰ä½ç½®æœ‰èŠ‚ç‚¹ï¼Œè¿›è¡Œé“¾è¡¨éå†ï¼Œå¯»æ‰¾åˆé€‚ä½ç½®æ’å…¥ 12 synchronized (currentNode) { // åœ¨è®¿é—®é“¾è¡¨èŠ‚ç‚¹æ—¶åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹ 13 Node\u0026lt;K, V\u0026gt; prev = null; 14 while (currentNode != null) { 15 if (currentNode.key.equals(key)) { 16 // å¦‚æœæ‰¾åˆ°ç›¸åŒçš„ keyï¼Œæ›´æ–° value 17 currentNode.value = value; 18 return currentNode.value; 19 } 20 prev = currentNode; 21 currentNode = currentNode.next; 22 } 23 // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸åŒçš„ keyï¼Œåœ¨é“¾è¡¨æœ«å°¾æ·»åŠ æ–°çš„èŠ‚ç‚¹ 24 prev.next = newNode; 25 return null; // æ’å…¥æˆåŠŸ 26 } 27 } 28} 464 CopyOnwriteArrayList çº¿ç¨‹å®‰å…¨çš„åŠ¨æ€æ•°ç»„ï¼Œé€šè¿‡å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼Œä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´æ€§å’Œéš”ç¦»æ€§ï¼Œå¹¶ä¸ä¿è¯å¼ºä¸€è‡´æ€§ã€‚\nå†™æ“ä½œå’Œè¯»æ“ä½œ(Volatileä¿®é¥°)åˆ†ç¦»ï¼Œè¯»å®Œå…¨ok(å¯èƒ½è¯»åˆ°æ—§ç‰ˆæœ¬)ï¼›å†™éœ€è¦åŠ é”ä¸”å¤åˆ¶æ•°ç»„ï¼Œå†ä¿®æ”¹æ—§æ•°ç»„çš„å¼•ç”¨ã€‚ çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š\nç«äº‰æ¡ä»¶ å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡è¿›è¡Œç´¯åŠ ï¼Œå¯ä»¥å¯¼è‡´ç»Ÿè®¡ä¸å¯¹ æ­»é” å¤šä¸ªçº¿ç¨‹æ“ä½œæ•°æ®æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®çš„è¯·æ±‚èµ„æºå’Œé‡Šæ”¾é¡ºåºï¼Œç›¸äº’ç­‰å¾… å¯è§æ€§é—®é¢˜ æŸä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œå…¶ä»–çº¿ç¨‹ä¸ä¸€å®šåŠæ—¶å¯è§ =\u0026gt; volatile å¼ºåˆ¶ä»å†…å­˜ä¸­ä¿®æ”¹\u0026amp;è¯»å– åŸå­æ€§é—®é¢˜ é€»è¾‘ç”±å¤šä¸ªæ“ä½œæ­¥éª¤ç»„æˆï¼Œå…¶ä¸­CPUæ—¶é—´ç‰‡åˆ°æœŸäº†ï¼Œä¸­é€”å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡ï¼Œå¯¼è‡´ä¸ä¸€è‡´ã€‚ çº¿ç¨‹é¥¥é¥¿ å¤šçº¿ç¨‹äº‰æŠ¢CPUï¼Œéå…¬å¹³ï¼Œæœ‰äº›æ°¸è¿œæŠ¢ä¸åˆ° ä¸ä¸€è‡´è§†å›¾ å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ä¸€ä¸ªå…±äº«å¯¹è±¡ï¼Œå¯¼è‡´ä¸€éƒ¨åˆ†æ•°æ®ä¸ä¸€è‡´ å¼ºåˆ¶è§†å›¾ä¸€è‡´ï¼Œå°±æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ‹¿åˆ°çš„æ•°æ®ï¼Œå’Œæœ€ç»ˆçš„æ•°æ®è¦ä¸€è‡´ï¼Œå…¶ä»–çº¿ç¨‹åˆ«ç»™æˆ‘æ”¹äº†ä¸€éƒ¨åˆ†å•Š =\u0026gt; åŠ synchronized ","permalink":"http://longcoding.top/posts/jobs/collection/","summary":"\u003ch3 id=\"6319-hashmap-åŸç†\"\u003e6319 HashMap åŸç†\u003c/h3\u003e\n\u003cp\u003eæ•°æ®ç»“æ„ï¼šæ•°ç»„ + é“¾è¡¨  ï¼ˆJAVA8ä¹‹åï¼šæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eæ•°æ®ç»“æ„\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ejdk1.7ï¼šæ•°ç»„+é“¾è¡¨ï¼Œæ•°ç»„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªé“¾è¡¨çš„è¡¨å¤´ï¼Œå½“å‘ç”Ÿå†²çªï¼Œå°†æ–°å…ƒç´ æ·»åŠ åœ¨å¤´éƒ¨(å¤´æ’æ³•)\n\u003cul\u003e\n\u003cli\u003ehashå†²çªï¼šå¤´æ’æ³•ï¼Œâ—æ‰©å®¹æ—¶å¯èƒ½é€ æˆç¯å½¢é“¾è¡¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ejdk1.8ï¼š\n\u003cul\u003e\n\u003cli\u003eå¼•å…¥çº¢é»‘æ ‘ï¼Œå½“é“¾è¡¨èŠ‚ç‚¹è¶…è¿‡8ä¸ªï¼Œé‚£ä¹ˆè¿™ä¸ªé“¾è¡¨ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚æŸ¥è¯¢æ—¶é—´ç”± O(n) ä¼˜åŒ–ä¸º O(logn)ã€‚å½“èŠ‚ç‚¹å°äº6ä¸ªï¼Œå†è½¬æ¢ä¸ºé“¾è¡¨ã€‚\u003c/li\u003e\n\u003cli\u003ehashå†²çªï¼šå°¾æ’æ³•ï¼Œé¿å…ç¯å½¢é“¾è¡¨â—\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eæ‰©å®¹æœºåˆ¶\n\u003cul\u003e\n\u003cli\u003ejdk1.7\n\u003cul\u003e\n\u003cli\u003eæ‰©å®¹ï¼Œå…ƒç´ ä¼šé‡æ–°è®¡ç®—hashå€¼ï¼Œå¹¶åˆ†é…åˆ°æ–°çš„æ‰©å®¹æ•°ç»„ä¸­ã€‚â­æ¯”è¾ƒè€—æ—¶\u003c/li\u003e\n\u003cli\u003eæ‰©å®¹æ—¶ï¼Œå¤´æ’æ³•ï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå¯èƒ½é€ æˆç¯å½¢é“¾è¡¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ejdk1.8\n\u003cul\u003e\n\u003cli\u003eæ‰©å®¹æ—¶ï¼Œåˆ©ç”¨äº†å…ƒç´ å“ˆå¸Œå€¼å’Œæ—§æ•°ç»„å®¹é‡å…³ç³»ï¼Œå‡å°‘äº†é‡æ–°è®¡ç®—çš„å“ˆå¸Œæ¬¡æ•°\u003c/li\u003e\n\u003cli\u003eæ‰©å®¹æ—¶ï¼Œå°¾æ’æ³•ï¼Œé¿å…ç¯å½¢é“¾è¡¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä½¿ç”¨é”®çš„\u003ccode\u003ehashcode()\u003c/code\u003eè®¡ç®—hashå€¼ï¼Œç„¶å(n-1) \u0026amp; hashç¡®å®šæ•°ç»„ä¸­çš„ä½ç½®ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003en-1 =\u0026gt; 10000 - 1 = 01111\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHashMapçš„åˆå§‹é»˜è®¤å®¹é‡ä¸º16ï¼Œè´Ÿè½½å› å­ä¸º0.75ã€‚å½“å­˜å‚¨çš„å…ƒç´ è¾¾åˆ°75%æ—¶ï¼Œè¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹ä¸ºåŸæ¥çš„2å€ç©ºé—´\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eæ‰©å±•çŸ¥è¯†ï¼š\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ehashmapçš„çº¢é»‘æ ‘ä¼˜åŒ–ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eJAVA8å¼€å§‹ï¼Œä¸ºäº†ä¼˜åŒ–hashå†²çªæ—¶çš„æŸ¥æ‰¾æ€§èƒ½ã€‚ä½†é“¾è¡¨çš„é•¿åº¦\u003cstrong\u003eè¶…è¿‡8\u003c/strong\u003eæ—¶ï¼Œé“¾è¡¨ä¼šè½¬å˜ä¸ºçº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ æŸ¥æ‰¾æ—¶é—´ O(n) =\u0026gt; O(logn)ã€‚ å½“å…ƒç´ å°‘äº6ä¸ªï¼Œåˆ‡æ¢ä¸ºé“¾è¡¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ehashCode() å’Œ equals()çš„é‡è¦æ€§ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ehashCodeè®¡ç®—hashå€¼ï¼Œå†³å®šé”®çš„å­˜å‚¨ä½ç½®ã€‚ è€ŒhashCodeç›¸åŒ=\u0026gt;å†²çªã€‚ equals()æ¯”è¾ƒçš„å€¼\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// HashMap Node class\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003estatic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eEntry\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eK\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003efinal\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eK\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c1\"\u003e// é”®\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"c1\"\u003e// å€¼\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003efinal\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ehash\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// è®¡ç®—åçš„å“ˆå¸Œå€¼\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eEntry\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eK\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼ˆå½¢æˆé“¾è¡¨ï¼‰\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eä¸ºä»€ä¹ˆå¤´æ’æ³•\u0026amp;å¤šçº¿ç¨‹\u0026amp;æ‰©å®¹ä¼šé€ æˆç¯å½¢é“¾è¡¨?\u003c/strong\u003e\u003c/p\u003e","title":"é›†åˆé¢è¯•é¢˜ç¬”è®°"},{"content":"521. Javaå¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿ Javaç¼–è¯‘ç”Ÿæˆçš„æ˜¯å­—èŠ‚ç æ–‡ä»¶.classæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç‰¹å®šäºæŸä¸ªæ“ä½œç³»ç»Ÿçš„æœºå™¨ç ã€‚\nä¸åŒæ“ä½œç³»ç»Ÿä¸Šéƒ½æœ‰å„è‡ªå®ç°çš„JVMï¼Œè´Ÿè´£å°†å­—èŠ‚ç ç¿»è¯‘æˆç‰¹å®šå¹³å°çš„æœºå™¨ä»£ç å¹¶æ‰§è¡Œã€‚ä½¿å¾—JAVAæ–‡ä»¶å¯ä»¥è¢«ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„JVMè¿è¡Œã€‚åŒ…è£…äº†ä¸€å±‚ã€‚\n9807. JVMçš„ç»„æˆéƒ¨åˆ† ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š\nç¼–è¯‘å¥½çš„JAVAå­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶ï¼‰å‡†å¤‡å°±ç»ªã€‚\nç±»åŠ è½½å™¨å­ç³»ç»Ÿï¼šå°†classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­(è¿è¡Œæ—¶çš„æ•°æ®åŒº)ã€‚ è¿è¡Œæ—¶æ•°æ®åŒºã€‚ æ‰§è¡Œå¼•æ“(å‘½ä»¤è§£é‡Šå™¨)ï¼šå°†å­—èŠ‚ç æ–‡ä»¶ç¿»è¯‘æˆæœºå™¨ç ï¼Œå¹¶äº¤ç»™CPUæ‰§è¡Œï¼› æœ¬åœ°æ–¹æ³•æ¥å£ï¼šè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ä¸åŒè¯­è¨€æä¾›çš„æ¥å£ï¼Œæ¯”å¦‚é©±åŠ¨å’Œ..ï¼Œè°ƒç”¨æœ¬åœ°æ–¹æ³•æ¥å£ï¼Œä¾‹å¦‚æ“ä½œç³»ç»Ÿçº§åˆ«çš„åŠŸèƒ½æˆ–è€…é«˜æ€§èƒ½åº“ã€‚ 522. ç¼–è¯‘æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œ ç¼–è¯‘æ‰§è¡Œï¼šå…ˆå°†æºä»£ç ç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œå†åœ¨CPUä¸Šè¿è¡Œã€‚ä¾‹å¦‚ï¼šCï¼ŒC++ï¼›\nâ€‹\tå•Š\nä¼˜ç‚¹ï¼šç¼–è¯‘åè¿è¡Œé€Ÿåº¦å¿«ï¼Œå¹¶ä¸”è¿è¡Œæ—¶ï¼Œä¸éœ€è¦å†è¿›è¡Œç¿»è¯‘ã€‚ è§£é‡Šæ‰§è¡Œï¼šè¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨é€è¡Œç¿»è¯‘å¹¶æ‰§è¡Œä¾‹å¦‚Pythonã€‚\nè·¨å¹³å°æ€§å¥½ï¼Œ æ¯ä¸ªä»£ç éƒ½æ˜¯åœ¨æ¯ä¸ªå¹³å°ä¸Šé€šè¿‡ç›¸åº”å¹³å°çš„è§£é‡Šå™¨è¿è¡Œã€‚ é€Ÿåº¦æ…¢ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦åŠ¨æ€ç¿»è¯‘ã€‚ =\u0026gt; Javaé‡‡æ ·ç¼–è¯‘æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œç›¸ç»“åˆçš„æ–¹å¼ï¼š\nè§£é‡Šæ‰§è¡Œï¼šJVMå°†.JAVAæ–‡ä»¶=\u0026gt;.classå­—èŠ‚ç ã€‚ æœ‰åŠ©äºç¨‹åºçš„è·¨å¹³å°æ€§ï¼› å³æ—¶ç¼–è¯‘ï¼šå°†ç»å¸¸æ‰§è¡Œçš„ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œé¿å…åå¤è§£é‡Š 523. JVMçš„å†…å­˜åŒºåŸŸå¦‚ä½•åˆ’åˆ†çš„â—? JVMè¿è¡Œæ—¶çš„æ•°æ®åŒºåˆ†ä¸ºï¼š1. æ–¹æ³•åŒº 2. å † 3. è™šæ‹Ÿæœºæ ˆ 4. æœ¬åœ°æ–¹æ³•æ ˆ 5. ç¨‹åºè®¡æ•°å™¨ã€‚\næ–¹æ³•åŒº - å­˜å‚¨ç±»\u0026amp;å…±äº«ä¿¡æ¯\nå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ è¿™äº›ä¿¡æ¯å±äºçº¿ç¨‹å…±äº«åŒºåŸŸ Javaå † - ä¸JVMå…±å­˜äº¡\nå­˜æ”¾æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å¯¹è±¡å®ä¾‹ å’Œ æ•°ç»„ (åƒåœ¾å›æ”¶ä¸»è¦æˆ˜åœ°) è™šæ‹Ÿæœºæ ˆ\næ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªæ ˆï¼šç”¨æ¥ä¿å­˜å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€æ–¹æ³•å‡ºå£ä¿¡æ¯ã€‚ å±€éƒ¨å˜é‡ï¼šåŸºæœ¬æ•°æ®ç±»å‹ï¼›ä»¥åŠå¯¹è±¡å¼•ç”¨ï¼› æ ˆä¸çº¿ç¨‹å…±å­˜äº¡ æœ¬åœ°æ–¹æ³•æ ˆ\nä¸ºæœ¬åœ°æ–¹æ³•æœåŠ¡ã€‚ã€‚ã€‚ ç¨‹åºè®¡æ•°å™¨\nä¿å­˜å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€æˆ–è¡Œå·ã€‚ æ€»ç»“ï¼šJavaç¨‹åºä¸çº¿ç¨‹åœ¨JVMå†…å­˜ä¸­çš„æµç¨‹ ç¨‹åºå¯åŠ¨ï¼šJVMåˆå§‹åŒ–å†…å­˜åŒºåŸŸï¼ŒåŠ è½½ç±»ä¿¡æ¯åˆ°æ–¹æ³•åŒºã€‚ çº¿ç¨‹åˆ›å»ºï¼šä¸ºçº¿ç¨‹åˆ†é…ç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆã€‚ æ–¹æ³•è°ƒç”¨ï¼šçº¿ç¨‹æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œåˆ›å»ºæ ˆå¸§å¹¶å‹å…¥Javaè™šæ‹Ÿæœºæ ˆã€‚ å¯¹è±¡åˆ›å»ºï¼šå¯¹è±¡å®ä¾‹å­˜å‚¨åœ¨Javaå †ä¸­ï¼Œå…ƒæ•°æ®å­˜å‚¨åœ¨æ–¹æ³•åŒºã€‚ åƒåœ¾å›æ”¶ï¼šJVMæ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡å’Œç±»ä¿¡æ¯ã€‚ çº¿ç¨‹ç»“æŸï¼šçº¿ç¨‹çš„æ ˆå’Œç¨‹åºè®¡æ•°å™¨è¢«é”€æ¯ã€‚ ç¨‹åºç»“æŸï¼šJVMé‡Šæ”¾æ‰€æœ‰å†…å­˜åŒºåŸŸå¹¶é€€å‡ºã€‚ 524. JVMä¸­å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ æ ˆï¼šä¸»è¦ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡(åŸºæœ¬ç±»å‹+å¯¹è±¡å¼•ç”¨)å’Œæ–¹æ³•çš„è°ƒç”¨ä¿¡æ¯(è¿”å›åœ°å€ã€å‚æ•°ç­‰)ã€‚çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºè¯¥çº¿ç¨‹çš„æ ˆå¸§ï¼Œè¢«å‹å…¥Javaè™šæ‹Ÿæœºæ ˆä¸­ã€‚ æ‰§è¡Œç»“æŸï¼Œçº¿ç¨‹æ ˆå¸§è¢«å¼¹å‡º(é”€æ¯)\nå †ï¼šä¸»è¦ç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚\n526. Javaå¸¸é‡æ±  Javaä¸­çš„å¸¸é‡æ± æ˜¯ç”¨äºå­˜å‚¨è¿è¡Œæ—¶çš„å¸¸é‡æˆ–ç¬¦å·çš„åŒºåŸŸ\nè¿è¡Œæ—¶å¸¸é‡æ± ï¼šåœ¨æ¯ä¸ªç±»oræ¥å£çš„Classæ–‡ä»¶ä¸­å­˜å‚¨ç¼–è¯‘ç”Ÿæˆçš„å¸¸é‡ä¿¡æ¯ï¼Œå¹¶åœ¨ç±»åŠ è½½æ—¶è¿›å…¥JVMæ–¹æ³•åŒºï¼› å­—ç¬¦ä¸²å¸¸é‡æ± ï¼šç”¨äºå­˜å‚¨å­—ç¬¦ä¸²å­—é¢é‡ï¼Œé€šè¿‡String.intern()æ–¹æ³•å¯ä»¥å°†å­—ç¬¦ä¸²åŠ å…¥åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚ ğŸ·ï¸å¸¸é‡æ± çš„ä½œç”¨ï¼š\nä¸»è¦å‘¢ï¼Œå°±æ˜¯ç”¨äºå‡å°‘é‡å¤å¯¹è±¡çš„åˆ›å»ºï¼ŒèŠ‚çœå†…å­˜å¹¶æé«˜æ•ˆç‡ã€‚ ğŸ·ï¸å­—ç¬¦ä¸²å¸¸é‡æ± ï¼š\nç›´æ¥ä½¿ç”¨å­—é¢é‡ï¼š String s = \u0026quot;Hello\u0026quot;; ä¼šå°†\u0026quot;\u0026quot;Helloå­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ï¼Œå¦‚æœå¸¸é‡æ± å·²å­˜åœ¨\u0026quot;Hello\u0026quot;ï¼Œåˆ™ä¸ä¼šé‡å¤åˆ›å»ºã€‚ ä½¿ç”¨newå…³é”®å­—ï¼š ä½¿ç”¨String s = new String(\u0026quot;Hello\u0026quot;);ä¸è®ºå¸¸é‡æ± ä¸­æ˜¯å¦å·²å­˜åœ¨Helloï¼Œéƒ½ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ã€‚ ğŸ·ï¸å¸¸é‡æ± çš„å­˜å‚¨å†…å®¹\nå¸¸é‡æ± ä¸ä»…ä»…å­˜å‚¨å­—ç¬¦ä¸²å¸¸é‡ï¼Œè¿˜åŒ…æ‹¬ï¼š\nåŸºæœ¬ç±»å‹çš„å­—é¢é‡ eg. æ•´æ•°ã€æµ®ç‚¹æ•°ï¼› ç±»å’Œæ¥å£çš„å¼•ç”¨ï¼› æ–¹æ³•å’Œå­—æ®µçš„ç¬¦å·å¼•ç”¨ã€‚ 527. Javaç±»åŠ è½½å™¨ åŠ¨æ€åŠ è½½ç±»æ–‡ä»¶çš„ç»„ä»¶ã€‚å°†.classæ–‡ä»¶çš„å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºClasså¯¹è±¡ï¼Œä»¥ä¾›JVMæ‰§è¡Œã€‚\nğŸ·ï¸ç±»åŠ è½½å™¨çš„ä½œç”¨ï¼š\nåŠ¨æ€åŠ è½½ç±»ï¼šåœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦åŠ è½½ç±»ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶åŠ è½½æ‰€æœ‰ç±»ï¼› éš”ç¦»ä¸åŒçš„ç±»å‘½åç©ºé—´ï¼šé€šè¿‡ä¸åŒçš„ç±»åŠ è½½å™¨ï¼Œå¯ä»¥éš”ç¦»åŒåç±»ï¼Œä½¿å¾—å®ƒä»¬ä¸ä¼šç›¸äº’å†²çªã€‚ ğŸ·ï¸æ‰©å±•çŸ¥è¯†\nJDK8ä¸€å…±æœ‰ä¸‰ç§ç±»åŠ è½½å™¨\nå¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader), å®ƒå±äºè™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦è´Ÿè´£åŠ è½½ \u0026lt;JAVA_HOME\u0026gt;\\lib ç›®å½•ä¸­æˆ–è¢« -XbootclasspathæŒ‡å®šçš„è·¯å¾„ä¸­è¢«è™šæ‹Ÿæœºè¯†åˆ«çš„æ–‡ä»¶ã€‚ å®ƒæ˜¯æ‰€æœ‰ç±»åŠ è½½å™¨çš„çˆ¶äº²ã€‚ æ‰©å±•ç±»åŠ è½½å™¨(Extension ClassLoader), å®ƒæ˜¯Javaå®ç°çš„ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºï¼Œä¸»è¦è´Ÿè´£åŠ è½½ \u0026lt;JAVA_HOME\u0026gt;\\lib\\ext ç›®å½•ä¸­çš„æˆ–è¢« java.ext.dirs ç³»ç»Ÿå˜é‡æŒ‡å®šè·¯å¾„çš„ç±»åº“ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨(Application ClassLoader), å®ƒæ˜¯Javaå®ç°çš„ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºã€‚ ä¸»è¦è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„(classPath)ä¸Šçš„ç±»åº“ï¼Œç¨‹åºé»˜è®¤çš„åŠ è½½å™¨ã€‚ 532. javaä¸­çš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨ å¼ºå¼•ç”¨(é»˜è®¤) æœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ã€‚æ™®é€šå¯¹è±¡çš„å¯¹è±¡å¼•ç”¨å°±æ˜¯å¼ºå¼•ç”¨ã€‚ åªè¦æœ‰ä¸€ä¸ªå¯¹è±¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘å®ƒï¼Œåƒåœ¾å›æ”¶æœŸæ°¸è¿œä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ã€‚ è½¯å¼•ç”¨(å¸¸ç”¨äºç¼“å­˜) å½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šè¢«åƒåœ¾å›æ”¶æ¸…ç† // å¼±å¼•ç”¨ã€è™šå¼•ç”¨ã€‚\n533. Javaä¸­å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨â—â—â— =\u0026gt; åˆ†ä¸ºæ–°ç”Ÿä»£æ”¶é›†å™¨å’Œè€å¹´ä»£æ”¶é›†å™¨ï¼ŒåŒ…æ‹¬å¦‚ä¸‹ï¼š\nğŸ·ï¸æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ï¼š\nSerialæ”¶é›†å™¨ å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé€‚åˆå°å‹åº”ç”¨å’Œå•å¤„ç†ç¯å¢ƒã€‚ è§¦å‘ Stop-The-Worldæ“ä½œï¼Œæ‰€æœ‰åº”ç”¨çº¿ç¨‹åœ¨GCæ˜¯æš‚åœã€‚ é€‚åˆå•çº¿ç¨‹åº”ç”¨å’Œå®¢æˆ·ç«¯æ¨¡å¼ã€‚ 535. ä¸ºä»€ä¹ˆJavaçš„åƒåœ¾æ”¶é›†å™¨å°†å †åˆ†ä¸ºè€å¹´ä»£å’Œæ–°ç”Ÿä»£ï¼Ÿ ä¸»è¦æ˜¯ä¸ºäº†æé«˜åƒåœ¾å›æ”¶æ•ˆç‡ï¼Œä¾æ®å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç‰¹ç‚¹æ¥è¿›è¡Œä¼˜åŒ–ã€‚\nå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç‰¹ç‚¹ï¼š\nå¤§å¤šæ•°å¯¹è±¡å­˜æ´»æ—¶é—´çŸ­ï¼š=\u0026gt; åˆ†é…åˆ°æ–°ç”Ÿä»£ å°‘éƒ¨åˆ†å¯¹è±¡å­˜è´§æ—¶é—´é•¿ï¼š=\u0026gt; æ™‹å‡ä¸ºè€å¹´ä»£ æŒ‰ç…§å­˜æ´»æ—¶é—´åˆ†åŒºç®¡ç†æ›´åŠ é«˜æ•ˆã€‚\nä¸åŒçš„å›æ”¶ç®—æ³•ï¼š\næ–°ç”Ÿä»£çš„å›æ”¶ï¼šç”Ÿå‘½å‘¨æœŸçŸ­ =\u0026gt; æ–°ç”Ÿä»£é€šå¸¸é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼› è€å¹´ä»£çš„å›æ”¶ï¼šå­˜æ´»æ—¶é—´é•¿ =\u0026gt; æ ‡è®°-æ•´ç†ç®—æ³• or æ ‡è®°-æ¸…é™¤ç®—æ³•ã€‚ åˆ†åŒºåå¯ä»¥å‡å°‘GCæš‚åœçš„æ—¶é—´ã€‚\n","permalink":"http://longcoding.top/posts/jobs/jvm/","summary":"\u003ch3 id=\"521-javaå¦‚ä½•å®ç°è·¨å¹³å°çš„\"\u003e521. Javaå¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿ\u003c/h3\u003e\n\u003cp\u003eJavaç¼–è¯‘ç”Ÿæˆçš„æ˜¯å­—èŠ‚ç æ–‡ä»¶.classæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç‰¹å®šäºæŸä¸ªæ“ä½œç³»ç»Ÿçš„æœºå™¨ç ã€‚\u003c/p\u003e\n\u003cp\u003eä¸åŒæ“ä½œç³»ç»Ÿä¸Šéƒ½æœ‰å„è‡ªå®ç°çš„JVMï¼Œè´Ÿè´£å°†å­—èŠ‚ç ç¿»è¯‘æˆç‰¹å®šå¹³å°çš„æœºå™¨ä»£ç å¹¶æ‰§è¡Œã€‚ä½¿å¾—JAVAæ–‡ä»¶å¯ä»¥è¢«ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„JVMè¿è¡Œã€‚åŒ…è£…äº†ä¸€å±‚ã€‚\u003c/p\u003e\n\u003ch3 id=\"9807-jvmçš„ç»„æˆéƒ¨åˆ†\"\u003e9807. JVMçš„ç»„æˆéƒ¨åˆ†\u003c/h3\u003e\n\u003cp\u003eä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š\u003c/p\u003e\n\u003cp\u003eç¼–è¯‘å¥½çš„JAVAå­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶ï¼‰å‡†å¤‡å°±ç»ªã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç±»åŠ è½½å™¨å­ç³»ç»Ÿï¼šå°†classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­(è¿è¡Œæ—¶çš„æ•°æ®åŒº)ã€‚\u003c/li\u003e\n\u003cli\u003eè¿è¡Œæ—¶æ•°æ®åŒºã€‚\u003c/li\u003e\n\u003cli\u003eæ‰§è¡Œå¼•æ“(å‘½ä»¤è§£é‡Šå™¨)ï¼šå°†å­—èŠ‚ç æ–‡ä»¶ç¿»è¯‘æˆæœºå™¨ç ï¼Œå¹¶äº¤ç»™CPUæ‰§è¡Œï¼›\u003c/li\u003e\n\u003cli\u003eæœ¬åœ°æ–¹æ³•æ¥å£ï¼šè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ä¸åŒè¯­è¨€æä¾›çš„æ¥å£ï¼Œæ¯”å¦‚é©±åŠ¨å’Œ..ï¼Œè°ƒç”¨æœ¬åœ°æ–¹æ³•æ¥å£ï¼Œä¾‹å¦‚æ“ä½œç³»ç»Ÿçº§åˆ«çš„åŠŸèƒ½æˆ–è€…é«˜æ€§èƒ½åº“ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cimg src=\"http://sthda9dn6.hd-bkt.clouddn.com/FtrSjvLjXEixufKxk9avjPMmQNpg\" alt=\"image-20250314162756632\" style=\"zoom:50%;\" /\u003e\r\n\u003ch3 id=\"522-ç¼–è¯‘æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œ\"\u003e522. ç¼–è¯‘æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œ\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003e\u003cstrong\u003eç¼–è¯‘æ‰§è¡Œ\u003c/strong\u003e\u003c/em\u003eï¼šå…ˆå°†æºä»£ç ç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œå†åœ¨CPUä¸Šè¿è¡Œã€‚ä¾‹å¦‚ï¼šCï¼ŒC++ï¼›\u003c/p\u003e\n\u003cp\u003eâ€‹\tå•Š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¼˜ç‚¹ï¼šç¼–è¯‘åè¿è¡Œé€Ÿåº¦å¿«ï¼Œå¹¶ä¸”è¿è¡Œæ—¶ï¼Œä¸éœ€è¦å†è¿›è¡Œç¿»è¯‘ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cem\u003e\u003cstrong\u003eè§£é‡Šæ‰§è¡Œ\u003c/strong\u003e\u003c/em\u003eï¼šè¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨é€è¡Œç¿»è¯‘å¹¶æ‰§è¡Œä¾‹å¦‚Pythonã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè·¨å¹³å°æ€§å¥½ï¼Œ æ¯ä¸ªä»£ç éƒ½æ˜¯åœ¨æ¯ä¸ªå¹³å°ä¸Šé€šè¿‡ç›¸åº”å¹³å°çš„è§£é‡Šå™¨è¿è¡Œã€‚\u003c/li\u003e\n\u003cli\u003eé€Ÿåº¦æ…¢ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦åŠ¨æ€ç¿»è¯‘ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e=\u0026gt; Javaé‡‡æ ·ç¼–è¯‘æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œç›¸ç»“åˆçš„æ–¹å¼ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè§£é‡Šæ‰§è¡Œï¼šJVMå°†.JAVAæ–‡ä»¶=\u0026gt;.classå­—èŠ‚ç ã€‚ æœ‰åŠ©äºç¨‹åºçš„è·¨å¹³å°æ€§ï¼›\u003c/li\u003e\n\u003cli\u003eå³æ—¶ç¼–è¯‘ï¼šå°†ç»å¸¸æ‰§è¡Œçš„ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œé¿å…åå¤è§£é‡Š\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"523-jvmçš„å†…å­˜åŒºåŸŸå¦‚ä½•åˆ’åˆ†çš„\"\u003e523. JVMçš„å†…å­˜åŒºåŸŸå¦‚ä½•åˆ’åˆ†çš„â—?\u003c/h3\u003e\n\u003cp\u003eJVMè¿è¡Œæ—¶çš„æ•°æ®åŒºåˆ†ä¸ºï¼š1. \u003cstrong\u003eæ–¹æ³•åŒº\u003c/strong\u003e 2. \u003cstrong\u003eå †\u003c/strong\u003e 3. \u003cstrong\u003eè™šæ‹Ÿæœºæ ˆ\u003c/strong\u003e 4. \u003cstrong\u003eæœ¬åœ°æ–¹æ³•æ ˆ\u003c/strong\u003e 5. ç¨‹åºè®¡æ•°å™¨ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eæ–¹æ³•åŒº\u003c/strong\u003e - å­˜å‚¨ç±»\u0026amp;å…±äº«ä¿¡æ¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡\u003c/li\u003e\n\u003cli\u003eè¿™äº›ä¿¡æ¯å±äºçº¿ç¨‹å…±äº«åŒºåŸŸ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eJava\u003cstrong\u003eå †\u003c/strong\u003e - ä¸JVMå…±å­˜äº¡\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå­˜æ”¾æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å¯¹è±¡å®ä¾‹ å’Œ æ•°ç»„ (åƒåœ¾å›æ”¶ä¸»è¦æˆ˜åœ°)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eè™šæ‹Ÿæœº\u003cstrong\u003eæ ˆ\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eæ¯ä¸ªçº¿ç¨‹\u003c/strong\u003eåˆ›å»ºä¸€ä¸ªæ ˆï¼šç”¨æ¥ä¿å­˜\u003cstrong\u003eå±€éƒ¨å˜é‡\u003c/strong\u003eã€\u003cstrong\u003eæ“ä½œæ•°æ ˆ\u003c/strong\u003eã€æ–¹æ³•å‡ºå£ä¿¡æ¯ã€‚\u003c/li\u003e\n\u003cli\u003eå±€éƒ¨å˜é‡ï¼šåŸºæœ¬æ•°æ®ç±»å‹ï¼›ä»¥åŠå¯¹è±¡å¼•ç”¨ï¼›\u003c/li\u003e\n\u003cli\u003eæ ˆä¸çº¿ç¨‹å…±å­˜äº¡\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæœ¬åœ°æ–¹æ³•æ ˆ\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¸ºæœ¬åœ°æ–¹æ³•æœåŠ¡ã€‚ã€‚ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eç¨‹åºè®¡æ•°å™¨\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¿å­˜\u003cstrong\u003eå½“å‰çº¿ç¨‹\u003c/strong\u003eæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€æˆ–è¡Œå·ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250314165936676\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FirLgeEVeLb4N108rU7mpuX1BdPY\"\u003e\u003c/p\u003e\n\u003ch3 id=\"æ€»ç»“javaç¨‹åºä¸çº¿ç¨‹åœ¨jvmå†…å­˜ä¸­çš„æµç¨‹\"\u003eæ€»ç»“ï¼šJavaç¨‹åºä¸çº¿ç¨‹åœ¨JVMå†…å­˜ä¸­çš„æµç¨‹\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eç¨‹åºå¯åŠ¨\u003c/strong\u003eï¼šJVMåˆå§‹åŒ–å†…å­˜åŒºåŸŸï¼ŒåŠ è½½\u003cstrong\u003eç±»ä¿¡æ¯\u003c/strong\u003eåˆ°\u003cstrong\u003eæ–¹æ³•åŒº\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eçº¿ç¨‹åˆ›å»º\u003c/strong\u003eï¼šä¸º\u003cstrong\u003eçº¿ç¨‹\u003c/strong\u003eåˆ†é…\u003cstrong\u003eç¨‹åºè®¡æ•°å™¨\u003c/strong\u003eã€Javaè™šæ‹Ÿæœº\u003cstrong\u003eæ ˆ\u003c/strong\u003eå’Œæœ¬åœ°æ–¹æ³•\u003cstrong\u003eæ ˆ\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ–¹æ³•è°ƒç”¨\u003c/strong\u003eï¼š\u003cstrong\u003eçº¿ç¨‹\u003c/strong\u003eæ‰§è¡Œæ–¹æ³•æ—¶ï¼Œ\u003cstrong\u003eåˆ›å»ºæ ˆå¸§å¹¶å‹å…¥Javaè™šæ‹Ÿæœºæ ˆ\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå¯¹è±¡åˆ›å»º\u003c/strong\u003eï¼š\u003cstrong\u003eå¯¹è±¡å®ä¾‹å­˜å‚¨åœ¨Javaå †ä¸­\u003c/strong\u003eï¼Œå…ƒæ•°æ®å­˜å‚¨åœ¨æ–¹æ³•åŒºã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eåƒåœ¾å›æ”¶\u003c/strong\u003eï¼šJVMæ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡å’Œç±»ä¿¡æ¯ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eçº¿ç¨‹ç»“æŸ\u003c/strong\u003eï¼šçº¿ç¨‹çš„æ ˆå’Œç¨‹åºè®¡æ•°å™¨è¢«é”€æ¯ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç¨‹åºç»“æŸ\u003c/strong\u003eï¼šJVMé‡Šæ”¾æ‰€æœ‰å†…å­˜åŒºåŸŸå¹¶é€€å‡ºã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch3 id=\"524-jvmä¸­å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ\"\u003e524. JVMä¸­å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\u003c/h3\u003e\n\u003cp\u003eæ ˆï¼šä¸»è¦ç”¨äº\u003cstrong\u003eå­˜å‚¨å±€éƒ¨å˜é‡(åŸºæœ¬ç±»å‹+å¯¹è±¡å¼•ç”¨)å’Œæ–¹æ³•çš„è°ƒç”¨ä¿¡æ¯(è¿”å›åœ°å€ã€å‚æ•°ç­‰)\u003c/strong\u003eã€‚çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºè¯¥çº¿ç¨‹çš„æ ˆå¸§ï¼Œè¢«å‹å…¥Javaè™šæ‹Ÿæœºæ ˆä¸­ã€‚ æ‰§è¡Œç»“æŸï¼Œçº¿ç¨‹æ ˆå¸§è¢«å¼¹å‡º(é”€æ¯)\u003c/p\u003e","title":"JVMé¢è¯•é¢˜ç¬”è®°"},{"content":"1 å¦‚ä½•åˆ›å»ºå¤šçº¿ç¨‹ 1ï¼‰ å®ç°Runnableæ¥å£\nå®ç°run()æ–¹æ³• 1new Thread(MyRunnable()).start(); 2ï¼‰ç»§æ‰¿Threadç±»\né‡å†™run()æ–¹æ³• 3ï¼‰Callableæ¥å£\u0026amp;\u0026amp;FutureTask\nå®ç°Callable call()æ–¹æ³•ï¼Œä½¿ç”¨FutureTaskåŒ…è£…Callableå¯¹è±¡ï¼Œé€šè¿‡Threadå¯åŠ¨ 1FutrueTask\u0026lt;ReturnType\u0026gt; task = new FutrueTask\u0026lt;\u0026gt;(MyCallable()); 2Thread(task).start 3 4ResultType res = task.get(); // è¿™é‡Œé˜»å¡ 4ï¼‰ä½¿ç”¨çº¿ç¨‹æ± \né€šè¿‡ExecutorServiceæäº¤Runnableæˆ–è€…Callableä»»åŠ¡ ä¸åŒæ–¹æ³•å¯¹æ¯”\n1Runnable vs Callable 2Callable:å¯ä»¥è¿”å›ç»“æœï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ 3 4çº¿ç¨‹æ± çš„ä¼˜åŠ¿ï¼šé¿å…é‡å¤åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œå‡å°‘è¿™éƒ¨åˆ†é‡å¤å¸¦æ¥çš„å¼€é”€ï¼› 5ThreadPool =\u0026gt; (FixedThreadPool, CachedThreadPool, ScheduledThreadPool) 6 7è™šæ‹Ÿçº¿ç¨‹ï¼šè™šæ‹Ÿçº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€æ›´ä½ 8Thread.startVirtualThread() ThreadPoolå®è·µ\nXXXThreadPool.submit(task\u0026hellip;)\n1FixedThreadPool: å›ºå®šæ± ä¸­çº¿ç¨‹æ•°é‡ =\u0026gt; é€‚åˆ1.æ‰§è¡Œè¾ƒé•¿ä»»åŠ¡ï¼›2.æ§åˆ¶å¹¶å‘åº¦ 2 3CachedThreadPoolï¼šæ± ä¸­çº¿ç¨‹æ•°é‡ä¸å›ºå®šï¼Œæ ¹æ®éœ€è¦åŠ¨æ€åˆ›å»ºçº¿ç¨‹ï¼Œç©ºçš„è¢«å›æ”¶ï¼Œå°‘äº†å¤šåˆ›å»ºï¼› 4â­é€‚ç”¨äºä»»åŠ¡æ‰§è¡Œæ—¶é—´çŸ­ä¸”ä»»åŠ¡æ•°é‡ä¸ç¡®å®šçš„åœºæ™¯ï¼› 5 6ScheduledThreadPoolï¼šé€‚ç”¨äºéœ€è¦å®šæ—¶æ‰§è¡Œæˆ–å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ã€‚ 1// å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±  2ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(5); 3// For å»¶è¿Ÿä»»åŠ¡ 4scheduledThreadPool.schedule(() -\u0026gt; { 5 // ä»»åŠ¡é€»è¾‘ 6}, 10, TimeUnit.SECONDS); // å»¶è¿Ÿ10ç§’æ‰§è¡Œ 7 8// Forå‘¨æœŸæ‰§è¡Œä»»åŠ¡ 9scheduledThreadPool.scheduleAtFixedRate(() -\u0026gt; { 10 // ä»»åŠ¡é€»è¾‘ 11}, 0, 1, TimeUnit.SECONDS); // æ¯éš”1ç§’æ‰§è¡Œä¸€æ¬¡ Thread.sleep(0) \u0026lt;= ä¸»åŠ¨è®©å‡ºCPUæ§åˆ¶æƒ\nthread.join() \u0026lt;= ç­‰å¾…è¯¥çº¿ç¨‹å®Œæˆ\n2 åˆ›å»ºçº¿ç¨‹æ±  1ï¼‰ Executorså·¥å‚ç±»\nExecutors.newFixedThreadPool(10) // 2ï¼‰ThreadPoolExecutorç›´æ¥åˆ›å»ºçº¿ç¨‹æ± \n1new ThreadPoolExecutor(corePoolSize, maximumPoolSize, KeepAliveTime,TimeUnit,new LinkedBlockingQueue\u0026lt;\u0026gt;()) 2 3LinkedBlockingQueue: å½“æäº¤çš„ä»»åŠ¡å¤šäºçº¿ç¨‹æ•°æ—¶ï¼Œä¼šå°†å¤šä½™çš„æš‚æ—¶æŒ‚èµ· çº¿ç¨‹æ± ç›¸å…³å‚æ•°è§£é‡Š\ncorePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³çº¿ç¨‹æ± ä¸­å§‹ç»ˆä¿å­˜çš„çº¿ç¨‹æ•°é‡ï¼› maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°é‡ï¼› KeepAliveTimeï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´ï¼Œéæ ¸å¿ƒçº¿ç¨‹ç©ºé—²è¶…è¿‡è¿™ä¸ªæ—¶é—´ä¼šè¢«é”€æ¯ï¼› workQueueï¼šå·¥ä½œé˜Ÿåˆ—ï¼Œå­˜æ”¾å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼› threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ï¼› rejectedExecutionHandlerï¼šä»»åŠ¡æ‹’ç»å¤„ç†å™¨ï¼Œå½“å‰ä»»åŠ¡æ— æ³•æ‰§è¡Œæ—¶çš„å¤„ç†ç­–ç•¥ã€‚ å·¥ä½œé˜Ÿåˆ—\nSynchronousQueueï¼šä¸å­˜å‚¨ä»»åŠ¡ï¼Œç›´æ¥æäº¤ä»»åŠ¡ç»™çº¿ç¨‹ï¼› LinkedBlockingQueueï¼šé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œå¤§å°æ— é™ï¼› ArrayBlockingQueueï¼šæ•°æ®ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼› PriorityBlockingQueueï¼šå¸¦ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚/ praÉªËˆÉ’rÉ™ti / çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥\né˜Ÿåˆ—æ»¡ä¸”æ— ç©ºé—²çº¿ç¨‹çš„æ·»åŠ ä»»åŠ¡çš„æƒ…å†µã€‚\nAbortPolicyï¼šæŠ›å¼‚å¸¸ï¼› CallerRunsPolicyï¼šç”±æäº¤çº¿ç¨‹æœ¬èº«æ‰§è¡Œï¼› DiscardOldestPolicyï¼šåˆ é™¤æœ€æ—©æäº¤çš„ä»»åŠ¡ï¼› DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒå½“å‰ä»»åŠ¡ã€‚ 3 çº¿ç¨‹å®‰å…¨çš„é›†åˆ 1concurrentHashMap: åŒæ­¥HashMap\u0026lt;K-\u0026gt;V\u0026gt; 2æ•°æ®ç»“æ„=\u0026gt; ä½¿ç”¨æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘çš„ç»“æ„; 3çº¿ç¨‹å®‰å…¨=\u0026gt; CASä¿è¯æ“ä½œçš„åŸå­æ€§ 4 5eg:çº¿ç¨‹ä¸å®‰å…¨çš„æ“ä½œï¼š 6// éçº¿ç¨‹å®‰å…¨çš„æ“ä½œ 7int value = map.get(\u0026#34;key\u0026#34;); // è¿™é‡Œï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹å¯¹key-\u0026gt;valueè¿›è¡Œäº†ä¿®æ”¹ï¼ï¼Œè¿™é‡Œçš„valueæ˜¯è¿‡æœŸäº†çš„ 8map.put(\u0026#34;key\u0026#34;, value + 1); 9// â­ä¿è¯åŸå­æ€§ 10map.compute(\u0026#34;key\u0026#34;, (k, v) -\u0026gt; v + 1); // ä¸€æ¬¡å®Œæˆ 11 12// å¦‚æœæ˜¯æ–¹æ³•ä¸­åˆ›å»ºçš„Map,æ¯ä¸ªçº¿ç¨‹ä¸“äº«ï¼Œä¸ä¼šæœ‰çº¿ç¨‹é—´å®‰å…¨é—®é¢˜ 13// å¦‚æœæ˜¯ç±»ä¸­ï¼Œä¸”å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªClasså®ä¾‹ï¼Œåˆ™å¯èƒ½å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ 14Methodä¸­åˆ›å»ºï¼šå®‰å…¨ 15Class-æˆå‘˜å˜é‡ï¼šå¤šä¸ªçº¿ç¨‹å¯èƒ½å…±äº«åŒä¸€ä¸ªmapå®ä¾‹ï¼Œéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ 16Class-é™æ€å˜é‡ï¼šæ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ª map å®ä¾‹ ï¼Œéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ 17 18BlockingQueueï¼š -æ•°ç»„å®ç° 19LinkedBlockingQueue: çº¿ç¨‹å®‰å…¨çš„é˜»å¡é˜Ÿåˆ—-é“¾è¡¨å®ç° 4 çº¿ç¨‹åŒæ­¥ å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œé¿å…å…±äº«èµ„æºåŒæ—¶è®¿é—®ï¼Œå¼•å‘æ•°æ®ä¸ä¸€è‡´ã€‚=\u0026gt; åŠ é”ï¼Œé™åˆ¶è®¿é—®ã€‚\nJAVAä¸­ï¼Œå¸¸è§çš„åŒæ­¥æ–¹å¼ï¼š\nsynchronized åŒæ­¥ // ä»…é™ä¸€ä¸ªçº¿ç¨‹è®¿é—®. ç”± JVM è´Ÿè´£ç®¡ç†é”çš„è·å–å’Œé‡Šæ”¾. éå…¬å¹³é”\nç”Ÿäº§-æ¶ˆè´¹ æ¨¡æ‹Ÿ\n1Mainï¼š 2// å…±äº«é˜Ÿåˆ—ï¼Œç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„æ•°æ®ä¼ é€’ 3Queue\u0026lt;Integer\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); // or BlockingQueue 4int maxSize = 5; // é˜Ÿåˆ—çš„æœ€å¤§å®¹é‡ 5 6// åˆ›å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹ 7Thread producer = new Thread(new Producer(queue, maxSize), \u0026#34;Producer\u0026#34;); 8Thread consumer = new Thread(new Consumer(queue), \u0026#34;Consumer\u0026#34;); 9 10// å¯åŠ¨çº¿ç¨‹ 11producer.start(); 12consumer.start(); 1Producer: å®ç°Runnable interface 2@Override 3public void run() { 4 int i = 0; 5 while (true) { 6 synchronized (queue) { // å¯¹é˜Ÿåˆ—åŠ é” 7 // å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…ç­‰å¾… 8 while (queue.size() == maxSize) { 9 try { 10 System.out.println(\u0026#34;é˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…ç­‰å¾…...\u0026#34;); 11 queue.wait(); // é‡Šæ”¾é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ 12 } catch (InterruptedException e) { 13 e.printStackTrace(); 14 } 15 } 16 17 // ç”Ÿäº§æ•°æ®å¹¶æ·»åŠ åˆ°é˜Ÿåˆ— 18 System.out.println(\u0026#34;ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®: \u0026#34; + i); 19 queue.add(i++); 20 21 // é€šçŸ¥æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹äº† 22 queue.notifyAll(); 23 24 // æ¨¡æ‹Ÿç”Ÿäº§è€—æ—¶ 25 try { 26 Thread.sleep(500); 27 } catch (InterruptedException e) { 28 e.printStackTrace(); 29 } 30 } 31 } 32} 1Consumerï¼šå®ç°Runnableæ¥å£ 2@Override 3public void run() { 4 while (true) { 5 synchronized (queue) { // å¯¹é˜Ÿåˆ—åŠ é” 6 // å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œæ¶ˆè´¹è€…ç­‰å¾… 7 while (queue.isEmpty()) { 8 try { 9 System.out.println(\u0026#34;é˜Ÿåˆ—ä¸ºç©ºï¼Œæ¶ˆè´¹è€…ç­‰å¾…...\u0026#34;); 10 queue.wait(); // é‡Šæ”¾é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ 11 } catch (InterruptedException e) { 12 e.printStackTrace(); 13 } 14 } 15 16 // æ¶ˆè´¹æ•°æ® 17 int value = queue.poll(); 18 System.out.println(\u0026#34;æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®: \u0026#34; + value); 19 20 // é€šçŸ¥ç”Ÿäº§è€…å¯ä»¥ç”Ÿäº§äº† 21 queue.notifyAll(); 22 23 // æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶ 24 try { 25 Thread.sleep(1000); 26 } catch (InterruptedException e) { 27 e.printStackTrace(); 28 } 29 } 30 } 31} â­â­â­\nsynchronizedï¼ˆä¸´ç•ŒåŒºå¯¹è±¡ï¼‰ \u0026lt;= é”ä½ä¸´ç•ŒåŒº\nwhile(ä¸´ç•ŒåŒºä¸å¯ç”¨) =\u0026gt; é‡è¯• =\u0026gt; .wait() å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€è®©å‡ºCPUï¼Œå¹¶ä¸”é‡Šæ”¾é”\nå¤„ç†å®Œæˆ=\u0026gt; .notifyAll() // é€šçŸ¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹\nsynchronizedï¼šé€šè¿‡ Object.wait() å’Œ Object.notify()/notifyAll() è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡\nReentrantLock å¯é‡å…¥é” Re en trant lock. éœ€è¦æ‰‹åŠ¨åŠ é”å’Œé‡Šæ”¾é”\n1lock.lock(); 2try { 3 // ä¸´ç•ŒåŒºä»£ç  4} finally { 5 lock.unlock(); 6} ReentrantLockï¼šä½¿ç”¨ Condition å¯¹è±¡æ›´çµæ´»åœ°æ§åˆ¶çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’ï¼š\n1Condition condition = lock.newCondition(); 2lock.lock(); 3try { 4 condition.await(); // çº¿ç¨‹ç­‰å¾… 5 condition.signal(); // å”¤é†’å•ä¸ªç­‰å¾…çš„çº¿ç¨‹ 6 condition.signalAll(); // å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ 7} finally { 8 lock.unlock(); 9} æ¡ˆä¾‹\n1// å…±äº«é˜Ÿåˆ—ï¼Œç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„æ•°æ®ä¼ é€’ 2Queue\u0026lt;Integer\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); 3// åˆ›å»º ReentrantLock å’Œ Condition 4Lock lock = new ReentrantLock(); 5Condition notFull = lock.newCondition(); // é˜Ÿåˆ—æœªæ»¡çš„æ¡ä»¶ 6Condition notEmpty = lock.newCondition(); // é˜Ÿåˆ—éç©ºçš„æ¡ä»¶ 7 8Producer: 9while(true) { 10 lock.lock() 11 try{ 12 // 13 while(queue.size == maxSize) { 14 System.out.println(\u0026#34;é˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…ç­‰å¾…...\u0026#34;); 15 notFull.await(); // ç­‰å¾…é˜Ÿåˆ—æœªæ»¡çš„æ¡ä»¶ 16 } 17 18 queue.add(?) 19 notEmpty.signalAll() 20 21 // ... ç”Ÿäº§è€—æ—¶ 22 23 }finally{ 24 lock.unlock() 25 } 26} 27 28Consumer: 29while(true) { 30 lock.lock() 31 try { 32 while(queue.size == 0) { 33 sout(\u0026#34;æ²¡ä¸œè¥¿æ¶ˆè´¹\u0026#34;) 34 notEmpty.await() 35 } 36 37 queue.poll() 38 notFull.signalAll() 39 40 // ...æ¶ˆè´¹æ—¶é•¿ 41 }finally{ 42\tlock.unlock() 43 } 44} â­â­â­ å…³é”®ç”¨æ³•ï¼š\nLock lock = new ReentrantLock(); Condition notFull = lock.newCondition(); // é˜Ÿåˆ—æœªæ»¡çš„æ¡ä»¶ Condition notEmpty = lock.newCondition(); // é˜Ÿåˆ—éç©ºçš„æ¡ä»¶\nlock.lock \u0026amp;\u0026amp; lock.unlock\nnotFull.await(), notFull.signal(), notFull.signalAll()\n5 çº¿ç¨‹å®‰å…¨ ä¿è¯å¤šçº¿ç¨‹ï¼Œä¹±åºæ‰§è¡Œæ—¶å€™ï¼Œæ— è®ºæ€ä¹ˆæ‰§è¡Œï¼Œéƒ½å¯ä»¥å¾—åˆ°é¢„æœŸç»“æœ\n=\u0026gt; é€šè¿‡ çº¿ç¨‹åŒæ­¥ (æ‚²è§‚é”)\né€šè¿‡Synchronized å’Œ ReentrantLock ËˆsÉªÅ‹krÉ™naÉªzd \u0026amp; riËËˆentrÉ™nt, lÉ’k å®ç°çº¿ç¨‹åŒæ­¥\n=\u0026gt; é€šè¿‡åŸå­æ“ä½œç±»\nAtomicInteger É™ËˆtÉ’mÉªk åŸå­ï¼Œ åŸå­æ•´æ•°\nâ­â­â­æ‰©å±•CASï¼ˆä¹è§‚é”ï¼‰ï¼šï¼ˆCompare And Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰æ˜¯ä¸€ç§æ— é”å¹¶å‘ç¼–ç¨‹æŠ€æœ¯ï¼Œå¸¸ç”¨äºå®ç°åŸå­æ“ä½œã€‚å®ƒçš„åŸºæœ¬åŸç†æ˜¯ï¼šå…ˆæ¯”è¾ƒï¼Œå†äº¤æ¢ï¼Œå³åªæœ‰å½“å˜é‡çš„å½“å‰å€¼ç­‰äºé¢„æœŸå€¼æ—¶ï¼Œæ‰ä¼šæ›´æ–°ï¼Œå¦åˆ™é‡è¯•ã€‚\n1// å½“å‰å€¼, é¢„æœŸå€¼, æ–°å€¼ 2boolean compareAndSwap(V, E, N) { 3 if (V == E) { // æ¯”è¾ƒå½“å‰å€¼æ˜¯å¦ç­‰äºé¢„æœŸå€¼ 4 V = N; // å¦‚æœç›¸ç­‰ï¼Œæ›´æ–°ä¸ºæ–°å€¼ 5 return true; // æ“ä½œæˆåŠŸ 6 } 7 return false; // æ“ä½œå¤±è´¥ 8} ä¾‹å­ï¼šæœ€ä½³å®è·µæ¡ˆä¾‹=\u0026gt; çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨\n1private AtomicInteger value = new AtomicInteger(0); 2 3// çº¿ç¨‹å®‰å…¨çš„é€’å¢æ–¹æ³• 4public void increment() { 5 int oldValue; 6 int newValue; 7 do { 8 oldValue = value.get(); // è·å–å½“å‰å€¼, å…ˆè·å–ä¿®æ”¹å€¼ 9 newValue = oldValue + 1; // è®¡ç®—æ–°å€¼ 10 } while (!value.compareAndSet(oldValue, newValue)); // CAS æ“ä½œ 11} 12// CAS compare and swap \u0026lt;=\u0026gt; è®¿é—®åˆ°ä¿®æ”¹æœŸé—´ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œå°±å¯ä»¥æ‰§è¡Œ 13value.compareAndSet(oldValue, newValue) =\u0026gt; oldvalue == value.get() ? value = newValue ï¼šnothing æ£€æŸ¥ç¬¬ä¸€æ¬¡å¾—åˆ°çš„æ—§å€¼ä¸ä¿®æ”¹æ—¶çš„å€¼æ˜¯å¦ä¸€è‡´ï¼Œåˆ¤æ–­æ˜¯å¦è¢«åŠ¨è¿‡ï¼Œæ²¡åŠ¨è¿‡å†æ”¹\n=\u0026gt; çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼šconcurrentHashMap or copyonWriteArrayListâŒ ä¸æ‡‚\n=\u0026gt; å±€éƒ¨å˜é‡ï¼Œçº¿ç¨‹ä¸“äº«\n=\u0026gt; ThreadLocal, çº¿ç¨‹æœ¬åœ°èµ„æºï¼Œçº¿ç¨‹ä¸“äº«\n6 çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ åˆå§‹(èµ„æº) =\u0026gt; å¯è¿è¡Œ(CPUé˜Ÿåˆ—) =\u0026gt; è¿è¡Œ =\u0026gt; ç»ˆæ­¢\nâ€‹ é˜»å¡\u0026amp;ç­‰å¾…\n7 çº¿ç¨‹é€šä¿¡ å¤šçº¿ç¨‹é—´çš„ååŒå·¥ä½œ\n1ï¼‰**å…±äº«å˜é‡ï¼š**è®¿é—®å…±äº«å†…å­˜å˜é‡æ¥äº¤æ¢ä¿¡æ¯ï¼›\n2ï¼‰åŒæ­¥æœºåˆ¶ï¼š\nsynchronized() =\u0026gt; wait =\u0026gt; notify\u0026amp;notifyAll ï¼ˆObjectä¸­çš„æ–¹æ³•ï¼‰\nReentrantLock.lock =\u0026gt; condition.await =\u0026gt; condition.signal\u0026amp;signalAll\nBlockingQueue =\u0026gt; queue.put() æ»¡åˆ™é˜»å¡ =\u0026gt; queue.take() ç©ºåˆ™é˜»å¡\n1synchronized (lock) { 2 while (conditionNotMet) { 3 lock.wait(); // é‡Šæ”¾é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ 4 } 5 // æ‰§è¡Œæ“ä½œ 6 lock.notify(); // å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ 7} 1Lock lock = new ReentrantLock(); 2Condition condition = lock.newCondition(); 3 4lock.lock(); 5try { 6 while (conditionNotMet) { 7 condition.await(); // ç­‰å¾… 8 } 9 // æ‰§è¡Œæ“ä½œ 10 condition.signal(); // å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ 11} finally { 12 lock.unlock(); 13} 1BlockingQueue\u0026lt;String\u0026gt; queue = new LinkedBlockingQueue\u0026lt;\u0026gt;(10); 2 3// ç”Ÿäº§è€… 4new Thread(() -\u0026gt; { 5 try { 6 queue.put(\u0026#34;Data\u0026#34;); 7 } catch (InterruptedException e) { 8 Thread.currentThread().interrupt(); 9 } 10}).start(); 11 12// æ¶ˆè´¹è€… 13new Thread(() -\u0026gt; { 14 try { 15 String data = queue.take(); 16 } catch (InterruptedException e) { 17 Thread.currentThread().interrupt(); 18 } 19}).start(); 8 çº¿ç¨‹æ±  æ± åŒ–æŠ€æœ¯ï¼Œé¢„å…ˆåˆ›å»ºå¹¶ç®¡ç†ä¸€ç»„çº¿ç¨‹ï¼Œé¿å…çº¿ç¨‹é‡å¤åˆ›å»ºå’Œé”€æ¯å¸¦æ¥çš„å¼€é”€\nå…³é”®é…ç½®ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œç©ºé—´å­˜æ´»æ—¶é—´ï¼Œå·¥ä½œé˜Ÿåˆ—ï¼Œæ‹’ç»ç­–ç•¥\n=\u0026gt; æäº¤ä»»åŠ¡æ‰ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œæˆ–è€…è®¾ç½®preStartAllCoreThreads\n=\u0026gt; æ ¸å¿ƒçº¿ç¨‹æ»¡äº†ä¸ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯æŠŠå¤šä½™çš„ä»»åŠ¡æ”¾åˆ°å·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ‰§è¡Œ\n=\u0026gt; æ ¸å¿ƒçº¿ç¨‹æ»¡è½½ä¸”å·¥ä½œé˜Ÿåˆ—æ”¾ä¸ä¸‹äº†ï¼Œæ‰ä¼šæ–°å¢çº¿ç¨‹æ‰§è¡Œæäº¤çš„ä»»åŠ¡(\u0026lt;æœ€å¤§çº¿ç¨‹æ•°)\n=\u0026gt; å·¥ä½œé˜Ÿåˆ—æ»¡äº†+å·²æœ€å¤§çº¿ç¨‹æ•°äº† =\u0026gt; æ‹’ç»ç­–ç•¥?æ–°ä»»åŠ¡\n=\u0026gt; çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡æŒ‡å®šæ—¶é—´ ä¸”æœ‰å¤šä½™çš„éæ ¸å¿ƒçº¿ç¨‹ =\u0026gt; é‡Šæ”¾éæ ¸å¿ƒçº¿ç¨‹\nå·¥ä½œé˜Ÿåˆ—ï¼š\nLinkedBlockingQueue æ— ç•Œé˜Ÿåˆ—ï¼Œé“¾å¼\nArrayBlockingQueue æœ‰ç•Œé˜Ÿåˆ—ï¼Œæ•°ç»„\nPriorityBlockingQueue å¸¦æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—\nçº¿ç¨‹æ± ç±»å‹ï¼š\n1FixedThreadPool: å›ºå®šçº¿ç¨‹æ•° 2CachedThreadPoolï¼šå˜åŒ–ï¼ŒåŠ¨æ€æ–°å»º 3SingleThreadPoolï¼šå•çº¿ç¨‹çš„æ± å­ 4ScheduledThreadPoolï¼šå®šæ—¶ä»»åŠ¡çš„æ± å­ shutdownä¸shutdownNowçš„åŒºåˆ«\nshutdownï¼šæé†’å…³é—­ï¼Œä¼šæŠŠå·²æäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•\nshutdownNowï¼šå¼ºåˆ¶åœæ­¢\n9 å¹¶å‘å·¥å…·ç±» ConcurrentHashMapï¼šçº¿ç¨‹å®‰å…¨çš„HashMapï¼Œå¤šçº¿ç¨‹ä¿®æ”¹ä¸´ç•ŒåŒºæ—¶åŠ é”æˆ–è€…å…¶ä»–æ–¹æ³•ï¼Œ=\u0026gt;å®‰å…¨\nAtomicIntergerï¼šÉ™ËˆtÉ’mÉªk çº¿ç¨‹å®‰å…¨çš„æ•´å‹ compareAndSet CASæ–¹æ³•ï¼ŒåŸå­ç±»å‹\nSemaphore ä¿¡å·é‡ï¼šacquire() and release()\nBlockingQueueï¼šé˜»å¡é˜Ÿåˆ—-é€šä¿¡å®¹å™¨ queue.put() and queue.take()\nCyclicBarrierï¼šå¾ªç¯å±éšœ barrier.await\nCountDownlatchï¼šè®¡æ—¶å™¨ latch.countDown() latch.await()\n497 ReentrantLockå®ç° =\u0026gt; å¯é‡å…¥é”ï¼Œå…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€æŠŠé”çš„é”æœºåˆ¶ï¼Œé¿å…çº¿ç¨‹å› ä¸ºé‡å¤è·å–é”è€Œå¯¼è‡´æ­»é”\næ¡ˆä¾‹ï¼š1. é€’å½’è°ƒç”¨ä¸­çš„é”ä¿æŠ¤\n1# éå…¬å¹³é” 2final boolean nonfairTryAcquire(int acquires) { 3 final Thread current = Thread.currentThread(); 4 int c = getState(); 5 if (c == 0) { // é”æœªè¢«å ç”¨ 6 if (compareAndSetState(0, acquires)) { // CAS å°è¯•è·å–é” 7 setExclusiveOwnerThread(current); // è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºç‹¬å çº¿ç¨‹ 8 return true; 9 } 10 } else if (current == getExclusiveOwnerThread()) { // â­â­â­é”å·²è¢«å½“å‰çº¿ç¨‹å ç”¨ï¼ˆé‡å…¥ï¼‰ 11 int nextc = c + acquires; // å¢åŠ é‡å…¥æ¬¡æ•° 12 if (nextc \u0026lt; 0) throw new Error(\u0026#34;Maximum lock count exceeded\u0026#34;); 13 setState(nextc); // æ›´æ–°çŠ¶æ€ 14 return true; 15 } 16 return false; // è·å–é”å¤±è´¥ 17} åŸºäºAQSå®ç°çš„ä¸€ä¸ªå¯é‡å…¥é”ï¼Œæ”¯æŒå…¬å¹³å’Œéå…¬å¹³ä¸¤ç§æ–¹å¼\nå†…éƒ¨ä¾é ä¸€ä¸ªStateå˜é‡å’Œä¸¤ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼šåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—\nåˆ©ç”¨CASä¿®æ”¹stateæ¥äº‰å¤ºé”\näº‰æŠ¢ä¸åˆ°é”å°±å…¥AQS ç­‰å¾…é˜Ÿåˆ—è¿›è¡Œç­‰å¾…ï¼ŒAQS ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒå‘é˜Ÿåˆ—\næŠ¢åˆ°é”ä½†æ˜¯æ¡ä»¶conditionä¸æ»¡è¶³åˆ™å…¥æ¡ä»¶é˜Ÿåˆ—(æ¯ä¸ªconditionç»´æŠ¤ä¸€ä¸ª)ï¼Œå•å‘é“¾è¡¨\næ˜¯å¦å…¬å¹³é” =\u0026gt; çº¿ç¨‹è·å–é” æ˜¯åŠ å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨è¿˜æ˜¯ç›´æ¥åˆ©ç”¨CASäº‰å¤ºé”\nReentrantLock æ˜¯åŸºäº AQS å®ç°çš„å¯é‡å…¥ç‹¬å é”ï¼Œæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ä¸¤ç§æ¨¡å¼ã€‚å…¶æ ¸å¿ƒæ˜¯é€šè¿‡ AQS çš„çŠ¶æ€ç®¡ç†ï¼ˆstateï¼‰å’Œç­‰å¾…é˜Ÿåˆ—æ¥å®ç°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’ã€‚éå…¬å¹³é”çš„æ€§èƒ½é€šå¸¸ä¼˜äºå…¬å¹³é”ï¼Œä½†å…¬å¹³é”å¯ä»¥é¿å…çº¿ç¨‹é¥¥é¥¿é—®é¢˜ã€‚ReentrantLock æä¾›äº†æ¯” synchronized æ›´çµæ´»çš„é”æ“ä½œï¼Œæ˜¯ Java å¹¶å‘ç¼–ç¨‹ä¸­çš„é‡è¦å·¥å…·\n492 Synchronizedå®ç° ä¾èµ–äºJVMçš„ç›‘è§†å™¨é”+å¯¹è±¡å¤´\nå½“synchronizedä¿®é¥°åœ¨æ–¹æ³•æˆ–è€…ä»£ç å—ä¸Šæ—¶ï¼Œä¼šå¯¹ç‰¹å®šçš„å¯¹è±¡æˆ–è€…ç±»åŠ é”ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿è¡ŒåŠ é”çš„ä»£ç å—ï¼›\nsynchronizedä¿®é¥°æ–¹æ³•ï¼šæ–¹æ³•çš„æ ‡å¿—ä½ä¼šå¢åŠ ä¸€ä¸ªACC_SYNCHRONIZEDæ ‡å¿—ï¼Œæ£€æŸ¥æ ‡å¿—å†è·å–é”ï¼Œè¿™éƒ¨åˆ†è¿›è¡ŒåŒæ­¥æ§åˆ¶ synchronizedä¿®é¥°ä»£ç å—ï¼šä¼šåœ¨ä»£ç å—å‰åæ’å…¥monitorenterå’Œmonitorexitå­—èŠ‚ç æŒ‡ä»¤ï¼Œä¸Šé”+è§£é” synchronizedæ˜¯å¯é‡å…¥é”\n491 Synchronizedå’ŒReentrantLock 496 å¦‚ä½•ä¼˜åŒ–Javaä¸­é”çš„ä½¿ç”¨ï¼Ÿ å‡å°‘é”çš„ç²’åº¦ï¼š å‡å°‘åŠ é”çš„èŒƒå›´ï¼Œå‡å°‘é”çš„æŒç»­æ—¶é—´ ä½¿ç”¨æ›´ç»†ç²’åº¦çš„é”ï¼šæé«˜å¹¶å‘åº¦ hashTable: é€šè¿‡æ–¹æ³•ä¸Šæ·»åŠ synchronizedå®ç°é”çš„å®‰å…¨ï¼Œä»…ä¸€ä¸ªçº¿ç¨‹ï¼Œæ€§èƒ½è¾ƒå·® concurrentHashMapï¼š é€šè¿‡CAS+synchronizedå®ç°çº¿ç¨‹å®‰å…¨ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™ï¼Œæ€§èƒ½æ›´é«˜ å‡å°‘é”çš„ä½¿ç”¨ é€šè¿‡æ— é”ç¼–ç¨‹ã€CASæ“ä½œå’ŒåŸå­ç±»æ¥é¿å…é”çš„ä½¿ç”¨ï¼Œå‡å°‘é”å¸¦æ¥çš„æ€§èƒ½æŸå¤± é€šè¿‡å‡å°‘å…±äº«èµ„æºçš„ä½¿ç”¨ï¼Œé¿å…å¯¹ä¸´ç•ŒåŒºçš„ç«äº‰ã€‚(æœ¬åœ°å˜é‡+çº¿ç¨‹æœ¬åœ°å˜é‡) æ‰©å±•ï¼š\nç‹¬å é”ï¼šå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é” è¯»å†™é”ï¼šå…è®¸å¤šä¸ªçº¿ç¨‹å¹¶å‘è¯»ï¼Œä½†å†™çš„æ—¶å€™éœ€è¦ä¸Šé”ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ ä¹è§‚é”å’Œæ‚²è§‚é”ï¼šæ‚²è§‚é”æ¯æ¬¡éƒ½åŠ é”ï¼›ä¹è§‚é”å‡è®¾æ²¡æœ‰å†²çª-CASæˆ–ç‰ˆæœ¬å·å®ç° 499 è¯»å†™é” å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»æ“ä½œï¼Œä½†æ˜¯å†™æ“ä½œéœ€è¦åŠ é”(å•ä¸ªçº¿ç¨‹)ã€‚\n=\u0026gt; è¯»å†™+å†™å†™æ“çºµæ˜¯äº’æ–¥æ“ä½œï¼›â­é€‚åˆè¯»å¤šå†™å°‘çš„æƒ…å†µ\nå¯ä»¥åˆ©ç”¨ReadWriteLockå’ŒReentrantReadWriteLockå®ç°\n1# ä»£ç ç¤ºä¾‹ 2 3ReentrantReadWriteLock lock = new ReentrantReadWriteLock() 4Lock readLock = lock.readLock() 5lock writeLock = lock.writeLock() 6 7// 1. åˆ¤æ–­å†™é”(è¯»å†™äº’æ–¥)2. åˆ¤æ–­è¯»é”,ç¬¬ä¸€ä¸ªå’Œåç»­ 8readLock.lock() 9try{ 10 ... 11} finally { 12 readLock.unlock() 13} 14 15// 1. æœ‰è¯»é”æˆ–å†™é”ä¸”å†™é”ä¸æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å¤±è´¥ 16// 2. æ ¹æ®å…¬å¹³æ€§ç­–ç•¥ï¼ˆå…¬å¹³é”æˆ–éå…¬å¹³é”ï¼‰å†³å®šæ˜¯å¦éœ€è¦é˜»å¡ 17// 3. CAS æ›´æ–°çŠ¶æ€ 18// 4. è®¾ç½®å†™é”æŒæœ‰è€… \u0026lt;= è®¾ç½®å¯é‡å…¥ 19writeLock.lock() // äº’æ–¥ å†™å†™äº’æ–¥ 20try{ 21 ... 22} finally { 23 writeLock.unlock() 24} 501 Java JMM javaå†…å­˜æ¨¡å‹ java memory model\nç”¨äºæè¿°çº¿ç¨‹ä½•æ—¶ä»ä¸»å†…å­˜ä¸­è¯»å–æ•°æ®ã€ä½•æ—¶æŠŠæ•°æ®å†™å›ä¸»å­˜ä¸­\nJMMæ ¸å¿ƒç›®æ ‡\nå¯è§æ€§ï¼šç¡®ä¿æŸä¸ªçº¿ç¨‹çš„ä¿®æ”¹ï¼Œå…¶ä»–çº¿ç¨‹åŠæ—¶å¯è§ã€‚ ä½¿ç”¨volatileå…³é”®å­—å¼ºåˆ¶çº¿ç¨‹æ¯æ¬¡è¯»å†™éƒ½ç›´æ¥ä»ä¸»å†…å­˜ä¸­è·å–æ–°å€¼ æœ‰åºæ€§ï¼šæŒ‡çº¿ç¨‹æ‰§è¡Œæ“ä½œçš„é¡ºåºï¼ŒJMMå…è®¸æŸäº›æŒ‡ä»¤é€šè¿‡æŒ‡ä»¤é‡æ‹æé«˜æ€§èƒ½ï¼Œä¸”ä¿è¯çº¿ç¨‹å†…çš„æ“ä½œé¡ºåºä¸ä¼šè¢«ç ´åï¼Œé€šè¿‡happens-beforeå…³ç³»ä¿è¯è·¨çº¿ç¨‹çš„æœ‰åºæ€§ã€‚ **åŸå­æ€§ï¼š**æŒ‡æ“ä½œä¸å¯åˆ†å‰²ï¼Œçº¿ç¨‹ä¸ä¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«ä¸­æ–­ã€‚ Why JMMï¼š\næ“ä½œç³»ç»Ÿæœ‰è‡ªå·±çš„å†…å­˜æ¨¡å‹ï¼Œä½†JAVAæ˜¯è·¨å¹³å°å®ç°çš„ï¼Œå› æ­¤éœ€è¦è‡ªå·±è®¾è®¡ä¸€å¥—å†…å­˜æ¨¡å‹å±è”½å„æ“ä½œç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ã€‚JMMæè¿°äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•åœ¨ä¸é€šè¿‡çš„çº¿ç¨‹ä¹‹é—´å…±äº«å˜é‡ä»¥åŠå˜é‡çš„æ“ä½œé¡ºåºã€‚\nä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ï¼š\nä¸»å†…å­˜ï¼šJAVAå †å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„å®ä¾‹å˜é‡ã€é™æ€å˜é‡å’Œæ•°ç»„å…ƒç´ éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼› å·¥ä½œå†…å­˜ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜å­˜å‚¨äº†ä¸»å†…å­˜ä¸­çš„å˜é‡å‰¯æœ¬ï¼Œçº¿ç¨‹çš„æ‰€æœ‰æ“ä½œéƒ½åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œã€‚ çº¿ç¨‹ä¹‹é—´çš„å˜é‡ï¼Œå¿…é¡»ç»è¿‡ä¸»å†…å­˜è¿›è¡Œä¼ é€’ 506 Why ThreadLocal æ¯ä¸ªçº¿ç¨‹è‡ªå·±ç‹¬äº«çš„ç‹¬ç«‹å˜é‡å‰¯æœ¬ï¼Œé¿å…å¤šä¸ªçº¿ç¨‹é—´çš„å˜é‡å…±äº«å’Œç«äº‰ï¼Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\næ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªThreadLocalMap ç”¨äºå­˜å‚¨çº¿ç¨‹ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼ŒThreadLocalMapä»¥ThreadLocalå®ä¾‹ä¸ºé”®ï¼Œä¸åŒçº¿ç¨‹é€šè¿‡è‡ªå·±ThreadLocalèº«ä»½è·å–å„è‡ªçš„å˜é‡å‰¯æœ¬ã€‚\né¿å…åŒä¸€ä¸ªThreadLocalMapçš„ç«äº‰\n517 Javaä¸­waitã€notifyå’ŒnotifyALL è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯Objectå¯¹è±¡å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨äºçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œä¸”éœ€è¦åœ¨Synchronizedä¿®é¥°å†…ä½¿ç”¨\nwait =\u0026gt; çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‡Šæ”¾é” notify =\u0026gt; å”¤é†’ä¸€ä¸ªåœ¨ç­‰å¾…çš„çº¿ç¨‹ notifyALL =\u0026gt; å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ 518 æ­»é” åŠ é¿å… æ¡ä»¶äº’æ–¥ï¼šç‹¬äº«èµ„æº å æœ‰ä¸”ç­‰å¾…ï¼šä¸æ”¾æ‰‹ï¼Œç­‰åˆ«äººæ”¾å¼ƒ ä¸å¯æŠ¢å ï¼šæ–‡æ˜ å¾ªç¯ç­‰å¾…ï¼š A=\u0026gt;B=\u0026gt;C=\u0026gt;A é¿å…ï¼š\næŒ‰åºç”³è¯· =\u0026gt; é”è·å–çš„é¡ºåºç›¸åŒï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å‰é¢å¡ä½ è¶…æ—¶ç­‰å¾…æ—¶é—´=\u0026gt;é‡Šæ”¾æ‰‹ä¸­èµ„æºå’Œé” 519 volatileå…³é”®å­— ä¸»è¦çš„ä½œç”¨è¿˜æ˜¯ä¿è¯å˜é‡çš„å¯è§æ€§\nå¯è§æ€§ï¼šä¿®æ”¹äº†volatileå˜é‡çš„å€¼ï¼Œè¯¥å€¼ä¼šè¢«ç«‹åˆ»åˆ·æ–°å›ä¸»å†…å­˜ä¸­ï¼ŒåŠæ—¶è®©å…¶ä»–çº¿ç¨‹å¯è§ã€‚ 6304 å¦‚ä½•çŸ¥æ™“å­çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Ÿ ThreadObj.join() ä¼šç­‰å¾…å¯¹åº”å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯• FutureTask+Callable futrue.get() æ‹¿åˆ°çº¿ç¨‹æ‰§è¡Œå®Œæˆçš„ç»“æœ å›è°ƒæœºåˆ¶ï¼šå®Œæˆåï¼Œè°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥ä¸»çº¿ç¨‹ï¼Œå¼‚æ­¥äº† 481 Semaphore ä¿¡å·é‡ ËˆsemÉ™fÉ”Ër\nä¸»è¦ä½œç”¨å°±æ˜¯ç¡®ä¿ åªæœ‰æŒ‡å®šæ•°é‡çš„çº¿ç¨‹èƒ½å¤Ÿè®¿é—®èµ„æºï¼Œé™åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡\nåŸºæœ¬æ¦‚å¿µ\nè®¸å¯ permits: å¯ä»¥è®¿é—®èµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚\nAcquireï¼šå°è¯•è·å–è®¸å¯ï¼›\nreleaseï¼šé‡Šæ”¾è®¸å¯ã€‚\nå…¬å¹³ï¼šæŒ‰ç…§è¯·æ±‚é¡ºåºè·å–è®¸å¯ï¼Œé˜²æ­¢çº¿ç¨‹é¥¥é¥¿\néå…¬å¹³ï¼šå¯ä»¥æé«˜æ€§èƒ½ã€‚\nå¸¸è§ç”¨æ³•ï¼š\n1Semaphore semaphore = new Semaphore(10); // å…è®¸æœ€å¤š10ä¸ªçº¿ç¨‹è®¿é—® 2semaphore.acquire(); // å¤±è´¥ä¼šé˜»å¡ä¸ä¼šå¾€ä¸‹æ‰§è¡Œäº† 3try { 4 // è®¿é—®å…±äº«èµ„æº 5} finally { 6 semaphore.release(); 7} 8 9Semaphore semaphore = new Semaphore(5); // å…è®¸æœ€å¤š5ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä»»åŠ¡ 10for (int i = 0; i \u0026lt; 10; i++) { 11 new Thread(() -\u0026gt; { 12 try { 13 semaphore.acquire(); // é˜»å¡ 14 // æ‰§è¡Œä»»åŠ¡ 15 } catch (InterruptedException e) { 16 Thread.currentThread().interrupt(); 17 } finally { 18 semaphore.release(); 19 } 20 }).start(); 21} 482 CyclicBarrier ËˆsaÉªklÉªk ËˆbÃ¦riÉ™(r) å¾ªç¯éšœç¢ // å¯ä»¥é‡ç”¨ï¼Œå½“æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾å±éšœåï¼Œåˆ·æ–°\nå…è®¸ä¸€ç»„çº¿ç¨‹åœ¨æ‰§è¡ŒæŸä¸ªä»»åŠ¡ç›¸äº’ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½è¾¾åˆ°äº†Barrierå±éšœåæ‰èƒ½ç»§ç»­æ‰§è¡Œ // ç›´æ¥å…¨å¡ä½\nå±éšœï¼šè°ƒç”¨barrier.await() é˜»å¡ï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœï¼› çº¿ç¨‹æ•°é‡ï¼šé¢„æŒ‡å®šçš„ï¼Œå½“æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾å±éšœï¼Œæ‰€æœ‰çº¿ç¨‹æ‰è¢«å”¤é†’ï¼› é‡ç”¨æ€§ï¼šå¯ä»¥è¢«é‡ç”¨ã€‚ 1# ç¤ºä¾‹ 2static CyclicBarrier cyclicbarrier; 3cyclicbarrier = new CyclicBarrier(parties=10, () -\u0026gt; Sout(\u0026#34;å…¨éƒ¨å‡†å¤‡å°±ç»ª\u0026#34;)) 4 5for(i ...) 6 new Thread(() -\u0026gt; { 7 Thread.sleep(i * 3000 ms) 8 sout(i+\u0026#34;ç©å®¶å‡†å¤‡å®Œæˆ\u0026#34;); 9 cyclicbarrier.await() // â­ç­‰å¾…å…¨éƒ¨å®Œæˆ 10 sout(i+\u0026#34;ç©å®¶è¿›å…¥æ¸¸æˆ\u0026#34;) 11 }) 483 CountDownLatch å€’è®¡æ—¶é—¨é—©é” - ä¸å¯å¤ç”¨\nä½œç”¨ï¼šä½¿æŸçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä¸€ç»„æ“ä½œå®Œæˆã€‚æ¯å½“å…¶ä»–çº¿ç¨‹å®Œæˆä¸€ä¸ªæ“ä½œï¼Œè®¡æ•°å™¨\u0026ndash;ï¼Œåˆ°è¾¾0åˆ™ç­‰å¾…çš„ALLçº¿ç¨‹ä¼šè¢«å”¤é†’\nä¸»è¦åŠŸèƒ½ï¼š\nç­‰å¾…äº‹ä»¶å®Œæˆï¼šawait()ï¼› é€’å‡è®¡æ•°å™¨ï¼šlatch.countdown()ï¼› çº¿ç¨‹åŒæ­¥ï¼šå½“è®¡æ•°å™¨å˜ä¸º0ï¼Œå”¤é†’çº¿ç¨‹ã€‚ 1CountDownLatch latch = new CountDownLatch(3) 2 3for(int i = 1; i \u0026lt;= 3; i++) { // å¼‚æ­¥ 4 new Thread(() -\u0026gt; { 5 Thread,sleep(i*3000) 6 sout(i+\u0026#34;???\u0026#34;) 7 latch.countDown(); // è¿™é‡Œæ¨¡æ‹Ÿé€’å‡è®¡æ•°å™¨ 8 }).start() 9} 10 11sout(\u0026#34;wait all thread finish\u0026#34;) 12latch.await() // ä¸»çº¿ç¨‹é˜»å¡ç­‰å¾… 13sout(\u0026#34;all thread finish\u0026#34;) // å¹¶è¡Œè®¡ç®—ç»“æœçš„æ±‡æ€»\n487 å¦‚ä½•æ§åˆ¶å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºå‘¢ï¼Ÿ synchronized + awit + notify, A =\u0026gt; B =\u0026gt; C å¤šç»„é” ReentrantLock + condition å¤šç»„ Thread.join, é€æ­¥ç­‰å¾… CountDownLatchï¼Œç­‰å¾…å…¶ä»–çš„çº¿ç¨‹countdown semaphoreï¼Œé™åˆ¶å¼‚æ­¥ä¸ºåŒæ­¥é¡ºåº 488 Javaé˜»å¡é˜Ÿåˆ— ArrayBlockingQueue LinkedBlockingQueue PriorBlockingQueue praÉªÉ™(r) 489 åŸå­ç±» AtomicInterger É™ËˆtÉ’mÉªk ËˆÉªntÉªdÊ’É™(r) AtomicStampedReference stÃ¦mpt 1.get 2.compareAndSet 3.getAndIncrement ËˆÉªÅ‹krÉ™mÉ™nt æé—® CAS Compare and swap\næ¯”è¾ƒå†…å­˜ä¸­çš„å€¼ æ˜¯å¦ä¸ ä¹‹å‰çš„é¢„æœŸå€¼(ä¹‹å‰æ‹¿åˆ°çš„æ—§å€¼) ç›¸ç­‰\nç›¸ç­‰ =\u0026gt; å°†è¯¥å˜é‡çš„å€¼è®¾ç½®ä¸ºæ–°å€¼\n=\u0026gt; åˆ¤æ–­ä»ä¹‹å‰çš„è®¿é—®åˆ°ç°åœ¨çš„ä¿®æ”¹ï¼Œä¸­é—´å˜é‡çš„å€¼æ˜¯å¦å˜åŠ¨è¿‡ï¼Œæ²¡å˜è¿‡=\u0026gt;å¯ä»¥ä¿®æ”¹\nä¼˜åŠ¿ï¼š\næ— é”å¹¶å‘ + CASæ˜¯åŸå­æ€§çš„(çº¿ç¨‹å®‰å…¨)\nç¼ºç‚¹ï¼š\nABAé—®é¢˜ï¼Œå¦‚æœå˜é‡å€¼ ä» A=\u0026gt;B=\u0026gt;A,CASæ— æ³•æ£€æµ‹åˆ°è¿™ç§å˜åŒ– è‡ªæ—‹(é‡å¤)å¼€é”€ï¼šå¯¼è‡´CPUèµ„æºæµªè´¹ï¼Œå› ä¸ºä¸€ç›´æ¯”è¾ƒï¼Œç›´åˆ°èƒ½å¤Ÿä¿®æ”¹ä¸ºæ­¢ å•å˜é‡é™åˆ¶ï¼šä»…æ”¯æŒä¿®æ”¹å•å˜é‡ ABAé—®é¢˜ï¼šå¼•å…¥ç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ï¼Œæ¯æ¬¡æ›´æ–°å˜é‡çš„åŒæ—¶æ›´æ–°ç‰ˆæœ¬å·ï¼Œä»è€Œä¾é ç‰ˆæœ¬å·åˆ¤æ–­å˜é‡æ˜¯å¦è¢«è°ƒæ•´è¿‡ã€‚\nåšæ³•ï¼š\n1private AtomicStampedReference\u0026lt;Integer\u0026gt; atomicStampedReference = new AtomicStampedReference\u0026lt;\u0026gt;(0, 0); // åˆå§‹å€¼:ç‰ˆæœ¬å· == 0:0 2 3public void updateValue(int expected, int newValue) { 4 int[] stampHolder = new int[1]; 5 Integer currentValue = atomicStampedReference.get(stampHolder); 6 int currentStamp = stampHolder[0]; 7\t8 // 9 boolean updated = atomicStampedReference.compareAndSet(expected, newValue, currentStamp, currentStamp + 1); 10 if (updated) { 11 System.out.println(\u0026#34;Value updated to \u0026#34; + newValue); 12 } else { 13 System.out.println(\u0026#34;Update failed\u0026#34;); 14 } 15} AtomicStampedReferenceï¼š\u0026lt;ObjRef =\u0026gt; stampedref\u0026gt;\nå°è¯•æ›´æ–°å€¼å’Œç‰ˆæœ¬å·\nboolean updated = atomicStampedReference.compareAndSet(expected, newValue, currentStamp, currentStamp + 1);\næœŸæœ›çš„å½“å‰å€¼ï¼Œæ›´æ–°å€¼ï¼ŒæœŸæœ›çš„ç‰ˆæœ¬å·ï¼Œæ›´æ–°çš„ç‰ˆæœ¬å·; å½“æœŸæœ›çš„ä¸¤ä¸ªå€¼ç›¸åŒæ‰æ›´æ–°\nè¾…åŠ©ç†è§£\n1expected, newValue \u0026lt;= ready 2 3// è·å–å½“å‰å¼•ç”¨å€¼å’Œç‰ˆæœ¬å· 4int[] stampHolder = new int[1]; 5 6// å› ä¸ºJavaåªèƒ½è¿”å›ä¸€ä¸ªè¿”å›å€¼ï¼Œå°†å¤šä¸ªç»“æœä¿®æ”¹æ•°ç»„çš„å½¢å¼é—´æ¥è¿”å› 7Integer currentValue = atomicStampedRef.get(stampHolder); 8int currentStamp = stampHolder[0]; // â­â­â­ 9 10\u0026#34;å½“å‰å€¼: \u0026#34; + currentValue 11ç‰ˆæœ¬å·: \u0026#34; + currentStamp 12 13atomicStampedReference.compareAndSet(expected, newValue, currentStamp, currentStamp + 1); åœ¨CASåŸºç¡€ä¸Šï¼Œå¤šåˆ¤æ–­ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ£€æŸ¥å˜é‡æ˜¯å¦ä¿®æ”¹è¿‡ï¼Œè§£å†³ABAé—®é¢˜\n// ##\nè‡ªæ—‹é” =\u0026gt; è·å–é”å¤±è´¥ï¼Œä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯é‡å¤å°è¯•è·å–é” â—éå…¬å¹³:é¥¥é¥¿ï¼›æ€§èƒ½é—®é¢˜:å¯¹åŒä¸€å˜é‡é«˜å¹¶å‘è¿›è¡ŒCAS\n1public class SpinLock { 2 private final AtomicBoolean lock = new AtomicBoolean(false); 3 4 public void lock() { 5 while (!lock.compareAndSet(false, true)) { 6 // è‡ªæ—‹ç­‰å¾… 7 } 8 } 9 10 public void unlock() { 11 lock.set(false); 12 } 13 14 } é’ˆå¯¹è‡ªæ—‹é”=\u0026gt;CLH\nAQS Abstract Queued Synchronizer æ˜¯åŒæ­¥å™¨çš„åŸºç¡€æ¡†æ¶ï¼Œ èµ·åˆ°æŠ½è±¡ã€å°è£…çš„ä½œç”¨ï¼Œå°†ä¸€äº›æ’é˜Ÿã€å…¥é˜Ÿã€åŠ é”ã€ä¸­æ–­æ–¹æ³•æä¾›å‡ºæ¥ï¼Œå…·ä½“åŠ é”æ—¶æœºã€å…¥é˜Ÿæ—¶æœºç­‰éœ€è¦å®ç°ç±»è‡ªå·±æ§åˆ¶ã€‚\n(volatileç”³æ˜)stateçŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡CASæ— é”å¹¶å‘æ–¹å¼ç«äº‰é” AQSæ”¯æŒ\nç‹¬å æ¨¡å¼ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œï¼Œäº’æ–¥é”ï¼› å…±äº«æ¨¡å¼ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œä¾‹å¦‚ä¿¡å·é‡ï¼› å½“ä¸€ä¸ªçº¿ç¨‹è·å–é”å¤±è´¥æ—¶ï¼ŒAQSå°†å…¶æ’å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶é˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°åŒæ­¥çŠ¶æ€å¯ç”¨ã€‚\nä½¿ç”¨AQSå®ç°ä¸€ä¸ªç‹¬å é”\n1 2public class SimpleLock { 3 private static class Sync extends AbstractQueuedSynchronizer { 4 @Override 5 protected boolean tryAcquire(int acquires) { 6 if (compareAndSetState(0, 1)) { 7 setExclusiveOwnerThread(Thread.currentThread()); 8 return true; 9 } 10 return false; 11 } 12 13 @Override 14 protected boolean tryRelease(int releases) { 15 if (getState() == 0) throw new IllegalMonitorStateException(); 16 setExclusiveOwnerThread(null); 17 setState(0); 18 return true; 19 } 20 21 @Override 22 protected boolean isHeldExclusively() { 23 return getState() == 1; 24 } 25 26 final ConditionObject newCondition() { 27 return new ConditionObject(); 28 } 29 } 30 31 private final Sync sync = new Sync(); 32 33 public void lock() { 34 sync.acquire(1); 35 } 36 37 public void unlock() { 38 sync.release(1); 39 } 40 41 public boolean isLocked() { 42 return sync.isHeldExclusively(); 43 } 44 45 public Condition newCondition() { 46 return sync.newCondition(); 47 } 48} 1# åŸºäºAQSçš„ç‹¬å é” 2tryAcquire: =\u0026gt; CAS(åŸå­ï¼Œæ¯”è¾ƒä¸”è®¾ç½®)æ£€æŸ¥æ˜¯å¦é”å¯ä»¥ä½¿ç”¨ =\u0026gt; å¯ä»¥åˆ™è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºç‹¬å æ¨¡å¼ true=\u0026gt;else false 3 4tryRelease: =\u0026gt; getState =\u0026gt; å¦‚æœä¸ä¸º1åˆ™å¼‚å¸¸ =\u0026gt; else å…³é—­ç‹¬å æ¨¡å¼å¹¶é‡Šæ”¾é”(stateè®¾ç½®ä¸º0) 5 6private final Sync sync = new Sync() // ä½œä¸ºé”å¯¹è±¡ 7lock: sync.acquire(1) 8unlock: sync.release(1) AQSå’ŒCASä¸¤è€…å¯ä»¥ç»å¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ReentrantLockä¸­ï¼ŒCASç”¨äºå®ç°é”çš„è·å–å’Œé‡Šæ”¾æ“ä½œï¼Œè€ŒAQSåˆ™ç®¡ç†é”çš„çŠ¶æ€å’Œç­‰å¾…é˜Ÿåˆ—ã€‚\n","permalink":"http://longcoding.top/posts/jobs/juc/","summary":"\u003ch3 id=\"1-å¦‚ä½•åˆ›å»ºå¤šçº¿ç¨‹\"\u003e1 å¦‚ä½•åˆ›å»ºå¤šçº¿ç¨‹\u003c/h3\u003e\n\u003cp\u003e1ï¼‰ å®ç°\u003cstrong\u003eRunnable\u003c/strong\u003eæ¥å£\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå®ç°run()æ–¹æ³•\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyRunnable\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"na\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e2ï¼‰ç»§æ‰¿Threadç±»\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé‡å†™run()æ–¹æ³•\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e3ï¼‰Callableæ¥å£\u0026amp;\u0026amp;FutureTask\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå®ç°Callable call()æ–¹æ³•ï¼Œä½¿ç”¨FutureTaskåŒ…è£…Callableå¯¹è±¡ï¼Œé€šè¿‡Threadå¯åŠ¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eFutrueTask\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eReturnType\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eFutrueTask\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyCallable\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"na\"\u003estart\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eResultType\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// è¿™é‡Œé˜»å¡\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e4ï¼‰ä½¿ç”¨çº¿ç¨‹æ± \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé€šè¿‡ExecutorServiceæäº¤Runnableæˆ–è€…Callableä»»åŠ¡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¸åŒæ–¹æ³•å¯¹æ¯”\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eRunnable\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evs\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eCallable\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nl\"\u003eCallable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eå¯ä»¥è¿”å›ç»“æœ\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"n\"\u003eå¯ä»¥æŠ›å‡ºå¼‚å¸¸\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eçº¿ç¨‹æ± çš„ä¼˜åŠ¿\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\u003cspan class=\"n\"\u003eé¿å…é‡å¤åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"n\"\u003eå‡å°‘è¿™éƒ¨åˆ†é‡å¤å¸¦æ¥çš„å¼€é”€\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼›\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eThreadPool\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFixedThreadPool\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eCachedThreadPool\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eScheduledThreadPool\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eè™šæ‹Ÿçº¿ç¨‹\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\u003cspan class=\"n\"\u003eè™šæ‹Ÿçº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€æ›´ä½\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003estartVirtualThread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eThreadPoolå®è·µ\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eXXXThreadPool.submit(task\u0026hellip;)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nl\"\u003eFixedThreadPool\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eå›ºå®šæ± ä¸­çº¿ç¨‹æ•°é‡\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eé€‚åˆ1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eæ‰§è¡Œè¾ƒé•¿ä»»åŠ¡\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼›\u003c/span\u003e\u003cspan class=\"n\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eæ§åˆ¶å¹¶å‘åº¦\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eCachedThreadPool\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\u003cspan class=\"n\"\u003eæ± ä¸­çº¿ç¨‹æ•°é‡ä¸å›ºå®š\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"n\"\u003eæ ¹æ®éœ€è¦åŠ¨æ€åˆ›å»ºçº¿ç¨‹\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"n\"\u003eç©ºçš„è¢«å›æ”¶\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"n\"\u003eå°‘äº†å¤šåˆ›å»º\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼›\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003eâ­\u003c/span\u003e\u003cspan class=\"n\"\u003eé€‚ç”¨äºä»»åŠ¡æ‰§è¡Œæ—¶é—´çŸ­ä¸”ä»»åŠ¡æ•°é‡ä¸ç¡®å®šçš„åœºæ™¯\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼›\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eScheduledThreadPool\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\u003cspan class=\"n\"\u003eé€‚ç”¨äºéœ€è¦å®šæ—¶æ‰§è¡Œæˆ–å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„åœºæ™¯\u003c/span\u003e\u003cspan class=\"err\"\u003eã€‚\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eScheduledExecutorService\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003escheduledThreadPool\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eExecutors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003enewScheduledThreadPool\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e// For å»¶è¿Ÿä»»åŠ¡\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003escheduledThreadPool\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eschedule\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c1\"\u003e// ä»»åŠ¡é€»è¾‘\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eTimeUnit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eSECONDS\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// å»¶è¿Ÿ10ç§’æ‰§è¡Œ\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e// Forå‘¨æœŸæ‰§è¡Œä»»åŠ¡\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003escheduledThreadPool\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003escheduleAtFixedRate\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c1\"\u003e// ä»»åŠ¡é€»è¾‘\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eTimeUnit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eSECONDS\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// æ¯éš”1ç§’æ‰§è¡Œä¸€æ¬¡\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThread.sleep(0) \u0026lt;= ä¸»åŠ¨è®©å‡ºCPUæ§åˆ¶æƒ\u003c/p\u003e","title":"å¹¶å‘é¢è¯•é¢˜ç¬”è®°"},{"content":"617 MySQL æ•°æ®æ’åº å®ç°ï¼Ÿ Order By å‘½ä¸­ç´¢å¼•(åŒ…æ‹¬ç´¢å¼•å­—æ®µ)ï¼Œä½¿ç”¨ç´¢å¼•æ’åº(æœ‰åº)ï¼Œæ•ˆç‡æœ€é«˜æ•ˆ å¦åˆ™ä½¿ç”¨æ–‡ä»¶æ’åºï¼Œæ–‡ä»¶å°‘=\u0026gt; å†…å­˜æ’åº sort_buffer æ–‡ä»¶å¤§=\u0026gt;å¤–éƒ¨æ’åºï¼Œå½’å¹¶æ’åº å†…éƒ¨æ’åºç»†èŠ‚ï¼š\nåŒè·¯æ’åº(å¾…æ’åºçš„åˆ—æ•°æ®å¤ªå¤§äº†)ï¼šä½¿ç”¨row_id(å›æŸ¥è¡¨) + sort_field\nâ€‹\tæ’å¥½åºåï¼Œä½¿ç”¨row_idå°†å®Œæ•´çš„è®°å½•å–å‡ºæ¥\nå•è·¯æ’åº(å¾…æ’åºæ•°æ®å¤§å°èƒ½æ¥å—)\nâ€‹\tç›´æ¥æ‹ï¼Œä¸ä¼šæŸ¥è¡¨ï¼Œç›´æ¥æŠŠæ‹å¥½çš„ç»“æœè¿”å›\nå¤–éƒ¨æ’åºï¼š\næ‹†åˆ†å°çš„ï¼Œå¤–éƒ¨å¤šè·¯å½’å¹¶æ’åºï¼Œå°=\u0026gt;å¤§\nå¤–éƒ¨å½’å¹¶æ’åº =\u0026gt; å…ˆåˆ†æ®µæ’åºï¼Œæ¯ä¸€æ®µè°ƒå…¥å†…å­˜æ‰§è¡Œå¿«æ’\nâ€‹ =\u0026gt; å½’å¹¶é˜¶æ®µï¼Œå› ä¸ºæ¯å­æ®µéƒ½æ˜¯æœ‰åºçš„ =\u0026gt; å¤šè·¯å½’å¹¶æ’åº\n589 ä¸€æ¡SQLçš„æ‰§è¡Œè¿‡ç¨‹ å…ˆé€šè¿‡è¿æ¥å™¨æ ¡éªŒæƒé™ åˆ©ç”¨åˆ†æå™¨è¿›è¡ŒSQLè¯­å¥è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æï¼Œæ„å»ºè§£ææ ‘ åˆ©ç”¨ä¼˜åŒ–å™¨é€‰æ‹©åˆé€‚çš„ç´¢å¼•å’Œè¡¨è¿æ¥é¡ºåºï¼Œæœ€ç»ˆé€‰æ‹©ä¸€æ¡æœ€ä½³çš„æ‰§è¡Œè®¡åˆ’ åˆ©ç”¨æ‰§è¡Œå™¨ï¼Œè°ƒç”¨å¼•æ“å±‚æŸ¥è¯¢æ•°æ®ï¼Œè¿”å›ç»“æœé›† å…·ä½“ï¼šSelect * from user where id = 1;\nSQL =\u0026gt; Serverå±‚è¿æ¥å™¨ï¼Œæƒé™æ ¡éªŒï¼Œè´¦å·æ˜¯å¦æœ‰èµ„æ ¼è·å–ã€‚æ— =\u0026gt; Access denied for userã€‚ è¿æ¥æˆåŠŸåï¼Œç©ºé—²ä¸€æ®µæ—¶é—´ä¼šæ–­å¼€\nåˆ†æå™¨(æŸ¥è¯¢è§£æ) =\u0026gt;\nè¯­æ³•åˆ†æï¼šSQL : Selectç±»å‹âœ”ï¸ userè¡¨âœ”ï¸ idåˆ— âœ”ï¸æ‹†åˆ†æˆè¯ï¼Œå†ç»„è£…ä¸ºè§£ææ ‘ã€‚ è¯­ä¹‰åˆ†æï¼šè¯­æ³•æ˜¯å¦æœ‰è¯¯ =\u0026gt; you have an error in your SQL syntax (å­—æ®µã€è¡¨|å­˜åœ¨ï¼Ÿ) åˆ†æè§£ææ ‘è¯­æ³•æ­£ç¡®æ€§ ä¼˜åŒ–å™¨(æŸ¥è¯¢ä¼˜åŒ–)=\u0026gt;\nä¼˜åŒ–SQLï¼Œæ¯”å¦‚ï¼šé€‰æ‹©å“ªä¸ªç´¢å¼•ã€è°ƒæ•´å¤šä¸ªè¡¨çš„è¿æ¥é¡ºåº æ‰§è¡Œå™¨ï¼ˆæŸ¥è¯¢æ‰§è¡Œï¼‰\næ ¡éªŒç”¨æˆ·å¯¹è¡¨çš„æƒé™ï¼Œæ ¹æ®å­˜å‚¨å¼•æ“æŸ¥è¯¢æ•°æ®ï¼Œéå† =\u0026gt; è¿”å›ç»“æœé›†\n590 MySQL å­˜å‚¨å¼•æ“ InnoDB\næä¾›äº‹åŠ¡ã€è¡Œçº§é”å’Œå¤–é”®\næä¾›é«˜å¹¶å‘æ€§èƒ½\nB+æ ‘ç´¢å¼•\nMVCC\n591 MySQLçš„ç´¢å¼•ç±»å‹æœ‰å“ªäº› æ•°æ®ç»“æ„è§’åº¦ï¼š\nB+æ ‘ç´¢å¼•ï¼š é€šè¿‡æ ‘å‹ç»“æ„ =\u0026gt; é€‚åˆèŒƒå›´æŸ¥è¯¢betweenå’Œç²¾ç¡®æŸ¥=ã€‚ å¶å­èŠ‚ç‚¹åŒå‘é“¾è¡¨è¿æ¥ æ¯”Bæ ‘å…·å¤‡æ›´å°‘çš„IOæ¬¡æ•° InnoDB+æ ‘ç´¢å¼•ç»“æ„ä¸Šçœ‹\nèšç°‡ç´¢å¼•(ä¸»é”®æ„å»º)ï¼š éå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•å€¼ å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´çš„æ•°æ®è¡Œæ•°æ®ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å®Œæ•´æ•°æ® æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼• éèšç°‡ç´¢å¼• (äºŒçº§ç´¢å¼•) éå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•å€¼ å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å’Œå¯¹åº”ç´¢å¼•åˆ—ï¼ŒæŸ¥è¯¢éå¯¹åº”ç´¢å¼•åˆ—ï¼Œåˆ™éœ€è¦å›è¡¨(æ ¹æ®ä¸»é”®)ï¼Œå¢åŠ é¢å¤–çš„IOï¼ˆSELELCT * æ…é‡ï¼‰ ç´¢å¼•:\nä¸»é”®ç´¢å¼•\nå”¯ä¸€ç´¢å¼•\næ™®é€šç´¢å¼•\nå•åˆ—ç´¢å¼• \u0026amp; è”åˆç´¢å¼•\n1ä¸»é”®ï¼š 2PRIMARY Key(id) 3å”¯ä¸€ï¼š 4Create unique index xxx on user(username); 5è”åˆï¼š 6Create INdex xxx on user(username, email); MySQLç´¢å¼•çš„æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Ÿ é’ˆå¯¹è”åˆç´¢å¼•\nè”åˆç´¢å¼•åœ¨B+æ ‘ç§çš„æ’åˆ—æ–¹å¼éµå¾ªâ€œä»å·¦åˆ°å³â€çš„é¡ºåº e.g. (first_name, last_name, age) ä¼šæŒ‰ç…§ è¿™ä¸ªé¡ºåºè¿›è¡Œç´¢å¼•\n1 (Alice, Black, 35) 2 | 3 ------------------------------------------------------------- 4 | | | | 5(Alice, Brown, 25) (Alice, Smith, 30) (Bob, Smith, 20) (Bob, White, 19) æŸ¥è¯¢æ—¶å€™WHERE æ¡ä»¶é¡ºåºæœ€å¥½å’Œç´¢å¼•ä¸€è‡´ï¼Œå¦åˆ™è·³è¿‡æœ€å·¦ä¾§ä¼šå¯¼è‡´æ— æ³•åˆ©ç”¨è¯¥ç´¢å¼•\n=\u0026gt; è¦ä¿è¯ç´¢å¼•å‘½ä¸­ï¼Œå»ºè®®ç´¢å¼•é¡ºåºä¸€è‡´\nä¸èƒ½è·³è¿‡ç¬¬ä¸€ä¸ªç´¢å¼•\nå¯ä»¥éƒ¨åˆ†åŒ¹é…ä½†ç¬¬ä¸€ä¸ªä¸€å®šè¦åœ¨\nindex: (a, b, c)\n1where a=1 âœ”ï¸ 2where a=1 and b=1 âœ”ï¸ 3where a=1 and b=1 and c=1âœ”ï¸ 4 5where b=1 and a=1 âŒâŒâŒ 595 MySQLç´¢å¼•è¦†ç›– æŒ‡äºŒçº§ç´¢å¼•åŒ…å«äº†æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰å­—æ®µ - ä¸€çº§ç´¢å¼•(Primary keyï¼Œå”¯ä¸€) ËˆpraÉªmÉ™ri - äºŒçº§ç´¢å¼•(å…¶ä»–ç´¢å¼•)\n1# INDEX idx_name_hiredate (last_name, first_name, hire_date) 2 3SELECT ... 4WHERE last_name = ? AND first_name = ? 5 6åˆ™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œå› ä¸ºè¿™ä¸ªSQLä¼šæ ¹æ®è”åˆç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”æŸ¥è¯¢çš„æ¡ä»¶åˆ—åŒ…å«æ‰€éœ€çš„æ•°æ® 596 MySQLç´¢å¼•ä¸‹æ¨ åº”ç”¨åœ¨è”åˆç´¢å¼•ä¸Šï¼Œå‡å°‘å›è¡¨æŸ¥è¯¢ã€‚MySQLè‡ªåŠ¨åº”ç”¨çš„ä¼˜åŒ–æŠ€æœ¯\nä¸»è¦æ˜¯å°†æ¡ä»¶ç´¢å¼•åˆ—çš„è¿‡æ»¤æ“ä½œä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚ï¼Œå‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“\né€šè¿‡äºŒçº§ç´¢å¼•æŸ¥åˆ°ä¸»é”®idåå›è¡¨å†è¿›è¡Œwhereæ¡ä»¶è¿‡æ»¤\n=\u0026gt; äºŒçº§ç´¢å¼•æŸ¥åˆ°æ•°æ®åç›´æ¥whereæ¡ä»¶è¿‡æ»¤ä¸€éï¼Œå†è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå‡å°‘å›è¡¨çš„æ¬¡æ•°\n1# example è”åˆç´¢å¼•ï¼šindex_age_grade 2(1, \u0026#39;Alice\u0026#39;, 18, 90), 3(2, \u0026#39;Bob\u0026#39;, 19, 85), 4(3, \u0026#39;Charlie\u0026#39;, 18, 95), 5(4, \u0026#39;David\u0026#39;, 20, 80); 6=\u0026gt; SELECT ... WHERE age = 18 and grade \u0026gt; 90 7# æ²¡æœ‰ç´¢å¼•ä¸‹æ¨ï¼š 81. å…ˆæ ¹æ®ageæŸ¥æ‰¾åˆ°æ‰€æœ‰ç»“æœ 92. è¿”å›æ‰€æœ‰ç»“æœæ•°æ®åˆ°æœåŠ¡å™¨å±‚ 103. æœåŠ¡å™¨å±‚è¿‡æ»¤grade\u0026gt;90çš„æ•°æ® 11 12# ç´¢å¼•ä¸‹æ¨ 131. å…ˆæ ¹æ®ageæŸ¥æ‰¾åˆ°æ‰€æœ‰ç»“æœ 142. å­˜å‚¨å¼•æ“å±‚ç›´æ¥è¿‡æ»¤grade\u0026gt;90çš„æ•°æ® 153. è¿”å›æ•°æ®ç»™æœåŠ¡å™¨å±‚ 597 å»ºç«‹ç´¢å¼•æ³¨æ„äº‹é¡¹ ä¸èƒ½ç›²ç›®å»ºç«‹ï¼Œå› ä¸ºç»´æŠ¤éœ€è¦ä»£ä»· è¡¨çš„ä¿®æ”¹é¢‘ç‡è¿œå¤§äºæŸ¥è¯¢é¢‘ç‡ =\u0026gt; ç»´æŠ¤ä»£ä»·å¤§ 598 æ’æŸ¥ç´¢å¼•æ•ˆæœï¼Ÿ åœ¨SQLè¯­å¥å‰ï¼Œä½¿ç”¨EXPLAINå…³é”®å­—ï¼ŒæŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œä¿¡æ¯\nè”åˆç´¢å¼• =\u0026gt; ç¬¦åˆæœ€å·¦å‰ç¼€é¡ºåº ç´¢å¼•ä¸­ä½¿ç”¨è¿ç®—æˆ–è€…å‡½æ•°ï¼Œlikeè¿›è¡Œå…¨ç›˜æ‰«æï¼Œå¯¹å€¼è¿›è¡Œäº†å¤„ç†ï¼Œåˆ™ä¼šä½¿ç´¢å¼•å¤±æ•ˆ ç ´åæœ€å·¦åŒ¹é… inå­—æ®µ order by ä¸ºä½¿ç”¨ç´¢å¼• 600 MySQLçš„B+æ ‘æŸ¥è¯¢æ•°æ®çš„å…¨è¿‡ç¨‹ æŸ¥è¯¢ä»è·ŸèŠ‚ç‚¹å‡ºå‘ï¼Œæ¯”è¾ƒæ•°æ®é”®å€¼ä¸èŠ‚ç‚¹ä¸­å­˜å‚¨çš„ç´¢å¼•é”®å€¼ï¼Œç¡®å®šæ•°æ®è½åœ¨å“ªä¸ªåŒºé—´ï¼Œä»è€Œç¡®å®šå¾€ä¸‹å“ªä¸ªåˆ†æ”¯èµ°ï¼Œä»ä¸Šåˆ°ä¸‹å®šä½åˆ°å¶å­èŠ‚ç‚¹ å¶å­èŠ‚ç‚¹å­˜å‚¨ç€æ•°æ®è¡Œè®°å½•ï¼Œä½†ä¸€é¡µçš„å¤§å°æœ‰16kbï¼Œå­˜å‚¨çš„æ•°æ®è¡Œä¸åªä¸€æ¡ å¶å­èŠ‚ç‚¹ä¸­çš„æ•°æ®è¡Œä»¥ç»„çš„å½¢å¼åˆ’åˆ†ï¼Œåˆ©ç”¨é¡µç›®å½•ç»“æ„ï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾å®šä½åˆ°å¯¹åº”çš„ç»„ å®šä½åˆ°ç»„åï¼Œåˆ©ç”¨é“¾è¡¨éå†=\u0026gt;row 601 ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ é«˜æ•ˆçš„æŸ¥è¯¢æ€§èƒ½ è‡ªå¹³è¡¡ï¼Œæ ¹åˆ°å¶å­è·¯å¾„é•¿åº¦ç›¸åŒ O(logn) æ ‘é«˜é•¿çš„ä¸ä¼šè¿‡å¿«ï¼Œä½¿å¾—æŸ¥è¯¢ç£ç›˜çš„IOæ¬¡æ•°å‡å°‘ éå¶å­èŠ‚ç‚¹åªå­˜æ”¾ç´¢å¼•å€¼å’Œé¡µé¢æŒ‡é’ˆ æ¯ä¸€é¡µä¸­èƒ½å¤Ÿå®¹çº³æ›´å¤šçš„è®°å½•ï¼Œå‡å°‘æŸ¥è¯¢çš„IOæ¬¡æ•° èŒƒå›´æŸ¥è¯¢èƒ½åŠ›å¼º å¶å­èŠ‚ç‚¹é€šè¿‡é“¾è¡¨è¿æ¥ï¼Œå®šä½åˆ°å¶å­èŠ‚ç‚¹ï¼Œæ ¹æ®èŒƒå›´æŸ¥è¯¢åªéœ€è¦é¡ºåºæ‰«æé“¾è¡¨ Bæ ‘\næ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨äº†å®Œæ•´çš„æ•°æ® Bæ ‘å¶å­èŠ‚ç‚¹æ²¡æœ‰è¿æ¥æŒ‡é’ˆ 602 MySQLæ€ä¹ˆå®ç°äº‹åŠ¡ âŒâŒâŒ é€šè¿‡é”ã€Redo Logã€Undo Logã€ MVCCå®ç°äº‹åŠ¡\nåˆ©ç”¨é”(è¡Œé”ã€é—´éš™é”ç­‰)æœºåˆ¶ï¼Œæ§åˆ¶æ•°æ®çš„å¹¶å‘ä¿®æ”¹ï¼Œæ»¡è¶³äº‹åŠ¡çš„éš”ç¦»æ€§\nRedo Log(é‡åšæ—¥å¿—)ï¼Œå®ƒè®°å½•äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹ï¼Œå½“MySQLå®•æœºäº†ï¼Œé€šè¿‡é‡æ”¾redo logå¯ä»¥æ¢å¤æ•°æ®ï¼Œæ»¡è¶³äº‹åŠ¡çš„æŒä¹…æ€§\nUndo Log(å›æ»šæ—¥å¿—)ï¼Œè®°å½•äº‹åŠ¡çš„åå‘æ“ä½œï¼Œä¿æŒæ•°æ®çš„å†å²ç‰ˆæœ¬ï¼Œç”¨äºäº‹åŠ¡çš„å›æ»šï¼Œä½¿äº‹åŠ¡æ‰§è¡Œå¤±è´¥åå¯ä»¥æ¢å¤åˆ°ä¹‹å‰çš„æ ·å­ã€‚å®ç°åŸå­æ€§å’Œéš”ç¦»æ€§\nMVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œæ»¡è¶³éé”è¯»çš„éœ€æ±‚ï¼Œæä¾›è¯»å†™å¹¶å‘ï¼Œå®ç°äº†è¯»å·²æäº¤å’Œå¯é‡å¤è¯»ä¸¤ç§éš”ç¦»çº§åˆ«\nè¯»å·²æäº¤ï¼šæ¯æ¬¡æŸ¥è¯¢ç”Ÿæˆæ–°çš„ ReadViewï¼Œå¯èƒ½å¯¼è‡´å¤šæ¬¡æŸ¥è¯¢ç»“æœä¸ä¸€è‡´ å¯é‡å¤è¯»ï¼šäº‹åŠ¡å¯åŠ¨æ—¶ç”Ÿæˆ ReadViewï¼Œä¿è¯æ•´ä¸ªäº‹åŠ¡ä¸­æŸ¥è¯¢ç»“æœä¸€è‡´ äº‹åŠ¡å·¥ä½œæµç¨‹ï¼š\nRedo Log(é‡åšæ—¥å¿—)ï¼š\n=\u0026gt; ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œå³ä½¿å®•æœºäº†ä¹Ÿèƒ½æ¢å¤æäº¤çš„æ•°æ®\nç‰ˆæœ¬é“¾ç¤ºæ„\nâ€‹\n609 Mysqlæœ‰å“ªäº›é” ç²’åº¦åˆ†ç±»ï¼š\nå…¨å±€é”ï¼šæ•´ä¸ªæ•°æ®åº“åŠ é”ï¼Œåªè¯»\nè¡Œçº§é”ï¼šç»†ç²’åº¦\nå¯¹ç‰¹å®šçš„è¡ŒåŠ é”ï¼Œå…è®¸å…¶ä»–äº‹åŠ¡å¹¶å‘è®¿é—®ä¸åŒçš„è¡Œï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„åœºæ™¯ è¡¨çº§é” ç²—ç²’åº¦\nå¯¹æ•´ä¸ªè¡¨è¿›è¡ŒåŠ é”ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•å¯¹è¯¥è¡¨è¿›è¡Œæ“ä½œ å±æ€§åˆ†ç±»ï¼š\nå…±äº«é” Sé” Shared lock\nå…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘è¯»åŒä¸€èµ„æºï¼Œä½†æ˜¯ä¸å…è®¸ä¿®æ”¹ï¼Œåªæœ‰é‡Šæ”¾å…±äº«é”åï¼Œå…¶ä»–äº‹åŠ¡æ‰èƒ½è·å–æ’ä»–é” æ’ä»–é” Exclusive lock Xé”\nåªå…è®¸ä¸€ä¸ªäº‹åŠ¡è¯»å†™èµ„æºï¼Œäº’æ–¥ï¼Œç‹¬äº« 1-- æ·»åŠ å…±äº«é” 2SELECT ... LOCK IN SHARE MODE; 3-- å…±äº«é” 4SELECT ... FOR SHARE; 5-- æ’ä»–é” 6SELECT ... FOR UPDATE; è®°å½•é”ï¼šé”å®šç‰¹å®šçš„è¡Œè®°å½•\né—´éš™é”\né’ˆå¯¹ç´¢å¼•ä¸­ä¸¤ä¸ªè®°å½•ä¹‹é—´çš„é—´éš™åŠ é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™ä¸­æ’å…¥æ–°çš„æ•°æ®ï¼Œé¿å…å¹»è¯»ã€‚é”å®šè¡Œä¸è¡Œä¹‹é—´çš„ç©ºé—´ é˜»æ­¢æ–°çš„è®°å½•çš„æ’å…¥ ä¸´é”®é”\né”å®šå…·ä½“è¡Œå’Œå…¶å‰é¢çš„é—´éš™ï¼Œç¡®ä¿èŒƒå›´å†…ä¸ä¼šå¹»è¯» 603 MySQLé•¿æ—¶é—´äº‹åŠ¡å¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ é—®é¢˜ï¼š\né•¿æ—¶é—´äº‹åŠ¡ =\u0026gt; é•¿æ—¶é—´çš„é”ç«äº‰+é˜»å¡èµ„æº å…¶ä»–äº‹åŠ¡ä¹Ÿéœ€è¦å¯¹åº”çš„é”ï¼Œä½†æ˜¯è¿™ä¸ªé”é•¿æ—¶é—´æ‹¿ä¸åˆ°ï¼Œé˜»å¡ éƒ¨åˆ†ä¸šåŠ¡çš„é˜»å¡ä¼šå½±å“åˆ°å…¶ä»–æœåŠ¡ï¼Œå¯¼è‡´ç³»ç»Ÿå‡ºç°ä¸¥é‡çš„æœåŠ¡å´©ç›˜ æ­»é”é£é™© å¤šä¸ªäº‹åŠ¡ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´ç³»ç»Ÿæ— æ³•ç»§ç»­æ‰§è¡Œ å›æ»šå¯¼è‡´æ—¶é—´çš„æµªè´¹ æ‰§è¡Œäº†å¾ˆé•¿ï¼Œä½†æ˜¯å¿«ç»“æŸå‡ºç°å¼‚å¸¸ =\u0026gt; äº‹åŠ¡å›æ»šéœ€è¦å¾ˆé•¿çš„æ—¶é—´ é•¿æ—¶é—´äº‹åŠ¡å¦‚ä½•è§£å†³\næ‹†åˆ†æˆä¸€å°ä»½ä¸€å°ä»½çš„çŸ­äº‹åŠ¡\næ—¶é—´ï¼Ÿ åˆ›é€ ç´¢å¼•æ¡ä»¶ï¼Œå¾—åˆ°è¡¨çš„ä¸»é”®æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œåˆ‡åˆ†æˆä¸€å°ä»½ä¸€å°ä»½çš„åŒºé—´åœ¨æ‰§è¡Œ\nåˆ é™¤å¤§é‡çš„æ•°æ® =\u0026gt; åœ¨æ–°çš„è¡¨ä¸­æ’å…¥ç›¸å¯¹å°çš„æ•°æ®\n604 MVCC [æ•°æ®ç‰ˆæœ¬æ§åˆ¶éšè—å­—æ®µå’ŒæŒ‡é’ˆã€äº‹åŠ¡è§†å›¾ReadView]\nMulti-Version Concurrency Control å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ =\u0026gt; å…è®¸äº‹åŠ¡åŒæ—¶è¯»å†™æ•°æ®åº“ï¼Œè€Œæ— éœ€ç›¸äº’ç­‰å¾…\næé«˜å¹¶å‘æ€§èƒ½ \u0026amp; é¿å…è¯»å†™å†²çª \u0026amp; å‡å°‘é”ç«äº‰ MVCCä¸­ï¼Œä¸ºæ¯ä¸ªäº‹åŠ¡åˆ›å»ºä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼ŒMySQLä¸ä¼šç«‹å³è¦†ç›–åŸæœ‰æ•°æ®ï¼Œè€Œæ˜¯ç”Ÿæˆæ–°ç‰ˆæœ¬çš„è®°å½•ã€‚æ¯ä¸ªè®°å½•éƒ½ä¿ç•™ç€ç›¸åº”çš„ç‰ˆæœ¬å·\nè¯»å†™å†²çªï¼šä¼ ç»Ÿè¯»å†™æˆ–äº’æ–¥ã€‚è§£å†³æ–¹æ³•ï¼šå¤šç‰ˆæœ¬æ–¹å¼ï¼Œè¯»æ—§ç‰ˆæœ¬æ•°æ®ï¼Œå†™åœ¨æ–°ç‰ˆæœ¬ä¸Šï¼Œä»è€Œé¿å…è¯»å†™å†²çªã€‚ é”ç«äº‰ï¼šä¼ ç»Ÿæ–¹å¼éœ€è¦ç«äº‰é”ï¼Œè§£å†³æ–¹å¼ï¼šé€šè¿‡ç‰ˆæœ¬æ§åˆ¶æ›¿ä»£é”ã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ«å®ç°ï¼šä¼ ç»Ÿæœºåˆ¶ï¼šé”ã€‚è§£å†³æ–¹å¼ï¼šç‰ˆæœ¬æ§åˆ¶ã€‚ MVCCä¸ºæ¯æ¡æ•°æ®ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬\næ¯ä¸ªç‰ˆæœ¬åŒ…æ‹¬ï¼š\nç‰ˆæœ¬å·ï¼šæ ‡è¯†åˆ›å»ºç‰ˆæœ¬çš„äº‹åŠ¡ID æ—¶é—´æˆ³ï¼šåˆ›å»ºæ—¶é—´ æ•°æ®å†…å®¹ è¯»æ“ä½œï¼š\næ ¹æ®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å’Œå½“å‰æ—¶é—´æˆ³ï¼Œé€‰æ‹©åˆé€‚çš„æ•°æ®ç‰ˆæœ¬ã€‚\nåœ¨è¯»å·²æäº¤ä¸‹éš”ç¦»çº§åˆ«ä¸‹ï¼šè¯»æ“ä½œä¼šè¯»å–å·²æäº¤çš„æœ€æ–°ç‰ˆæœ¬ åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼šè¯»æ“ä½œä¼šè¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®ç‰ˆæœ¬ å†™æ“ä½œ:\n=\u0026gt; åˆ›å»ºæ–°çš„æ•°æ®æ–°ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ—§ç‰ˆæœ¬æ•°æ® æ—§ç‰ˆæœ¬æ•°æ®ä¼šè¢«ä¿ç•™ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•äº‹åŠ¡å¼•ç”¨ \u0026lt;= åƒåœ¾å›æ”¶ MVCCä¼˜åŠ¿ï¼š\né«˜å¹¶å‘ï¼› çµæ´»çš„éš”ç¦»çº§åˆ«ï¼› å‡å°‘é”ç«äº‰ï¼› ä¸€è‡´æ€§è§†å›¾ éšè—å­—æ®µï¼š\næ¯è¡Œè®°å½•é™¤äº†è‡ªå·±å®šä¹‰çš„å­—æ®µå¤–ï¼Œè¿˜æœ‰ä¸€äº›é‡è¦çš„éšè—å­—æ®µ\ndb_row_idï¼š æ²¡æœ‰å®šä¹‰Primary Keyï¼Œé»˜è®¤ç”¨è¿™ä¸ªä¸ºIndex db_trx_idï¼šæœ€è¿‘å¯¹è¿™ä¸ªè®°å½•ä¿®æ”¹çš„äº‹åŠ¡ID db_roll_ptr: å›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™ä¸ªè®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ŒæŒ‡å‘Undo Logä¸­çš„ä¸Šä¸€ä¸ªå¿«ç…§ç‰ˆæœ¬çš„åœ°å€ å¤šç‰ˆæœ¬ä¹‹é—´ä¸²è”èµ·æ¥å½¢æˆä¸€æ¡ç‰ˆæœ¬é“¾ã€‚ ä¸åŒäº‹åŠ¡å¯ä»¥æ— é”çš„è¯»å–ä¸åŒç‰ˆæœ¬çš„æ•°æ®(æ™®é€šè¯»)ã€‚æ™®é€šè¯»å’Œå†™ä¸ä¼šé˜»å¡\nå†™æ“ä½œå¯ä»¥ç»§ç»­å†™ï¼Œå°±æ˜¯æ–°çš„æ•°æ®ç‰ˆæœ¬ä¸ä¼šç«‹å³å¯¹å…¶ä»–äº‹åŠ¡å¯è§ï¼Œåªæœ‰äº‹åŠ¡æäº¤åï¼Œæ–°ç‰ˆæœ¬çš„è®°å½•æ‰ä¼šå¯è§\nMySQL InnoDBé€šè¿‡Undo Log æ“ä½œ å’Œ ReadViewå®ç°\nUndo Log è®°å½•æ•°æ®ä¿®æ”¹ä¹‹å‰çš„çŠ¶æ€çš„æ—¥å¿—ï¼Œä½œç”¨å¦‚ä¸‹ï¼š\näº‹åŠ¡å›æ»šï¼šæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¿®æ”¹ å®ç°MVCCï¼šæä¾›å†å²ç‰ˆæœ¬æ•°æ®ï¼Œæ”¯æŒä¸€è‡´æ€§è¯» =\u0026gt; å½“äº‹åŠ¡ä¿®æ”¹æ•°æ®æ—¶ï¼ŒInnoDBä¼šå°†æ•°æ®çš„æ—§ç‰ˆæœ¬å†™å…¥Undo Logä¸­\n=\u0026gt; å½“Undo Logæ²¡è¢«ä»»åŠ¡äº‹åŠ¡å¼•ç”¨æ—¶ï¼Œä¼šè¢«åƒåœ¾å›æ”¶\nReadView è¯»è§†å›¾\näº‹åŠ¡æŸæ—¶åˆ»åˆ›å»ºçš„æ•°æ®åº“å¿«ç…§ï¼Œç”¨äºç¡®å®šå“ªäº›æ•°æ®ç‰ˆæœ¬å¯¹äº‹åŠ¡å¯è§ =\u0026gt; å®ç°äº‹åŠ¡éš”ç¦»æ€§\næ ¸å¿ƒå­—æ®µ\nm_ids: å½“å‰æ´»åŠ¨äº‹åŠ¡IDåˆ—è¡¨ min_trx_id: m_idsä¸­æœ€å°äº‹åŠ¡çš„ID max_trx_id creator_trx_id: åˆ›å»ºè¯¥ReadViewäº‹åŠ¡çš„ID å¯è§æ€§è§„åˆ™\nå¯¹äºæ¯æ¡æ•°æ®çš„ç‰ˆæœ¬ï¼ŒReadViewä¼šæ ¹æ®ä¸€ä¸‹è§„åˆ™åˆ¤æ–­æ˜¯å¦å¯è§\nå½“æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ID \u0026lt; min_trx_id\n=\u0026gt; æ•°æ®ç‰ˆæœ¬ä»¥åŠæäº¤(è¿‡å»çš„äº‹åŠ¡)ï¼Œå¯è§\nå½“æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ID \u0026gt;= max_trx_id\nâ€‹\t=\u0026gt; è¯´æ˜æ•°æ®ç‰ˆæœ¬æ˜¯æœªæ¥äº‹åŠ¡åˆ›å»ºçš„ï¼Œä¸å¯è§\nâ€‹\t3. æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ID åœ¨ m_idsä¸­ â­â­â­\nâ€‹\t=\u0026gt; è¯´æ˜ä»–æ˜¯ç”±æœªæäº¤çš„äº‹åŠ¡åˆ›å»ºçš„ï¼Œ ä¸å¯è§, å¦åˆ™å¯è§\nå¦‚æœå½“å‰æ•°æ®ç‰ˆæœ¬çš„ trx id å¤§å°åœ¨ min trx id å’Œ max trx id ä¹‹é—´ï¼Œæ­¤æ—¶ trx id è‹¥åœ¨ m ids ä¸­ï¼Œè¯´æ˜ä¿®æ”¹è¿™æ¡æ•°æ®çš„äº‹åŠ¡æ­¤æ—¶è¿˜æœªæäº¤ï¼Œæ‰€ä»¥ä¸å¯è§ï¼Œè‹¥ä¸åœ¨m ids ä¸­ï¼Œè¡¨æ˜äº‹åŠ¡å·²ç»æäº¤ï¼Œå¯è§ã€‚\râ€‹\t4. æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ID == creator_trx_id\nâ€‹\t=\u0026gt; è‡ªå·±åˆ›å»ºçš„ï¼Œå¯é‡å…¥ï¼Œå½“ç„¶å¯è§äº†\nâ€‹\tå¯è§æ€§å–å†³äºReadViewçš„å¿«ç…§æœºåˆ¶ =\u0026gt; ReadViewåˆ›å»ºæ—¶é—´ å†³å®šäº†äº‹åŠ¡èƒ½çœ‹åˆ°å“ªäº›å·²æäº¤çš„æ•°æ®ã€‚\nMVCC\nè§£å†³è„è¯»ï¼šäº‹åŠ¡åªèƒ½è¯»å–å·²æäº¤çš„æ•°æ®è®°å½•ï¼›å¯è§æ€§æ§åˆ¶ =\u0026gt; å»UndoLogä¸­æ‰¾å†å²è®°å½•\nè§£å†³ä¸å¯é‡å¤è¯»ï¼šReadView\nâ—ä¸èƒ½è§£å†³å¹»è¯»ï¼šæ¯”å½“å‰äº‹åŠ¡Idå°çš„äº‹åŠ¡æäº¤äº†ï¼Œé‚£ä¹ˆæ–°å‡ºç°çš„è®°å½•å¯ä»¥è¢«çœ‹åˆ°ï¼Œç‰¹åˆ«æ˜¯èŒƒå›´æŸ¥è¯¢çš„æ—¶å€™\nä½¿ç”¨åœºæ™¯ï¼š\nMVCCï¼šè¯»å¤šå†™å°‘çš„åœºæ™¯ =\u0026gt; å•†å“åº“å­˜æŸ¥è¯¢ï¼Ÿ è¯»äº‹åŠ¡ä¸ä¼šè¢«å†™äº‹åŠ¡é˜»å¡ å¯¹äºé“¶è¡Œé‡‘é¢å˜æ›´åœºæ™¯ =\u0026gt; é” äº‹åŠ¡éš”ç¦»çº§åˆ« äº‹åŠ¡çš„ACIDç‰¹æ€§ï¼šAtomicity, Consistency, Isolation, Durability\næ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼š\nè„è¯»ï¼šäº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bå°šæœªæäº¤çš„æ•°æ®ï¼Œæ­¤æ—¶äº‹åŠ¡Bå›æ»šï¼Œé‚£ä¹ˆAè¯»çš„æ•°æ®æ˜¯è„æ•°æ®(æ— æ•ˆ) å¹»è¯»ï¼šåŒä¸€äº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡æ‰§è¡Œçš„ç›¸åŒæŸ¥è¯¢ï¼Œå¾—åˆ°çš„ç»“æœé›†ä¸ä¸€è‡´ã€‚ å…¶ä»–äº‹åŠ¡æ’å…¥æ–°çš„æ•°æ®å¹¶æäº¤ ä¸å¯é‡å¤è¯»ï¼šåŒä¸€äº‹åŠ¡ï¼Œå¤šæ¬¡è¯»å–çš„åŒä¸€æ•°æ®ï¼Œç»“æœä¸ä¸€è‡´ å› ä¸ºäº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡å¯¹ç»“æœè¿›è¡Œäº†ä¿®æ”¹ äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šé¿å…ä¸Šè¿°æ•°æ®ä¸ä¸€è‡´é—®é¢˜\nè¯»æœªæäº¤ï¼šå…è®¸äº‹åŠ¡è¯»å–å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚ ä¼šå¼•èµ·ï¼šè„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼› è¯»å·²æäº¤ï¼šäº‹åŠ¡åªèƒ½è¯»å–å…¶ä»–äº‹åŠ¡å·²æäº¤çš„æ•°æ®ã€‚é¿å…äº†ï¼šåœ¨è„è¯»ï¼›(é»˜è®¤) å¯é‡å¤è¯»ï¼šåŠ é”(è¡Œé”)ï¼Œç¡®ä¿äº‹åŠ¡å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®çš„ä¸€è‡´æ€§ã€‚é¿å…äº†ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ï¼›å¯èƒ½ï¼šå¹»è¯» ä¸²è¡ŒåŒ–ï¼šäº‹åŠ¡å®Œå…¨ä¸²è¡Œæ‰§è¡Œï¼šé”å®šæ•´ä¸ªè¡¨æˆ–è€…èŒƒå›´æ¥å®ç°ã€‚é¿å…ï¼šè„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯» MySQLä¸»ä»å¤åˆ¶ æ ¸å¿ƒæ˜¯åŸºäºäºŒè¿›åˆ¶æ—¥å¿—(BinLog File)è¿›è¡Œæ•°æ®åŒæ­¥\nä¸»åº“(Master)è®°å½•å˜æ›´ ä»»ä½•å¯¹æ•°æ®åº“è¿›è¡Œå˜æ›´çš„æ“ä½œéƒ½ä¼šè¢«è®°å½•åˆ°BinLogä¸­ã€‚Update Delete Insert ä»åº“Slaveè·å–Binlog ä»åº“é€šè¿‡IOçº¿ç¨‹è¿æ¥ä¸»åº“ï¼Œè¯»å–Binlogï¼Œå¹¶å­˜å…¥æœ¬åœ°ä¸­ç»§æ—¥å¿—ä¸­(Relay log) ä»åº“Slave å›æ”¾Binlog ä»åº“SQLçº¿ç¨‹è§£æRelay Logï¼Œæ‰§è¡Œç›¸åŒçš„SQLè¯­å¥ï¼Œè¿›è€Œä¿æŒä¸ä¸»åº“ç›¸åŒçš„æ•°æ® ä¸€ä¸»å¤šä»\nä¸€ä¸ªä¸»åº“ï¼Œå¤šä¸ªä»åº“ï¼Œæ¯ä¸ªä»åº“ç‹¬ç«‹åŒæ­¥ä¸»åº“æ•°æ® ä¸»ä»å¤åˆ¶çš„ä¼˜åŠ¿\næ•°æ®å†—ä½™ =\u0026gt; æ›´å®‰å…¨ è¯»å†™åˆ†ç¦» =\u0026gt; ä¸»åº“å†™ï¼Œä»åº“è¯»ï¼Œæé«˜æ€§èƒ½ é«˜å¯ç”¨æ€§ =\u0026gt; ä¸»åº“æ•…éšœ åˆ‡æ¢ä»åº“ï¼Œæé«˜ç³»ç»Ÿå¯é æ€§ 610 MySQLä¹è§‚é”\u0026amp;æ‚²è§‚é” ä¹è§‚é”ï¼šæ¯”å¦‚CASæœºåˆ¶ï¼Œä¸åŠ é”å®ç°å¹¶å‘ã€‚å¹¶å‘æ€§èƒ½é«˜ã€‚ æ¯”è¾ƒç‰ˆæœ¬å·å’Œæ—¶é—´æˆ³å®ç°\næ‚²è§‚é”ï¼šæ¯æ¬¡æ“ä½œéƒ½åŠ é”ï¼Œäº’æ–¥æ“ä½œï¼Œæ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ã€‚å¹¶å‘æ€§èƒ½ä½\nâ€‹\n616 MySQL SQLè°ƒä¼˜ é€šè¿‡åˆ†ææ…¢SQLï¼Œåˆ©ç”¨explainåˆ†ææŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œä¼˜åŒ–æŸ¥è¯¢è¯­å¥\nåˆç†è®¾è®¡ç´¢å¼•ï¼Œåˆ©ç”¨è”åˆç´¢å¼•è¿›è¡Œè¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–\nè¦†ç›–ç´¢å¼•ï¼šè®©å¸¸ç”¨çš„å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å›è¡¨æŸ¥è¯¢çš„å¼€é”€ ç´¢å¼•ä¸‹å±‚ï¼šè¿‡æ»¤æ‰ä¸ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®ï¼Œå‡å°‘å›è¡¨æ“ä½œ è‡ªåŠ¨çš„ é¿å… SELECT *ï¼ŒåªæŸ¥è¯¢å¿…è¦çš„å­—æ®µ\né¿å…åœ¨SQLWHRERä¸­æ‰§è¡Œå‡½æ•°è®¡ç®—ï¼Œä½¿å¾—ç´¢å¼•å¤±æ•ˆ\né¿å…%LIKEï¼Œå¯¼è‡´å…¨å±æ‰«æ\næ³¨æ„è”åˆç´¢å¼•éœ€æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™\nä¸è¦å¯¹æ— ç´¢å¼•å­—æ®µè¿›è¡Œæ’åº\né€šè¿‡ä¸šåŠ¡çš„ä¼˜åŒ–ï¼Œè¿›è¡Œç¼“å­˜ï¼Œå‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®\nå‡å°‘å¤šè¡¨æŸ¥è¯¢çš„æƒ…å†µ\nJOINæ“ä½œï¼Œæ•°æ®é‡å¤§æ—¶ï¼Œå®¹æ˜“å¯¼è‡´æŸ¥è¯¢é€Ÿåº¦æ…¢ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½ é¿å…é¢‘ç¹ä½¿ç”¨JOINå¤šå¼ å¤§è¡¨ï¼Œè€Œæ˜¯åˆ†æ­¥æŸ¥è¯¢æˆ–ç¼“å­˜ å¿…è¦æ—¶ä½¿ç”¨å†—ä½™å­˜å‚¨ï¼Œå‡å°‘JOINã€‚ ä¸€æ¬¡æŸ¥å¤§é‡æ•°æ®çš„ä¼˜åŒ–æ–¹å¼\nåˆ†é¡µæŸ¥è¯¢\nä½¿ç”¨LIMITå’ŒOFFSETï¼Œæ¯æ¬¡åªæŸ¥ä¸€éƒ¨åˆ†æ•°æ®\n1SELECT ... FROM ... WHERE ... LIMIT ??? OFFSET ... åˆ†æ‰¹æ¬¡æŸ¥è¯¢ï¼š\n```sql\rSELECT ... FROM ... WHERE id \u0026gt; 1000 ORDER BY id LIMIT 100;\r```\rå›ç­”ï¼šç´¢å¼•ç›¸å…³ï¼š\næŸ¥è¯¢çš„æ—¶å€™ï¼Œæ»¡è¶³æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ æœ€å°æŸ¥è¯¢ï¼ŒåªæŸ¥è¯¢æ‰€éœ€è¦çš„å¿…è¦ä¿¡æ¯ã€‚å‡å°‘å›è¡¨æƒ…å†µ åˆ©ç”¨å¥½ç´¢å¼•ï¼ŒåŠ é€Ÿæ£€ç´¢ã€‚ é¿å…å…¨ç›˜æ‰«æçš„æƒ…å†µ é¿å… Like % å…¨ç›˜åŒ¹é… é¿å…WHereä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œä½¿å¾—ç´¢å¼•å¤±æ•ˆ ä¸è¦å¯¹æ— å…³å­—æ®µè¿›è¡Œæ’åº åˆ©ç”¨å¥½ç¼“å­˜ï¼Œç›´æ¥å‡å°‘æ•°æ®åº“çš„è®¿é—® 619 MySQLå®ç°è¯»å†™åˆ†ç¦» è¯»æ“ä½œæ¬¡æ•°è¿œå¤§äºå†™æ“ä½œ\nå°†è¯»æ“ä½œåˆ†æ‘Šåˆ°ä»æ•°æ®åº“ä¸­ã€‚ä¸»æ•°æ®åº“è´Ÿè´£å†™æ“ä½œã€‚ç„¶åé€šè¿‡ä¸»ä»å¤åˆ¶ï¼ŒåŒæ­¥æ•°æ®ã€‚\næ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯\nâ­1. å…³é”®äº‹åŠ¡å¿…é¡»å¼ºåˆ¶ä»ä¸»åº“ä¸­è¯»å–æ•°æ®\næ”¯ä»˜è®¢å•çŠ¶æ€ æ‰£å‡åº“å­˜ç­‰ç­‰ 2.åŠåŒæ­¥æ§åˆ¶\nå½“äº‹åŠ¡æäº¤åï¼Œè‡³å°‘æœ‰ä¸€ä¸ªä»åº“ç¡®è®¤æ¥æ”¶åˆ°æ•°æ®ï¼Œæ‰è®¤ä¸ºæ•°æ®å†™å…¥æˆåŠŸ\n3.ä¸šåŠ¡å±‚è§£å†³ï¼Œå°†æ•°æ®å†™å…¥Redisä¸­ï¼Œä¼˜å…ˆä»ç¼“å­˜ä¸­è¯»å–æ•°æ®\nè¯»å†™åˆ†ç¦» =\u0026gt; å°†å‹åŠ›åˆ†æ‘Šåˆ°å­åº“ä¸­ï¼Œæé«˜æ€§èƒ½\nåŒæ­¥ =\u0026gt; æ•°æ®ä¸€è‡´æ€§ =\u0026gt; å…¨åŒæ­¥ï¼Œ åŠåŒæ­¥ 620 MySQLä¸»ä»å¤åˆ¶æœºåˆ¶ åº”ç”¨åœºæ™¯æ•°æ®å¤‡ä»½orä¸»ä»æ•°æ®åŒæ­¥\nåŒæ­¥å¤åˆ¶ï¼šå°†binlog fileå¤åˆ¶åˆ°æ‰€æœ‰ä»åº“ï¼Œç­‰æ‰€æœ‰ä»åº“å“åº”äº†ï¼Œä¸»åº“æ‰å“åº”å®¢æˆ·ç«¯ ï¼ˆæ€§èƒ½å·®ï¼Œæ•°æ®ä¸€è‡´æ€§é«˜ï¼‰ åŠåŒæ­¥å¤åˆ¶ï¼šä¸»åº“ç­‰å¾…è‡³å°‘ä¸€ä¸ªä»åº“ç¡®è®¤æ”¶åˆ°æ•°æ®ï¼ˆæ€§èƒ½æŠ˜ä¸­ï¼Œæ•°æ®ä¸€è‡´æ€§è¾ƒé«˜ï¼‰ å¼‚æ­¥å¤åˆ¶ï¼šä¸»åº“ä¸ç”¨ç­‰å¾…ä»åº“ç¡®è®¤ï¼ˆæ€§èƒ½é«˜ï¼Œæ•°æ®ä¸€è‡´æ€§å·®ï¼‰ å¦‚ä½•å®ç°åŒæ­¥è¿‡ç¨‹\næäº¤äº‹åŠ¡è¯·æ±‚ =\u0026gt; ä¸»åº“ =\u0026gt; åŒæ—¶å†™å…¥binlog fileï¼Œæ›´æ–°æ•°æ®å¹¶ç›¸åº”å®¢æˆ·ç«¯ï¼Œå¹¶æ¨é€binlogæ›´æ–°äº‹ä»¶ binlog file è¢«ä¸»åº“çš„dumpçº¿ç¨‹å‘é€ç»™ä»åº“ ä»åº“IOçº¿ç¨‹æ¥æ”¶binlogï¼Œå¹¶å†™å…¥Relay log(ä¸­ç»§æ—¥å¿—)ä¸­ï¼Œç¼“å†² ä»åº“SQLçº¿ç¨‹ä»Relay logé‡å†™äº‹ä»¶åˆ°ä»åº“æ•°æ®åº“ä¸­ã€‚ 622 æ•°æ®åº“è¿›è¡Œåˆ†åº“åˆ†è¡¨ä»¥åŠå¸¦æœ‰çš„é—®é¢˜ åˆ†åº“åˆ†è¡¨ç­–ç•¥\n**æ°´å¹³åˆ†è¡¨ï¼š**å°†ä¸€å¼ è¡¨çš„æ•°æ®ï¼Œæ”¾åœ¨ä¸¤ä¸ªè¡¨ä¸­ã€‚ä¾‹å¦‚æ ¹æ®ID **å‚ç›´åˆ†è¡¨ï¼š**å°†ä¸€å¼ è¡¨ä¸åŒåˆ—æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ä¸­ï¼Œâ­å‡å°‘æ¯å¼ è¡¨çš„å­—æ®µæ•°æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¡¨å¯ä»¥æ‹†åˆ†ä¸ºåŸºæœ¬ä¿¡æ¯å’Œè¯¦ç»†ä¿¡æ¯è¡¨ã€‚ **æ°´å¹³åˆ†åº“ï¼š**å°†ç›¸åŒè¡¨ç»“æ„å¤åˆ¶ä¸€ä»½åˆ°å¦ä¸€å¼ è¡¨ä¸­ï¼Œå‡å°‘å•ä¸€æ•°æ®åº“çš„è¯»å†™å‹åŠ›ã€‚ **å‚ç›´åˆ†åº“ï¼š**æ ¹æ®ä¸šåŠ¡åŠŸèƒ½ï¼Œå°†è¡¨åˆ†åˆ°ä¸åŒæ•°æ®åº“ä¸­ã€‚ä¾‹å¦‚å°†ç”¨æˆ·æ•°æ®ã€å•†å“æ•°æ®åˆ†åˆ«å­˜å‚¨åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ã€‚ ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ\néšç€ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œå¯¼è‡´è¡¨æ•°æ®é‡å¤§(æ•°æ®å †ç§¯)ï¼Œè¯»å†™è¯·æ±‚å¤š(å¹¶å‘é‡é«˜)ã€‚\n=\u0026gt;å¯¼è‡´ æ€§èƒ½ç“¶é¢ˆï¼Œå•ä¸€æ•°æ®åº“æ€§èƒ½æœ‰é™ã€‚\nåˆ†è¡¨ï¼š100wä¸­æ‰¾ï¼Œå’Œ1wä¸­æ‰¾è¿˜æ˜¯ä¸ä¸€æ ·çš„ã€‚å¯ä»¥å…ˆhashè®¡ç®—åˆ°åº•åœ¨å“ªä¸ªæ•°æ®åº“ï¼Œå†å…·ä½“æ‰§è¡Œã€‚ åˆ†åº“ï¼šå¯ä»¥æŒ‰ä¸šåŠ¡oråŠŸèƒ½ä¸åŒï¼Œå°†è¯·æ±‚åˆ†é…åˆ°å¤šæ€æœåŠ¡å™¨ä¸Šï¼Œé™ä½å•ä¸€æœåŠ¡å™¨å‹åŠ›ã€‚ 624 æ•°æ®åº“åˆ†åº“åˆ†è¡¨å¯èƒ½å¼•å‘çš„é—®é¢˜ å•æœº =\u0026gt; åˆ†å¸ƒå¼\näº‹åŠ¡é—®é¢˜ï¼šä¼šå‡ºç°äº‹åŠ¡çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³ã€‚ JOINè¿è¡¨é—®é¢˜ï¼š è·¨æœåŠ¡å™¨æ— æ³•JOINè¡¨ï¼Œä¸šåŠ¡ä¸­å®ç°å…³è”ï¼Œæˆ–è€…ä½¿ç”¨å†—ä½™å­—æ®µã€‚ **å…¨å±€å”¯ä¸€IDé—®é¢˜ï¼š**å•æœºï¼Œä½¿ç”¨è‡ªå¢é•¿çš„IDå³å¯ï¼Œåˆ†å¸ƒå¼å¿…é¡»ä½¿ç”¨å…¨å±€å”¯ä¸€IDå‘å·å™¨ç”Ÿæˆå”¯ä¸€IDã€‚ **æ’åºé—®é¢˜ï¼š**ä¸Šæ¨åˆ°ä¸šåŠ¡ä¸­å®ç°ã€‚ **counté—®é¢˜ï¼š**ä¸šåŠ¡ä»£ç ä¸­ç´¯åŠ ã€‚ 625 MySQLè·å–æ•°æ®ï¼Œä»ç£ç›˜ä¸­å†™çš„å—ï¼Ÿ MySQLä¸­ï¼Œå¹¶ä¸æ€»æ˜¯ä»ç£ç›˜ä¸­è¯»å–ã€‚åˆ©ç”¨ç¼“å­˜æœºåˆ¶ï¼Œæé«˜è¯»å–æ€§èƒ½ã€‚\nmysql8.0ä¸­æœ‰æŸ¥è¯¢ç¼“å­˜ï¼Œåªæœ‰sqlç›¸åŒæ—¶æ‰ä¼šå‘½ä¸­ï¼Œå‘½ä¸­ç‡ä½ï¼Œåœ¨8.0åç§»é™¤äº†\nbuffer pool(old sublist, young sublist), é‡Œé¢å­˜å‚¨äº†ä¸€ä¸ªä¸€ä¸ªçš„æ•°æ®é¡µï¼Œmysqlä¼šä»buffer poolä¸­æ‰¾ï¼Œæ‰¾åˆ°å°±è¿”å›ã€‚\n=\u0026gt; ä¸€å—å†…å­˜ç©ºé—´ï¼Œè®¿é—®æŸä¸ªæ•°æ®(ç£ç›˜ä¸­)æ—¶ï¼Œä¼šå°†åŒ…æ‹¬è¯¥æ•°æ®çš„é¡µåŠ è½½åˆ°å†…å­˜ä¸­ã€‚é¡µå¤§å°16KBï¼Œå±€éƒ¨æ€§åŸç†ï¼Œä»¥åå¯¹è¯¥é¡µçš„ä¿®æ”¹å’Œè®¿é—®éƒ½åœ¨buffer poolä¸­è¿›è¡Œã€‚\n=\u0026gt; å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šå˜ä½“çš„LRU(least recently usedæœ€è¿‘æœ€å°‘ä½¿ç”¨)ã€‚ buffer poolå°†æ•°æ®åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£(é»˜è®¤5:3)ï¼Œå½“æ•°æ®ä»ç£ç›˜è°ƒåˆ°å†…å­˜ä¸­æ—¶ï¼Œå› ä¸ºç©ºé—´æ—¶é—´å±€éƒ¨æ€§ï¼Œæ–°çš„æ•°æ®ä¼šæ”¾åœ¨è€å¹´é˜Ÿåˆ—ä¸­ï¼Œå½“1sä¸­æ²¡æœ‰å†æ¬¡è®¿é—®æ—¶æ‰è½¬åˆ°å¹´è½»é˜Ÿåˆ—ä¸­ã€‚\n=\u0026gt; å¦‚æœç›´æ¥æ”¾åœ¨å¹´è½»ä»£ä¸­ï¼Œå¯èƒ½ä¼šæŠŠçƒ­ç‚¹æ•°æ®æ·˜æ±°æ‰\n=\u0026gt; 1sï¼Œæ—¶é—´çª—å£ï¼Œæ¸¡è¿‡è¿™ä¸ªæ—¶é—´è¿˜è¢«è®¿é—®è®¤ä¸ºæ˜¯çƒ­ç‚¹æ•°æ®ã€‚\n629 ä¸ºä»€ä¹ˆä¸æ¨èå¤šè¡¨JOIN æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œå¤šè¡¨JOINï¼Œæ•°æ®åº“éœ€è¦å¯¹è”æ¥çš„æ¯ä¸ªè¡¨è¿›è¡Œæ‰«æï¼Œä¼šæ¶ˆè€—å¤§é‡çš„CPUå’Œå†…å­˜èµ„æºã€‚ æ€§èƒ½æ¯”è¾ƒä½\næ•°æ®åº“å¾€å¾€æ˜¯æˆ‘ä»¬ç³»ç»Ÿçš„å¼±ç‚¹ï¼Œå¾ˆå¤šæƒ…å†µæ€§èƒ½ç“¶é¢ˆéƒ½åœ¨æ•°æ®åº“ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°½å¯èƒ½é¿å…æŠŠå‹åŠ›æ”¾åœ¨æ•°æ®åº“ä¸Šã€‚\nJOINè¿æ¥è¡¨çš„æ—¶å€™ï¼Œéœ€è¦å…³æ³¨è¢«é©±åŠ¨è¡¨çš„æŸ¥è¯¢æ˜¯å¦èƒ½å¤Ÿå‘½ä¸­ç´¢å¼•ï¼Œä¸ç„¶ä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚\nå°½å¯èƒ½è®©å°è¡¨åšé©±åŠ¨è¡¨ï¼Œå› ä¸ºé©±åŠ¨è¡¨éœ€è¦å…¨è¡¨æ‰«æï¼Œè€Œè¢«é©±åŠ¨è¡¨æ˜¯é€šè¿‡ç´¢å¼•æŸ¥è¯¢çš„ã€‚ä¸”è¢«é©±åŠ¨è¡¨æœ€å¥½èƒ½å¤Ÿå‘½ä¸­ç´¢å¼•ã€‚\nä¾‹å­\n1SELECT * FROM ... a1 join ... a2 on (a1.a == a2.a) å°è¡¨æœ‰Aè¡Œï¼Œå¤§è¡¨æœ‰Bè¡Œã€‚æ¯æ¬¡æ‰«æAï¼Œæ¯è¡Œéƒ½éœ€è¦å»å¤§è¡¨é‡Œé¢æŸ¥ï¼Œæ—¶é—´LogB(å‘½ä¸­ç´¢å¼•)ï¼Œå‡è®¾å­˜åœ¨å›è¡¨ï¼Œé‚£ä¹ˆä¸º2*LogBçš„æŸ¥è¯¢æ—¶é—´ã€‚æœ‰Aè¡Œï¼Œé‚£ä¹ˆæŸ¥Bè¡¨çš„æ—¶é—´ä¸º=\u0026gt;A*2*LogBï¼›æŸ¥Aè¡¨çš„æ—¶é—´ä¸ºA,total =\u0026gt; A+A*2*LogBã€‚\nJOIN SQLæŸ¥è¯¢çš„æµç¨‹\næ‰«æAè¡¨(å°è¡¨) è¯»å–Aè¡¨çš„æ‰€æœ‰è¡Œï¼ŒåŠAæ¬¡æ“ä½œ æŸ¥è¯¢Bè¡¨ Aè¡Œ * LogB(å‘½ä¸­ç´¢å¼•çš„æŸ¥è¯¢æ—¶é—´) * 2(å›è¡¨æ—¶é—´) =\u0026gt; A + A*2*LogB 630 MySQLä¸­è§£å†³æ·±åº¦åˆ†é¡µé—®é¢˜ æ·±åº¦åˆ†é¡µæ˜¯æŒ‡æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼ŒæŒ‰ç…§åˆ†é¡µè®¿é—®åé¢çš„æ•°æ®ï¼Œä¾‹å¦‚limit 99999, 10ï¼Œè¿™å›ä½¿å¾—æ•°æ®åº“æ‰«æå‰é¢çš„99999æ¡æ•°æ®ï¼Œæ‰èƒ½å¾—åˆ°æœ€ç»ˆçš„10æ¡æ•°æ®ã€‚\n1LIMIT num1, num2; -- åç§»é‡ï¼Œ è¿”å›è¡Œæ•°ã€‚ ä¼šæ‰«æèµ·ç‚¹åˆ°num1æ•´æ®µè®°å½• 2LIMIT num1; -- è¿”å›è¡Œæ•° è§£å†³æ–¹æ³•ï¼š\nå­æŸ¥è¯¢ï¼š å­æŸ¥è¯¢ + è®°å½•ä¸Šä¸€æ¬¡æŸ¥è¯¢çš„ Last ID 1SELECT id, name 2FROM tabel 3WHERE name = \u0026#39;A\u0026#39; 4and id \u0026gt;= (SELECT id FROM tabel WHERE name = \u0026#39;A\u0026#39; order by id limit 99999, 1) 5order by id limit 10; 6 7-- ä¼ é€’ä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€åä¸€ä¸ªID 8SELECT * FROM users WHERE id \u0026gt; last_id ORDER BY id LIMIT 10; 1418 æ•°æ®åº“è§†å›¾ æ•°æ®åº“è§†å›¾æ˜¯è™šæ‹Ÿè¡¨ï¼Œä½œç”¨ï¼šç®€åŒ–å¤æ‚æŸ¥è¯¢ã€å®‰å…¨æ€§ã€æ•°æ®æŠ½è±¡ã€å¯é‡ç”¨æ€§\n1CREATE VIEW employee_salaries AS 2SELECT 3 e.employee_id, 4 CONCAT(e.first_name, \u0026#39; \u0026#39;, e.last_name) AS full_name, 5 d.department_name, 6 e.salary 7FROM 8 employees e 9JOIN 10 departments d ON e.department_id = d.department_id; 11 12-- CREATE VIEW view__ AS 1479 ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œä¸æ¨èä¸ºæ•°æ®åº“å»ºç«‹ç´¢å¼• æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š\nåŸå›  æ•°æ®é‡å°çš„è¡¨ å»ºè®®ç´¢å¼•å¹¶ä¸ä¼šæ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œåè€Œå¢åŠ å¤æ‚æ€§ é¢‘ç¹æ›´æ–°çš„è¡¨ æ¯ä¸ªæ’å…¥åˆ é™¤æ“ä½œï¼Œéƒ½éœ€è¦æ›´æ–°ç´¢å¼•ï¼Œå¯¼è‡´è¿‡é«˜çš„ç»´æŠ¤ç´¢å¼•çš„å¼€é”€ é«˜åº¦é‡å¤çš„åˆ— ä¾‹å¦‚ï¼Œæ€§åˆ«ï¼Œç´¢å¼•æ•ˆæœä¸æ˜æ˜¾ï¼Œåè€Œå¢åŠ å­˜å‚¨ç©ºé—´ é•¿æ–‡æœ¬å­—æ®µ è¿™äº›ç±»å‹çš„åˆ—åŒ…å«å¤§é‡æ•°æ®ï¼Œæ·»åŠ ç´¢å¼•ï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨å†…å­˜æ’åºï¼Œéœ€è¦åˆ©ç”¨ç£ç›˜ï¼Œå¯¼è‡´å¤§é‡IO 3179 æ•°æ®åº“ä¸åœæœè¿ç§» é€šè¿‡æ•°æ®åŒå†™å®ç°\n**æ—§æ•°æ®åŒæ­¥ï¼š**é‡‡ç”¨ä¸»ä»åŒæ­¥æ–¹å¼ï¼Œå°†æ–°åº“ä½œä¸ºæ—§åº“çš„ä»åº“ï¼Œå®ç°å†å²æ•°æ®çš„è¿ç§»ï¼› **æ–°æ•°æ®åŒæ­¥ï¼š**é‡‡ç”¨æ•°æ®åŒå†™æ–¹å¼ï¼Œå°†æ–°æ•°æ®åŒæ—¶å†™å…¥æ–°æ—§ä¸¤ä¸ªåº“ä¸­ã€‚ **ä¸€è‡´æ€§æ£€æŸ¥ï¼š**å®šæ—¶ä»»åŠ¡ï¼ŒæŠ½æ£€ä¸¤ä¸ªåº“çš„æ•°æ®ä¸€è‡´æ€§ï¼› ç°åº¦åˆ‡æµï¼š é€æ¸å°†ç”¨æˆ·çš„æ•°æ®è¯·æ±‚ï¼Œè¿ç§»åˆ°æ–°åº“ä¸­ã€‚ 4040 MySQLæ•°æ®åº“çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³• SQL å’Œ åº“è¡¨ä¸¤éƒ¨åˆ†è®¾è®¡ï¼Œä¼˜åŒ–MySQLæ€§èƒ½é—®é¢˜ã€‚\nSQLä¼˜åŒ–:\né¿å… SELECT * ï¼ŒåªæŸ¥è¯¢å¿…è¦å­—æ®µï¼› é¿å…åœ¨SQLä¸­è¿›è¡Œå‡½æ•°ç­‰è®¡ç®—æ“ä½œï¼Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼› é¿å…ä½¿ç”¨ %Likeï¼Œå¯¼è‡´å…¨è¡¨æ‰«æï¼› æ³¨æ„è”åˆç´¢å¼•éœ€è¦æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™ï¼› ä¸è¦å¯¹æ— ç´¢å¼•å­—æ®µè¿›è¡Œæ’åºã€‚ åº“è¡¨è®¾è®¡\nåˆç†è¡¨ç»“æ„ï¼šåˆç†çš„æ•°æ®ç±»å‹ï¼› åˆç†å†—ä½™å­—æ®µï¼šå†—ä½™è®¾è®¡ï¼Œå‡å°‘å…³è”æŸ¥è¯¢ï¼› ç´¢å¼•ä¼˜åŒ–ï¼šæ ¹æ®æŸ¥è¯¢é¢‘ç‡å’Œæ¡ä»¶ï¼Œåˆ›å»ºåˆé€‚çš„ç´¢å¼•ï¼› åˆ†åº“åˆ†è¡¨ï¼šæé«˜è¯»å†™æ€§èƒ½ã€‚ 1219 æ•°æ®åº“ä¸‰å¤§èŒƒå¼ ç¬¬ä¸€èŒƒå¼ï¼šåŸå­æ€§ï¼Œå­—æ®µåªåŒ…å«å•ä¸€æ•°æ®é¡¹ï¼›\nç¬¬äºŒèŒƒå¼ï¼šéä¸»é”®å¿…é¡»ä¾èµ–äºæ•´ä¸ªä¸»é”®ï¼›\nç¬¬ä¸‰èŒƒå¼ï¼šéä¸»é”®å­—æ®µåªä¾èµ–äºä¸»é”®ï¼Œä¸åº”è¯¥ç›¸äº’ä¾èµ–ã€‚\næ•°æ®åº“ä¸­å­˜å‚¨é‡‘é¢æ•°æ®ä½¿ç”¨çš„æ•°æ®ç±»å‹ï¼šbigint and decimal\nsql:java\nbigint: long;\ndecimal:BigDecimal\n1482 MySQLä¸­EXISTSå’ŒINçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ EXISTS ÉªÉ¡ËˆzÉªsts åˆ¤æ–­å­æŸ¥è¯¢æ˜¯å¦è¿”å›ä»»ä½•è¡Œï¼Œé€šå¸¸ç”¨äºæ£€æŸ¥æŸä¸ªæ¡ä»¶æ˜¯å¦æ»¡è¶³; æ»¡è¶³æ¡ä»¶ååˆ™è¿”å›ï¼Œå¤§æ•°æ®é‡æ—¶æ€§èƒ½å¥½ IN æ£€æŸ¥æŸä¸ªå€¼æ˜¯å¦åœ¨æŒ‡å®šé›†åˆä¸­ï¼› EXISTS å¤–=\u0026gt;å†…åˆ¤æ–­ï¼Œæ»¡è¶³å³åœæ­¢ã€‚æœ€å¥½å­è¡¨æœ‰ç´¢å¼•ã€‚\nIN =\u0026gt; å…ˆå†…ï¼Œ å†å¤–åŒ¹é…å†…ã€‚\n11175 SQLä¸­SELECTã€FROM\u0026hellip; çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ FROM WHEREï¼š æ·˜æ±°çš„å•ä½æ˜¯è¡Œ GROUP BY HAVINGï¼šèšåˆæ•°æ®ï¼Œæ·˜æ±°çš„å•ä½æ˜¯æ•´ç»„ SELECT ORDER BY LIMIT B+æ ‘ã€èšç°‡ç´¢å¼•ã€ä¸»é”®ç´¢å¼•ã€äºŒçº§ç´¢å¼• B+æ ‘ï¼šæ•°æ®ç»“æ„\nèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ï¼šå¶å­èŠ‚ç‚¹å­˜å‚¨äº†æ•´è¡Œæ•°æ®ï¼Œä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€å¼ (Primary Key)ã€‚ ä½¿ç”¨B+æ ‘å®ç°\näºŒçº§ç´¢å¼•ï¼šå¶å­å’Œéå¶å­éƒ½åªå­˜å‚¨äº†Indexæ¯”è¾ƒéœ€è¦çš„æ•°æ®ã€‚ä½¿ç”¨B+æ ‘å®ç°ã€‚å› æ­¤ï¼Œç´¢å¼•å®Œï¼ŒSELECTæœ‰å…¶ä»–å­—æ®µï¼Œéœ€è¦å›è¡¨æ ¹æ®Primary Keyå†æŸ¥ä¸€æ¬¡\n=\u0026gt; ç´¢å¼•è¦†ç›–ï¼šå°†SELECT æ‰€éœ€çš„å­—æ®µå‡æ”¾ç½®åœ¨Indexä¸­ï¼Œå°±ä¸ç”¨å›è¡¨æŸ¥è¯¢äº†\n","permalink":"http://longcoding.top/posts/jobs/mysql/","summary":"\u003ch3 id=\"617-mysql-æ•°æ®æ’åº-å®ç°\"\u003e617 MySQL æ•°æ®æ’åº å®ç°ï¼Ÿ\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eOrder By å‘½ä¸­ç´¢å¼•(åŒ…æ‹¬ç´¢å¼•å­—æ®µ)ï¼Œä½¿ç”¨ç´¢å¼•æ’åº(æœ‰åº)ï¼Œæ•ˆç‡æœ€é«˜æ•ˆ\u003c/li\u003e\n\u003cli\u003eå¦åˆ™ä½¿ç”¨æ–‡ä»¶æ’åºï¼Œæ–‡ä»¶å°‘=\u0026gt; å†…å­˜æ’åº sort_buffer\u003c/li\u003e\n\u003cli\u003eæ–‡ä»¶å¤§=\u0026gt;å¤–éƒ¨æ’åºï¼Œå½’å¹¶æ’åº\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eå†…éƒ¨æ’åºç»†èŠ‚ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eåŒè·¯æ’åº(å¾…æ’åºçš„åˆ—æ•°æ®å¤ªå¤§äº†)\u003c/strong\u003eï¼šä½¿ç”¨row_id(å›æŸ¥è¡¨) + sort_field\u003c/p\u003e\n\u003cp\u003eâ€‹\t\tæ’å¥½åºåï¼Œä½¿ç”¨row_idå°†å®Œæ•´çš„è®°å½•å–å‡ºæ¥\u003c/p\u003e\n\u003cp\u003eå•è·¯æ’åº(å¾…æ’åºæ•°æ®å¤§å°èƒ½æ¥å—)\u003c/p\u003e\n\u003cp\u003eâ€‹\tç›´æ¥æ‹ï¼Œä¸ä¼šæŸ¥è¡¨ï¼Œç›´æ¥æŠŠæ‹å¥½çš„ç»“æœè¿”å›\u003c/p\u003e\n\u003cp\u003eå¤–éƒ¨æ’åºï¼š\u003c/p\u003e\n\u003cp\u003eæ‹†åˆ†å°çš„ï¼Œå¤–éƒ¨å¤šè·¯å½’å¹¶æ’åºï¼Œå°=\u0026gt;å¤§\u003c/p\u003e\n\u003cp\u003eå¤–éƒ¨å½’å¹¶æ’åº =\u0026gt; å…ˆåˆ†æ®µæ’åºï¼Œæ¯ä¸€æ®µè°ƒå…¥å†…å­˜æ‰§è¡Œå¿«æ’\u003c/p\u003e\n\u003cp\u003eâ€‹                        =\u0026gt; å½’å¹¶é˜¶æ®µï¼Œå› ä¸ºæ¯å­æ®µéƒ½æ˜¯æœ‰åºçš„ =\u0026gt; å¤šè·¯å½’å¹¶æ’åº\u003c/p\u003e\n\u003ch3 id=\"589-ä¸€æ¡sqlçš„æ‰§è¡Œè¿‡ç¨‹\"\u003e589 ä¸€æ¡SQLçš„æ‰§è¡Œè¿‡ç¨‹\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eå…ˆé€šè¿‡\u003cstrong\u003eè¿æ¥å™¨\u003c/strong\u003eæ ¡éªŒæƒé™\u003c/li\u003e\n\u003cli\u003eåˆ©ç”¨\u003cstrong\u003eåˆ†æå™¨\u003c/strong\u003eè¿›è¡ŒSQLè¯­å¥è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æï¼Œæ„å»ºè§£ææ ‘\u003c/li\u003e\n\u003cli\u003eåˆ©ç”¨\u003cstrong\u003eä¼˜åŒ–å™¨\u003c/strong\u003eé€‰æ‹©åˆé€‚çš„ç´¢å¼•å’Œè¡¨è¿æ¥é¡ºåºï¼Œæœ€ç»ˆé€‰æ‹©ä¸€æ¡æœ€ä½³çš„æ‰§è¡Œè®¡åˆ’\u003c/li\u003e\n\u003cli\u003eåˆ©ç”¨\u003cstrong\u003eæ‰§è¡Œå™¨\u003c/strong\u003eï¼Œè°ƒç”¨å¼•æ“å±‚æŸ¥è¯¢æ•°æ®ï¼Œè¿”å›ç»“æœé›†\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eå…·ä½“ï¼šSelect * from user where id = 1;\u003c/p\u003e\n\u003cimg src=\"http://sthda9dn6.hd-bkt.clouddn.com/FssKKPCKzeVJv4TEPdMldct1M8z4\" alt=\"image-20250305222939319\" style=\"zoom:50%;\" /\u003e\r\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eSQL =\u0026gt; Serverå±‚\u003cstrong\u003eè¿æ¥å™¨\u003c/strong\u003eï¼Œæƒé™æ ¡éªŒï¼Œè´¦å·æ˜¯å¦æœ‰èµ„æ ¼è·å–ã€‚æ— =\u0026gt; Access denied for userã€‚  è¿æ¥æˆåŠŸåï¼Œç©ºé—²ä¸€æ®µæ—¶é—´ä¼šæ–­å¼€\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eåˆ†æå™¨(æŸ¥è¯¢è§£æ)\u003c/strong\u003e =\u0026gt;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè¯­æ³•åˆ†æï¼šSQL  : Selectç±»å‹âœ”ï¸ userè¡¨âœ”ï¸ idåˆ— âœ”ï¸æ‹†åˆ†æˆè¯ï¼Œå†ç»„è£…ä¸ºè§£ææ ‘ã€‚\u003c/li\u003e\n\u003cli\u003eè¯­ä¹‰åˆ†æï¼šè¯­æ³•æ˜¯å¦æœ‰è¯¯ =\u0026gt; you have an error in your SQL syntax (å­—æ®µã€è¡¨|å­˜åœ¨ï¼Ÿ)   åˆ†æè§£ææ ‘è¯­æ³•æ­£ç¡®æ€§\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eä¼˜åŒ–å™¨\u003c/strong\u003e(æŸ¥è¯¢ä¼˜åŒ–)=\u0026gt;\u003c/p\u003e","title":"MySQLé¢è¯•é¢˜ç¬”è®°"},{"content":"637 å¸¸è§çš„æ•°æ®ç±»å‹ String Set Hash List Zset ï¼ˆSorted Setï¼‰ BitMap =\u0026gt; ä½å›¾ï¼Œè€ƒå‹¤ï¼Œæˆ–è€…xxxåˆ†é…æƒ…å†µ\nHyperLogLog =\u0026gt; ç”¨æˆ·è®¿é—®çš„ç‹¬ç«‹ç”¨æˆ·æ•°é‡\nGEO =\u0026gt; åœ°ç†\nåº”ç”¨åœºæ™¯ï¼š\nç¼“å­˜ å®æ—¶ç³»ç»Ÿ æ¶ˆæ¯é˜Ÿåˆ— åˆ†å¸ƒå¼é” è®¡æ•°å™¨ï¼šé¡µé¢è®¿é—®é‡ã€ç‚¹èµæ•°ã€è¯„è®ºæ•° 651 Redis ä¸»ä»å¤åˆ¶çš„å®ç°åŸç† â¡ï¸ä¸»èŠ‚ç‚¹-ä»èŠ‚ç‚¹ çš„æ•°æ®åŒæ­¥\nWhy éœ€è¦ä¸»å’Œä»\næ•°æ®å†—ä½™\u0026amp;æ•…éšœæ¢å¤ï¼ŒæŸä¸ªèŠ‚ç‚¹å®•æœºäº†ï¼Œä½†æ˜¯å…¶ä»–èŠ‚ç‚¹è¿˜æ´»ç€ï¼› æä¾›è´Ÿè½½å‡è¡¡ï¼Œé…åˆè¯»å†™åˆ†ç¦»ç­–ç•¥ï¼Œä¸»èŠ‚ç‚¹å†™æ“ä½œï¼Œä»èŠ‚ç‚¹æä¾›è¯»æ“ä½œï¼› é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶æ˜¯Redisçš„é«˜å¯ç”¨çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯å“¨å…µå’Œé›†ç¾¤å®æ–½çš„åŸºç¡€ã€‚ å¤åˆ¶æµç¨‹ï¼š å…¨é‡ \u0026amp; å¢é‡\nä¸»èŠ‚ç‚¹å‘é€SYNCå‘½ä»¤ä¸ä»èŠ‚ç‚¹è¿›è¡Œè¿æ¥ï¼Œå¼€å§‹åŒæ­¥ï¼Œ ä¸»ä»ä¹‹é—´å»ºç«‹è”ç³»ï¼›\nå…¨é‡å¤åˆ¶(ç¬¬ä¸€æ¬¡è¿æ¥)ï¼š ä¸»èŠ‚ç‚¹æŠŠå…¨éƒ¨æ•°æ®å¤åˆ¶åˆ°ä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹å°†å½“å‰æ•°æ®ç”ŸæˆRDBæ–‡ä»¶ï¼Œå‘é€ç»™ä»èŠ‚ç‚¹ï¼›\nå‘é€çš„æœŸé—´ï¼Œä¸»èŠ‚ç‚¹ç¼“å­˜(Replication backlog buffer-å¤åˆ¶ç§¯å‹ç¼“å†²åŒº)æ‰€æœ‰å†™å‘½ä»¤ã€‚\nå‘é€ç¼“å­˜çš„å†™å‘½ä»¤ç»™ä»èŠ‚ç‚¹ã€‚\næŒç»­åŒæ­¥ï¼ŒæŒç»­æŠŠå†™å‘½ä»¤åŒæ­¥ç»™ä»èŠ‚ç‚¹ã€‚\nä¿æŒè¿æ¥ä¸æ–­çº¿é‡è¿\nRedisä¸­ï¼Œä¸»èŠ‚ç‚¹ä¼šå’Œä»èŠ‚ç‚¹ä¿æŒé•¿è¿æ¥ï¼Œä»¥ç¡®ä¿æ•°æ®çš„æŒç»­åŒæ­¥ï¼›\nå½“è¿æ¥æ–­å¼€åï¼Œé‡è¿ï¼Œè¯·æ±‚å¢é‡å¤åˆ¶ï¼Œé¿å…å…¨é‡å¤åˆ¶å¸¦æ¥çš„å¤§é‡å¼€é”€ã€‚\næ•°æ®ä¸€è‡´æ€§å’Œå¤åˆ¶å»¶è¿Ÿ\nç”±äºç½‘ç»œå»¶è¿Ÿï¼Œä¸»ä»ä¹‹é—´ä¼šå­˜åœ¨çŸ­æš‚çš„æ•°æ®ä¸ä¸€è‡´ã€‚ â­å¯¹äºæ•°æ®ä¸€è‡´æ€§ä¸¥æ ¼çš„ä»»åŠ¡ï¼Œè¦æ±‚è®¿é—®ä¸»èŠ‚ç‚¹ã€‚\n652 Redisé›†ç¾¤å®ç°çš„åŸç† â¡ï¸é€šè¿‡å¤šä¸ªRediså®ä¾‹å®ç°ï¼Œæ¯ä¸ªå®ä¾‹å­˜å‚¨éƒ¨åˆ†æ•°æ®ï¼Œä¸”è¿™äº›æ•°æ®æ˜¯ä¸é‡å¤çš„ã€‚ç±»ä¼¼äºå°†æ•°æ®åº“åˆ†åº“ï¼ŒæŒ‰ä¸šåŠ¡åŠŸèƒ½\nâ¡ï¸å…·ä½“ä¸ºé‡‡ç”¨Hash Slotå“ˆå¸Œæ§½ï¼Œå°†é”®çš„ç©ºé—´åˆ’åˆ†ä¸º16384ä¸ªæ§½ã€‚æ¯ä¸ªRediså®ä¾‹åªè´Ÿè´£ä¸€éƒ¨åˆ†æ§½ã€‚\nå®¢æˆ·ç«¯ =\u0026gt; ä»»æ„Rediså®ä¾‹ =\u0026gt; æ•°æ®æ˜¯å¦åœ¨æœ¬æœºä¸Šï¼Œåœ¨è¿”å›ï¼Œå¦åˆ™è¿”å›ç›®æ ‡èŠ‚ç‚¹ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å†è·¯ç”±åˆ°å…¶ä»–Redisä¸­ã€‚\n\u0026lt;= å°†å•ä¸ªRedisçš„å‹åŠ›ï¼Œåˆ†æ‘Šåˆ°å¤šå°Rediså®ä¾‹ä¸Šï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚\nç‰¹æ€§\nå®ç°æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå°†ä¸åŒæ•°æ®å‚¨å­˜åœ¨ä¸åŒèŠ‚ç‚¹ä¸­ å»ä¸­å¿ƒåŒ–æ€æƒ³ï¼Œæ— ä¸­å¿ƒèŠ‚ç‚¹ï¼Œè®¿é—®ä»»æ„ä¸€ä¸ªå³å¯ã€‚è®¿é—®æ­£ç¡®åˆ™å“åº”æ•°æ®ï¼Œå¦åˆ™å“åº”å¯¹åº”çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®ã€‚ å†…ç½®é«˜å¯ç”¨æ€§ï¼šåˆ†ä¸ºNç»„ï¼Œæ¯ç»„æä¾›ä¸åŒçš„æ•°æ®ç¼“å­˜æœåŠ¡ï¼Œæ¯ç»„ä¸­åˆæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’ŒKä¸ªä»èŠ‚ç‚¹(ä¸»æä¾›è¯»å†™ï¼Œä»æé«˜è¯»ï¼Œå¹¶è¿›è¡Œæ•°æ®åŒæ­¥åŠŸèƒ½) å¸ƒå±€ï¼š\né›†ç¾¤æœ‰å¤šä¸ªmasterï¼Œæ¯ä¸ªmasterä¿å­˜ä¸åŒçš„æ•°æ®(æµ·é‡æ•°æ®) æ¯ä¸ªmasteræœ‰å¤šä¸ªslave (æ”¯æŒé«˜å¹¶å‘è¯») masterä¹‹é—´é€šè¿‡pingæ£€æŸ¥å½¼æ­¤çš„å¥åº·åº¦ å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ­£ç¡®çš„èŠ‚ç‚¹(è·¯ç”±è§„åˆ™) å­˜å‚¨ä¸è¯»å–\nåˆ†ç‰‡é›†ç¾¤å¼•å…¥hash slotï¼Œä¸€å…±æœ‰16384ä¸ªæ§½ ä¸åŒå®ä¾‹å¤„ç†ä¸åŒçš„æ§½ è¯»å†™æ•°æ®ï¼šæ ¹æ®æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—hashå€¼ï¼Œå¯¹16384å–ä½™ï¼Œå¾—åˆ°æ’æ§½ï¼Œå¯»æ‰¾æ’æ§½æ‰€åœ¨å®ä¾‹ã€‚ ä¼ ç»Ÿå“ˆå¸Œ\n1hash(key)%N N:æœåŠ¡å™¨æ•°é‡ï¼Œ Nä¸€æ—¦å˜äº†ï¼Œå¤§éƒ¨åˆ†æ•°æ®éƒ½éœ€è¦é‡æ–°æ˜ å°„åˆ°æ–°çš„æœåŠ¡å™¨ä¸Š ä¸€è‡´æ€§å“ˆå¸ŒâŒâŒâŒ\n635 Redisä¸ºä»€ä¹ˆå¿« å­˜å‚¨æ–¹å¼ã€çº¿ç¨‹æ¨¡å‹ã€IOæ¨¡å‹ã€æ•°æ®ç»“æ„\nåŸºäºå†…å­˜\nå•çº¿ç¨‹äº‹ä»¶é©±åŠ¨(é¿å…çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼Œé¿å…é”ç«äº‰,æ•°æ®ä¸€è‡´æ€§) ç»“åˆ IOå¤šè·¯å¤ç”¨(å•çº¿ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥)\né«˜æ•ˆæ•°æ®ç»“æ„ =\u0026gt; ï¼ˆStringï¼ŒListï¼Œ Setï¼‰\nå¤šçº¿ç¨‹å¼•å…¥ =\u0026gt; ç½‘ç»œå¤„ç†å¹¶å‘è¯·æ±‚ï¼Œå‡å°‘ç½‘ç»œIOç­‰å¾…å½±å“ (ç½‘ç»œIOå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ)\nRedisä¸»çº¿ç¨‹å¾ˆå¿«ï¼Œä½†æ˜¯ç½‘ç»œIOå¤„ç†ä¸ä¸€å®šæ›´å¾—ä¸Šå®ƒçš„é€Ÿåº¦ï¼Œå¯èƒ½æˆä¸ºç´¯èµ˜ã€‚\nä½¿ç”¨å¤šä¸ªIOè¿›ç¨‹åŠ å¿«ç½‘ç»œIOé€Ÿåº¦(æ•°æ®åºåˆ—å·\u0026amp;ååºåˆ—åŒ–ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„è§£æ\u0026hellip;)\n638 è·³è¡¨ å¤šå±‚é“¾è¡¨å®ç°ï¼Œåº•å±‚é“¾è¡¨ä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œæ¯å±‚é“¾è¡¨éƒ½æ˜¯ä¸‹ä¸€å±‚çš„å­é›† (æœ‰åºé“¾è¡¨çš„åŸºç¡€ä¸Šæ·»åŠ å¤šçº§ç´¢å¼•)\nç‰¹æ€§\nå¿«æŸ¥æ‰¾æŸä¸ªå…ƒç´  \u0026amp; èŒƒå›´æŸ¥è¯¢ å¤æ‚åº¦O(logn) 1Level 3: 1 ---------------\u0026gt; 9 ----------------\u0026gt; 20 2Level 2: 1 ------\u0026gt; 5 -----\u0026gt; 9 ----\u0026gt; 13 -----\u0026gt; 20 3Level 1: 1 -\u0026gt; 3 -\u0026gt; 5 -\u0026gt; 7 -\u0026gt; 9 -\u0026gt; 11 -\u0026gt; 13 -\u0026gt; 15 -\u0026gt; 20 4Level 0: 1 -\u0026gt; 2 -\u0026gt; 3 -\u0026gt; 4 -\u0026gt; 5 -\u0026gt; 6 -\u0026gt; 7 -\u0026gt; 8 -\u0026gt; 9 -\u0026gt; 10 -\u0026gt; 11 -\u0026gt; 12 -\u0026gt; 13 -\u0026gt; 14 -\u0026gt; 15 -\u0026gt; 16 -\u0026gt; 20 ä»é«˜å±‚å¼€å§‹å¾€ä¸‹æ‰¾\næ’å…¥æ—¶å€™å‘¢ æ’å…¥çš„éšæœºå±‚çº§ï¼šæ¦‚ç‡å‡½æ•°å†³å®šä»ä¸‹(level-0)åˆ°ä¸Š(level-n) æ¦‚ç‡ä¸º 0.25(n)\nè·³è¡¨ç»“æ„\n1Class SkipNode{ 2 int value; 3 SkipNode[] forward;// æŒ‡å‘ä¸åŒå±‚çº§çš„åç»§ï¼Œ ä¸‹ä¸€ä¸ªlevelèŠ‚ç‚¹ 4 5 public SkipNode(int value, int level) { 6 this.value = value; 7 this.forward = new SkipNode[level + 1]; // 0 åˆ° level å±‚ æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŠ¨æ€çš„æ•°æ®é•¿åº¦ 8 } 9} 1class SkipList { 2 private static final int MAX_LEVEL = 16; // æœ€å¤§å±‚æ•° 3 private int level; // å½“å‰å±‚æ•° 4 private SkipListNode header; // å¤´èŠ‚ç‚¹ 5 private Random random; // éšæœºæ•°ç”Ÿæˆå™¨ï¼Œç”¨äºå†³å®šèŠ‚ç‚¹å±‚æ•° 6\t7 // åˆå§‹åŒ–å¤´èŠ‚ç‚¹ï¼Œå…¶ä¸­æœ‰[0,...,MAX_LEVEL]çš„èŠ‚ç‚¹ 8 public SkipList() { 9 this.level = 0; 10 this.header = new SkipListNode(Integer.MIN_VALUE, MAX_LEVEL); 11 this.random = new Random(); 12 } 13 14 // æ’å…¥èŠ‚ç‚¹ 15 public void insert(int value) { 16 SkipListNode[] update = new SkipListNode[MAX_LEVEL + 1]; // è®°å½•æ¯å±‚éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ä½ç½® 17 SkipListNode current = header; 18 19 // ä»æœ€é«˜å±‚å¼€å§‹æŸ¥æ‰¾æ’å…¥ä½ç½® 20 for (int i = level; i \u0026gt;= 0; i--) { 21 // æ‰¾åˆ°æ’å…¥èŠ‚ç‚¹çš„ä½ç½® 22 while (current.forward[i] != null \u0026amp;\u0026amp; current.forward[i].value \u0026lt; value) { 23 current = current.forward[i]; 24 } 25 update[i] = current; // è®°å½•æ’å…¥èŠ‚ç‚¹çš„ä½ç½® 26 } 27 28 // éšæœºç”Ÿæˆæ–°èŠ‚ç‚¹çš„å±‚æ•° 29 int newLevel = randomLevel(); 30 31 // å¦‚æœæ–°èŠ‚ç‚¹çš„å±‚æ•°å¤§äºå½“å‰å±‚æ•°ï¼Œæ›´æ–° update æ•°ç»„å’Œå½“å‰å±‚æ•° 32 if (newLevel \u0026gt; level) { 33 for (int i = level + 1; i \u0026lt;= newLevel; i++) { 34 update[i] = header; 35 } 36 level = newLevel; 37 } 38 39 // åˆ›å»ºæ–°èŠ‚ç‚¹ 40 SkipListNode newNode = new SkipListNode(value, newLevel); 41 42 // æ›´æ–°æ¯å±‚çš„æŒ‡é’ˆ 43 for (int i = 0; i \u0026lt;= newLevel; i++) { 44 newNode.forward[i] = update[i].forward[i]; 45 update[i].forward[i] = newNode; 46 } 47 48 System.out.println(\u0026#34;Inserted: \u0026#34; + value); 49 } 50 51 52} 13 []=\u0026gt;^ 22 [] =\u0026gt; [] =\u0026gt;^ 31 []=\u0026gt;[]=\u0026gt;[] =\u0026gt;^ 40 []=\u0026gt;[]=\u0026gt;[] =\u0026gt;^ 5 -1 3 6 6 7update è®°å½•æ¯ä¸€å±‚çš„æ’å…¥ä½ç½® 8SkipListNode newNode = new SkipListNode(value, newLevel); æ¯ä¸ªèŠ‚ç‚¹æ•°ç»„é•¿åº¦ä¸ºnewLevel+1 639 Redis Hash é”®å€¼å¯¹é›†åˆ\nObjKey =\u0026gt; {k1:v1, k2:v2}\n642 Redisæ•°æ®è¿‡æœŸåˆ é™¤ç­–ç•¥ å®šæ—¶åˆ é™¤ =\u0026gt; å®šæ—¶ä»»åŠ¡ï¼Œå¤šå°‘æ—¶é—´æ£€æŸ¥ï¼Œåˆ é™¤è¿‡æœŸçš„é”® æƒ°æ€§åˆ é™¤ =\u0026gt; è®¿é—®æ—¶ï¼Œåˆ¤æ–­ï¼Œè¿‡æœŸäº†æ‰åˆ  å†…å­˜å›æ”¶æœºåˆ¶\nå½“å†…å­˜ä½¿ç”¨è¾¾åˆ°é™åˆ¶äº†ï¼Œä¸»åŠ¨åˆ é™¤ä¸å¸¸ç”¨çš„æ•°æ®ã€‚ LRUç®—æ³• 643 Rediså†…å­˜æ·˜æ±°ç­–ç•¥ è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ® æ·˜æ±°ç­–ç•¥\nrandom ttl lru æœ€è¿‘æœ€å°‘ä½¿ç”¨ least recent used lfu æœ€ä¸å¸¸ç”¨ least frequency used 644 Redis Luaè„šæœ¬ æ ¸å¿ƒ\nåŸå­æ€§ï¼Œé¿å…å¹¶å‘ä¿®æ”¹å¸¦æ¥çš„å®‰å…¨é—®é¢˜ å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•° å¤æ‚æ“ä½œ Luaæœ¬èº«ä¸å…·å¤‡åŸå­æ€§ï¼Œä½†æ˜¯Redisçº¿ç¨‹æ˜¯å•çº¿ç¨‹ï¼Œå› æ­¤Luaä»»åŠ¡ä¼šä¸€åŒæ‰§è¡Œï¼Œå…¶ä»–ä»»åŠ¡ä¼šè¢«é˜»å¡\n646 Redis BigKeyé—®é¢˜ï¼Œä»¥åŠè§£å†³ Big Memory Keyï¼Œkeyå¯¹åº”çš„valueè¶…çº§å¤§\nå†…å­˜åˆ†é…ä¸å‡ï¼Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå¦‚ä½•æŸä¸ªå®ä¾‹çš„å¤§keyè¿‡å¤šï¼Œè´Ÿæ‹…ä¸å‡è¡¡ å®¢æˆ·ç«¯è¶…æ—¶ é˜»å¡å…¶ä»–ä»»åŠ¡ è§£å†³\nå¼€å‘æ–¹é¢\nå¼€å‘æ—¶ï¼Œæ•°æ®å‹ç¼© å¤§åŒ–å°ï¼Œæ‹†æˆå‡ ä»½ é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„å­˜å‚¨ ä¸šåŠ¡æ–¹é¢\nä»…å­˜å‚¨å¿…è¦ä¿¡æ¯ æ•°æ®åˆ†å¸ƒæ–¹é¢\nå¤§Keyæ‹†åˆ†æˆå°keyï¼Œåˆ†æ•£åˆ°ä¸åŒrediså®ä¾‹ä¸­ 647 å¦‚ä½•è§£å†³redisä¸­çš„çƒ­ç‚¹keyé—®é¢˜ é—®é¢˜ï¼šæŸä¸ªkeyè¢«é¢‘ç¹è®¿é—®ï¼Œå¯¼è‡´rediså‹åŠ›è¿‡å¤§\nçƒ­ç‚¹keyæ‹†åˆ†ï¼šå°†å¤šä¸ªçƒ­ç‚¹æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªkeyä¸­ï¼Œä¾‹å¦‚é€šè¿‡å‰ç¼€ï¼Œä½¿ä¸åŒè¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªkeyä¸­ï¼Œä¸”åˆ†å¸ƒåœ¨å¤šå®ä¾‹ä¸­ï¼Œé¿å…é›†ä¸­è®¿é—®å•ä¸€keyã€‚\nå…¨é‡æ‹·è´ï¼Œkey:datainfo =\u0026gt; key:datainfo_1, key:datainfo_2, key:datainfo_3 Keyæ‹†åˆ†ï¼Œæ¯ä¸ªkeyåªå­˜ä¸€éƒ¨åˆ† ä¾‹å¦‚ï¼šçƒ­ç‚¹åº“å­˜key =\u0026gt; stock:product_123,è¿™ä¸ªkeyè¢«å¤§é‡è®¿é—®\n=\u0026gt; å¯¹å…¶è¿›è¡Œæ‹†åˆ† 4ä»½\n1stock:product_123:1 2stock:product_123:2 3stock:product_123:3 4stock:product_123:4 5 6# ä¸šåŠ¡å±‚ 7int shardIndex = (productId.hashCode() \u0026amp; Integer.MAX_VALUE) % shardCount; 8String shardKey = \u0026#34;stock:product_123:\u0026#34; + shardIndex; å°†è¯·æ±‚æ‹†åˆ†æˆå¤šä¸ªkeyï¼Œåˆ†æ‘Šå‹åŠ›\nâ­æ•°æ®ä¸€è‡´æ€§ï¼šéœ€è¦åŒæ­¥æ‰€æœ‰ç›¸å…³çš„key\nå¤šçº§ç¼“å­˜ï¼šåœ¨Rediså‰ï¼Œå¢åŠ å…¶ä»–ç¼“å­˜å±‚ï¼Œå¦‚(CDN,æœ¬åœ°ç¼“å­˜)ï¼Œåˆ†æ‹…redisçš„å‹åŠ›ï¼› CDN(Content Delivery Network å†…å®¹åˆ†å‘ç½‘ç»œ)ï¼›\nè¯»å†™åˆ†ç¦»ï¼šé€šè¿‡Redisä¸»ä»å¤åˆ¶ï¼Œå°†è¯»è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªä»èŠ‚ç‚¹ï¼Œåˆ†æ‘Šå‹åŠ›ï¼›\né™æµå’Œé™çº§ï¼šåº”ç”¨é™æµç­–ç•¥ï¼Œå‡å°‘å¯¹redisçš„è¯·æ±‚ï¼Œå¿…è¦æ—¶å›ä¼ ç©ºå€¼æˆ–é™çº§æ•°æ®ã€‚\n648 Redisçš„æŒä¹…åŒ–æœºåˆ¶ RDB(redis database)å¿«ç…§ é€šè¿‡ç”ŸæˆæŸä¸€æ—¶åˆ»çš„æ•°æ®å¿«ç…§æ¥å®ç°æŒä¹…åŒ–ï¼Œé—´éš”ä¸€å®šæ—¶é—´ äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ•°æ®ç´§å‡‘ï¼Œæ¢å¤æ•°æ®å¿« AOP(Append only file)æ—¥å¿— AOPé€šè¿‡å°†æ¯ä¸ªå†™æ“ä½œè¿½åŠ åˆ°æ—¥å¿—ä¸­å®ç°æŒä¹…åŒ–ï¼Œä»¥ä¾¿æ ¹æ®æ“ä½œæ—¥å¿—è¿›è¡Œæ¢å¤ï¼Œé‡æ”¾ æ¢å¤ç²¾ç¡®ï¼Œä½†æ–‡ä»¶ä½“ç§¯å¤§ æ“ä½œè®°å½•ä»€ä¹ˆæ—¶å€™å†™å›ç£ç›˜ ç«‹å³ï¼Œæ¯ä¸ªæ“ä½œ =\u0026gt; é—´éš”, é—´éš”ä¸€å®šæ—¶é—´=\u0026gt; å†™AOF ç¼“å†²åŒºæ»¡ï¼Œå†å†™AOF æ··åˆRDB+AOP åˆ©ç”¨RDBæ–‡ä»¶å¿«å’ŒAOFçš„ç²¾ç¡® å¤‡ä»½çš„æ—¶å€™ï¼Œå…ˆç”ŸæˆRDBï¼Œå†å°†æ–°å¢çš„å†™æ“ä½œåŠ åˆ°AOFæ–‡ä»¶åé¢ 649 Redisåœ¨ç”ŸæˆRDBå¿«ç…§æ—¶ï¼Œå¦‚ä½•å¤„ç†è¯·æ±‚ å†™æ—¶å¤åˆ¶æŠ€æœ¯\nRDBå¿«ç…§å¹¶ä¸ä¼šå¤åˆ¶æ•°æ®ï¼Œè€Œæ˜¯å¤åˆ¶é¡µè¡¨(ç›¸å½“äºæŒ‡é’ˆ) å½“Rediså¤„ç†å†™è¯·æ±‚æ—¶ï¼Œä¼šå¤åˆ¶å¯¹åº”çš„é¡µæ•°æ®ï¼Œè¿™æ ·RDBå¿«ç…§å’Œå½“å‰æ•°æ®çš„é¡µè¡¨éƒ¨åˆ†æŒ‡å‘å°†å˜åŒ–äº†ï¼Œè¿›è¡Œé”™å¼€. RDBå¿«ç…§åœ¨åˆ©ç”¨forkå­è¿›ç¨‹å­˜å‚¨å¿«ç…§ 650 Rediså“¨å…µæœºåˆ¶ sentinel ËˆsentÉªn(É™)l =\u0026gt; ç³»ç»Ÿèƒ½å¤Ÿåœ¨é•¿æ—¶é—´è¿è¡Œä¸­ä¿æŒè¾ƒé«˜çš„å¯ç”¨æ€§å’Œç¨³å®šæ€§ï¼Œå³ä½¿åœ¨å‡ºç°æ•…éšœæ—¶ä»ç„¶èƒ½å¿«é€Ÿæ¢å¤ï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¸­æ–­ã€‚\nä¸€ç§é«˜å¯ç”¨æ€§(ç¨³å¥)è§£å†³æ–¹æ¡ˆï¼Œç”¨äºç›‘æ§Redisä¸»ä»é›†ç¾¤ï¼Œè‡ªåŠ¨å®Œæˆä¸»ä»åˆ‡æ¢ï¼Œä»¥åŠæ•…éšœè‡ªåŠ¨æ¢å¤å’Œé€šçŸ¥\nç›‘æ§ï¼šå“¨å…µä¼šä¸æ–­çš„Ping redisä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ï¼Œå®šæ—¶Ping Rediså®ä¾‹ï¼Œæ£€æŸ¥å­˜æ´»çŠ¶æ€ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šä¸»èŠ‚ç‚¹å®•æœºäº†ï¼Œä¼šé€‰æ‹©ä¸€ä¸ªä»èŠ‚ç‚¹æ™‹å‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯ é€šçŸ¥ï¼Œå‘ç®¡ç†å‘˜æˆ–å…¶ä»–æœåŠ¡å‘é€é€šçŸ¥ï¼Œä»¥ä¾¿å¿«é€Ÿå¤„ç†rediså®ä¾‹çš„å˜åŒ– Redisä¸»èŠ‚ç‚¹é€‰ä¸¾\nä¼˜å…ˆçº§ï¼Œ é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œ slave_priority\nä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™çœ‹åŒæ­¥çŠ¶æ€offset(æ•°æ®åŒæ­¥ï¼Œå¤åˆ¶åç§»)ï¼Œæ•°æ®è¶Šä¸€è‡´ï¼Œè¶Šå¯èƒ½æˆä¸ºä¸»èŠ‚ç‚¹\nåŒæ­¥çŠ¶æ€ä¸€è‡´ï¼Œåˆ™æ¯”è¾ƒIDå·\né€‰å¥½master redisåï¼Œsentinelä¼šæŠŠå…¶ä»–rediså®ä¾‹å˜ä¸ºmaster redisçš„slaveï¼Œå°†æ–°ä¸»èŠ‚ç‚¹çš„IPå’Œç«¯å£é€šçŸ¥ç»™å®¢æˆ·ç«¯\nä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿\n1ï¼‰ sentinelæ¯ä¸ª1s Pingæ‰€æœ‰èŠ‚ç‚¹ï¼Œå½“è¶…è¿‡ä¸€æ®µæ—¶é—´æ²¡æ”¶åˆ°å¯¹äºèŠ‚ç‚¹çš„Pongï¼Œä¸»è§‚è®¤ä¸ºä¸‹çº¿ã€‚\n2ï¼‰å®¢è§‚ä¸‹çº¿(ä¸»èŠ‚ç‚¹è€Œå·²)ï¼šå¦‚æœä¸»èŠ‚ç‚¹å®•æœºäº†ï¼Œå®ƒå‘å…¶ä»–å“¨å…µå‘èµ·æŠ•ç¥¨ï¼Œåªæœ‰å½“ä¸‹çº¿çš„æŠ•ç¥¨æ•°å¤§äºä¸€åŠçš„æ—¶å€™ï¼Œæ‰è®¤ä¸ºä¸»èŠ‚ç‚¹å®•æœºäº†ã€‚\n653. Redisé›†ç¾¤è„‘è£‚é—®é¢˜ åœ¨ç½‘ç»œåˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯¼è‡´åŒä¸€ä¸ªé›†ç¾¤å‡ºç°å¤šä¸ªä¸»èŠ‚ç‚¹ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºç½‘ç»œåˆ†åŒºé—®é¢˜å¯¼è‡´ç³»ç»Ÿå¤šä¸ªèŠ‚ç‚¹è¯¯è®¤ä¸ºè‡ªå·±æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¯¼è‡´å¤šä¸ªä¸»èŠ‚ç‚¹æä¾›å†™å…¥æœåŠ¡ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚\nğŸ·ï¸é¿å…è„‘è£‚é—®é¢˜ï¼š\nã€min-slaves-to-writeã€‘è®¾ç½®ä¸»èŠ‚ç‚¹è‡³å°‘æœ‰æŒ‡å®šçš„ä»èŠ‚ç‚¹çš„æƒ…å†µä¸‹æ‰æ‰§è¡Œå†™æ“ä½œã€‚ ã€min-slaves-max-lagã€‘è®¾ç½®ä»èŠ‚ç‚¹çš„æœ€å¤§å»¶è¿Ÿï¼Œå¦‚æœä»èŠ‚ç‚¹çš„å»¶è¿Ÿè¶…è¿‡è¿™ä¸ªå€¼ï¼Œåˆ™ä¸è®¡å…¥min-slaves-to-writeã€‚ è¿™æ ·å½“è„‘è£‚åï¼ŒæŸä¸ªä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹æ•°é‡ä¸å¤Ÿæˆ–è€…å»¶è¿Ÿè¾ƒå¤§ï¼Œå°±æ— æ³•å†™å…¥ï¼Œé¿å…å¤šä¸ªä¸»èŠ‚ç‚¹å†™å…¥é€ æˆçš„æ•°æ®ä¸ä¸€è‡´ã€‚ ã€å¹¶ä¸èƒ½å®Œå…¨è§£å†³ã€‘\n655 å®ç°åˆ†å¸ƒå¼é” set ex nx (set expire_time not-exists) å‘½ä»¤ + luaè„šæœ¬å®ç°\nåŠ é”ï¼šSET lock_key uniqueValue EX expire_time NX è§£é”å¦‚ä¸‹ 1if redis.call(\u0026#34;GET\u0026#34;,KEYS[1]) == ARGV[1] # é¿å…åˆ«äººåˆ äº†è¿™æŠŠé” 2then 3 return redis.call(\u0026#34;DEL\u0026#34;,KEYS[1]) 4else 5 return 0 6end 656 åˆ†å¸ƒå¼é”åœ¨æœªå®Œæˆä¸šåŠ¡æ—¶ï¼Œè¿‡æœŸäº†æ€ä¹ˆåŠ =\u0026gt; é€»è¾‘é€”ä¸­ï¼Œç»™å®ƒç»­æœŸ\næ‰©å±•çŸ¥è¯† - çœ‹é—¨ç‹—æœºåˆ¶\næŠ¢åˆ°é”ä¹‹åï¼Œå¯åŠ¨åå°å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶å‘redisè¿›è¡Œé”çš„ç»­æœŸã€‚æ¯”å¦‚æ¯è¿‡1/3é”çš„è¿‡æœŸæ—¶é—´ï¼Œç»™é”ç»­æœŸ\nä¸šåŠ¡å®Œæˆï¼Œå†æŠŠè¿™ä¸ªåå°å®šæ—¶ä»»åŠ¡ç»™ç»“æŸ\nå¹¶ä¸”åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³è°ä¸Šé”è°è§£é” é‡Šæ”¾é”æ—¶,éœ€è¦1.æ£€æŸ¥é”æ˜¯ä¸æ˜¯è‡ªå·±ä¸Šçš„,å†é‡Šæ”¾é”. ä¸¤æ­¥=\u0026gt; Luaè„šæœ¬ 654 Redis è®¢é˜…\u0026amp;å‘å¸ƒ 1 =\u0026gt; Subscriber 1 2publisher =\u0026gt; channel =\u0026gt; Subscriber 2 3 =\u0026gt; Subscriber 3 æ¶ˆæ¯çš„è®¢é˜…å’Œæ¨é€ - é˜»å¡å¼æ¶ˆæ¯æ‹‰å–\nSUBSCRIBE channel\rPUBLISH channel message\rUNSUBSCRIBE channel 658 Redis å®ç°åˆ†å¸ƒå¼é”å¯èƒ½é‡åˆ°çš„é—®é¢˜æœ‰å“ªäº›? åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„è¦æ±‚\né”çš„äº’æ–¥: Redis setnx+rediså•çº¿ç¨‹ å¯é‡å…¥æ€§:ä¸€ä¸ªçº¿ç¨‹å¯ä»¥é‡å¤æ‹¿åˆ°åŒä¸€æŠŠé” é”çš„æ€§èƒ½: éœ€è¦åŸºäºå†…å­˜ ä¼šå‡ºç°é—®é¢˜:\né”è¯¯è§£ =\u0026gt; éœ€è¦ç¡®ä¿é”è‡ªå·±è‡ªå·±è§£é”, æˆ–è€…è¿‡æœŸ(çº¿ç¨‹IDåˆ¤æ–­ä¸‹)\né”çš„æœ‰æ•ˆæ—¶é—´ =\u0026gt; Watchdogæœºåˆ¶,ç»™é”å®šæœŸç»­æ—¶é—´\nå•ç‚¹æ•…éšœé—®é¢˜ =\u0026gt; RedLock =\u0026gt;\néœ€è¦ä¿è¯ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹åŠ é”æˆåŠŸæ‰ç®—æ‹¿åˆ°è¿™æŠŠé” å¯é‡å…¥é”\n1-- tryLock.lua 2-- KEYS[1] é”çš„Key 3-- ARGV[1] å½“å‰çº¿ç¨‹æ ‡è¯† 4-- ARGV[2] é”çš„è¿‡æœŸæ—¶é—´ 5 6local lockValue = redis.call(\u0026#39;get\u0026#39;, KEYS[1]) 7if lockValue == false then 8 // é”ä¸å­˜åœ¨ 9 redis.call(\u0026#39;setex\u0026#39;, KEYS[1], ARGV[2], ARGV[2]) 10 return true 11else 12 // é”å­˜åœ¨ 13 local parts = {} 14\tlocal index = 0 15 for match in (localValue .. \u0026#34;:\u0026#34;):gmatch(\u0026#34;(.-):\u0026#34;) do 16 parts[index] = match 17 index = index + 1 18 end 19 if parts[0] == ARGV[1] then 20 -- é”ç”±å½“å‰çº¿ç¨‹æ‰€æœ‰,é‡å…¥æ¬¡æ•°+1 21 local count = tonumber(parts[1]) + 1 22 redis.call(\u0026#39;setex\u0026#39;, KEYS[1], ARGV[2], ARGV[1] .. \u0026#34;:\u0026#34; .. count) 23 return true 24 end 25end 26return false 659 Redisä¸­çš„ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€å’Œç¼“å­˜é›ªå´© æ¦‚å¿µ\nç¼“å­˜å‡»ç©¿ï¼š æŸä¸ªçƒ­ç‚¹Keyæ•°æ®åœ¨ç¼“å­˜ä¸­å¤±æ•ˆï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ã€‚ ç¬é—´çš„é«˜å¹¶å‘ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®åº“å´©æºƒï¼› \u0026ndash; çƒ­ç‚¹è¿‡æœŸ\\åˆ é™¤ ç¼“å­˜ç©¿é€ï¼š æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜ä¸­æ²¡æœ‰å­˜å‚¨ï¼Œç›´æ¥äºŒæ¬¡æ˜ å°„åˆ°æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼Œé€ æˆæ•°æ®åº“è´Ÿæ‹…ï¼› ç¼“å­˜é›ªå´©ï¼š æŒ‡å¤šä¸ªç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åŒæ—¶è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé€ æˆæ•°æ®åº“ç¬é—´è´Ÿè½½æ¿€å¢ã€‚ \u0026ndash; æ‰¹é‡è¿‡æœŸ è§£å†³\nç¼“å­˜å‡»ç©¿ï¼š\n1 åŠ äº’æ–¥é”ï¼Œä¿è¯åŒä¸€è¯·æ±‚åªæœ‰ä¸€ä¸ªè¯·æ±‚æ¥é‡æ–°æ„å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚\n2 çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ\n3 åŒé‡æ£€æŸ¥\n1String data = redisTemplate.opsForValue().get(\u0026#34;hot_key\u0026#34;) 2if(data == null) { // æ•°æ®æ²¡ç¼“å­˜ 3 synchronized(this) { // åŠ é€Ÿï¼Œä»…ä¸€ä¸ªçº¿ç¨‹å–æ„å»ºç¼“å­˜ 4 String data = redisTemplate.opsForValue().get(\u0026#34;hot_key\u0026#34;) // è¿™é‡Œå†æ¬¡åˆ¤æ–­ï¼Œè¿™æ ·å…¶ä»–è¿›å…¥åŒæ­¥å—çš„å°±ä¸ç”¨é‡æ–°è®¿é—®DBæ„å»ºç¼“å­˜äº† 5 if(data == null){ 6 data = queryFromDB(); 7 redisTemplate.opsForValue().set(\u0026#34;hot_key\u0026#34;, data, 30, TimeUnit.MINUTES); 8 } 9 } 10} ç¼“å­˜ç©¿é€(é¿å…äºŒæ¬¡è·¯ç”±åˆ°æ•°æ®åº“ï¼Œæ‹¦æˆªå®ƒ)ï¼š\nä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤æ‰ä¸å­˜åœ¨çš„è¯·æ±‚ï¼Œé¿å…ç›´æ¥è®¿é—®æ•°æ®åº“; hash(where condition)\nå®ç°// å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨BitMapä¸­ï¼Œå°†å­—ç¬¦ä¸²ç”¨å¤šä¸ªHashå‡½æ•°æ˜ å°„åˆ°ä¸åŒçš„äºŒè¿›åˆ¶ä½ç½®ï¼Œå°†å¯¹é½ä½ç½®è®¾ç½®ä¸º1ï¼›å½“æŸ¥è¯¢çš„æ—¶å€™ï¼Œéœ€è¦æ‰€æœ‰ä½ç½®éƒ½ç½®1ï¼Œé‚£ä¹ˆè¯¥æ•°æ®æ‰å¯èƒ½å­˜åœ¨ã€‚å› ä¸ºä¸ä¼šé‡ç½®ä¸º0ï¼›\nå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå³ä½¿ä¸å­˜åœ¨çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ¢æˆä¸ªæ ‡è¯†(ç©ºæ•°æ®ï¼Œè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´)ï¼Œå‡å°‘å¯¹æ•°æ®åº“çš„è¯·æ±‚\nç¼“å­˜é›ªå´©(å¤šä¸ªè¿‡æœŸ)\næ•°æ®é¢„çƒ­ï¼Œæå‰å°†çƒ­é—¨çš„æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œé¿å…é«˜å¹¶å‘å‡ºç°å¤§é‡çš„æ•°æ®åº“è®¿é—®ã€‚ é‡‡ç”¨éšæœºåˆ†å¸ƒçš„æ–¹å¼è®¾ç½®ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œé¿å…å¤šä¸ªç¼“å­˜æ•°æ®åŒæ—¶è¿‡æœŸ(æ‰¹é‡è¿‡æœŸ)ï¼›æ·»åŠ éšæœºå€¼ï¼Œè¿›è¡Œåç§» åŒç¼“å­˜ç­–ç•¥ï¼Œå°†æ•°æ®åŒæ—¶å‚¨å­˜åœ¨ä¸¤å±‚ç¼“å­˜ä¸­ã€‚ åœ¨Redisä¹‹å‰ï¼Œæ·»åŠ ä¸€å±‚æœ¬åœ°ç¼“å­˜ï¼Œå‡å°‘å¯¹Redisçš„ä¾èµ–ã€‚ â€‹\tâ­Caffeineé«˜æ€§èƒ½ç¼“å­˜åº“ LRUæ·˜æ±°ç­–ç•¥\n1@Service 2public class CacheService { 3 @Resource 4 private Cache\u0026lt;String, String\u0026gt; localCache; 5 6 public void put(String key, String value) { 7 localCache.put(key, value); 8 } 9 10 public String get(String key) { 11 return localCache.getIfPresent(key); 12 } 13} 14 15@Configuration 16@EnableCaching 17public class CaffeineCacheConfig { 18 19 @Bean 20 public com.github.benmanes.caffeine.cache.Cache\u0026lt;String, String\u0026gt; localCache() { 21 return Caffeine.newBuilder() 22 .maximumSize(1000) // æœ€å¤§ç¼“å­˜æ¡ç›® 23 .expireAfterWrite(10, TimeUnit.MINUTES) // 10 åˆ†é’Ÿè‡ªåŠ¨è¿‡æœŸ 24 .build(); 25 } 26 27 @Bean 28 public CacheManager cacheManager() { 29 CaffeineCacheManager cacheManager = new CaffeineCacheManager(); 30 cacheManager.setCaffeine(Caffeine.newBuilder() 31 .expireAfterWrite(10, TimeUnit.MINUTES) 32 .maximumSize(1000)); 33 return cacheManager; 34 } 35} 36 37// # ----------- ç”¨æ³• 38@Cacheable(value = \u0026#34;users\u0026#34;, key = \u0026#34;#id\u0026#34;) 39public String getUserById(String id) { 40 System.out.println(\u0026#34;æŸ¥è¯¢æ•°æ®åº“ï¼š\u0026#34; + id); 41 return \u0026#34;User_\u0026#34; + id; 42} æœ¬åœ°ç¼“å­˜+Redis ï¼ˆå¤šçº§ç¼“å­˜ï¼‰\n1public String getData(String key) { 2 // 1. å…ˆæŸ¥æœ¬åœ°ç¼“å­˜ 3 String value = localCache.getIfPresent(key); 4 if (value != null) return value; 5 6 // 2. æŸ¥ Redis 7 value = redisTemplate.opsForValue().get(key); 8 if (value != null) { 9 // å›å†™æœ¬åœ°ç¼“å­˜ 10 localCache.put(key, value); 11 return value; 12 } 13 14 // 3. æŸ¥è¯¢æ•°æ®åº“ï¼ˆæ¨¡æ‹Ÿï¼‰ 15 value = queryFromDB(key); 16 17 // 4. å›å†™ Redis å’Œæœ¬åœ°ç¼“å­˜ 18 redisTemplate.opsForValue().set(key, value, 10, TimeUnit.MINUTES); 19 localCache.put(key, value); 20 return value; 21} 660 Redisä¸MySQLçš„ä¸€è‡´æ€§ç­–ç•¥ ä¸»è¦å°±æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå’Œè¯·æ±‚å¹¶å‘é—®é¢˜é€ æˆçš„ä¸ä¸€è‡´æ€§\nâ­ è®©rediså’Œmysqlæ•°æ®ä¸€æ ·â­\nå…ˆæ›´æ–°Redisï¼Œå†æ›´æ–°MySQL âŒä¸æ¨è å…ˆæ›´æ–°MySQLï¼Œå†æ›´æ–°Redis âŒä¸æ¨è å…ˆåˆ é™¤Redisï¼Œå†æ›´æ–°MySQLï¼Œæœ€åå†™å›Redis âŒä¸æ¨è å…ˆæ›´æ–°MySQLï¼Œå†åˆ é™¤Redisï¼Œç­‰è¯·æ±‚é‡æ–°ç¼“å­˜(æƒ°æ€§) âœ”ï¸æ¨è ç¼“å­˜åŒåˆ é™¤ç­–ç•¥ã€‚æ›´æ–°MySQLä¹‹å‰ï¼Œåˆ é™¤ä¸€æ¬¡Redisï¼›æ›´æ–°å®ŒMySQLåï¼Œå†è¿›è¡Œä¸€æ¬¡å»¶è¿Ÿåˆ é™¤ âœ”ï¸æ¨è æ•°æ®åº“æ²¡é—®é¢˜ï¼Œä½†æ˜¯ç¼“å­˜æœ‰é—®é¢˜ï¼Œç­‰å¾…ä¸€æ®µå®è·µ\nä½¿ç”¨Binlogå¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œç›‘å¬æ•°æ®åº“çš„binlogå˜åŒ–ï¼Œé€šè¿‡å¼‚æ­¥æ–¹å¼æ›´æ–°Redisç¼“å­˜ âœ”ï¸æ¨è # ==========================\nGPTç‰ˆæœ¬ï¼š\nğŸ“Œæ–¹æ¡ˆä¸€ï¼š å»¶è¿ŸåŒåˆ (æœ€ç»ˆä¸€è‡´æ€§)ï¼Œæ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š åˆ é™¤Redisç¼“å­˜ æ›´æ–°MySQLæ•°æ® ç­‰å¾…ä¸€å°ä¼šæ—¶é—´ å†æ¬¡åˆ é™¤Redisç¼“å­˜ï¼Œé˜²æ­¢å¹¶å‘è¯·æ±‚å†™å›è„æ•°æ® 1// 1. å…ˆåˆ é™¤ Redis 2redisTemplate.delete(key); 3 4// 2. æ›´æ–° MySQL 5databaseService.updateDataInMySQL(key, newValue); 6 7// 3. å»¶æ—¶å†åˆ é™¤ä¸€æ¬¡ Redisï¼ˆè§£å†³å¹¶å‘é—®é¢˜ï¼‰ 8new Thread(() -\u0026gt; { 9 try { 10 TimeUnit.MILLISECONDS.sleep(500); 11 redisTemplate.delete(key); 12 } catch (InterruptedException e) { 13 e.printStackTrace(); 14 } 15}).start(); âœ… é€‚ç”¨åœºæ™¯\nâœ” é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼ˆå¦‚å•†å“è¯¦æƒ…é¡µï¼‰ âœ” ä¸å½±å“æ•°æ®åº“å†™å…¥æ€§èƒ½ âœ” ä»£ç ç®€å•ï¼Œå®¹æ˜“å®ç°\nğŸ”´ ç¼ºç‚¹\nâŒ å­˜åœ¨ 500ms çš„æ•°æ®ä¸ä¸€è‡´çª—å£ âŒ ä¸èƒ½ä¿è¯å¼ºä¸€è‡´æ€§\nğŸ“Œæ–¹æ¡ˆ2ï¼šå¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š\næ›´æ–°MySQLæ•°æ® å‘é€æ¶ˆæ¯åˆ°RabbitMQ æ¶ˆæ¯æ¶ˆè´¹è€…ç›‘å¬æ›´æ–°ï¼Œåˆ é™¤Redisç¼“å­˜ 1public void updateData(String key, String newValue) { 2 // 1. æ›´æ–° MySQL 3 databaseService.updateDataInMySQL(key, newValue); 4 5 // 2. å‘é€æ¶ˆæ¯åˆ° MQï¼Œé€šçŸ¥æ¶ˆè´¹è€…åˆ é™¤ Redis 6 rabbitTemplate.convertAndSend(\u0026#34;cache_update_queue\u0026#34;, key); 7} 8 9@RabbitListener(queues = \u0026#34;cache_update_queue\u0026#34;) 10public void processCacheUpdate(String key) { 11 redisTemplate.delete(key); 12} âœ… é€‚ç”¨åœºæ™¯\nâœ” é€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ âœ” é¿å…äº† Redis å’Œ MySQL ç›´æ¥è€¦åˆ âœ” ä¿è¯æœ€ç»ˆä¸€è‡´æ€§\nğŸ”´ ç¼ºç‚¹\nâŒ éœ€è¦é¢å¤–çš„ MQ æœåŠ¡ï¼ˆKafkaã€RabbitMQï¼‰ âŒ å¢åŠ ç³»ç»Ÿå¤æ‚åº¦\nğŸ“Œæ–¹æ¡ˆ3ï¼šç›‘å¬MySQL Binlogï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ã€‚\nâœ…æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š\nç›‘å¬MySQL Binlogæ—¥å¿— å®æ—¶è§£æSQLå˜æ›´ åˆ é™¤Redisç¼“å­˜ ä¿è¯Rediså’ŒMySQLå¼ºä¸€è‡´æ€§ âœ…å®ç°æ–¹å¼\nCanal é˜¿é‡Œå·´å·´å¼€æº 1public void onMessage(String binlogData) { 2 String changedKey = parseBinlog(binlogData); 3 redisTemplate.delete(changedKey); 4} âœ… é€‚ç”¨åœºæ™¯\nâœ” é€‚ç”¨äºé«˜ä¸€è‡´æ€§è¦æ±‚çš„ä¸šåŠ¡ï¼ˆå¦‚é‡‘èã€ç”µå•†æ”¯ä»˜ï¼‰ âœ” é«˜ååï¼Œä½å»¶è¿Ÿï¼Œå®æ—¶æ¸…ç†ç¼“å­˜ âœ” é€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿ\nğŸ”´ ç¼ºç‚¹\nâŒ ä¾èµ– Canalï¼Œè¿ç»´æˆæœ¬è¾ƒé«˜ âŒ éœ€è¦è§£æ Binlogï¼Œä»£ç å®ç°å¤æ‚\nè¯„è®ºï¼š\n661 Redis String ç±»å‹åº•å±‚å®ç° âŒ Redis Stringç±»å‹åº•å±‚å®ç°ä¸»è¦åŸºäº SDS(Simple dynamic string)ç»“æ„ï¼Œå¹¶ç»“åˆç¼–ç æ–¹å¼è¿›è¡Œä¼˜åŒ–å­˜å‚¨\n1struct __attribute__ ((__packed__)) sdshdr64 { 2 uint64_t len; /* used */ 3 uint64_t alloc; /* excluding the header and null terminator */ 4 unsigned char flags; /* 3 lsb of type, 5 unused bits */ 5 char buf[]; 6}; flags: SDSç±»å‹ï¼ŒSDSæœ‰5ä¸ªç±»å‹ =\u0026gt; sdshdr5, sdshdr8 sdshdr16 sdshdr32 sdshdr64\n// simple dynamic string header =\u0026gt; sdshdr\n662 å¦‚ä½•ä½¿ç”¨Rediså¿«é€Ÿå®ç°æ’è¡Œæ¦œ [(userInfo, liked_star), \u0026hellip;, ]\nåˆ©ç”¨Sorted Set(è·³è¡¨å®ç°) å­˜å‚¨åˆ†æ•°å’Œæˆå‘˜ 663 å¦‚ä½•åˆ©ç”¨Rediså®ç°å¸ƒéš†è¿‡æ»¤å™¨ åˆ©ç”¨BitMap: (setBit, getBit)\n1// æ·»åŠ å…ƒç´ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ 2public void add(String value) 3 for(SimpleHash hashFunc : hashFuncs) { 4 xxx.setbit(BLOOM_FILTER_KEY, hashFUnc(Value)) 5 } 6 7// æ£€æŸ¥æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ 8public boolean mightContain(String value) { 9 for(SimpleHash hashFunc : hashFuncs) { 10 if(xxx.getBit(BLOOM_FILTER_KEY, hashFunc(value)) !=1) { 11 return false; 12 } 13} å¸ƒéš†è¿‡æ»¤å™¨çš„é€‚ç”¨åœºæ™¯\nçˆ¬è™«ï¼šURLå»é‡\né»‘åå•ï¼šåˆ¤æ–­\nåˆ†å¸ƒå¼ç³»ç»Ÿï¼šåˆ¤æ–­æ•°æ®æ˜¯å¦åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Š\næ¨èç³»ç»Ÿï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦çœ‹è¿‡æŸä¸ªå†…å®¹\n664 å¦‚ä½•åˆ©ç”¨Redisç»Ÿè®¡å¤§é‡ç”¨æˆ·å”¯ä¸€è®¿é—®é‡ =\u0026gt; HyperLogLog\nPFADD key element =\u0026gt; ADD HyperLogLogä¸­ PFCOUNT key =\u0026gt; return unique number 665 Redisä¸­çš„Geoæ•°æ®ç»“æ„ GEOADD key longitude latitude member GEODIST key member1 member2 GEORADIUS key longitude latitude radius unit; 668 Redis æ€§èƒ½ç“¶é¢ˆ æ‰©å®¹å†…å­˜ã€è¯»å†™åˆ†ç¦»ã€é›†ç¾¤æ¨¡å¼ã€å¤šçº§ç¼“å­˜(æœ¬åœ°ã€redisã€mysql)\n885 Redis Clusteræ¨¡å¼ å’ŒSentinelæ¨¡å¼ é›†ç¾¤ä¸å“¨å…µæ¨¡å¼\né›†ç¾¤ =\u0026gt; æ•°æ®åˆ‡ç‰‡,æ¯ä¸ªé›†ç¾¤è´Ÿè´£ä¸€éƒ¨åˆ†æ•°æ®, é›†ç¾¤å†…åˆåˆ†ä¸ºä¸»ä»æ¨¡å¼;\nå“¨å…µï¼šé«˜å¯ç”¨æ€§ï¼Œå½“masterå®•æœºï¼Œæ ¹æ®è§„åˆ™é€‰æ‹©æœ€ä¼˜çš„slaveå¹¶æ™‹å‡ä¸ºæ–°çš„master\n1.Clusteré›†ç¾¤æ¨¡å¼:é›†ç¾¤æ¨¡å¼ç”¨äºå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œä¸»è¦ç”¨äºè§£å†³å¤§æ•°æ®ã€é«˜ååé‡çš„åœºæ™¯ã€‚å°†æ•°æ®è‡ªåŠ¨åˆ†ä¸åˆ°å¤šä¸ªRediså®ä¾‹ä¸Šï¼Œæ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»(å¦‚æœæŸä¸ªå®ä¾‹å¤±æ•ˆï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨é‡å†™é…ç½®å’Œå¹³è¡¡ï¼Œä¸éœ€è¦æ‰‹åŠ¨è¿›è¡Œè°ƒæ•´ï¼Œå› ä¸ºå†…ç½®äº†å“¨å…µé€»è¾‘) 2.Sentinelå“¨å…µæ¨¡å¼: å“¨å…µæ¨¡å¼ç”¨äºä¿è¯ä¸»ä»èŠ‚ç‚¹çš„é«˜å¯ç”¨ï¼Œè¯»å†™åˆ†ç¦»åœºæ™¯ã€‚å¦‚æœä¸»èŠ‚ç‚¹å®•æœºï¼Œå“¨å…µä¼šå°†ä»èŠ‚ç‚¹å‡ä¸ºä¸»èŠ‚ç‚¹.\n6305 Redissonåˆ†å¸ƒå¼é”çš„åŸç† Redissonæ˜¯åŸºäºRedis+luaè„šæœ¬å®ç°çš„åˆ†å¸ƒå¼é”, ä½¿ç”¨redisçš„åŸå­æ“ä½œæ¥ç¡®ä¿å¤šçº¿ç¨‹\u0026hellip;ï¼Œ åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°é”ï¼Œå®ç°äº’æ–¥ã€‚\nä¸»è¦åŒ…æ‹¬ï¼š\nè·å–é”ï¼š(setNX + è¿‡æœŸæ—¶é—´) è‡ªåŠ¨ç»­æœŸï¼š(Watchdog æœºåˆ¶) å¯é‡å…¥æ€§ï¼š(çº¿ç¨‹IDè®¡æ•°å™¨ï¼Œå½“å€¼ä¸º0è¡¨ç¤ºæ‰çœŸæ­£çš„åˆ é™¤é”) é‡Šæ”¾é”ï¼š(Luaè„šæœ¬ä¿è¯åŸå­æ€§) 1// ### get lock 2RLock lock = redisson.getLock(\u0026#34;lock:key\u0026#34;) 3// =\u0026gt; SET mylock thread-id NX PX 30s; thread-idä¿è¯å¯é‡å…¥ 4lock.lock() 5 6// ### è‡ªåŠ¨ç»­æœŸ watchdog 7// å¦‚æœçº¿ç¨‹æœªä¸»åŠ¨é‡Šæ”¾é”ï¼Œredissonåˆ™æ¯éš”10sç»­æœŸ30s 8PEXPIRE lock:key 30s 9 10// ### å¯é‡å…¥æ€§ 11// ç¬¬ä¸€æ¬¡åŠ é” 12lock.lock(); 13 14// åŒä¸€çº¿ç¨‹å†æ¬¡åŠ é” 15lock.lock(); 16 17// é‡Šæ”¾é” 18lock.unlock(); 19lock.unlock(); // åªæœ‰ count=0 æ—¶æ‰çœŸæ­£é‡Šæ”¾ åˆ†å¸ƒå¼é”æœ€ä½³å®è·µ\n1RLock lock = redisson.getLock(\u0026#34;myLock\u0026#34;); 2 3try { 4 // å°è¯•è·å–é”ï¼Œæœ€å¤šç­‰å¾… 5 ç§’ï¼Œ10 ç§’åè‡ªåŠ¨é‡Šæ”¾ï¼ˆé˜²æ­¢æ­»é”ï¼‰ 5 if (lock.tryLock(5, 10, TimeUnit.SECONDS)) { 6 try { 7 // æ‰§è¡Œä¸šåŠ¡é€»è¾‘ 8 // ... 9 } finally { 10 lock.unlock(); // é‡Šæ”¾é” 11 } 12 } else { 13 System.out.println(\u0026#34;è·å–é”å¤±è´¥\u0026#34;); 14 } 15} catch (InterruptedException e) { 16 e.printStackTrace(); 17} ","permalink":"http://longcoding.top/posts/jobs/redis/","summary":"\u003ch3 id=\"637-å¸¸è§çš„æ•°æ®ç±»å‹\"\u003e637 å¸¸è§çš„æ•°æ®ç±»å‹\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eString\u003c/li\u003e\n\u003cli\u003eSet\u003c/li\u003e\n\u003cli\u003eHash\u003c/li\u003e\n\u003cli\u003eList\u003c/li\u003e\n\u003cli\u003eZset ï¼ˆSorted Setï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eBitMap =\u0026gt; ä½å›¾ï¼Œè€ƒå‹¤ï¼Œæˆ–è€…xxxåˆ†é…æƒ…å†µ\u003c/p\u003e\n\u003cp\u003eHyperLogLog =\u0026gt; ç”¨æˆ·è®¿é—®çš„ç‹¬ç«‹ç”¨æˆ·æ•°é‡\u003c/p\u003e\n\u003cp\u003eGEO =\u0026gt; åœ°ç†\u003c/p\u003e\n\u003cp\u003eåº”ç”¨åœºæ™¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç¼“å­˜\u003c/li\u003e\n\u003cli\u003eå®æ—¶ç³»ç»Ÿ\u003c/li\u003e\n\u003cli\u003eæ¶ˆæ¯é˜Ÿåˆ—\u003c/li\u003e\n\u003cli\u003eåˆ†å¸ƒå¼é”\u003c/li\u003e\n\u003cli\u003eè®¡æ•°å™¨ï¼šé¡µé¢è®¿é—®é‡ã€ç‚¹èµæ•°ã€è¯„è®ºæ•°\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"651-redis-ä¸»ä»å¤åˆ¶çš„å®ç°åŸç†\"\u003e651 Redis ä¸»ä»å¤åˆ¶çš„å®ç°åŸç†\u003c/h3\u003e\n\u003cp\u003eâ¡ï¸ä¸»èŠ‚ç‚¹-ä»èŠ‚ç‚¹ çš„æ•°æ®åŒæ­¥\u003c/p\u003e\n\u003cp\u003eWhy éœ€è¦ä¸»å’Œä»\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ•°æ®å†—ä½™\u0026amp;æ•…éšœæ¢å¤ï¼ŒæŸä¸ªèŠ‚ç‚¹å®•æœºäº†ï¼Œä½†æ˜¯å…¶ä»–èŠ‚ç‚¹è¿˜æ´»ç€ï¼›\u003c/li\u003e\n\u003cli\u003eæä¾›è´Ÿè½½å‡è¡¡ï¼Œé…åˆè¯»å†™åˆ†ç¦»ç­–ç•¥ï¼Œä¸»èŠ‚ç‚¹å†™æ“ä½œï¼Œä»èŠ‚ç‚¹æä¾›è¯»æ“ä½œï¼›\u003c/li\u003e\n\u003cli\u003eé«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶æ˜¯Redisçš„é«˜å¯ç”¨çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯å“¨å…µå’Œé›†ç¾¤å®æ–½çš„åŸºç¡€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¤åˆ¶æµç¨‹ï¼š å…¨é‡ \u0026amp; å¢é‡\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eä¸»èŠ‚ç‚¹å‘é€SYNCå‘½ä»¤ä¸ä»èŠ‚ç‚¹è¿›è¡Œè¿æ¥ï¼Œå¼€å§‹åŒæ­¥ï¼Œ ä¸»ä»ä¹‹é—´å»ºç«‹è”ç³»ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå…¨é‡å¤åˆ¶(ç¬¬ä¸€æ¬¡è¿æ¥)ï¼š ä¸»èŠ‚ç‚¹æŠŠå…¨éƒ¨æ•°æ®å¤åˆ¶åˆ°ä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹å°†å½“å‰æ•°æ®ç”ŸæˆRDBæ–‡ä»¶ï¼Œå‘é€ç»™ä»èŠ‚ç‚¹ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå‘é€çš„æœŸé—´ï¼Œä¸»èŠ‚ç‚¹ç¼“å­˜(Replication backlog buffer-å¤åˆ¶ç§¯å‹ç¼“å†²åŒº)æ‰€æœ‰å†™å‘½ä»¤ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå‘é€ç¼“å­˜çš„å†™å‘½ä»¤ç»™ä»èŠ‚ç‚¹ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæŒç»­åŒæ­¥ï¼ŒæŒç»­æŠŠå†™å‘½ä»¤åŒæ­¥ç»™ä»èŠ‚ç‚¹ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e\n\u003cp\u003eä¿æŒè¿æ¥ä¸æ–­çº¿é‡è¿\u003c/p\u003e\n\u003cp\u003eRedisä¸­ï¼Œä¸»èŠ‚ç‚¹ä¼šå’Œä»èŠ‚ç‚¹ä¿æŒé•¿è¿æ¥ï¼Œä»¥ç¡®ä¿æ•°æ®çš„æŒç»­åŒæ­¥ï¼›\u003c/p\u003e\n\u003cp\u003eå½“è¿æ¥æ–­å¼€åï¼Œé‡è¿ï¼Œè¯·æ±‚å¢é‡å¤åˆ¶ï¼Œé¿å…å…¨é‡å¤åˆ¶å¸¦æ¥çš„å¤§é‡å¼€é”€ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæ•°æ®ä¸€è‡´æ€§å’Œå¤åˆ¶å»¶è¿Ÿ\u003c/p\u003e\n\u003cp\u003eç”±äºç½‘ç»œå»¶è¿Ÿï¼Œä¸»ä»ä¹‹é—´ä¼šå­˜åœ¨çŸ­æš‚çš„æ•°æ®ä¸ä¸€è‡´ã€‚ â­å¯¹äºæ•°æ®ä¸€è‡´æ€§ä¸¥æ ¼çš„ä»»åŠ¡ï¼Œè¦æ±‚è®¿é—®ä¸»èŠ‚ç‚¹ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch3 id=\"652-redisé›†ç¾¤å®ç°çš„åŸç†\"\u003e652 Redisé›†ç¾¤å®ç°çš„åŸç†\u003c/h3\u003e\n\u003cp\u003eâ¡ï¸é€šè¿‡å¤šä¸ªRediså®ä¾‹å®ç°ï¼Œæ¯ä¸ªå®ä¾‹å­˜å‚¨éƒ¨åˆ†æ•°æ®ï¼Œä¸”è¿™äº›æ•°æ®æ˜¯ä¸é‡å¤çš„ã€‚\u003cstrong\u003eç±»ä¼¼äºå°†æ•°æ®åº“åˆ†åº“ï¼ŒæŒ‰ä¸šåŠ¡åŠŸèƒ½\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eâ¡ï¸å…·ä½“ä¸ºé‡‡ç”¨Hash Slotå“ˆå¸Œæ§½ï¼Œå°†é”®çš„ç©ºé—´åˆ’åˆ†ä¸º16384ä¸ªæ§½ã€‚æ¯ä¸ªRediså®ä¾‹åªè´Ÿè´£ä¸€éƒ¨åˆ†æ§½ã€‚\u003c/p\u003e\n\u003cp\u003eå®¢æˆ·ç«¯ =\u0026gt; ä»»æ„Rediså®ä¾‹ =\u0026gt; æ•°æ®æ˜¯å¦åœ¨æœ¬æœºä¸Šï¼Œåœ¨è¿”å›ï¼Œå¦åˆ™è¿”å›ç›®æ ‡èŠ‚ç‚¹ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å†è·¯ç”±åˆ°å…¶ä»–Redisä¸­ã€‚\u003c/p\u003e\n\u003cp\u003e\u0026lt;= å°†å•ä¸ªRedisçš„å‹åŠ›ï¼Œåˆ†æ‘Šåˆ°å¤šå°Rediså®ä¾‹ä¸Šï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚\u003c/p\u003e\n\u003cp\u003eç‰¹æ€§\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå®ç°æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå°†ä¸åŒæ•°æ®å‚¨å­˜åœ¨ä¸åŒèŠ‚ç‚¹ä¸­\u003c/li\u003e\n\u003cli\u003eå»ä¸­å¿ƒåŒ–æ€æƒ³ï¼Œæ— ä¸­å¿ƒèŠ‚ç‚¹ï¼Œè®¿é—®ä»»æ„ä¸€ä¸ªå³å¯ã€‚è®¿é—®æ­£ç¡®åˆ™å“åº”æ•°æ®ï¼Œå¦åˆ™å“åº”å¯¹åº”çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®ã€‚\u003c/li\u003e\n\u003cli\u003eå†…ç½®é«˜å¯ç”¨æ€§ï¼šåˆ†ä¸ºNç»„ï¼Œæ¯ç»„æä¾›ä¸åŒçš„æ•°æ®ç¼“å­˜æœåŠ¡ï¼Œæ¯ç»„ä¸­åˆæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’ŒKä¸ªä»èŠ‚ç‚¹(ä¸»æä¾›è¯»å†™ï¼Œä»æé«˜è¯»ï¼Œå¹¶è¿›è¡Œæ•°æ®åŒæ­¥åŠŸèƒ½)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250307175456538\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/Fo9jCIPyRQ866mnZdasVsUwqao1j\"\u003e\u003c/p\u003e","title":"Redisé¢è¯•é¢˜ç¬”è®°"},{"content":"415 åºåˆ—åŒ–\u0026amp;ååºåˆ—åŒ– å°†Objectè½¬ä¸ºå­—èŠ‚æµï¼Œæˆ–åä¹‹\næ™®é€šï¼šå®ç°serializableæ¥å£ ËˆsÉªÉ™rÉªÉ™laÉªzÉ™bl ä½¿ç”¨Jackonï¼ŒObj =\u0026gt; jsonæ ¼å¼ 416 Javaä¸­çš„ä¸å¯å˜ç±» final ä¿®é¥°ï¼Œä¾‹å¦‚Stringç±»\nğŸ‰ä¼˜ç‚¹ï¼š\nçº¿ç¨‹å®‰å…¨ ç¼“å­˜å‹å¥½ ç¼ºç‚¹\næ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºä¸èƒ½ä¿®æ”¹ï¼Œæ‰€æœ‰æ¯æ¬¡çŠ¶æ€å˜åŒ–ï¼Œéƒ½éœ€è¦ç”Ÿæˆæ–°çš„å¯¹è±¡ã€‚ 411 å¤šæ€ç‰¹æ€§ ç»§æ‰¿ æ–¹æ³•é‡è½½ï¼Œå‡½æ•°åç›¸åŒï¼Œä½†æ˜¯å‡½æ•°ç­¾åéœ€è¦æœ‰å·®å¼‚(å‚æ•°ç±»å‹\u0026amp;æ•°é‡) é‡å†™ï¼Œå­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œé€šè¿‡çˆ¶ç±»è°ƒç”¨æ–¹æ³•æ—¶ï¼Œè°ƒç”¨çš„æ˜¯å­ç±»é‡å†™åçš„å‡½æ•°ã€‚ 412 Javaå‚æ•°ä¼ å€¼æ˜¯å‰¯æœ¬è¿˜æ˜¯å¼•ç”¨å‘¢ï¼Ÿ åŸºæœ¬ç±»å‹æ˜¯ä¼ å€¼å‰¯æœ¬ï¼Œint\u0026hellip; å¼•ç”¨æ•°æ®ç±»å‹æ˜¯ä¼ å¼•ç”¨å‰¯æœ¬ã€‚ includingï¼šobjï¼Œarray 425 Javaä¸­ åŒ…è£…ç±»å‹å’ŒåŸºæœ¬ç±»å‹ ğŸ·ï¸åŸºæœ¬ç±»å‹ =\u0026gt; int long float double \u0026hellip; ä½äºæ ˆä¸Š(å±€éƒ¨å˜é‡çš„è¯) ï¼Œæ€§èƒ½å¥½ï¼Œä½†ä¸æ”¯æŒä¸ºnull\nï¼ˆå±€éƒ¨å˜é‡åœ¨æ ˆä¸Šï¼Œæˆå‘˜å˜é‡åœ¨å †ä¸Šï¼Œé™æ€å­—æ®µåœ¨æ–¹æ³•åŒºï¼‰\nğŸ·ï¸åŒ…è£…ç±»å‹ =\u0026gt; æ¯ä¸€ä¸ªåŸºæœ¬ç±»å‹éƒ½å¯¹åº”ä¸€ä¸ªåŒ…è£…ç±»å‹ã€‚åŒ…è£…ç±»å‹æ˜¯ç±»ï¼Œåœ¨å †ä¸­ï¼Œæ”¯æŒnull\nJVMå†…å­˜æ¨¡å‹ â—â—â—å†…å­˜å †å’Œæ•°æ®ç»“æ„å †ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿(ä¸æ˜¯å †çš„ç»“æ„)\n1+--------------------------------------------+ 2| æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ | â† çº¿ç¨‹å…±äº« 3| - ç±»å…ƒæ•°æ®ï¼ˆClass ä¿¡æ¯ï¼‰ | 4| - é™æ€å˜é‡ï¼ˆstatic å˜é‡ï¼‰ | 5| - å¸¸é‡æ± ï¼ˆå­—ç¬¦ä¸²å¸¸é‡ç­‰ï¼‰ | 6+--------------------------------------------+ 7 â†‘ â†‘ 8 | | 9+----------------+ +-----------------+ 10| æ ˆï¼ˆStackï¼‰ | | å †ï¼ˆHeapï¼‰ | â† çº¿ç¨‹å…±äº« 11| - å±€éƒ¨å˜é‡ | | - Java å¯¹è±¡å®ä¾‹ | 12| - æ–¹æ³•è°ƒç”¨æ ˆ | | - æ•°ç»„ | 13+----------------+ +-----------------+ 413 interface \u0026amp; abstract class interface(è‡ªä¸Šè€Œä¸‹) çŸ¥æ™“æŸä¸€ç§è¡Œä¸ºï¼ŒåŸºäºè¿™äº›è¡Œä¸ºçº¦æŸå®šä¹‰çš„æ¥å£ï¼Œ ä¸€äº›ç±»éœ€è¦æœ‰è¿™äº›è¡Œä¸ºçš„è¯ï¼Œéœ€è¦å®ç°è¿™äº›æ¥å£ abstract class(è‡ªä¸‹è€Œä¸Š): æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬æœ‰å…±åŒç‚¹ï¼Œå¾ˆå¤šä»£ç å¯ä»¥å¤ç”¨ï¼Œå› æ­¤å°†å…¬å…±é€»è¾‘å°è£…ä¸ºæŠ½è±¡å¯¹è±¡ã€‚ 100 hashCode \u0026amp; equals \u0026amp; == hashCodeç”¨äºæ•£åˆ—è¡¨(hashMap)ç”¨äºè®¡ç®—hashå€¼ï¼Œä»è€Œè®¡ç®—å­˜å‚¨ä½ç½®ï¼›\nequalsæ¯”è¾ƒå¯¹è±¡å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼Œé»˜è®¤æ˜¯==ã€‚ å¯èƒ½éœ€è¦é‡å†™equalsæ–¹æ³•é€»è¾‘ï¼Œå®ç°å¯¹è±¡æˆå‘˜å˜é‡çš„æ¯”è¾ƒï¼›\n== å¼•ç”¨ç±»å‹æ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡(å†…å­˜åœ°å€)ï¼ŒåŸºæœ¬ç±»å‹åˆ™æ¯”è¾ƒå€¼ã€‚\n431 Javaæ³¨è§£ æ³¨è§£å°±æ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œæä¾›å…ƒæ•°æ®æœºåˆ¶ï¼Œç»™äºˆä»£ç æ·»åŠ è¯´æ˜ä¿¡æ¯ã€‚å¯ä»¥åœ¨ç±»ï¼Œæ–¹æ³•ï¼Œæˆå‘˜å˜é‡\u0026hellip;ä¸Šæ ‡è®°ï¼Œæ ‡è®°æœ¬èº«å¯ä»¥è®¾ç½®ä¸€äº›å€¼ã€‚\n1 @Target(Class,...) 2@Retention(RetentionPolicy.RUNTIME) // æ³¨è§£ä¿ç•™æ—¶é—´ 3public @interface MyInterface { 4 String value(); 5} 6 7// è¿è¡Œæ—¶ï¼Œé€šè¿‡åå°„æœºåˆ¶æ‹¿åˆ°å¯¹åº”çš„æ³¨è§£ -- ç»“åˆAOPåšäº‹æƒ… 8...Obj.getAnnotation(\u0026#34;MyInterface\u0026#34;)... 432 Javaåå°„ è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯ï¼Œå¹¶æ“ä½œå¯¹è±¡\n1Person person = new Person(\u0026#34;Emma\u0026#34;, 28); 2Class\u0026lt;?\u0026gt; cls = person.getClass(); 3 4// è°ƒç”¨æ— å‚æ–¹æ³• 5Method greetMethod = cls.getDeclaredMethod(\u0026#34;greet\u0026#34;); 6greetMethod.invoke(person); 7 8// è°ƒç”¨æœ‰å‚æ–¹æ³• 9Method setAgeMethod = cls.getDeclaredMethod(\u0026#34;setAge\u0026#34;, int.class); 10setAgeMethod.invoke(person, 35); 11 12System.out.println(person); // Person{name=\u0026#39;Emma\u0026#39;, age=35} 434 Javaæ³›å‹ é€šè¿‡åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹å®‰å…¨ï¼Œä½¿å¾—ä»£ç æ›´åŠ é€šç”¨å’Œçµæ´»ï¼Œé¿å…è¿è¡Œæ—¶å‘ç”Ÿç±»å‹è½¬æ¢é”™è¯¯ã€‚ ç®€å•ç†è§£=\u0026gt; å°†è¿è¡Œæ—¶çš„ç±»å‹è½¬æ¢å¼‚å¸¸ä¸Šå‡åˆ°ç¼–è¯‘æ—¶å€™\nç±»å‹å®‰å…¨ ä»£ç é‡ç”¨ æ¶ˆé™¤æ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œä¸€å¼€å§‹æŒ‡å®šå¥½ ğŸ·ï¸æ³›å‹ç±»\n1public class Box\u0026lt;T\u0026gt; { 2 private T value; 3 public Box(T value) { this.value = value; } 4 public T getValue() { return value; } 5} 6// è¿™æ ·çš„è¯ getValue()å°±ä¸éœ€è¦(Type)getValue()äº†ï¼Œ ç›´æ¥å‘Šè¯‰è°ƒç”¨è€…è¿”å›ç±»å‹ =\u0026gt; é¿å…ç±»å‹è½¬æ¢,ä¸”æé«˜ä»£ç å¤ç”¨æ€§ ğŸ·ï¸æ³›å‹æ–¹æ³•\n1// æ³›å‹æ–¹æ³• 2public static \u0026lt;T\u0026gt; T getFirst(T[] array) { 3 return array[0]; 4} 5 6// \u0026lt;T\u0026gt; æ˜¯ç”³æ˜Tæ˜¯æ³›å‹å“¦ï¼Œ ä¸ç„¶è°çŸ¥é“å®ƒæ˜¯ä¸æ˜¯ä¸€ä¸ªç±»çš„åç§° 7// ğŸ‰æ›´åŠ çµæ´» 8String[] words = {\u0026#34;Hello\u0026#34;, \u0026#34;World\u0026#34;}; 9Integer[] numbers = {1, 2, 3}; 10 11System.out.println(getFirst(words)); // Hello 12System.out.println(getFirst(numbers)); // 1 ğŸ·ï¸é™åˆ¶å‚æ•°ç±»å‹ é˜²æ­¢éæ³•ç±»å‹ä½¿ç”¨\n1class Calculator\u0026lt;T extends Number\u0026gt; 6306 Javaæ³›å‹æ“¦é™¤ Javaç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä»£ç çš„æ—¶å€™ï¼Œå°†æ‰€æœ‰æ³›å‹ä¿¡æ¯åˆ é™¤çš„è¿‡ç¨‹ã€‚ æ“¦é™¤æ˜¯ä¸ºäº†ç¡®ä¿ä¸æ—§ç‰ˆæœ¬å…¼å®¹\n1Class Box\u0026lt;T\u0026gt; {} =\u0026gt; class Box {} (T =\u0026gt; Object) 2Class Box\u0026lt;T extends Number\u0026gt; {} =\u0026gt; class Box {} (T =\u0026gt; Number) æ³›å‹ç±»å‹ä¸Šç•Œ ? extends T\næ³›å‹ç±»å‹ä¸‹å±Š ? super T\né™åˆ¶ç±»å‹\n436 Javaæ·±æ‹·è´\u0026amp;æµ…æ‹·è´ æ·±æ‹·è´ï¼šä¸ä»…å¤åˆ¶å½“å‰å¯¹è±¡æœ¬èº«ï¼Œè€Œä¸”é€’å½’çš„å¤åˆ¶å¯¹è±¡å†…çš„å¼•ç”¨ã€‚ é‡å†™cloneæ–¹æ³•ï¼Œæˆ–è®¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç”Ÿæˆæ–°çš„å¯¹è±¡ï¼› æµ…æ‹·è´ï¼šåªå¤åˆ¶å¯¹è±¡çš„æœ¬èº«å’ŒåŸºæœ¬ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œè€Œä¸å¤åˆ¶å¼•ç”¨ç±»å‹çš„å¯¹è±¡ã€‚ Object.clone()ï¼› å¼•ç”¨æ‹·è´ï¼šä»…å¤åˆ¶å¯¹åº”å¼•ç”¨ **Object o1 = o2; ** ã€‚ 438 Javaç±»åŠ è½½è¿‡ç¨‹ ç±»åŠ è½½è¿‡ç¨‹ï¼š\nåŠ è½½ï¼šäºŒè¿›åˆ¶æµè¯»å…¥å†…å­˜ï¼Œç”ŸæˆClasså¯¹è±¡ è¿æ¥ éªŒè¯ï¼šæ ¼å¼æ˜¯å¦è§„èŒƒ å‡†å¤‡ï¼šä¸ºé™æ€å˜é‡è®¾ç½®åˆå§‹å€¼ï¼Œä¸ºå®ƒä»¬åœ¨æ–¹æ³•åŒºå¼€è¾Ÿã€‚ è§£æï¼šå°†å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ã€‚ åˆå§‹åŒ–ï¼šæ‰§è¡Œé™æ€ä»£ç å—ï¼Œä¸ºé™æ€å˜é‡èµ‹å€¼(ä»£ç é€»è¾‘é‡Œé¢çš„)ã€‚ 440 BigDecimal é«˜ç²¾åº¦çš„è®¡ç®—ç±»ï¼Œå¤„ç†ä»»æ„ç²¾åº¦çš„æ•°å€¼ã€‚ æ¶‰åŠåˆ°é’±ï¼Œç”¨è¿™ä¸ª\n442 Javaä¸­çš„finalã€finally finalä¿®é¥°ç¬¦ï¼ŒæŒ‡ç±»å’Œå˜é‡ä¸èƒ½å†ä¿®æ”¹ã€‚\n1class final MyClass { 2 3} ä¸è®ºæ˜¯å¦å¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œfinallyä»£ç å—\n1try{ 2 3}catch() { 4 5} finally { 6 7} 825 Javaè°ƒç”¨å¤–éƒ¨å¯æ‰§è¡Œç¨‹åº ä½¿ç”¨Runtime.exec()\n1try { 2 // æ‰§è¡Œå‘½ä»¤ 3 Process process = Runtime.getRuntime().exec(\u0026#34;notepad.exe\u0026#34;); 4 // ç­‰å¾…å¤–éƒ¨è¿›ç¨‹ç»“æŸ 5 int exitCode = process.waitFor(); 6 // æ£€æŸ¥æ‰§è¡Œæƒ…å†µ 7 if ... else ... 8} ä½¿ç”¨ProcessBuilder\n1// é…ç½®ç¨‹åºä¿¡æ¯ 2ProcessBuilder builder = new ProcessBuilder(\u0026#34;cmd.exe\u0026#34;, \u0026#34;/c\u0026#34;, \u0026#34;dir\u0026#34;); 3// builder.xxx() ... é…ç½®ä¿¡æ¯ 4 5// å¯åŠ¨è¿›ç¨‹ 6Process process = builder.start(); 7 8// è·å–è¿›ç¨‹è¾“å‡º 9InputStream is = process.getInputStream(); 10// ... 11 12// ç­‰å¾…ç»“æŸ 13int code = process.waitFor() 14 15// æ£€æŸ¥æ‰§è¡Œæƒ…å†µ 938 å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨Javaä¸­è¢«ä¸¤æ¬¡è°ƒç”¨startæ–¹æ³•ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ æŠ¥é”™ =\u0026gt; Javaä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½è¢«å¯åŠ¨ä¸€æ¬¡ã€‚\n943 IOæµ è¯»å–æ•°æ®å’Œè¾“å‡ºæ•°æ®\nå­—èŠ‚æµï¼Œç”¨äºå¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶, InputStream\u0026amp;OutputStream; InputStream å­ç±»å¦‚ä¸‹ï¼š FileInputStream BufferedInputStream // æä¾›ç¼“å†²åŒºï¼Œæé«˜æ€§èƒ½ å­—ç¬¦æµï¼Œç”¨äºå¤„ç†æ–‡æœ¬ã€‚ Reader\u0026amp;Writerï¼› Reader å­ç±»å¦‚ä¸‹ï¼š FileReader BufferedReader 945 Javaç½‘ç»œç¼–ç¨‹ ğŸ·ï¸ç”¨äºç½‘ç»œé€šä¿¡ï¼Œç½‘ç»œç¼–ç¨‹åŸºæœ¬æ¦‚å¿µ\nIPåœ°å€ ç«¯å£å· socket(ip:port) åè®®ï¼ŒTCP \u0026amp; UDP ç­‰ç­‰ TCPå®è·µ\n1// æœåŠ¡å™¨ä»£ç  2class ServerThread extends Thread { 3 private Socket socket = new ServerSocket(\u0026#34;localhost\u0026#34;, 8080); 4 5 @overwrite 6 public void run() { 7 try { 8 PrintWriter out = new PrintWriter(socket.getOutputStream() ... ); 9 BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream())); 10 11 String message = in.readLine(); 12 out.println(\u0026#34;Hello, client!\u0026#34;); 13 } 14 } 15} 16 17// Client 18Socket socket = new Socket(\u0026#34;localhost\u0026#34;, 8080) 19 20// ServerSocket \u0026amp; Socket 949 Javaä¸­çš„è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®± è‡ªåŠ¨è£…ç®±/æ‹†ç®±è®© Java æ›´åŠ æ˜“ç”¨ï¼Œå‡å°‘äº†æ‰‹åŠ¨è½¬æ¢çš„å†—ä½™ä»£ç ï¼ŒåŒæ—¶ä¿æŒäº†ç±»å‹å®‰å…¨\nè‡ªåŠ¨æ‹†ç®±å’Œè£…ç®± , è§£å†³æ³›å‹ä¸æ”¯æŒåŸºæœ¬ç±»å‹ 1List\u0026lt;Integer\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); // âœ… ä½¿ç”¨åŒ…è£…ç±» Integer 2 3// æ‰‹åŠ¨è£…ç®±å’Œæ‹†ç®± 4list.add(Integer.valueOf(10)); // int =\u0026gt; Integer 5int a = list.get(0).intValue(); // Integer =\u0026gt; int æ‰‹åŠ¨å®ç° 6 7// è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®± 8list.add(10) 9int a = list.get(0) åŸºæœ¬ç±»å‹å½“ä½œå¯¹è±¡ä½¿ç”¨ 1Map\u0026lt;Integer,String\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); 2map.put(1, \u0026#34;One\u0026#34;) \u0026lt;= è‡ªåŠ¨è£…ç®± 3String value = map.get(1) \u0026lt;= è‡ªåŠ¨è£…ç®± ç®€åŒ–åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ 1public static int add(Integer a, Integer b) { 2 return a + b; // è¿™é‡Œçš„ a å’Œ b éœ€è¦è‡ªåŠ¨æ‹†ç®± 3} 4 5// æ‰‹åŠ¨æ‹†ç®± 6public static int add(Integer a, Integer b) { 7 return a.intValue() + b.intValue(); // è¿™é‡Œçš„ a å’Œ b éœ€è¦è‡ªåŠ¨æ‹†ç®± 8} 988 Javaä¸­çš„è¿­ä»£å™¨ Iterator ÉªtÉ™ËˆreÉªtÉ™ ä½œç”¨ç”¨äºéå†é›†åˆ\nhasNext(): è¿”å›æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´  next(): è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´  1Iterator iterator = list.iterator() 2while(iterator.hasNext()) { 3 // ... 4 iterator.next(); 5} 993 Javaç‰¹æ€§ å°è£…ï¼šå°†å¯¹è±¡çš„çŠ¶æ€å’Œè¡Œä¸ºå°è£…åœ¨ä¸€ä¸ªç±»å†…éƒ¨ï¼Œå¹¶é€šè¿‡å…¬å¼€çš„æ¥å£ä¸å¤–éƒ¨è¿›è¡Œäº¤äº’ã€‚åªæš´éœ²å¿…è¦åŠŸèƒ½ã€‚\nç»§æ‰¿ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå¯ä»¥ç»§æ‰¿å®ƒçš„å±æ€§å’Œæ–¹æ³•ï¼Œæé«˜ä»£ç é‡ç”¨å’Œæ‰©å±•ã€‚\nå¤šæ€ï¼šé‡å†™\u0026amp;é‡è½½\n994 Javaä¸­è®¿é—®ä¿®é¥°ç¬¦ publicï¼šAll privateï¼šå½“å‰ç±» protectedï¼šå½“å‰ç±»ï¼ŒåŒä¸€åŒ…(packageå£°æ˜ä¸€è‡´)ï¼Œå­ç±» defaultï¼Œå½“å‰ç±»ï¼ŒåŒä¸€åŒ… 995 é™æ€æ–¹æ³•\u0026amp;å®ä¾‹æ–¹æ³• é™æ€æ–¹æ³• staticå£°æ˜ï¼šå±äºç±»è€Œéå…·ä½“çš„å®ä¾‹ï¼Œé€šè¿‡ç±»åè°ƒç”¨ã€‚\nå·¥å‚æ–¹æ³•ï¼Œå·¥å…·ç±» å½“ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œç±»æ–¹æ³•çš„å…¥å£åœ°å€å°±ä¼šè¢«åˆ†é…å®Œæˆï¼Œæ‰€ä»¥ç±»æ–¹æ³•ä¸ä»…ä»…è¢«è¯¥ç±»çš„å¯¹è±¡è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ç±»åç§°å®Œæˆè°ƒç”¨ï¼Œç±»æ–¹æ³•çš„å…¥å£åœ°å€åªæœ‰ç¨‹åºé€€å‡ºæ‰æ¶ˆå¤±ã€‚ å®ä¾‹æ–¹æ³•ï¼šå±äºå®ä¾‹ï¼Œé€šè¿‡å®ä¾‹è°ƒç”¨ï¼›\nå½“ç±»çš„å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­çš„æ—¶å€™ï¼Œç±»çš„å®ä¾‹æ–¹æ³•å¹¶æ²¡æœ‰è¢«åˆ†é…åˆ°å…¥å£åœ°å€ï¼Œåªæœ‰å½“ç±»çš„å¯¹è±¡åˆ›å»ºä¹‹åï¼Œå®ä¾‹æ–¹æ³•æ‰åˆ†é…äº†å…¥å£åœ°å€ï¼Œä»è€Œå®ä¾‹æ–¹æ³•å¯ä»¥è¢«ç±»åˆ›å»ºçš„æ‰€æœ‰çš„å¯¹è±¡æ‰€è°ƒç”¨ï¼Œè¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œå½“æˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªç±»çš„å¯¹è±¡æ—¶ï¼Œå®ä¾‹æ–¹æ³•çš„å…¥å£åœ°å€ä¼šå®Œæˆåˆ†é…ï¼Œå½“åç»­åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¸ä¼šè¢«åˆ†é…æ–°çš„å…¥å£åœ°å€ï¼Œè¯¥ç±»çš„æ‰€æœ‰çš„å¯¹è±¡å…±äº«å®ä¾‹æ–¹æ³•çš„å…¥å£åœ°å€ï¼Œå½“è¯¥ç±»çš„æ‰€æœ‰çš„å¯¹è±¡è¢«é”€æ¯ï¼Œå…¥å£çš„åœ°å€æ‰ä¼šæ¶ˆå¤±ã€‚ 990 javaä¸­forå’Œfor-each forï¼Œä¸‹æ ‡éå† for-eachï¼Œéå†é›†åˆï¼Œä¸æä¾›ä¸‹æ ‡ï¼Œä¸”ä¸èƒ½ä¿®æ”¹é›†åˆï¼Œå¦åˆ™æŠ¥é”™ 5900 wait()å’Œsleep() wait() éœ€è¦å’Œ notify()æ­é…ä½¿ç”¨ã€‚ ç”¨äºåœ¨åŒæ­¥ä»£ç å—åŒï¼Œé˜»å¡å’Œå”¤é†’\nsleep() ä½¿çº¿ç¨‹è¿›è¡Œä¼‘çœ çŠ¶æ€ï¼Œè®©å‡ºCPUä½¿ç”¨æƒï¼Œæ—¶é—´åˆ°äº†è‡ªåŠ¨æ¢å¤ä¸ºå°±ç»ªæ€ç­‰å¾…ç³»ç»Ÿåˆ†é…CPU\n5908 Java Objectç±»æœ‰ä»€ä¹ˆæ–¹æ³•åŠå¯¹åº”ä½œç”¨ hashCode() è®¡ç®—å“ˆå¸Œå€¼\nequals() é»˜è®¤å¼•ç”¨æ˜¯å¦ä¸€è‡´\næ ¹æ®éœ€æ±‚é‡å†™è¿™ä¸ªï¼Œå®ç°æŒ‡å®šå¯¹è±¡å±æ€§æ¯”è¾ƒ toString() é»˜è®¤è¿”å›å¯¹è±¡çš„ç±»å+hashCodeçš„16è¿›åˆ¶è¡¨ç¤º\né‡å†™ä½¿å…¶æ›´æœ‰æè¿°æ„ä¹‰ã€‚ getClass() è¿”å›å¯¹è±¡çš„Classç±»å¯¹è±¡\nwait() æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œä½¿å…¶å˜ä¸ºç­‰å¾…çŠ¶æ€ã€‚\nnotify\u0026amp;notifyAll() å”¤é†’åœ¨å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„ä¸€ä¸ªorå…¨éƒ¨çº¿ç¨‹\nclone() æµ…æ‹·è´å¯¹è±¡ï¼Œå…¶ä¸­å¼•ç”¨å±æ€§ä¸æ‹·è´\né‡å†™å®ç°æ·±æ‹·è´ï¼Œä¿è¯å®Œæ•´æ€§ 5909 Javaå­—èŠ‚ç æ˜¯ä»€ä¹ˆï¼ŸâŒ å¤„äº æºä»£ç .java å’Œ JVM.bin æ‰§è¡Œçš„æœºå™¨ä»£ç .exe(windows)ä¹‹é—´çš„ä¸­é—´è¡¨ç¤ºã€‚\n.class æ–‡ä»¶ å¯ä»¥è¢«JVMè§£é‡Šå™¨ç¼–è¯‘ä¸ºæœºå™¨ç \nğŸ‰é€šè¿‡Javaåå°„Apiï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆæˆ–è€…ä¿®æ”¹å­—èŠ‚ç ï¼Œä»è€Œåˆ›å»ºä»£ç†å¯¹è±¡æˆ–å®ç°åŠ¨æ€æ–¹æ³•è°ƒç”¨\n166 BIOã€NIOã€AIO BIO:äººä¸€ç›´ç›¯ç€æ°´çƒ§å¼€ï¼Œæ°´çƒ§å¼€ä¹‹åäº²è‡ªå…³ç« NIO:äººåœ¨çƒ§æ°´çš„æ—¶å€™å»å¹²åˆ«çš„äº‹æƒ…ï¼Œæ—¶ä¸æ—¶çœ‹ç€æ°´çƒ§æ²¡çƒ§å¼€ï¼Œçƒ§å¼€ä¹‹åäº²è‡ªå…³ç« AIO:äººæ‰¾äº†ä¸€ä¸ªå¸®æ‰‹ï¼Œå¸®æ‰‹åœ¨çƒ§æ°´çš„æ—¶å€™ä¸€ç›´ç›¯ç€ï¼Œæ°´çƒ§å¼€ä¹‹åå¸®æ‰‹å…³ç«ï¼Œç„¶åæé†’äººæ°´çƒ§å¼€äº†ã€‚äººå…¨ç¨‹ä¸ç®¡çƒ§æ°´çš„äº‹æƒ…\nBIOï¼šBlocking IOã€‚ä¼ ç»Ÿé˜»å¡å¼IOæ¨¡å¼ï¼Œè°ƒç”¨æ–¹è°ƒç”¨BIOä¼šè¢«é˜»å¡ï¼Œç›´åˆ°IOæœåŠ¡å®Œæˆæ‰è¢«å”¤é†’ã€‚ åœºæ™¯ï¼šåŒæ­¥ã€é˜»å¡ï¼Œé€‚åˆå¹¶å‘è¿æ¥è¾ƒå°‘çš„åœºæ™¯ï¼Œå°å‹æœåŠ¡ã€‚ 1// å®¢æˆ·ç«¯ 2// 1. åˆ›å»ºæœåŠ¡å™¨ socketï¼Œç›‘å¬ç«¯å£ 3serverSocket = åˆ›å»º ServerSocket(ç«¯å£); 4 5// 2. æœåŠ¡å™¨å¾ªç¯ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ 6while (true) { 7 // 3. é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ 8 socket = serverSocket.accept(); â­è¿™é‡Œä¼šå¡ä½ 9 10 // 4. æ¯ä¸ªè¿æ¥åˆ›å»ºæ–°çº¿ç¨‹ 11 å¯åŠ¨æ–°çº¿ç¨‹(() -\u0026gt; { 12 inputStream = socket.getInputStream(); 13 outputStream = socket.getOutputStream(); 14 15 while (true) { 16 // 5. è¯»å–æ•°æ®ï¼ˆé˜»å¡ï¼‰ 17 data = è¯»å–æ•°æ®(inputStream); 18 if (data == null) break; 19 20 // 6. å¤„ç†æ•°æ® 21 å¤„ç†æ•°æ®(data); 22 23 // 7. å“åº”å®¢æˆ·ç«¯ï¼ˆé˜»å¡ï¼‰ 24 outputStream.write(å“åº”æ•°æ®); 25 } 26 // 8. å…³é—­è¿æ¥ 27 socket.close(); 28 }); 29} 30 31 32// å®¢æˆ·ç«¯ 33// 1. åˆ›å»º Socket è¿æ¥æœåŠ¡å™¨ 34socket = åˆ›å»º Socket(æœåŠ¡å™¨IP, ç«¯å£); 35 36// 2. è·å–è¾“å…¥è¾“å‡ºæµ 37inputStream = socket.getInputStream(); 38outputStream = socket.getOutputStream(); 39 40// 3. å‘é€æ•°æ®ï¼ˆé˜»å¡ï¼‰ 41outputStream.write(è¯·æ±‚æ•°æ®); 42outputStream.flush(); 43 44// 4. è¯»å–æœåŠ¡å™¨å“åº”ï¼ˆé˜»å¡ï¼‰ 45response = è¯»å–æ•°æ®(inputStream); 46 47// 5. å¤„ç†å“åº” 48å¤„ç†æ•°æ®(response); 49 50// 6. å…³é—­è¿æ¥ 51socket.close(); ä¸€è¿æ¥ä¸€çº¿ç¨‹\nNIOï¼šNon-blocking IOã€‚éé˜»å¡IOæ¨¡å¼ï¼Œè°ƒç”¨æ–¹å‘èµ·IOæ“ä½œå³è¿”å›ï¼Œä¸è®ºä»»åŠ¡æ˜¯å¦å®Œæˆã€‚é€šå¸¸ç»“åˆIOå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œä½¿å¾—ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªè¿æ¥ã€‚ 1// 1. åˆ›å»º Selectorï¼ˆäº‹ä»¶é€‰æ‹©å™¨ï¼‰ 2selector = åˆ›å»º Selector(); 3 4// 2. åˆ›å»ºéé˜»å¡ ServerSocketChannelï¼Œç»‘å®šç«¯å£ 5serverChannel = åˆ›å»º â­ServerSocketChannel(ç«¯å£)â­; 6serverChannel.configureBlocking(false); 7 8// 3. æ³¨å†Œåˆ° Selectorï¼Œç›‘å¬ \u0026#34;accept\u0026#34; äº‹ä»¶ 9serverChannel.register(selector, OP_ACCEPT); 10 11// 4. æœåŠ¡å™¨å¾ªç¯ç›‘å¬äº‹ä»¶ 12while (true) { 13 // 5. è½®è¯¢ç›‘å¬å·²å‡†å¤‡å¥½çš„ I/O äº‹ä»¶ï¼Œ ç›‘è§†å¤šä¸ªChannel 14 selector.select(); 15 16 // 6. éå†æ‰€æœ‰å‘ç”Ÿäº‹ä»¶çš„é€šé“ 17 for (key : selector.selectedKeys()) { 18 if (key.isAcceptable()) { // 7. å¤„ç†æ–°è¿æ¥ 19 socketChannel = serverChannel.accept(); 20 socketChannel.configureBlocking(false); 21 socketChannel.register(selector, OP_READ | OP_WRITE); 22 } 23 else if (key.isReadable()) { // 8. è¯»å–æ•°æ® 24 socketChannel = key.channel(); 25 buffer = åˆ›å»º ByteBuffer(); 26 bytesRead = socketChannel.read(buffer); 27 if (bytesRead \u0026gt; 0) { 28 å¤„ç†æ•°æ®(buffer); 29 } 30 } 31 else if (key.isWritable()) { // 9. å“åº”å®¢æˆ·ç«¯ 32 socketChannel = key.channel(); 33 buffer = åˆ›å»º ByteBuffer(å“åº”æ•°æ®); 34 socketChannel.write(buffer); 35 } 36 } 37} 38 39 40// å®¢æˆ·ç«¯ 41// 1. åˆ›å»º Selectorï¼ˆäº‹ä»¶ç®¡ç†å™¨ï¼‰ 42selector = åˆ›å»º Selector(); 43 44// 2. åˆ›å»ºéé˜»å¡ SocketChannel 45socketChannel = åˆ›å»º â­SocketChannel()â­; 46socketChannel.configureBlocking(false); 47 48// 3. è¿æ¥æœåŠ¡å™¨ï¼ˆéé˜»å¡ï¼‰ 49socketChannel.connect(æœåŠ¡å™¨IP, ç«¯å£); 50 51// 4. æ³¨å†Œåˆ° Selectorï¼Œç›‘å¬ \u0026#34;è¿æ¥å®Œæˆ\u0026#34; äº‹ä»¶ 52socketChannel.register(selector, OP_CONNECT | OP_READ | OP_WRITE); 53 54// 5. è½®è¯¢ Selector ç›‘å¬äº‹ä»¶ 55while (true) { 56 selector.select(); // è½®è¯¢ç­‰å¾…äº‹ä»¶ 57 for (key : selector.selectedKeys()) { 58 if (key.isConnectable()) { // 6. å¤„ç†è¿æ¥å®Œæˆäº‹ä»¶ 59 if (socketChannel.finishConnect()) { 60 socketChannel.register(selector, OP_READ | OP_WRITE); 61 } 62 } 63 else if (key.isWritable()) { // 7. å‘é€æ•°æ® 64 buffer = åˆ›å»º ByteBuffer(è¯·æ±‚æ•°æ®); 65 socketChannel.write(buffer); 66 } 67 else if (key.isReadable()) { // 8. è¯»å–æœåŠ¡å™¨å“åº” 68 buffer = åˆ›å»º ByteBuffer(); 69 bytesRead = socketChannel.read(buffer); 70 if (bytesRead \u0026gt; 0) { 71 å¤„ç†æ•°æ®(buffer); 72 } 73 } 74 } 75} â€‹\nAIOï¼šAsynchronous IO å¼‚æ­¥IO åˆ©ç”¨å›è°ƒoré€šçŸ¥çš„æ–¹å¼å‘ŠçŸ¥è°ƒç”¨æ–¹ 1// 1. åˆ›å»ºå¼‚æ­¥ ServerSocketChannel 2serverChannel = åˆ›å»º AsynchronousServerSocketChannel(ç«¯å£); 3serverChannel.bind(ç«¯å£); 4 5// 2. ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼ˆå¼‚æ­¥å›è°ƒï¼‰ 6serverChannel.accept(null, new CompletionHandler\u0026lt;\u0026gt;() { 7 // 3. å¤„ç†æ–°è¿æ¥ 8 completed(socketChannel, attachment) { 9 // 4. ç»§ç»­ç›‘å¬æ–°çš„å®¢æˆ·ç«¯ 10 serverChannel.accept(null, this); 11 12 // 5. è¯»å–æ•°æ®ï¼ˆå¼‚æ­¥å›è°ƒï¼‰ 13 buffer = åˆ›å»º ByteBuffer(); 14 socketChannel.read(buffer, buffer, new CompletionHandler\u0026lt;\u0026gt;() { 15 // 6. è¯»å–å®Œæˆï¼Œå¤„ç†æ•°æ® 16 completed(bytesRead, buffer) { 17 if (bytesRead \u0026gt; 0) { 18 å¤„ç†æ•°æ®(buffer); 19 20 // 7. å“åº”å®¢æˆ·ç«¯ï¼ˆå¼‚æ­¥å›è°ƒï¼‰ 21 socketChannel.write(ByteBuffer.wrap(å“åº”æ•°æ®), null, new CompletionHandler\u0026lt;\u0026gt;() { 22 completed(bytesWritten, attachment) { 23 // å“åº”å®Œæˆ 24 } 25 }); 26 } 27 } 28 }); 29 } 30}); 31 32// å®¢æˆ·ç«¯ 33// 1. åˆ›å»ºå¼‚æ­¥ SocketChannel 34socketChannel = åˆ›å»º AsynchronousSocketChannel(); 35 36// 2. è¿æ¥æœåŠ¡å™¨ï¼ˆå¼‚æ­¥å›è°ƒï¼‰ 37socketChannel.connect(æœåŠ¡å™¨IP, ç«¯å£, null, new CompletionHandler\u0026lt;\u0026gt;() { 38 // 3. è¿æ¥æˆåŠŸå›è°ƒ 39 completed(attachment) { 40 // 4. å‘é€æ•°æ®ï¼ˆå¼‚æ­¥ï¼‰ 41 buffer = åˆ›å»º ByteBuffer(è¯·æ±‚æ•°æ®); 42 socketChannel.write(buffer, buffer, new CompletionHandler\u0026lt;\u0026gt;() { 43 completed(bytesWritten, buffer) { 44 // 5. ç»§ç»­è¯»å–æœåŠ¡å™¨å“åº”ï¼ˆå¼‚æ­¥ï¼‰ 45 buffer.clear(); 46 socketChannel.read(buffer, buffer, new CompletionHandler\u0026lt;\u0026gt;() { 47 completed(bytesRead, buffer) { 48 å¤„ç†æ•°æ®(buffer); 49 } 50 }); 51 } 52 }); 53 } 54}); 439 JavaåŒäº²å§”æ´¾æ¨¡å‹ âŒâŒâŒ Javaç±»åŠ è½½æœºåˆ¶çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚ æ ¸å¿ƒæ€æƒ³ï¼šç±»åŠ è½½å™¨åœ¨åŠ è½½æŸä¸ªç±»æ—¶ï¼Œå…ˆå§”æ´¾çˆ¶ç±»å»åŠ è½½ï¼Œçˆ¶ç±»æ— æ³•åŠ è½½æ—¶ï¼Œæ‰ç”±å½“å‰ç±»åŠ è½½å™¨åŠ è½½ã€‚ è‡ªå®šä¹‰ClassLoaderç»§æ‰¿ç³»ç»Ÿçš„\u0026amp;é‡å†™findClasså³å¯\nGPT: åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰ æ˜¯ Java ç±»åŠ è½½æœºåˆ¶ çš„ä¸€ä¸ªè§„åˆ™ã€‚ å½“ä¸€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½æŸä¸ªç±»æ—¶ï¼Œå…ˆè®©çˆ¶ç±»åŠ è½½å™¨å°è¯•åŠ è½½ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»æ—¶ï¼Œæ‰ç”±è‡ªèº«åŠ è½½\n1ã€Bootstrap ClassLoaderã€‘ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰ 2 â†‘ åŠ è½½-1ï¼Œä¸è¡Œçš„è¯åˆ°2 3ã€ExtClassLoaderã€‘ï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰ 4 â†‘ åŠ è½½-2ï¼Œä¸è¡Œçš„è¯åˆ°3 5ã€AppClassLoaderã€‘ï¼ˆåº”ç”¨ç±»åŠ è½½å™¨ï¼‰ 6 â†‘ åŠ è½½-3ï¼Œä¸è¡Œçš„è¯åˆ°4 7ã€è‡ªå®šä¹‰ ClassLoaderã€‘ï¼ˆç”¨æˆ·è‡ªå®šä¹‰åŠ è½½å™¨ï¼‰ åŠ è½½-4 8 9// å€’ç€çš„Uå­—å½¢ å®ƒè§£å†³çš„é—®é¢˜\né¿å…ç±»é‡å¤åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰è¯¥æœºåˆ¶ =\u0026gt; æ¯ä¸ªç±»åŠ è½½å™¨éƒ½å¯ä»¥è‡ªè¡ŒåŠ è½½åŒä¸€ä¸ªç±»ï¼Œå¯èƒ½å¯¼è‡´ ClassCastExceptionï¼ˆç±»è½¬æ¢å¼‚å¸¸ï¼‰ 1ClassLoader cl1 = new MyClassLoader(); // è‡ªå®šä¹‰ç±»åŠ è½½å™¨ 2ClassLoader cl2 = new MyClassLoader(); 3 4Class\u0026lt;?\u0026gt; class1 = cl1.loadClass(\u0026#34;com.example.MyClass\u0026#34;); 5Class\u0026lt;?\u0026gt; class2 = cl2.loadClass(\u0026#34;com.example.MyClass\u0026#34;); 6 7// class1 å’Œ class2 è™½ç„¶åå­—ç›¸åŒï¼Œä½†æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±» 8Object obj = class1.newInstance(); 9MyClass myObj = (MyClass) obj; // å¯èƒ½æŠ›å‡º ClassCastException 10// æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ç±»åŠ è½½ç©ºé—´ã€‚å¦‚æœä½ ä½¿ç”¨å¤šä¸ªç±»åŠ è½½å™¨åŠ è½½åŒä¸€ä¸ªç±»ï¼Œå®ƒä»¬ä¼šè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼Œå°½ç®¡ç±»çš„åå­—å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚ ä¿è¯Javaæ ¸å¿ƒç±»çš„å®‰å…¨ å› ä¸ºå§”æ‰˜çˆ¶ç±»åŠ è½½\nä¾‹å¦‚\n1package java.lang; 2public class String { 3 public static void hack() { 4 System.out.println(\u0026#34;Java è¢«é»‘äº†ï¼\u0026#34;); 5 } 6} å¦‚æœæ²¡æœ‰åŒäº²å§”æ´¾ï¼Œé‚£ä¹ˆåŠ è½½çš„æ˜¯è‡ªå®šä¹‰çš„ç±»ï¼Œå¯èƒ½å¯¼è‡´å®‰å…¨æ¼æ´ã€‚\n","permalink":"http://longcoding.top/posts/jobs/java/","summary":"\u003ch3 id=\"415-åºåˆ—åŒ–ååºåˆ—åŒ–\"\u003e415 åºåˆ—åŒ–\u0026amp;ååºåˆ—åŒ–\u003c/h3\u003e\n\u003cp\u003eå°†Objectè½¬ä¸ºå­—èŠ‚æµï¼Œæˆ–åä¹‹\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ™®é€šï¼šå®ç°serializableæ¥å£ ËˆsÉªÉ™rÉªÉ™laÉªzÉ™bl\u003c/li\u003e\n\u003cli\u003eä½¿ç”¨Jackonï¼ŒObj =\u0026gt; jsonæ ¼å¼\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"416-javaä¸­çš„ä¸å¯å˜ç±»\"\u003e416 Javaä¸­çš„ä¸å¯å˜ç±»\u003c/h3\u003e\n\u003cp\u003efinal ä¿®é¥°ï¼Œä¾‹å¦‚Stringç±»\u003c/p\u003e\n\u003cp\u003eğŸ‰ä¼˜ç‚¹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eçº¿ç¨‹å®‰å…¨\u003c/li\u003e\n\u003cli\u003eç¼“å­˜å‹å¥½\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç¼ºç‚¹\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºä¸èƒ½ä¿®æ”¹ï¼Œæ‰€æœ‰æ¯æ¬¡çŠ¶æ€å˜åŒ–ï¼Œéƒ½éœ€è¦ç”Ÿæˆæ–°çš„å¯¹è±¡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"411-å¤šæ€ç‰¹æ€§\"\u003e411 å¤šæ€ç‰¹æ€§\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eç»§æ‰¿\u003c/li\u003e\n\u003cli\u003eæ–¹æ³•é‡è½½ï¼Œå‡½æ•°åç›¸åŒï¼Œä½†æ˜¯å‡½æ•°ç­¾åéœ€è¦æœ‰å·®å¼‚(å‚æ•°ç±»å‹\u0026amp;æ•°é‡)\u003c/li\u003e\n\u003cli\u003eé‡å†™ï¼Œå­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œé€šè¿‡çˆ¶ç±»è°ƒç”¨æ–¹æ³•æ—¶ï¼Œè°ƒç”¨çš„æ˜¯å­ç±»é‡å†™åçš„å‡½æ•°ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"412-javaå‚æ•°ä¼ å€¼æ˜¯å‰¯æœ¬è¿˜æ˜¯å¼•ç”¨å‘¢\"\u003e412 Javaå‚æ•°ä¼ å€¼æ˜¯å‰¯æœ¬è¿˜æ˜¯å¼•ç”¨å‘¢ï¼Ÿ\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eåŸºæœ¬ç±»å‹æ˜¯ä¼ \u003cstrong\u003eå€¼å‰¯æœ¬\u003c/strong\u003eï¼Œint\u0026hellip;\u003c/li\u003e\n\u003cli\u003eå¼•ç”¨æ•°æ®ç±»å‹æ˜¯ä¼ \u003cstrong\u003eå¼•ç”¨å‰¯æœ¬\u003c/strong\u003eã€‚ includingï¼šobjï¼Œarray\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"425-javaä¸­-åŒ…è£…ç±»å‹å’ŒåŸºæœ¬ç±»å‹\"\u003e425 Javaä¸­ åŒ…è£…ç±»å‹å’ŒåŸºæœ¬ç±»å‹\u003c/h3\u003e\n\u003cp\u003eğŸ·ï¸åŸºæœ¬ç±»å‹ =\u0026gt; int long float double  \u0026hellip;  ä½äºæ ˆä¸Š(å±€éƒ¨å˜é‡çš„è¯) ï¼Œæ€§èƒ½å¥½ï¼Œä½†\u003cstrong\u003eä¸æ”¯æŒä¸ºnull\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eï¼ˆå±€éƒ¨å˜é‡åœ¨æ ˆä¸Šï¼Œæˆå‘˜å˜é‡åœ¨å †ä¸Šï¼Œé™æ€å­—æ®µåœ¨æ–¹æ³•åŒºï¼‰\u003c/p\u003e\n\u003cp\u003eğŸ·ï¸åŒ…è£…ç±»å‹ =\u0026gt; æ¯ä¸€ä¸ªåŸºæœ¬ç±»å‹éƒ½å¯¹åº”ä¸€ä¸ªåŒ…è£…ç±»å‹ã€‚\u003cstrong\u003eåŒ…è£…ç±»å‹æ˜¯ç±»ï¼Œåœ¨å †ä¸­ï¼Œæ”¯æŒnull\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJVMå†…å­˜æ¨¡å‹\u003c/strong\u003e  â—â—â—å†…å­˜å †å’Œæ•°æ®ç»“æ„å †ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿(ä¸æ˜¯å †çš„ç»“æ„)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e+--------------------------------------------+\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e               \u003c/span\u003e\u003cspan class=\"n\"\u003eæ–¹æ³•åŒº\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼ˆ\u003c/span\u003e\u003cspan class=\"n\"\u003eMethod\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eArea\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼‰\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eâ†\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eçº¿ç¨‹å…±äº«\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eç±»å…ƒæ•°æ®\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼ˆ\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eä¿¡æ¯\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼‰\u003c/span\u003e\u003cspan class=\"w\"\u003e                   \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eé™æ€å˜é‡\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼ˆ\u003c/span\u003e\u003cspan class=\"kd\"\u003estatic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eå˜é‡\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼‰\u003c/span\u003e\u003cspan class=\"w\"\u003e                  \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eå¸¸é‡æ± \u003c/span\u003e\u003cspan class=\"err\"\u003eï¼ˆ\u003c/span\u003e\u003cspan class=\"n\"\u003eå­—ç¬¦ä¸²å¸¸é‡ç­‰\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼‰\u003c/span\u003e\u003cspan class=\"w\"\u003e                   \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e+--------------------------------------------+\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"err\"\u003eâ†‘\u003c/span\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"err\"\u003eâ†‘\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e+----------------+\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"o\"\u003e+-----------------+\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"n\"\u003eæ ˆ\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼ˆ\u003c/span\u003e\u003cspan class=\"n\"\u003eStack\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼‰\u003c/span\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"n\"\u003eå †\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼ˆ\u003c/span\u003e\u003cspan class=\"n\"\u003eHeap\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼‰\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eâ†\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eçº¿ç¨‹å…±äº«\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eå±€éƒ¨å˜é‡\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eJava\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eå¯¹è±¡å®ä¾‹\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e12\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eæ–¹æ³•è°ƒç”¨æ ˆ\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eæ•°ç»„\u003c/span\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e13\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e+----------------+\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"o\"\u003e+-----------------+\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"413-interface--abstract-class\"\u003e413 interface \u0026amp; abstract class\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003einterface(è‡ªä¸Šè€Œä¸‹) çŸ¥æ™“æŸä¸€ç§è¡Œä¸ºï¼ŒåŸºäºè¿™äº›è¡Œä¸ºçº¦æŸå®šä¹‰çš„æ¥å£ï¼Œ ä¸€äº›ç±»éœ€è¦æœ‰è¿™äº›è¡Œä¸ºçš„è¯ï¼Œéœ€è¦å®ç°è¿™äº›æ¥å£\u003c/li\u003e\n\u003cli\u003eabstract class(è‡ªä¸‹è€Œä¸Š): æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬æœ‰å…±åŒç‚¹ï¼Œå¾ˆå¤šä»£ç å¯ä»¥å¤ç”¨ï¼Œå› æ­¤å°†å…¬å…±é€»è¾‘å°è£…ä¸ºæŠ½è±¡å¯¹è±¡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"100-hashcode--equals--\"\u003e100 hashCode \u0026amp; equals \u0026amp; ==\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ehashCodeç”¨äºæ•£åˆ—è¡¨(hashMap)ç”¨äºè®¡ç®—hashå€¼ï¼Œä»è€Œè®¡ç®—å­˜å‚¨ä½ç½®ï¼›\u003c/p\u003e","title":"Javaé¢è¯•é¢˜ç¬”è®°"},{"content":"é«˜é¢‘SQL50é¢˜ æŸ¥è¯¢ Where\u0026amp;GroupBy\u0026amp;HAVING 1SELECT id, revenue # æŸä¸ªç”¨æˆ·2021å¹´å¯èƒ½æœ‰å¤šé¡¹è®°å½• 2FROM users 3Where year = 2021 4 5SELECT id, SUM(revenue) 6FROM users 7Where year = 2021 # 1. å…ˆç­›é€‰å‡ºæ­¤å¹´ä»½æ‰€æœ‰è®°å½• 8Group By id # 2. å†æ ¹æ®idåˆ†ç»„ 3. å¿…é¡»ç»“åˆSUM() æˆ–è€…å…¶ä»–èšåˆå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªæœ‰å¤šåˆ—ï¼Œéœ€è¦å¤„ç†ä¸ºå•å€¼ã€‚ 9 10SELECT id 11FROM users 12Where year = 2021 # 1. å…ˆç­›é€‰è®°å½• 13Group By id # 2. åˆ†ç»„ 14HAVING SUM(revenue) \u0026gt; 1000 # 3. èšåˆåˆ†ç»„å­—æ®µè®°å½• å¹¶ åˆ¤æ–­ æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢ 1# 1. NOT EXISTS 2SELECT `name` AS `Customers` 3FROM `Customers` AS c 4WHERE NOT EXISTS ( 5 SELECT `customerId` 6 FROM `Orders` AS o 7 Where o.customerId = c.id 8) 1# 2. Left Join 2# example 3SELECT c.id AS id, c.name, o.id AS oid 4FROM customers AS c LEFT JOIN orders AS o 5on c.id = o.customerId 6 7SELECT `name` as `Customers` 8FROM customers AS c LEFT JOIN orders AS o 9on c.id = o.customerId 10WHERE o.id is NULL è®¡ç®—ç‰¹æ®Šå¥–é‡‘ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ å¥‡æ•° å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ 'M' å¼€å¤´ï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ 100% ï¼Œå¦åˆ™å¥–é‡‘ä¸º 0 ã€‚\nè¿”å›çš„ç»“æœæŒ‰ç…§ employee_id æ’åºã€‚\nIFç”¨æ³• IF(condition, True, False) AS alias\n1select `employee_id`, IF(name not like \u0026#39;M%\u0026#39; and employee_id%2 = 1, salary, 0) AS `bonus` 2from Employees 3Order by employee_id ASC è´­ä¹°äº†äº§å“ A å’Œäº§å“ B å´æ²¡æœ‰è´­ä¹°äº§å“ C çš„é¡¾å®¢ Where ä¸­ å¤šé‡ åˆ¤æ–­\n1select customer_id, customer_name 2from Customers as c 3where exists ( 4 select o.customer_id 5 from Orders as o 6 where o.customer_id=c.customer_id and product_name = \u0026#39;A\u0026#39; 7) and exists ( 8 select o.customer_id 9 from Orders as o 10 where o.customer_id=c.customer_id and product_name = \u0026#39;B\u0026#39; 11) and not exists ( 12 select o.customer_id 13 from Orders as o 14 where o.customer_id=c.customer_id and product_name = \u0026#39;C\u0026#39; 15) 16Order By c.customer_id ASC è¿è¡¨ï¼Œåˆ†ç»„åˆ¤æ–­\n1SELECT c.customer_id, c.customer_name 2FROM `Orders` as o left join `Customers` as c 3on o.customer_id = c.customer_id 4Group By o.customer_id 5HAVING SUM(product_name = \u0026#39;A\u0026#39;) \u0026gt; 0 and SUM(product_name = \u0026#39;B\u0026#39;) \u0026gt; 0 and SUM(product_name = \u0026#39;C\u0026#39;) = 0 6Order By c.customer_id ASC 1[o.id, o.customerId, o.product_name, c.customerId, c.name] 2 1 1 \u0026#39;A\u0026#39; 1 X 3 2 1 \u0026#39;B\u0026#39; 1 X 4 3 2 \u0026#39;A\u0026#39; 2 Y 5 4 2 \u0026#39;B\u0026#39; 2 Y 6 5 2 \u0026#39;C\u0026#39; 2 Y 7 8 Group By c.customerId 9 1 1 \u0026#39;A\u0026#39; 1 X 10 2 1 \u0026#39;B\u0026#39; 1 X 11 12 3 2 \u0026#39;A\u0026#39; 2 Y 13 4 2 \u0026#39;B\u0026#39; 2 Y 14 5 2 \u0026#39;C\u0026#39; 2 Y 15 16 SUM(express condition) ? condition # å¯¹äºStringæ˜¯ç»Ÿè®¡æ¡æ•° æ¯ä½å­¦ç”Ÿæˆç»©æœ€å¥½çš„ç§‘ç›® æ‰€æœ‰æœ‰ç›¸åŒç§‘ç›®æˆç»©ä¸€æ ·ï¼Œé€‰æ‹©ç§‘ç›®idå°çš„\n1+---------------+---------+ 2| Column Name | Type | 3+---------------+---------+ 4| student_id | int | 5| course_id | int | 6| grade | int | 7+---------------+---------+ # 1\n1# æŸ¥æŸå­¦ç”Ÿæˆç»©æœ€å¥½çš„é‚£äº›ç§‘ç›®ï¼Œå› ä¸ºå¯èƒ½æœ‰é‡å¤çš„ 2SELECT student_id, MAX(grade) AS grade 3From Enrollments 4Group By student_id # 2\n1# æŸ¥æŸå­¦ç”Ÿæœ€å¥½çš„é‚£äº›ç§‘ç›®ä¸­ courseIdæœ€å°çš„ 2SELECT student_id, MIN(courseId) AS course_id, grade 3From Enrollments 4# è¡Œ =\u0026gt; æœ€å¥½çš„é‚£äº›ç§‘ç›® 5Where (student_id, grade) in ( 6\tSELECT student_id, MAX(grade) AS grade 7\tFrom Enrollments 8\tGroup By student_id 9) 10Group By student_id 11Order By student_id ASC è¿æ¥ Left Join\næ‹“å±•å·¦è¾¹ï¼Œå³ä½¿å³è¡¨æŸäº›è¡Œä¸å­˜åœ¨ï¼ˆä¼šå‡ºç°é‡å¤è¡Œï¼‰\n=\u0026gt; **Right Join **åŒç†\n1SELECT * 2FROM `customers` as c 3LEFT JOIN orders as o 4ON c.id = o.customerId Inner Join =\u0026gt; åªå±•ç¤ºå·¦å³è¡¨å‡æˆåŠŸå¯¹æ¥ä¸Šçš„è¡Œ\næ²¡æœ‰å–å‡ºçš„å•†å®¶ å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ, æŠ¥å‘Šæ‰€æœ‰åœ¨ 2020 å¹´åº¦æ²¡æœ‰ä»»ä½•å–å‡ºçš„å–å®¶çš„åå­—ã€‚\nè¿”å›ç»“æœæŒ‰ç…§ seller_name å‡åºæ’åˆ—ã€‚\n1SELECT seller_name 2FROM Seller 3WHERE seller_id not in ( 4 SELECT DISTINCT Orders.seller_id 5 FROM Orders 6 WHERE Orders.sale_date like \u0026#39;2020%\u0026#39; 7) 8ORDER By seller_name ASC æ’åé å‰çš„æ—…è¡Œè€… è¿”å›çš„ç»“æœè¡¨å•ï¼Œä»¥ travelled_distance é™åºæ’åˆ— ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„ç”¨æˆ·æ—…è¡Œäº†ç›¸åŒçš„è·ç¦», é‚£ä¹ˆå†ä»¥ name å‡åºæ’åˆ— ã€‚\n1SELECT name, COALESCE(SUM(distance), 0) AS travelled_distance 2From Users Left join Rides 3On Rides.user_id = Users.id 4Group By Rides.user_id 5ORDER BY travelled_distance DESC, name ASC; # ä½¿ç”¨åˆ«åæ’åº 607. é”€å”®å‘˜ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ²¡æœ‰ä»»ä½•ä¸åä¸º â€œREDâ€ çš„å…¬å¸ç›¸å…³çš„è®¢å•çš„æ‰€æœ‰é”€å”®äººå‘˜çš„å§“åã€‚\n1SELECT name 2FROM SalesPerson 3WHERE sales_id not in ( 4 SELECT DISTINCT Orders.sales_id 5 FROM Orders LEFT JOIN Company 6 ON Orders.com_id = Company.com_id 7 WHERE name = \u0026#39;RED\u0026#39; 8) è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼ è¾“å…¥ï¼š\rVariables è¡¨:\r+------+-------+\r| name | value |\r+------+-------+\r| x | 66 |\r| y | 77 |\r+------+-------+\rExpressions è¡¨:\r+--------------+----------+---------------+\r| left_operand | operator | right_operand |\r+--------------+----------+---------------+\r| x | \u0026gt; | y |\r| x | \u0026lt; | y |\r| x | = | y |\r| y | \u0026gt; | x |\r| y | \u0026lt; | x |\r| x | = | x |\r+--------------+----------+---------------+\rè¾“å‡º:\r+--------------+----------+---------------+-------+\r| left_operand | operator | right_operand | value |\r+--------------+----------+---------------+-------+\r| x | \u0026gt; | y | false |\r| x | \u0026lt; | y | true |\r| x | = | y | false |\r| y | \u0026gt; | x | true |\r| y | \u0026lt; | x | false |\r| x | = | x | true |\r+--------------+----------+---------------+-------+ 1SELECT e.left_operand, e.operator, e.right_operand, 2CASE e.operator 3 WHEN \u0026#39;\u0026gt;\u0026#39; THEN IF(v1.value\u0026gt;v2.value, \u0026#39;true\u0026#39;, \u0026#39;false\u0026#39;) 4 WHEN \u0026#39;\u0026lt;\u0026#39; THEN IF(v1.value\u0026lt;v2.value, \u0026#39;true\u0026#39;, \u0026#39;false\u0026#39;) 5 ELSE IF(v1.value=v2.value, \u0026#39;true\u0026#39;, \u0026#39;false\u0026#39;) 6END value 7 8FROM Expressions e 9LEFT JOIN Variables v1 ON e.left_operand = v1.name 10LEFT JOIN Variables v2 ON e.right_operand = v2.name è€ƒç‚¹ï¼šå¤šé‡è¿è¡¨ e.(\u0026hellip;)v1.(\u0026hellip;)v2.(\u0026hellip;)\næ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼\ncase [sign]\nâ€‹\twhen exp then result[if(exp, true, false)]\nâ€‹\twhen exp then result\nâ€‹\telse result\nend\næŸ¥è¯¢çƒé˜Ÿç§¯åˆ† åˆ†åˆ«æŸ¥è¯¢ä¸»é˜Ÿå¾—åˆ†å’Œå®¢é˜Ÿå¾—åˆ†ã€‚å†è¿›è¡Œæ±‡æ€»ç»Ÿè®¡\nIFNULL(SUM(num_points), 0) # IFNULL(Origin, NULL-value)\n1SELECT t.team_id, t.team_name, IFNULL(SUM(num_points), 0) as num_points 2FROM Teams AS t 3LEFT JOIN ( 4 SELECT host_team AS team_id, 5 CASE 6 WHEN host_goals \u0026gt; guest_goals THEN 3 7 WHEN host_goals = guest_goals THEN 1 8 END AS num_points 9 FROM Matches 10 UNION ALL 11 SELECT guest_team AS team_id, 12 CASE 13 WHEN guest_goals \u0026gt; host_goals THEN 3 14 WHEN host_goals = guest_goals THEN 1 15 END AS num_points 16 FROM Matches 17) AS m ON t.team_id = m.team_id 18Group By t.team_id 19Order BY num_points DESC, t.team_id ASC # 1. LEFT JOIN å°†ç›¸å…³çš„å³è¡¨è¡¥å……è‡³å·¦è¡¨ ï¼è‹¥1vNåˆ™äº§ç”Ÿé‡å¤è®°å½•(èšåˆè¯¥è®°å½•)\n# 2. UNION(ALL) ä¸¤å¼ è¡¨éœ€å­—æ®µç›¸åŒï¼Œä¸Šä¸‹æ‹¼æ¥ä¸ºä¸€å¼ è¡¨ï¼ŒALLåˆ™ä¿ç•™é‡å¤è®°å½•\n# 3. case ç©ºæ¡ä»¶\nâ€‹\twhen ? then x\nâ€‹\t\u0026hellip;\nâ€‹\tELSE y\nâ€‹\tend\nèšåˆå‡½æ•° 2020æœ€åä¸€æ¬¡ç™»å½• 1SELECT MAX(Feild) # \u0026lt;= åªè¦ç»„å†…æœ€å¤§çš„è®°å½• 2\tMin(Feild) # \u0026lt;= åªè¦ç»„å†…æœ€å°çš„è®°å½• 3... 4 5Group By ä»“åº“ç»ç† 1SELECT Warehouse.name AS warehouse_name, 2SUM(units*Products.Width*Products.Length*Products.Height) AS volume # èšåˆç»„å†…æ•°æ® 3FROM Warehouse 4LEFT JOIN Products ON Warehouse.product_id = Products.product_id # è¡¥é½ä¿¡æ¯ 5Group By Warehouse.name # åˆ†ç»„ è®¢å•æœ€å¤šçš„å®¢æˆ· 1SELECT customer_number 2FROM Orders 3GROUP BY customer_number 4ORDER BY COUNT(*) DESC # å¯¹ç»„è¿›è¡Œæ’åº 5LIMIT 1 # Topä½ç½® 6 7 8SELECT o.customer_number 9FROM ( 10\tSELECT customer_number, COUNT(*) AS count_number 11\tFROM Orders 12\tGROUP BY customer_number 13) o 14ORDER BY o.count_number DESC 15LIMIT 1 æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´ å¤šæ¬¡åˆ†ç»„ \u0026amp; èšåˆ\n1SELECT `day`, emp_id, SUM(out_time-in_time) 2FROM Employees 3GROUP BY emp_id, event_day åŠæ—¶é£Ÿç‰©é…é€ è€ƒç‚¹ï¼šè®¡ç®—å…¬å¼\n#1 ROUND(X*100, 2) 33.33\n#2 SUM(IF(X, 1, 0)) / COUNT(ID)\næŒ‰åˆ—æ“ä½œ\n1SELECT ROUND((SUM(IF(order_date = customer_pref_delivery_date, 1, 0)))/COUNT(delivery_id)*100, 2) AS immediate_percentage 2FROM Delivery è‹¹æœå’Œæ¡”å­ 1SELECT sale_date, 2(SUM(IF(fruit=\u0026#39;apples\u0026#39;, sold_num, 0)) - SUM(IF(fruit=\u0026#39;oranges\u0026#39;, sold_num, 0))) AS diff 3FROM Sales 4Group By sale_date â­ åˆ†åˆ«èšåˆç»„å†…ä¸åŒæ¡ä»¶çš„è®°å½•\nä¸¤ä¸ªäººçš„é€šè¯è®°å½• è€ƒç‚¹ï¼Œå¤šæ¬¡åˆ†ç»„è¿›è¡Œèšåˆç»Ÿè®¡ã€‚\né¢˜å¹²ä¸­ï¼Œå‘¼å«ä¸æ¥æ”¶ä¸åˆ†ã€‚\n1SELECT from_id AS person1, to_id AS person2, COUNT(*) AS call_count,SUM(duration) AS total_duration 2 3FROM ( 4 5 SELECT IF(from_id \u0026lt; to_id, from_id, to_id) AS from_id, IF(from_id \u0026lt; to_id, to_id, from_id) AS to_id, duration 6 7 FROM Calls 8 9) AS c 10 11Group BY from_id, to_id æ’åºå’Œåˆ†ç»„ é“¶è¡Œè´¦æˆ·æ¦‚è¦ II ç¼–å†™è§£å†³æ–¹æ¡ˆ, æŠ¥å‘Šä½™é¢é«˜äº 10000 çš„æ‰€æœ‰ç”¨æˆ·çš„åå­—å’Œä½™é¢. è´¦æˆ·çš„ä½™é¢ç­‰äºåŒ…å«è¯¥è´¦æˆ·çš„æ‰€æœ‰äº¤æ˜“çš„æ€»å’Œ\n1SELECT name, balance 2FROM Users 3LEFT JOIN ( 4 SELECT account, SUM(amount) AS balance 5 FROM Transactions 6 Group BY account) AS trans On Users.account = trans.account 7Where balance \u0026gt; 10000 æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®± ç¼–å†™è§£å†³æ–¹æ¡ˆæ¥æŠ¥å‘Šæ‰€æœ‰é‡å¤çš„ç”µå­é‚®ä»¶\n1SELECT email AS Email 2FROM Person 3Group By email 4HAVING count(*) \u0026gt; 1 åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼” ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡ºåˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”çš„ id å¯¹ (actor_id, director_id)\n1SELECT actor_id, director_id 2FROM ActorDirector 3GROUP BY actor_id, director_id 4HAVING COUNT(*) \u0026gt;= 3 æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡\n67æœˆï¼Œæ¯ä¸ªæœˆå‡æ¶ˆè´¹è‡³å°‘100çš„ç”¨æˆ·\n1SELECT o.customer_id, name 2FROM () AS o 3LEFT JOIN Customers ON o.customer_id = Customers.customer_id 4 5 6# å…¶ä¸­ 7SELECT customer_id, order_date, (quantity*price) AS cost 8FROM Orders 9LEFT JOIN Product ON Orders.product_id = Product.product_id 10WHERE month(order_date) in (6,7) 11Group BY customer_id 12HAVING SUM(IF(month(order_date) = 6, cost, 0)) \u0026gt;= 100 and 13 SUM(IF(month(order_date) = 7, cost, 0)) \u0026gt;= 100 å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶ åˆ†æ­¥å®ç°ï¼š\n1ï¸âƒ£ å°†å‘¼å«\\æ¥å¬è”åˆ\n2ï¸âƒ£ å°†å¯¹åº”äººå‘˜åŠå…¶å›½å®¶å‡†å¤‡å¥½\n3ï¸âƒ£ å†æ¬¡è¿æ¥ï¼Œå¹¶æŒ‰å›½å®¶åˆ†ç»„ä¸”èšåˆ(HAVINGè¿›è¡Œæ¡ä»¶ç­›é€‰)\n1SELECT name as country 2FROM 3( 4 SELECT caller_id AS call_id, duration FROM Calls 5 UNION ALL 6 SELECT callee_id AS call_id, duration FROM Calls 7) a 8LEFT JOIN 9( 10 SELECT id, Country.name 11 FROM Person 12 LEFT JOIN Country on SUBSTR(phone_number, 1, 3) = country_code 13) b 14ON a.call_id = b.id 15Group BY name 16HAVING AVG(duration) \u0026gt; (SELECT AVG(duration) FROM Calls) é«˜çº§æŸ¥è¯¢å’Œè¿æ¥ HAVING å­å¥ç”¨æ¥å¯¹ èšåˆç»“æœ è¿›è¡Œè¿‡æ»¤ï¼Œè€Œ HAVING å­å¥æ— æ³•ç›´æ¥ä½¿ç”¨éèšåˆåˆ—\né¡µé¢æ¨è ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œå‘user_id = 1 çš„ç”¨æˆ·ï¼Œæ¨èå…¶æœ‹å‹ä»¬å–œæ¬¢çš„é¡µé¢ã€‚ä¸è¦æ¨èè¯¥ç”¨æˆ·å·²ç»å–œæ¬¢çš„é¡µé¢ã€‚\nå…ˆfindä»–çš„æ‰€æœ‰æœ‹å‹ã€‚ ä»–-\u0026gt;æœ‹å‹ and æœ‹å‹ -\u0026gt;\n1SELECT DISTINCT page_id as recommended_page 2FROM (SELECT user2_id as user_id 3 FROM Friendship 4 WHERE user1_id = 1 5 UNION 6 SELECT user1_id as user_id 7 FROM Friendship 8 WHERE user2_id = 1) AS fs 9LEFT JOIN Likes ls ON fs.user_id = ls.user_id 10WHERE page_id not in ( 11 SELECT page_id 12 FROM Likes 13 WHERE user_id = 1 14) 15ORDER BY recommended_page ASC æ ‘èŠ‚ç‚¹ CASE \u0026hellip; END æŒ‰åˆ—æ¥ï¼Œæ¯æ¬¡å¤„ç†åˆ—çš„ä¸€ä¸ªå…ƒç´ \n1SELECT id AS `id`, 2CASE 3 WHEN id = 1 THEN \u0026#34;Root\u0026#34; 4 WHEN id in (SELECT atree.p_id FROM tree atree) THEN \u0026#34;Inner\u0026#34; 5 ELSE \u0026#34;Leaf\u0026#34; 6END AS type 7FROM Tree æ¸¸æˆç©æ³•åˆ†æ III ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶æŠ¥å‘Šæ¯ç»„ç©å®¶å’Œæ—¥æœŸï¼Œä»¥åŠç©å®¶åˆ° ç›®å‰ä¸ºæ­¢ ç©äº†å¤šå°‘æ¸¸æˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç©å®¶åœ¨è¯¥æ—¥æœŸä¹‹å‰æ‰€ç©çš„æ¸¸æˆæ€»æ•°ã€‚è¯¦ç»†æƒ…å†µè¯·æŸ¥çœ‹ç¤ºä¾‹ã€‚\nåˆ©ç”¨ç¬›å¡å°”ç§¯ï¼Œ è‡ªå·±è·Ÿè‡ªå·±æ‰€æœ‰çš„è®°å½•è¿›è¡Œè¿æ¥ã€‚æš´åŠ›éå†\n1SELECT a1.player_id, a1.event_date, SUM(a2.games_played) AS games_played_so_far 2FROM Activity a1, Activity a2 # ç¬›å¡å„¿ç§¯ï¼Œo(n) x o(n) = o(n^2) æ¡çºªå½• 3WHERE a1.player_id = a2.player_id and a1.event_date \u0026gt;= a2.event_date # åªè¦è‡ªå·±å’Œè‡ªå·±è¿›è¡Œè¿æ¥çš„è®°å½• 4GROUP BY a1.player_id, a1.event_date å¤§æ»¡è´¯æ•°é‡ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ¯ä¸€ä¸ªçƒå‘˜èµ¢å¾—å¤§æ»¡è´¯æ¯”èµ›çš„æ¬¡æ•°ã€‚ç»“æœä¸åŒ…å«æ²¡æœ‰èµ¢å¾—æ¯”èµ›çš„çƒå‘˜çš„ID ã€‚\næ€è·¯ï¼š è¡Œ -\u0026gt; åˆ— å†èšåˆ\nPlayers è¡¨ï¼š\r+-----------+-------------+\r| player_id | player_name |\r+-----------+-------------+\r| 1 | Nadal |\r| 2 | Federer |\r| 3 | Novak |\r+-----------+-------------+\rChampionships è¡¨ï¼š\r+------+-----------+---------+---------+---------+\r| year | Wimbledon | Fr_open | US_open | Au_open |\r+------+-----------+---------+---------+---------+\r| 2018 | 1 | 1 | 1 | 1 |\r| 2019 | 1 | 1 | 2 | 2 |\r| 2020 | 2 | 1 | 2 | 2 |\r+------+-----------+---------+---------+---------+\rè¾“å‡ºï¼š\r+-----------+-------------+-------------------+\r| player_id | player_name | grand_slams_count |\r+-----------+-------------+-------------------+\r| 2 | Federer | 5 |\r| 1 | Nadal | 7 |\r+-----------+-------------+-------------------+ 1SELECT res.player_id, ps.player_name, res.grand_slams_count 2FROM ( 3 SELECT player_id, COUNT(*) AS grand_slams_count 4 FROM ( 5 SELECT Wimbledon player_id 6 FROM Championships 7 UNION ALL 8 SELECT Fr_open player_id 9 FROM Championships 10 UNION ALL 11 SELECT US_open player_id 12 FROM Championships 13 UNION ALL 14 SELECT Au_open player_id 15 FROM Championships 16 ) AS rec 17 GROUP BY rec.player_id 18) AS res 19LEFT JOIN Players AS ps ON res.player_id = ps.player_id åº”è¯¥è¢«ç¦æ­¢çš„ Leetflex è´¦æˆ· ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŸ¥æ‰¾é‚£äº›åº”è¯¥è¢«ç¦æ­¢çš„Leetflexå¸æˆ·ç¼–å· account_id ã€‚ å¦‚æœæŸä¸ªå¸æˆ·åœ¨æŸä¸€æ—¶åˆ»ä»ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œåœ°å€ç™»å½•äº†ï¼Œåˆ™è¿™ä¸ªå¸æˆ·åº”è¯¥è¢«ç¦æ­¢ã€‚\nLogInfo table:\r+------------+------------+---------------------+---------------------+\r| account_id | ip_address | login | logout |\r+------------+------------+---------------------+---------------------+\r| 1 | 1 | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 |\r| 1 | 2 | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 |\r| 2 | 6 | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 |\r| 2 | 7 | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 |\r| 3 | 9 | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 |\r| 3 | 13 | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |\r| 4 | 10 | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 |\r| 4 | 11 | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |\r+------------+------------+---------------------+---------------------+ 1AND ((a.login between b.login and b.logout) OR (a.logout between b.login and b.logout)) GROUP BY åˆ†ç»„\nHAVING ä½œç”¨äºç»„ï¼ŒæŒ‘é€‰æŒ‡å®šçš„ç»„\nå­æŸ¥è¯¢ å„éƒ¨é—¨æœ€é«˜æ”¶å…¥çš„å‘˜å·¥ (å¯èƒ½æœ‰å¤šä¸ª) 1SELECT d.name AS Department, e1.name AS Employee, e1.salary AS Salary 2FROM Employee e1 3LEFT JOIN Department d ON e1.departmentId = d.id 4WHERE e1.salary = ( 5 SELECT MAX(salary) 6 FROM Employee e2 7 GROUP BY e2.departmentId 8 HAVING e2.departmentId = e1.departmentId 9) æ•ˆç‡ä¸é«˜ï¼ï¼ï¼\nä¼˜åŒ–ï¼š\n1SELECT d.name AS Department, e1.name AS Employee, e1.salary AS Salary 2FROM Employee e1 3LEFT JOIN Department d ON e1.departmentId = d.id 4WHERE (e1.departmentId,e1.salary) in ( 5 SELECT e2.departmentId, MAX(salary) 6 FROM Employee e2 7 GROUP BY e2.departmentId 8) ç”Ÿæˆä¸´æ—¶è¡¨ï¼ˆé¿å…å­æŸ¥è¯¢ é‡å¤çš„æ‰§è¡Œï¼‰\n1WITH MaxSalaries AS ( 2 SELECT departmentId, MAX(salary) AS max_salary 3 FROM Employee 4 GROUP BY departmentId 5) æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å• å¯èƒ½æœ‰å¤šä¸ª\n1With LatestDate AS ( 2 SELECT product_id, MAX(order_date) AS order_date 3 FROM Orders 4 GROUP BY product_id 5) 6 7 8SELECT p.product_name, o.product_id, o.order_id, o.order_date 9FROM Orders AS o 10LEFT JOIN LatestDate AS ld ON o.product_id = ld.product_id 11LEFT JOIN Products AS p ON o.product_id = p.product_id 12WHERE o.order_date = ld.order_date 13ORDER BY p.product_name ASC, o.product_id ASC, o.order_id ASC æœ€è¿‘çš„ä¸‰ç¬”è®¢å• å­¦ä¹ ï¼Œ å¯åˆ†ç»„æ‰“indexæ ‡è®°ï¼Œæ ‡è®°æŒ‰ç…§ORDERé¡ºåº\n1ROW_NUMBER() OVER ( 2\tPARTITION BY ? 3 ORDER BY ? 4) 1WITH ORDER_INFO AS ( 2 SELECT c.name, c.customer_id, o.order_id, o.order_date, 3 ROW_NUMBER() OVER ( 4 PARTITION BY o.customer_id 5 ORDER BY o.order_date DESC 6 ) AS row_num 7 FROM Orders AS o 8 LEFT JOIN Customers AS c ON o.customer_id = c.customer_id 9) 10 11SELECT name AS customer_name, customer_id, order_id, order_date 12FROM ORDER_INFO AS o 13WHERE o.row_num \u0026lt;= 3 14ORDER BY customer_name ASC, customer_id ASC, order_date DESC å…ˆç”Ÿæˆä¸´æ—¶è¡¨ï¼Œé¿å…é‡å¤ç”Ÿæˆå­æŸ¥è¯¢\næ¯å¤©çš„æœ€å¤§é‡‘é¢ å…ˆç­›é€‰å‡ºæ¯å¤©çš„æœ€å¤§é‡‘é¢ï¼Œå†æ‰§è¡Œåç»­çš„åˆ¤æ–­\n1WITH MAX_AMOUNT AS ( 2 SELECT DATE(`day`) AS `day`, MAX(amount) max_amount 3 FROM Transactions AS t 4 GROUP BY DATE(`day`) 5) 6 7 8SELECT transaction_id 9FROM Transactions AS t 10LEFT JOIN MAX_AMOUNT AS ma ON DATE(t.day) = ma.day 11WHERE (DATE(t.day), t.amount) = (ma.day, ma.max_amount) 12ORDER BY transaction_id ASC ç›´æ¥ç»™æ¯å¤©çš„ è®¢å•ï¼ŒæŒ‰ç…§é‡‘é¢ï¼Œ æ‰“indexæ ‡è®°\nâ— RANK ç›¸åŒå€¼ä¼šè·å¾—ç›¸åŒçš„æ’å\n1RANK() OVER ( 2) è€Œ ROW_NUMBERï¼Œidxä¸¥æ ¼é€’å¢\n1WITH Temp AS ( 2 SELECT transaction_id, `day`, amount, 3 rank() OVER ( 4 PARTITION BY DATE(`day`) 5 ORDER BY amount DESC 6 ) AS idx 7 FROM Transactions AS t 8) 9 10SELECT transaction_id 11FROM Temp as t 12WHERE idx = 1 13ORDER BY transaction_id ASC çª—å£å‡½æ•°å’Œå…¬å…±è¡¨è¡¨è¾¾å¼ é¡¹ç›®å‘˜å·¥ III æ‰¾å‡ºæ¯ä¸ªé¡¹ç›® ç»éªŒæœ€ä¸°å¯Œçš„å‘˜å·¥(å¯èƒ½æœ‰å¤šä¸ª)\nç›´æ¥1. åˆ†é¡¹ç›® 2. é¡¹ç›®å†…æŒ‰ç»éªŒç¨‹åº¦è¿›è¡ŒRANK 3. å†ç­›é€‰\n1WITH Temp AS ( 2 SELECT p.project_id, p.employee_id, 3 RANK() OVER ( 4 PARTITION BY p.project_id 5 ORDER BY e.experience_years DESC 6 ) AS idx 7 FROM Project AS p 8 LEFT JOIN Employee as e ON p.employee_id = e.employee_id 9) 10 11 12SELECT project_id, employee_id 13FROM Temp 14WHERE idx = 1 æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“ ä¸»SQL GROUP BY ä¹‹åï¼Œä¸ RANK() çš„æ“ä½œ\n1SELECT 2 customer_id, 3 product_id, 4 COUNT(*) AS order_count, 5 RANK() OVER (ORDER BY COUNT(*) DESC) AS RK 6FROM Orders 7GROUP BY customer_id, product_id; ç»“æœï¼š\næ·»åŠ  PARTITION BY customer_id è¿›è¡Œéš”ç¦»\n1SELECT 2 customer_id, 3 product_id, 4 COUNT(*) AS order_count, 5 RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS RK 6FROM Orders 7GROUP BY customer_id, product_id; ç»“æœï¼š\n=\u0026gt; ç»“è®ºã€‚ 1. å…ˆæ‰§è¡Œä¸»SQLçš„GROUP BYï¼Œè¿›è¡Œåˆ†åŒºï¼Œå†RANK(), RANK()æŒ‰ç…§ ORDER BY(å¿…é¡»èšåˆä¸ºå•è¡Œ)è¿›è¡Œæ’åºï¼Œ åˆ©ç”¨PARTITIONè¿›è¡Œæ’åºéš”ç¦»ã€‚\nç­”æ¡ˆ\n1WITH Temp AS ( 2 SELECT 3 customer_id, 4 product_id, 5 COUNT(*) AS order_count, 6 RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS RK 7 FROM Orders 8 GROUP BY customer_id, product_id 9) 10 11SELECT t.customer_id, t.product_id, p.product_name 12FROM Temp AS t 13LEFT JOIN Products AS p ON t.product_id = p.product_id 14WHERE RK = 1 # æœ€é«˜çš„ NO.1 è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ LEAD(column, offset, defualt) OVER (PARTITION BY \u0026hellip; ORDER BY \u0026hellip;) æ‰¾åé¢çš„è¡Œã€‚å…¶ä¸­LEADè¡¨ç¤ºå¼•é¢†ã€‚\nLAG(\u0026hellip;) æ‰¾å‰é¢çš„è¡Œï¼Œ æ»å\n1SELECT user_id, MAX(DATEDIFF(after_day, visit_date)) AS biggest_window 2FROM ( 3 SELECT user_id, visit_date, 4 LEAD(visit_date, 1, \u0026#39;2021-1-1\u0026#39;) OVER (PARTITION BY user_id ORDER BY visit_date ASC) AS after_day 5 FROM UserVisits AS uv 6) AS t 7GROUP BY user_id è€ƒç‚¹ï¼šè¡Œä¹‹é—´çš„å·®å€¼\nCTE Common Table Expression\nå‘å…¬å¸ CEO æ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº æŸ¥è¯¢æ ‘çŠ¶ç»“æ„èŠ‚ç‚¹ åˆ—è½¬è¡Œ\nä¾æ¬¡æš´åŠ›æšä¸¾\n1SELECT employee_id 2FROM ( 3 SELECT employee_id 4 FROM Employees 5 WHERE manager_id = 1 and employee_id != 1 6 UNION 7 SELECT employee_id 8 FROM Employees 9 WHERE manager_id in ( 10 SELECT employee_id 11 FROM (SELECT employee_id 12 FROM Employees 13 WHERE manager_id = 1 and employee_id != 1) AS e1 14 ) 15 UNION 16 SELECT employee_id 17 FROM Employees 18 WHERE manager_id in ( 19 SELECT employee_id 20 FROM (SELECT employee_id 21 FROM Employees 22 WHERE manager_id in ( 23 SELECT employee_id 24 FROM (SELECT employee_id 25 FROM Employees 26 WHERE manager_id = 1 and employee_id != 1) AS e2 27 )) e3 28 ) 29) AS e å¤ªä½æ•ˆäº†ï¼ï¼ï¼ SBæ“ä½œï¼Œç–¯ç‹‚è¿ç»­æŸ¥è¯¢\nä¼˜åŒ–\n1SELECT employee_id 2FROM ( 3 SELECT employee_id 4 FROM Employees 5 WHERE manager_id = 1 and employee_id != 1 # âœ”ï¸ 6 UNION 7 8 SELECT employee_id 9 FROM Employees 10 WHERE manager_id in ( 11 SELECT employee_id 12 FROM Employees 13 WHERE manager_id = 1 and employee_id != 1 14 ) 15 UNION 16 17 SELECT employee_id 18 FROM Employees 19 WHERE manager_id in ( 20 SELECT employee_id 21 FROM Employees 22 WHERE manager_id in ( 23 SELECT employee_id 24 FROM Employees 25 WHERE manager_id = 1 and employee_id != 1 26 ) 27 ) 28) AS e åˆ©ç”¨è¿æ¥æ¥è®¡ç®—\n1SELECT DISTINCT e4.employee_id 2FROM Employees e1 3LEFT JOIN Employees e2 ON e1.employee_id = e2.manager_id 4LEFT JOIN Employees e3 ON e2.employee_id = e3.manager_id 5LEFT JOIN Employees e4 ON e3.employee_id = e4.manager_id 6WHERE e1.employee_id = 1 and e4.employee_id != 1 11 Boss =\u0026gt; { 2 1 Boss =\u0026gt; { 3 1 Boss =\u0026gt; { 4 1 Boss 5 2 Bob 6 77 Robert 7 } 8 2 Bob =\u0026gt; 4 Daniel 9 77 Robert =\u0026gt; null 10 } 11 2 Bob =\u0026gt; 4 Daniel =\u0026gt; null 12 77 Robert =\u0026gt; null =\u0026gt; null 13} å¯»æ‰¾è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸä½ç½® æ€è·¯ï¼š\n1data: 1,2,3,7,8,10 2idx : 1,2,3,4,5, 6 3diff: 0,0,0,3,3, 4 \u0026lt;= GROUP BY diff =\u0026gt; MIN(idx) AS Start_ID, MAX(idx) AS End_ID 1WITH Temp AS ( 2 SELECT log_id, 3 ROW_NUMBER() OVER (ORDER BY log_id ASC) AS idx 4 FROM Logs 5) 6 7SELECT MIN(log_id) AS start_id, MAX(log_id) AS end_id 8FROM ( 9 SELECT log_id, (log_id-idx ) AS diff 10 FROM Temp 11) AS t 12GROUP BY diff æŸ¥æ‰¾å¤„äºæˆç»©ä¸­æ¸¸çš„å­¦ç”Ÿ å‚åŠ çš„è€ƒè¯•ï¼Œæ²¡æœ‰ä¸€ç§‘æ˜¯æœ€é«˜åˆ†æˆ–è€…æœ€ä½åˆ†ã€‚ç§‘ç§‘ä¸­ç­‰\né€»è¾‘ï¼š 1. åˆ¤æ–­æ¯ä¸€ç§‘ï¼Œå†ç»Ÿè®¡æ‰€æœ‰ç§‘ç›®\n1WITH MAXMIN AS ( 2 SELECT exam_id, MIN(score) min_score, MAX(score) max_score 3 FROM Exam 4 GROUP BY exam_id 5) 6 7 8SELECT s.student_id, s.student_name 9FROM ( 10 SELECT e.exam_id, e.student_id, 11 CASE 12 WHEN score != min_score and score != max_score THEN 1 13 ELSE 0 14 END AS is_medium 15 FROM Exam AS e 16 LEFT JOIN MAXMIN m ON e.exam_id = m.exam_id 17) AS t 18LEFT JOIN Student AS s ON t.student_id = s.student_id 19GROUP BY t.student_id 20HAVING SUM(t.is_medium) = COUNT(t.is_medium) 21ORDER BY student_id ASC åè¿‡æ¥ï¼š å°†å°–å­ç”Ÿå’Œå«åº•ç”Ÿæ’é™¤åœ¨å¤–å³å¯\nå¯»æ‰¾æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¯¹ 1with recursive all_subtask(task_id, subtask_id) as ( 2 SELECT task_id, subtasks_count 3\tFROM Tasks 4 UNION ALL 5\t6 SELECT task_id, subtask_id-1 7\tFROM all_subtask 8\twhere subtask_id-1 \u0026gt; 0 9) 10 11 12SELECT task_id, subtask_id 13From all_subtask 14WHERE (task_id, subtask_id) not in (SELECT task_id, subtask_id FROM Executed) 1with recursive TableName(param1, param2) AS ( 2\tSELECT param1, param2 // åŸºç¡€ç»“æœ 3\tFROM BaseTable 4 UNION ALL 5 // ä¸‹é¢å¼å­ä¼šè¢«é‡å¤é€’å½’ 6 SELECT param1, param2-1 // æ–°çš„ç»“æœ 7 FROM TableName // ä¸Šä¸€è½®çš„ç»“æœ 8 where param2-1 \u0026gt; 0 // é€’å½’ç»ˆæ­¢æ¡ä»¶ 9) ","permalink":"http://longcoding.top/posts/leetcode/leetcode_sql/","summary":"\u003ch2 id=\"é«˜é¢‘sql50é¢˜\"\u003eé«˜é¢‘SQL50é¢˜\u003c/h2\u003e\n\u003ch3 id=\"æŸ¥è¯¢\"\u003eæŸ¥è¯¢\u003c/h3\u003e\n\u003ch4 id=\"wheregroupbyhaving\"\u003eWhere\u0026amp;GroupBy\u0026amp;HAVING\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-mysql\" data-lang=\"mysql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003erevenue\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c1\"\u003e# æŸä¸ªç”¨æˆ·2021å¹´å¯èƒ½æœ‰å¤šé¡¹è®°å½•\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eusers\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eWhere\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kt\"\u003eyear\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e2021\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nf\"\u003eSUM\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erevenue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eusers\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eWhere\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kt\"\u003eyear\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e2021\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c1\"\u003e# 1. å…ˆç­›é€‰å‡ºæ­¤å¹´ä»½æ‰€æœ‰è®°å½•\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eGroup\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eBy\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"c1\"\u003e# 2. å†æ ¹æ®idåˆ†ç»„ 3. å¿…é¡»ç»“åˆSUM() æˆ–è€…å…¶ä»–èšåˆå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªæœ‰å¤šåˆ—ï¼Œéœ€è¦å¤„ç†ä¸ºå•å€¼ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eusers\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e12\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eWhere\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kt\"\u003eyear\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e2021\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"c1\"\u003e# 1. å…ˆç­›é€‰è®°å½•\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e13\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eGroup\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eBy\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e                \u003c/span\u003e\u003cspan class=\"c1\"\u003e# 2. åˆ†ç»„\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e14\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eHAVING\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nf\"\u003eSUM\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erevenue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c1\"\u003e#  3. èšåˆåˆ†ç»„å­—æ®µè®°å½• å¹¶ åˆ¤æ–­\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"æŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢\"\u003eæŸ¥æ‰¾æ²¡ä¹°è¿‡ä¸œè¥¿çš„é¡¾å®¢\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-mysql\" data-lang=\"mysql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 1. NOT EXISTS\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eCustomers\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eCustomers\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eNOT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003ecustomerId\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eOrders\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eWhere\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecustomerId\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cimg src=\"http://sthda9dn6.hd-bkt.clouddn.com/FlT4eqfOPSYMmcNCB5mh_bpamx5B\" alt=\"Image\" style=\"float:left; margin-right: 10px;\" /\u003e\r\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-mysql\" data-lang=\"mysql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 2. Left Join \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# example\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eoid\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecustomers\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eorders\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eon\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecustomerId\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eCustomers\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecustomers\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eorders\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eAS\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eon\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecustomerId\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eis\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"no\"\u003eNULL\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"è®¡ç®—ç‰¹æ®Šå¥–é‡‘\"\u003e\u003ca href=\"https://leetcode.cn/problems/calculate-special-bonus/\"\u003eè®¡ç®—ç‰¹æ®Šå¥–é‡‘\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ \u003cstrong\u003eå¥‡æ•°\u003c/strong\u003e å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ \u003ccode\u003e'M'\u003c/code\u003e \u003cstrong\u003eå¼€å¤´\u003c/strong\u003eï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ \u003ccode\u003e100%\u003c/code\u003e ï¼Œå¦åˆ™å¥–é‡‘ä¸º \u003ccode\u003e0\u003c/code\u003e ã€‚\u003c/p\u003e","title":"é«˜é¢‘SQL50é¢˜åˆ·é¢˜ç¬”è®°"},{"content":"minGPT author: karpathy Andrej\nwork flow\n1String: [\u0026#39;X1\u0026#39;, \u0026#39;X2\u0026#39;, ..., \u0026#39;Xn\u0026#39;] =[dictionary]=\u0026gt; [k1, k2, ..., kn] # word2index 2 3# Train: 4X = [X1, X2, X3, Y1, Y2], Y = [-1, -1, Y1, Y2, Y3] 5Model = {(WordEmbed+PosEmbed) =\u0026gt; (CausalSelfAttention+FFN)xN =\u0026gt; (ClassHead)} 6# attn = A B C 7# A âˆš Ã— Ã— uni-directional 8# B âˆš âˆš Ã— 9# C âˆš âˆš âˆš 10 11Z = Model(X) =\u0026gt; [Z1, Z2, Z3, Z4, Z5] 12Y = [-1, -1, Y1, Y2, Y3] 13# Equal to Parallel Train 14(X1,X2,X3) =predict=\u0026gt; Y1 15(X1,X2,X3,Y1) =predict=\u0026gt; Y2 16(X1,X2,X3,Y1,Y2) =predict=\u0026gt; Y3 17 18loss = crossentropy(Z, Y, ignore=-1) # Zi =\u0026gt; {P1,...,Pclass} multi-class task 19 20# Test: Serial generation 21give inp = [X1, X2, X3] 22Step 1: 23 Z = Model(inp) = [Z1,Z2,Z3] 24 Y = [-1,-1,Y1] 25 inp = inp + Y[-1] = [Z1,Z2,Z3,Y1] 26Step 2: 27 Z = Model(inp) = [Z1,Z2,Z3,Z4] 28 Y = [-1,-1,-1,Y2] 29 inp = inp + Y[-1] = [Z1,Z2,Z3,Y1,Y2] 30Step 3: 31 Z = Model(inp) = [Z1,Z2,Z3,Z4,Z5] 32 Y = [-1,-1,-1,-1,Y3] 33 inp = inp + Y[-1] = [Z1,Z2,Z3,Y1,Y2,Y3] 34 35out: [Z1,Z2,Z3,Y1,Y2,Y3] minBert work flow\npre-trainning\n1# Data preparation 2data = [{\u0026#34;S1\u0026#34;, \u0026#34;S2\u0026#34;, ..., \u0026#34;Sn\u0026#34;}, [{k1, k2, ..., kn}, 3 {\u0026#34;S1\u0026#34;, \u0026#34;S2\u0026#34;, ..., \u0026#34;Sn\u0026#34;}, =vocabulary=\u0026gt; [{k1, k2, ..., kn}, 4 {\u0026#34;S1\u0026#34;, \u0026#34;S2\u0026#34;, ..., \u0026#34;Sn\u0026#34;}] [{k1, k2, ..., kn}, 5 6# Mask-Word \u0026amp; Predict isNext 7while positive != batch_size / 2 or negative != batch_size / 2: # isNext,notIsNext sample number is equality 8\trandom-sentence-A, random-sentence-B =\u0026gt; tokens_a, tokens_b 9 input_ids = [word_dict[\u0026#39;CLS\u0026#39;]] + tokens_a + [word_dict[\u0026#39;SEP\u0026#39;]] + tokens_b + [word_dict[\u0026#39;SEP\u0026#39;]] 10 seg_ids = [0] * (1 + len(tokens_a) + 1) + [1] * (len(tokens_b) + 1) 11 12 # fixed input length =\u0026gt; padding [\u0026#39;Pad\u0026#39;] 13 input_ids extend [word_dict[\u0026#39;Pad\u0026#39;]] * num_pad 14 seg_ids extend [0] * num_pad 15 16 =\u0026gt; masked_pos, masked_tokens 17 =\u0026gt; isNext 18=\u0026gt; [{input_ids,seg_ids,masked_pos,masked_tokens,isNext}, 19 {...}...] 20 21attn_pad_mask = [0,..,0,1,..,1] 22 23Bert = {(Token_embed+Pos_embed+Seg_embed) =\u0026gt; {MHSA[attn_pad_mask]=\u0026gt;FFN}xN 24 =\u0026gt; {head1(dim_token-\u0026gt;2)-o1:isNext, head2(dim_token-\u0026gt;vocab_len)-o2:predict_masked_word}} 25# attn = A B P P-\u0026gt;Padding 26# A âˆš âˆš Ã— bi-directional 27# B âˆš âˆš Ã— 28# P âˆš âˆš Ã— 29 30loss1 = CrossEntropyLoss(o1,isNext) 31loss2 = CrossEntropyLoss(o2,masked_tokens) fine-tuning\ninput: [CLS] + Token-A + [SEP], get [CLS] # å•ç‹¬ input: [CLS] + Token-A + [SEP] + Token-B + [SEP], get =\u0026gt; [SEP] + Token-B + [SEP] # å…³è”å…³ç³» minUnet work flow\n1# Model U-shape feature-flow 2input =\u0026gt; [Enc1] =\u0026gt; [Dec6] =\u0026gt; output # Pixel-Level semantic token =\u0026gt; binary classification 3 [Enc2] =\u0026gt; [Dec5] 4 [Enc3] =\u0026gt; [Dec4] 1# Training: 2for data in dataloader: 3 inp, mask = data 4 oup = model(inp) 5 6 loss = BCELoss(oup, inp) 7 ... minYolo 1X:(1,3,H,W) =\u0026gt; Model =\u0026gt; Y:(K,K,B*5+C) 2 3[k1,k2,k3] 4[k4,k5,k6] =\u0026gt; [X,Y,W,H,Confidence,C1,...,Cn] 5[k7,k8,k9] 6 7# Inference (x, y) (w, h) confidence prob-class[0,...,79]{80-category} 8# Step 1 9conf_mask = (prediction[:, :, 4] \u0026gt; confidence).float().unsqueeze(2) # æ ¹æ®confidenceåˆ¤æ–­è¯¥é”šæ¡†æ˜¯å¦å­˜åœ¨å¯¹è±¡ 10prediction = prediction * conf_mask 11# Step 2 12# å¤„ç†x,y,w,h =\u0026gt; (x1,y1,x2,y2) 13 14# è‹¥B\u0026gt;1: =\u0026gt; é‡å¡‘ä¸º (KK+N,5+C) 15 16# æ•´ç†æˆ [X1,Y1,X2,Y2,idx_class,class_score] \u0026lt;= å­˜åœ¨å¯¹è±¡ 17 18# è¿›è¡ŒNMSéæå¤§å€¼æŠ‘åˆ¶ 19for img : per_img: 20 # æ ¹æ® class_score æ’åº 21 # è®¡ç®—å½“å‰é¢„æµ‹æ¡†ä¸åç»­é¢„æµ‹æ¡†çš„IoU 22 # æ ¹æ® iou ? nms_conf è¿›è¡Œå»é™¤å†—ä½™çš„æ¡† 23 24é”šæ¡†æ•°æ®ï¼š[X1,Y1,X2,Y2,idx_class,class_score] 25 26 27# Inference 28label: [[idx_class,x,y,w,h],[...]] =\u0026gt; [[X,Y,W,H,Confidence,C1,...,Cn],[...]] 29# Yolo-v1: å°†é”šæ¡†å‡åŒ€çš„ç­‰åˆ†ä¸º7Ã—7çš„Cell 30 31X:(1,3,H,W) =\u0026gt; Model =\u0026gt; P:(K,K,5+C) Y:(K,K,5+C) 32 33# Loss 34åˆ†ä¸‰æ­¥ï¼š 351. é”šæ¡†Loss : x,y and w,h 362. Confidence-Loss: obj and noobj 373. class-loss: Ci 38 39# å…·ä½“åšæ³•å°±æ˜¯ 401. æŒ‰ç…§Confidence\u0026gt;0.5 =\u0026gt; æ˜¯å¦å­˜åœ¨å¯¹è±¡ 412. æ”¶é›†æ‰€éœ€è¦çš„Cell =\u0026gt; åˆ†åˆ«è®¡ç®—Loss ","permalink":"http://longcoding.top/posts/learning/minibaseline_learning/","summary":"\u003ch3 id=\"mingpt\"\u003eminGPT\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003eauthor: karpathy Andrej\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ework flow\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;X1\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;X2\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Xn\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003edictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ek2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekn\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# word2index\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Train:    \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eX1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eX2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eX3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eModel\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{(\u003c/span\u003e\u003cspan class=\"n\"\u003eWordEmbed\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ePosEmbed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCausalSelfAttention\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003eFFN\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003exN\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eClassHead\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#  attn =   A B C\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#         A âˆš Ã— Ã—       uni-directional\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#         B âˆš âˆš Ã—  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#         C âˆš âˆš âˆš\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eZ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eModel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eZ1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZ2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZ3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZ4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZ5\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e12\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eY\u003c/span\u003e             \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e13\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Equal to        Parallel Train\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e14\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eX1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eX2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eX3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003epredict\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eY1\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e15\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eX1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eX2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eX3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003epredict\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eY2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e16\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eX1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eX2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eX3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003epredict\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eY3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e17\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e18\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eloss\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecrossentropy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eZ\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eignore\u003c/span\u003e\u003cspan class=\"o\"\u003e=-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# Zi =\u0026gt; {P1,...,Pclass} multi-class task\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e19\u003c/span\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e20\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Test:  Serial generation\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e21\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003egive\u003c/span\u003e \u003cspan class=\"n\"\u003einp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eX1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eX2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eX3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e22\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eStep\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e23\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eZ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eModel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eZ1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e24\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eY\u003c/span\u003e              \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e25\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003einp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einp\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eZ1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e26\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eStep\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e27\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eZ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eModel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eZ1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e28\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eY\u003c/span\u003e              \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e29\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003einp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einp\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eZ1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e30\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eStep\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e31\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eZ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eModel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eZ1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ5\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e32\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eY\u003c/span\u003e              \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e33\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003einp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einp\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eZ1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e34\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e35\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eZ1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eZ3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eY3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003ch3 id=\"minbert\"\u003eminBert\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003ework flow\u003c/strong\u003e\u003c/p\u003e","title":"DLåŸºå‡†æ¨¡å‹è®­ç»ƒä¼ªä»£ç "},{"content":"çƒ­é¢˜100 å“ˆå¸Œ 1. ä¸¤æ•°ä¹‹å’Œ ç»™å®šï¼š æ•°ç»„nums å’Œtarget\nè¦æ±‚ï¼šæ‰¾å‡ºä¸¤å…ƒç´ ä¹‹å’Œä¸ºtargetçš„æ•°ç»„ä¸‹æ ‡\næš´åŠ›ï¼š\n1for i in range(len(nums)): 2 for j in range(i+1, len(nums)): 3 if ... 4# O(n^2) é¢˜è§£ï¼š\né—®é¢˜åˆ†è§£ =\u0026gt; ç»™å®šx å¯»æ‰¾ target-x(è¿™æ˜¯å¤æ‚åº¦çš„ä¸»è¦éƒ¨åˆ†)\nç”¨é¢å¤–ç»“æ„è®°å½•\n1hashtable = dict() 2for i in range(len(nums)): 3 if nums[i] in hashtable: 4 return [i, hashtable[nums[i]]] 5 else: 6 hashtable[nums[i]] = i 7# ä¿å­˜éå†è¿‡çš„å…ƒç´ ï¼Œå‚è€ƒè¿‡å» 49. å­—æ¯å¼‚ä½è¯åˆ†ç»„ è¾“å…¥: strs = [\u0026#34;eat\u0026#34;, \u0026#34;tea\u0026#34;, \u0026#34;tan\u0026#34;, \u0026#34;ate\u0026#34;, \u0026#34;nat\u0026#34;, \u0026#34;bat\u0026#34;]\rè¾“å‡º: [[\u0026#34;bat\u0026#34;],[\u0026#34;nat\u0026#34;,\u0026#34;tan\u0026#34;],[\u0026#34;ate\u0026#34;,\u0026#34;eat\u0026#34;,\u0026#34;tea\u0026#34;]] æ€è·¯ï¼šcondition =\u0026gt; [\u0026hellip;]\nHashTable, Key=æ’åºåçš„Str, Value=List\u0026lt;String\u0026gt;\n1HashMap\u0026lt;String, List\u0026lt;String\u0026gt;\u0026gt; hashTable = new HashMap\u0026lt;\u0026gt;(); 2for(String str : strs){ 3 char[] charArray = str.toCharArray(); // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„ 4 Arrays.sort(charArray); // å¯¹å­—ç¬¦æ•°ç»„è¿›è¡Œæ’åº 5 String orderStr = new String(charArray); 6 if (hashTable.containsKey(orderStr)) { 7 hashTable.get(orderStr).add(str); 8 }else { 9 hashTable.put(orderStr, new ArrayList\u0026lt;\u0026gt;()); 10 hashTable.get(orderStr).add(str); 11 } 12} 13 14List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; res = new ArrayList\u0026lt;\u0026gt;(); 15 16for (Map.Entry\u0026lt;String, List\u0026lt;String\u0026gt;\u0026gt; entry : hashTable.entrySet()) { 17 res.add(entry.getValue()); 18} 19return res; 128. æœ€é•¿è¿ç»­åºåˆ— 1HashSet\u0026lt;Integer\u0026gt; hashSet = new HashSet\u0026lt;\u0026gt;(); 2// å»é‡å¤ï¼Œå¹¶ä¸”æŸ¥è¯¢O(1) 3for (int num : nums) { 4 hashSet.add(num); 5} 6 7List\u0026lt;Integer\u0026gt; start_nums = new ArrayList\u0026lt;\u0026gt;(); 8 9// æ‰¾æ‰€æœ‰ä¸ºèµ·ç‚¹çš„æ•° 10for (Iterator\u0026lt;Integer\u0026gt; it = hashSet.iterator(); it.hasNext(); ) { 11 int num = it.next(); 12 if (!hashSet.contains(num-1)){ 13 start_nums.add(num); 14 } 15} 16 17// éå†èµ·ç‚¹x, éå† x+1, x+2, ... 18int longest_length = 0; 19for(int start : start_nums){ 20 int current_length = 1; 21 int start_i = start; 22 while (hashSet.contains(start_i+1)) { 23 current_length += 1; 24 start_i += 1; 25 } 26 if (current_length \u0026gt; longest_length){ 27 longest_length = current_length; 28 } 29} 30return longest_length; 31} åŒæŒ‡é’ˆ 283. ç§»åŠ¨é›¶ ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ 0 ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåº(åŸå§‹æ•°ç»„ä½ç½®ï¼Œéä¸æ˜¯é‡æ–°æ’åº)ã€‚\nè¯·æ³¨æ„ ï¼Œå¿…é¡»åœ¨ä¸å¤åˆ¶æ•°ç»„çš„æƒ…å†µä¸‹åŸåœ°å¯¹æ•°ç»„è¿›è¡Œæ“ä½œã€‚\n1if (nums.length == 1){ 2 return; 3} 4int i = 0; 5int j = 1; 6for (;j\u0026lt;nums.length;j++) { 7 if (nums[i] == 0 \u0026amp;\u0026amp; nums[j] != 0){ 8 nums[i] = nums[j]; 9 nums[j] = 0; 10 } 11 while (i\u0026lt;=j) { 12 if (nums[i] != 0) { 13 i+=1; 14 } else { 15 break; 16 } 17 } 18} 19for (;i\u0026lt;nums.length;i++) { 20 nums[i] = 0; 21} 11. ç››æœ€å¤šæ°´çš„å®¹å™¨ ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ height ã€‚æœ‰ n æ¡å‚çº¿ï¼Œç¬¬ i æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯ (i, 0) å’Œ (i, height[i]) ã€‚\næ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚\nè¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚\n**è¯´æ˜ï¼š**ä½ ä¸èƒ½å€¾æ–œå®¹å™¨ã€‚\n1// å·¦å³åŒæŒ‡é’ˆï¼Œarea = h * w, hé™åˆ¶äºæœ€çŸ®çš„è¾¹ \u0026lt;= æ¼æ°´ 2int i = 0; 3int j = height.length - 1; 4int max = 0; 5while (i \u0026lt; j) { 6 int h = 0; 7 if (height[i] \u0026lt; height[j]) { 8 h = height[i]; 9 } else { 10 h = height[j]; 11 } 12 int area = h * (j - i); 13 if (area \u0026gt; max) { 14 max = area; 15 } 16 if (height[i] \u0026lt; height[j]) { 17 i += 1; 18 } else { 19 j -= 1; 20 } 21} 22return max; 15. ä¸‰æ•°ä¹‹å’Œ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ [nums[i], nums[j], nums[k]] æ»¡è¶³ i != jã€i != k ä¸” j != k ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ nums[i] + nums[j] + nums[k] == 0 ã€‚è¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚\nâ­ åˆ†æï¼š\nå…ˆæ’åºï¼Œé€’å¢\nå›ºå®ša =\u0026gt; éå†b åˆ™ c = - a - b\n1 a 2[-4,-1,-1,0,1,2] 3 b c 4// è‹¥bå‘å³ï¼Œåˆ™cå‘å·¦ï¼Œå› ä¸º c = - a - bï¼Œä¸”numsé€’å¢, bå¢å¤§ =\u0026gt; cå‡å° 5 6// e.g. 7 a a 8[-3,-1,0,1,2,3,4,5] =\u0026gt; [-3,-1,0,1,2,3,4,5] 9 b c âœ”ï¸ b c||| 10cä¸æ¯”ä»æœ€å³ä¾§å¼€å§‹ 1. 1// å›ºå®ša, b =\u0026gt; c !!! ç”±äº nums[b]\u0026lt;=nums[c] å¹¶ä¸”numsé€’å¢ cä¸æ¯”æ¯æ¬¡ä»æœ«å°¾å¼€å§‹ï¼Œå› ä¸ºbå‘å³ï¼Œåˆ™cå‘å·¦ã€‚ 2Arrays.sort(nums); 3ArrayList\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; res = new ArrayList\u0026lt;\u0026gt;(); 4for (int a=0; a\u0026lt;nums.length-2; a++) { 5 if (a-1\u0026gt;=0 \u0026amp;\u0026amp; nums[a-1] == nums[a]) { 6 continue; 7 } 8 if (nums[a] \u0026gt; 0){ 9 break; 10 } 11 // æœ€å³ä¾§ 12 int c = nums.length-1; 13 for (int b=a+1; b\u0026lt;nums.length-1; b++) { 14 if (b-1\u0026gt;a \u0026amp;\u0026amp; nums[b] == nums[b-1]) { 15 // b+=1; 16 continue; 17 } 18 int target = -nums[a] - nums[b]; 19 20 while (b \u0026lt; c \u0026amp;\u0026amp; target \u0026lt;= nums[c]) { 21 if (nums[a] + nums[b] + nums[c] == 0) { 22 List\u0026lt;Integer\u0026gt; temp = new ArrayList\u0026lt;\u0026gt;(); 23 temp.add(nums[a]); 24 temp.add(nums[b]); 25 temp.add(nums[c]); 26 res.add(temp); 27 break; 28 } 29 c -= 1; 30 } 31 } 32} 33return res; 42. æ¥é›¨æ°´ å±€éƒ¨åŒ– =\u0026gt; æ¯ä¸ªå•ä½çš„å‚¨æ°´é‡\næš´åŠ› |_| æŸ¥æ¯ä¸ªå•ä½çš„å·¦å³æœ€å¤§è¾¹ï¼Œçœ‹çœ‹è¿™ä¸ªåœ°æ–¹æ˜¯å¦æœ‰å­˜æ°´çš„èµ„æ ¼ 1// æš´åŠ› =\u0026gt; åˆ†è§£ä¸ºå±€éƒ¨æŸå°å—[å•ä½é•¿åº¦]èšæ°´é‡ 2if (height.length \u0026lt; 3) 3 return 0; 4int ans = 0; 5for (int i=1; i\u0026lt;height.length-1; i++) { 6 int max_left = 0; 7 // å·¦ä¾§æœ€å¤§å€¼ 8 for (int left=0; left\u0026lt;i; left++) { 9 if (max_left \u0026lt; height[left]) 10 max_left = height[left]; 11 } 12 if (max_left \u0026lt; height[i]) { 13 continue; 14 } 15 int max_right = 0; 16 // å³ä¾§æœ€å¤§å€¼ 17 for (int right=height.length-1; right\u0026gt;i; right--) { 18 if (max_right \u0026lt; height[right]) 19 max_right = height[right]; 20 } 21 if (max_left\u0026gt;height[i] \u0026amp;\u0026amp; max_right\u0026gt;height[i]){ 22 ans += Math.min(max_left, max_right) - height[i]; 23 } 24} 25return ans; é¢„å…ˆè®¡ç®—ï¼Œé¿å…é‡å¤ã€‚ é¢„å…ˆæŠŠæ¯ä¸ªä½ç½®çš„å·¦å³æœ€å¤§é«˜è®¡ç®—å‡ºæ¥ï¼Œç›´æ¥åˆ¤æ–­æ˜¯å¦è¢«ä¸¤é«˜è¾¹å¤¹ä½ =\u0026gt; èƒ½å­˜æ°´\n1if (height.length \u0026lt; 3) 2 return 0; 3// é¢„å…ˆå­˜å‚¨æ¯ä¸ªä½ç½®çš„å·¦å³æœ€å¤§é«˜ï¼Œåˆ¤æ–­è¯¥ä½ç½®æ˜¯å¦èƒ½è“„æ°´ 4int[] per_pos_left_max = new int[height.length]; 5per_pos_left_max[0] = 0; 6int[] per_pos_right_max = new int[height.length]; 7per_pos_right_max[height.length-1] = 0; 8 9for (int i=1; i\u0026lt;height.length; i++) { 10 per_pos_left_max[i] = Math.max(per_pos_left_max[i-1], height[i-1]); 11} 12for (int i=height.length-2; i \u0026gt;= 0; i--) { 13 per_pos_right_max[i] = Math.max(per_pos_right_max[i+1], height[i+1]); 14} 15int ans = 0; 16for (int i=0; i\u0026lt;height.length; i++) { 17 int min = Math.min(per_pos_left_max[i], per_pos_right_max[i]); 18 if (min \u0026gt; height[i]) 19 ans += min - height[i]; 20} 21 22return ans; æ»‘åŠ¨çª—å£ 3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² æ»‘åŠ¨çª—å£ =\u0026gt; a[???bca]bcbb =\u0026gt; a???b[cab]cbb\nå·¦è¾¹ç•Œç›´æ¥æ»‘åŠ¨çª—å£å†…ç¬¬ä¸€ä¸ªé‡å¤ä½ç½®çš„å³ä¾§ã€å·¦è¾¹ç•Œå³æ»‘ä¸€å¤§æ­¥ã€‘\n1char[] chars = s.toCharArray(); 2HashSet\u0026lt;Character\u0026gt; hashSet = new HashSet\u0026lt;\u0026gt;(); 3int res = 0; 4for(int left=0, right=0; right\u0026lt;s.length(); right++) { 5 char ch = chars[right]; 6 7 while(hashSet.contains(ch)) { 8 hashSet.remove(chars[left]); 9 left+=1; 10 } 11 12 hashSet.add(ch); 13 res = Math.max(res, right - left + 1); 14} 15 16return res; 438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ æè¿°ï¼š ç»™å®šs,å’Œç›®æ ‡pï¼Œæ‰¾å‡ºåœ¨sä¸­æ‰€æœ‰ç”±péšæœºç»„åˆçš„å­—ä¸²èµ·ç‚¹\næ€è·¯ï¼š\nã€æš´åŠ›ã€‘éå†æ•°ç»„sï¼Œæ¯ä¸ªå…ƒç´ ä½œä¸ºèµ·å§‹ç‚¹ï¼ŒsortStr([start, start+target.length()-1]).equals(sortStr(target)) ã€æ»‘åŠ¨çª—å£ã€‘ DNAè½¬å½•ï¼Ÿ 1ï¸âƒ£ è¿˜æ˜¯éå†æ•´ä¸ªsæ•°ç»„ 2ï¸âƒ£ æ¯”è¾ƒæ–¹æ³•å˜ä¸º å½“å‰çª—å£å…ƒç´ å‡ºç°æ¬¡æ•°çš„è¯é¢‘è¡¨ 1List\u0026lt;Integer\u0026gt; ans = new ArrayList\u0026lt;\u0026gt;(); 2 3// æ„å¤–æƒ…å†µ 4if (s.length() \u0026lt; p.length()) { 5 return ans; 6} 7 8// è¯é¢‘è¡¨ index-value == alpha-count 9int[] sCount = new int[26]; 10int[] pCount = new int[26]; 11for (int i = 0; i \u0026lt; p.length(); i++) { 12 sCount[s.charAt(i) - \u0026#39;a\u0026#39;] += 1; 13 pCount[p.charAt(i) - \u0026#39;a\u0026#39;] += 1; 14} 15// é¦–ä¸ªå¼‚æ„è¯ 16if (Arrays.equals(sCount, pCount)) { 17 ans.add(0); 18} 19 20int left = 0; 21int right = p.length()-1; 22for(int i=0; i\u0026lt;s.length()-p.length(); i++) { 23 // å·¦ä¾§å‡ºç•Œ 24 sCount[s.charAt(left) - \u0026#39;a\u0026#39;] -= 1; 25 left += 1; 26 // å³è¾¹ç•Œæ·»åŠ æ–°å…ƒç´  27 right += 1; 28 sCount[s.charAt(right) - \u0026#39;a\u0026#39;] += 1; 29 30 if (Arrays.equals(sCount, pCount)) { 31 ans.add(left); 32 } 33} 34 35return ans; å­—ä¸² 560. å’Œä¸º K çš„å­æ•°ç»„ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å› è¯¥æ•°ç»„ä¸­å’Œä¸º k çš„å­æ•°ç»„çš„ä¸ªæ•° ã€‚\nå­æ•°ç»„æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„è¿ç»­éç©ºåºåˆ—ã€‚\næ€è·¯ï¼š\nç»Ÿè®¡ä¸ªæ•°è€Œéä½ç½® =\u0026gt; å‰ç¼€å’Œ\n[[???]\u0026mdash;?] åˆ©ç”¨å‰ç¼€å’Œ-å‰ç¼€å’Œçš„å·® ä»£è¡¨ä¹‹å‰çš„å­åˆ—å’Œ\nä¾‹å¦‚ï¼š nums=[[1,2,3,4,5,6],-2,2,6], k=6\nâ€‹ preSum=[0,1,3,6,10,15,21,[19,21],27] , åˆ©ç”¨HashMapå­˜å‚¨å­åˆ—å‰ç¼€å’Œå’Œå…¶æ¬¡æ•°ï¼Œå¦‚æ¬¡æ•°å¤§äº0ï¼Œè¯´æ˜å­åˆ—1ä¸å­åˆ—2å‰ç¼€å’Œç›¸ç­‰=\u0026gt;å®ƒä»¬ä¹‹é—´çš„å’Œä¸º0.\nâ€‹ å½“preSum=27æ—¶ï¼Œæ¬¡æ•°num=6, æœ¬èº«[6]ä¸ºå­åˆ—ï¼Œå¹¶ä¸”[-2,2,6]ä¹Ÿæ˜¯\n1public static int subarraySum(int[] nums, int k) { 2 int count = 0; 3 // preSum -\u0026gt; count 4 HashMap\u0026lt;Integer, Integer\u0026gt; preSum = new HashMap\u0026lt;\u0026gt;(); 5 preSum.put(0, 1); 6 int sum = 0; 7 for (int i = 0; i \u0026lt; nums.length; i++) { 8 sum += nums[i]; 9 if (preSum.containsKey(sum - k)) { 10 count += preSum.get(sum - k); 11 } 12 preSum.put(sum, preSum.getOrDefault(sum, 0) + 1); 13 } 14 15 return count; 16} 239.æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º k çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ k ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚\nè¿”å› æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ ã€‚\næ€è·¯ =\u0026gt;\n?[???]?? ç»´æŠ¤ä¸€ä¸ªæœ€å¤§å †ï¼Œæ¯æ¬¡åˆ é™¤\u0026amp;æ·»åŠ ï¼Œè®°å½•ç»“æœ for(æ•°ç»„)=\u0026gt;{for(çª—å£å¤§å°)=\u0026gt;{æŒ‘é€‰å‡ºæœ€å¤§çš„å…ƒç´ }} \u0026ndash; æš´åŠ›éå† ç»´æŠ¤ä¸€ä¸ªå•è°ƒé˜Ÿåˆ—: [max\u0026hellip;min] æ¯æ¬¡æ»‘åŠ¨çª—å£ å¾ªç¯(å°†å³ä¾§æ–°å…ƒç´ ä¸é˜Ÿåˆ—minæ¯”è¾ƒï¼Œå¤§äº†ï¼Œåˆ™åˆ é™¤Last_Min)ï¼Œç®€å•æ’å…¥æ’åº=\u0026gt; å› ä¸ºåªè¦çª—å£å†…çš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆå°çš„å€¼æ²¡æœ‰å¿…è¦ç»´æŠ¤ï¼Œåˆ äº†è¿˜å‡è½»æ¯”è¾ƒå¼€é”€ã€‚ å°†æœ€å·¦ä¾§çš„å…ƒç´ å‡ºé˜Ÿ 1int n = nums.length; 2int ans_idx = 0; 3int[] ans = new int[n-k+1]; 4 5Deque\u0026lt;Integer\u0026gt; deque = new LinkedList\u0026lt;\u0026gt;(); // å­˜å‚¨ä¸‹æ ‡å°±è¡Œ 6// ç¬¬ä¸€ä¸ªçª—å£ 7for (int i = 0; i \u0026lt; k; i++) { 8 while (!deque.isEmpty() \u0026amp;\u0026amp; nums[i] \u0026gt; nums[deque.peekLast()]) { 9 deque.removeLast(); 10 } 11 deque.offerLast(i); 12} 13 14ans[ans_idx++] = nums[deque.peekFirst()]; 15// å¼€å§‹ç§»åŠ¨ 16for (int i = k; i \u0026lt; n; i++) { 17 while (!deque.isEmpty() \u0026amp;\u0026amp; nums[i] \u0026gt; nums[deque.peekLast()]) { 18 deque.removeLast(); 19 } 20 deque.offerLast(i); 21 22 while (deque.peekFirst() \u0026lt; i-k+1) { 23 deque.removeFirst(); 24 } 25 ans[ans_idx++] = nums[deque.peekFirst()]; 26} 27return ans; [Xå¾…å†™X]76. æœ€å°è¦†ç›–å­ä¸² ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ã€ä¸€ä¸ªå­—ç¬¦ä¸² t ã€‚è¿”å› s ä¸­æ¶µç›– t æ‰€æœ‰å­—ç¬¦çš„æœ€å°å­ä¸²ã€‚å¦‚æœ s ä¸­ä¸å­˜åœ¨æ¶µç›– t æ‰€æœ‰å­—ç¬¦çš„å­ä¸²ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² \u0026quot;\u0026quot; ã€‚ # å”¯ä¸€\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šs = \u0026#34;ADOBECODEBANC\u0026#34;, t = \u0026#34;ABC\u0026#34;\rè¾“å‡ºï¼š\u0026#34;BANC\u0026#34;\rè§£é‡Šï¼šæœ€å°è¦†ç›–å­ä¸² \u0026#34;BANC\u0026#34; åŒ…å«æ¥è‡ªå­—ç¬¦ä¸² t çš„ \u0026#39;A\u0026#39;ã€\u0026#39;B\u0026#39; å’Œ \u0026#39;C\u0026#39;ã€‚ æ‰©å¼ [å³è¾¹ç•Œ]ä¸æ”¶ç¼©[å·¦è¾¹ç•Œ]\n1ï¸âƒ£åˆ©ç”¨HashMapè¿›è¡Œåˆ¤æ–­æ˜¯å¦é‡åˆ\n1public boolean isCovered(Map\u0026lt;Character, Integer\u0026gt; targetMap, Map\u0026lt;Character, Integer\u0026gt; curMap) { 2 Set\u0026lt;Character\u0026gt; keySet = targetMap.keySet(); 3 for (Character key : keySet) { 4 Integer tgt = targetMap.getOrDefault(key, 0); 5 Integer crt = curMap.getOrDefault(key, 0); 6 if (tgt \u0026gt; crt) 7 return false; 8 } 9 return true; 10} 11 12public String minWindow(String s, String t) { 13 Map\u0026lt;Character, Integer\u0026gt; targetMap = new HashMap\u0026lt;\u0026gt;(); 14 Map\u0026lt;Character, Integer\u0026gt; curMap = new HashMap\u0026lt;\u0026gt;(); 15 16 for (int i = 0; i \u0026lt; t.length(); i++) { 17 char c = t.charAt(i); 18 targetMap.put(c, targetMap.getOrDefault(c, 0)+1); 19 } 20 int minLen = Integer.MAX_VALUE; int startLoc = 0; 21 int left = 0, right = 0; 22 for (right = 0; right \u0026lt; s.length(); right++) { 23 char c = s.charAt(right); 24 curMap.put(c, curMap.getOrDefault(c, 0)+1); 25 while (isCovered(targetMap, curMap)) { 26 if (minLen \u0026gt; (right - left)){ 27 minLen = right - left; 28 startLoc = left; 29 } 30 char ch = s.charAt(left); 31 curMap.put(ch, curMap.get(ch)-1); 32 left += 1; 33 } 34 } 35 36 if (minLen \u0026lt; Integer.MAX_VALUE) return s.substring(startLoc, startLoc+minLen+1); 37 else return \u0026#34;\u0026#34;; 38} æ™®é€šæ•°ç»„ 53. æœ€å¤§å­æ•°ç»„å’Œ çº¿æ®µæ ‘åšæ³•\n1// ä¾‹ [-2,4,5,-1][-1,2,3,-4] 2// l:{ 3//\tiSum=6,lSum=7,rSum=8,mSum=9 4// } 5// r:{ 6//\tiSum=0,lSum=4,rSum=1,mSum=5 7// } 8public class Status { 9 public int iSum, lSum, rSum, mSum; 10 11 public Status(int iSum, int lSum, int rSum, int mSum) { 12 this.iSum = iSum; // åŒºé—´æ€»å’Œ 13 this.lSum = lSum; // åŒºé—´ä»å·¦è¾¹ç•Œå¼€å§‹æœ€å¤§å’Œ 14 this.rSum = rSum; // åŒºé—´ä»å³è¾¹ç•Œå¼€å§‹æœ€å¤§å’Œ 15 this.mSum = mSum; // åŒºé—´æœ€å¤§å’Œ 16 } 17} 18 19public Status getMaxSum(int[] nums, int start, int end) { 20 if (start == end) { 21 return new Status(nums[start], nums[start], nums[start], nums[start]); 22 } 23 int mid = (start + end) \u0026gt;\u0026gt; 1; 24 Status l = getMaxSum(nums, start, mid); 25 Status r = getMaxSum(nums, mid+1, end); 26 return popPush(l, r); 27} 28 29// 30public Status pushUp(Status l, Status r) { 31 int iSum = l.iSum + r.iSum; // åŒºé—´æ€»å’Œ 32 // 1. [x?][??] or [xx][x?] 33 int lSum = Math.max(l.lSum, l.iSum+r.lSum); 34 // 2. [??][?x] or [?x][xx] 35 int rSum = Math.max(r.rSum, l.rSum+r.iSum); 36 // 1. [?xx?][???] 2. [???][?xx?] 3. [?xx][xx?] 37 int mSum = Math.max(Math.max(l.mSum, r.mSum), l.rSum+r.lSum); 38 return new Status(iSum,lSum,rSum,mSum); 39} 40 41public int maxSubArray(int[] nums) { 42 return getMaxSum(nums, 0, nums.length-1).mSum; 43} 2ï¸âƒ£ æ¯æ¬¡è®°å½•ç¬¦åˆä¸ªæ•°ï¼Œé¿å… é‡å¤çš„å¯¹ä¸¤å­—ä¸²è¿›è¡Œåˆ¤æ–­å¤åˆå…³ç³»\n1public String minWindow(String s, String t) { 2 Map\u0026lt;Character, Integer\u0026gt; targetMap = new HashMap\u0026lt;\u0026gt;(); 3 Map\u0026lt;Character, Integer\u0026gt; curMap = new HashMap\u0026lt;\u0026gt;(); 4 5 for (int i = 0; i \u0026lt; t.length(); i++) { 6 char c = t.charAt(i); 7 targetMap.put(c, targetMap.getOrDefault(c, 0) + 1); 8 } 9 int minLen = Integer.MAX_VALUE; int startLoc = 0; 10 int curLen = 0; int tgtLen = targetMap.keySet().size(); 11 int left = 0, right; 12 13 for (right = 0; right \u0026lt; s.length(); right++) { 14 char c = s.charAt(right); 15 if (targetMap.containsKey(c)) { 16 curMap.put(c, curMap.getOrDefault(c, 0)+1); 17 if (targetMap.get(c).equals(curMap.get(c))) { 18 curLen += 1; 19 } 20 } 21 while (curLen == tgtLen) { 22 if (minLen \u0026gt; (right-left)){ 23 minLen = right-left; 24 startLoc = left; 25 } 26 char ch = s.charAt(left); 27 if (curMap.containsKey(ch)) { 28 curMap.put(ch, curMap.get(ch)-1); 29 if (curMap.get(ch) \u0026lt; targetMap.get(ch)) 30 curLen -=1; 31 } 32 left += 1; 33 } 34 } 35 36 if (minLen \u0026lt; Integer.MAX_VALUE) return s.substring(startLoc, startLoc+minLen+1); 37 else return \u0026#34;\u0026#34;; 38} 41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•° ç¤ºä¾‹ 1ï¼š\rè¾“å…¥ï¼šnums = [1,2,0]\rè¾“å‡ºï¼š3\rè§£é‡Šï¼šèŒƒå›´ [1,2] ä¸­çš„æ•°å­—éƒ½åœ¨æ•°ç»„ä¸­ã€‚\rç¤ºä¾‹ 2ï¼š\rè¾“å…¥ï¼šnums = [3,4,-1,1]\rè¾“å‡ºï¼š2\rè§£é‡Šï¼š1 åœ¨æ•°ç»„ä¸­ï¼Œä½† 2 æ²¡æœ‰ã€‚\rç¤ºä¾‹ 3ï¼š\rè¾“å…¥ï¼šnums = [7,8,9,11,12]\rè¾“å‡ºï¼š1\rè§£é‡Šï¼šæœ€å°çš„æ­£æ•° 1 æ²¡æœ‰å‡ºç°ã€‚\r### ç¼ºå¤±çš„æœ€å°çš„æ­£æ•´æ•°ï¼Œç»™å®šæ•°ç»„nums, é‚£ä¹ˆç›®æ ‡ä¸€å®šåœ¨[1, N+1]ä¸­ã€‚\rä¾‹å­ 1. [x?????]? =\u0026gt; 1\r2. [???x??]? =\u0026gt;[-1\u0026lt;x, ...]\r3. [??????]x =\u0026gt;N+1 # ç»™å®šçš„æ•°ç»„åˆšå¥½å æ»¡[1-N],é‚£ä¹ˆæœ€å°çš„æ­£æ•´æ•°ä¸ºN+1 æš´åŠ›ï¼š\nå°†æ•°ç»„æ”¾å…¥HashSet(æŸ¥è¯¢æ—¶é—´O(1)=\u0026gt;ç©ºé—´æ¢æ—¶é—´)ä¸­ï¼Œç„¶åæ£€æŸ¥[1-N]æ˜¯å¦åœ¨HashSetä¸­ï¼Œä¸åœ¨è¿”å›iï¼Œå…¨åœ¨è¿”å›N+1ï¼›\næ€è·¯2âœ”ï¸.\næ„å»ºhashMapï¼Œæ˜ å°„æ¡ä»¶ä¸º i=\u0026gt;i+1, ç»™å®šä¸‹æ ‡iï¼Œåˆ™å…ƒç´ å€¼ä¸ºi+1;\nä¾‹ï¼š\rnums = [3,4,-1,1]\r=\u0026gt; i: 0,1, 2,3\r=\u0026gt;nums = [-1,4,3,1] i 0, 1,2,3\r=\u0026gt;nums = [-1,1,3,4] =\u0026gt; [1,-1,3,4] =\u0026gt; i=1å¤„å¼‚å¸¸ =\u0026gt; ans=i+1=2 JAVAè¯­æ³•ï¼š\n1// ä¼ é€’ç»™æ–¹æ³•çš„æ˜¯å¼•ç”¨çš„æ‹·è´ï¼Œè€Œä¸æ˜¯å¼•ç”¨æœ¬èº« 2public void rotate(int[] nums, int k) { 3\tint n = nums.length; 4 int[] ans = new int[n]; 5 // ... 6 nums = ans; //âŒâŒâŒ numsçš„å¼•ç”¨æ˜¯åŸæ•°ç»„å¼•ç”¨çš„æ‹·è´ 7} 8 9ä¾‹ï¼š a -\u0026gt; [???] 10 rotate(a) =\u0026gt; rotate(nums) { 11 // nums-\u0026gt;[???]\u0026lt;-a 12} 13// nums != a çŸ©é˜µ 73. çŸ©é˜µç½®é›¶ 1ä½¿ç”¨é¢å¤–æ ‡è®°æ•°ç»„ col,row æ ‡è¯†æŸåˆ—\\è¡Œæ˜¯å¦å­˜åœ¨0ï¼Œåˆ·æ–°ä¸º0çš„colæˆ–row 2\tcol: 0,1,0 row åˆ¤æ–­ mark col[0][j]==0 || row[i][0]==0 3è¾“å…¥ï¼šmatrix = [[1,1,1], 0 4 [1,0,1], 1 5 [1,1,1]] 0 6é¢å¤–ç©ºé—´=\u0026gt; O(M+N) 7è¾“å‡ºï¼š[[1,0,1], 8 [0,0,0], 9 [1,0,1]] 10 11åˆ©ç”¨ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—å……å½“æ ‡è®°æ•°ç»„ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸¤ä¸ªå˜é‡æ ‡è¯†ç¬¬ä¸€åˆ—è¡Œæ˜¯å¦åˆ·ä¸º0 ç©ºé—´å¤æ‚åº¦O(1) 12 1 1 1 13 è¾“å…¥ï¼šmatrix = 1[0,1] 14 1[1,1] 54. èºæ—‹çŸ©é˜µ 1æ€è·¯ï¼š å®šä¹‰å››ä¸ªè¾¹ç•Œ top,bottm,left,right 2while() { 3 1.for â¡ï¸ å¹¶ä¸”æ›´æ–°è¾¹ç•Œ + åˆ¤æ–­æ˜¯å¦é€€å‡º 4 2.for â¬‡ï¸ 5 3.for â¬…ï¸ 6 4.for â¬†ï¸ 7} 48. æ—‹è½¬å›¾åƒ 11 2 3 4 22 y z 5 33 x k 6 45 6 7 8 5 6åˆ†æ­¥ å…ˆæ—‹è½¬å¤–å›´ å†é€å±‚å¾€å†…è¿›è¡Œæ—‹è½¬ 7x â¡ï¸ x 8â¬†ï¸ â¬‡ï¸ 9x â¬…ï¸ x 1int len = matrix.length; 2int count = len - 2 \u0026gt; 0?len - 2:1; 3for (int i = 0; i \u0026lt; count; i++) { 4 int left=i, top=i, right=len-1-i, bottom=len-1-i; 5 for (int j = i; j \u0026lt; len-i-1; j++) { 6 int temp1, temp2; 7 // 1. matrix[top][left] 8 temp1 = matrix[top][len-1-i]; 9 matrix[top][len-1-i] = matrix[i][left]; 10 11 // 2. matrix[top][right] 12 temp2 = matrix[len-1-i][right]; 13 matrix[len-1-i][right] = temp1; 14 15 // 3. matrix[bottom][right] 16 temp1 = matrix[bottom][i]; 17 matrix[bottom][i] = temp2; 18 19 // 4. matrix[bottom][left] 20 matrix[i][left] = temp1; 21 22 // move 23 left += 1; 24 top += 1; 25 right -= 1; 26 bottom -= 1; 27 } 28} or\n123 147 741\r456 =.T\u0026gt; 258 =filp\u0026gt; 852 789 369 963 240. æœç´¢äºŒç»´çŸ©é˜µ II ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ *m* x *n* çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ target ã€‚è¯¥çŸ©é˜µå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\næ¯è¡Œçš„å…ƒç´ ä»å·¦åˆ°å³å‡åºæ’åˆ—ã€‚ æ¯åˆ—çš„å…ƒç´ ä»ä¸Šåˆ°ä¸‹å‡åºæ’åˆ—ã€‚ æœ‰åº=\u0026gt;äºŒåˆ†æŸ¥æ‰¾O(logn)\nfor int[]row in nums:\rbinarySearch(row) Zå­—æŸ¥è¯¢ \u0026ndash; äºŒåˆ†æŸ¥æ‰¾æ ‘\n1// small\u0026lt;-medium-\u0026gt;large 2[1,4,7,11,{15â­}] small\u0026lt;- medium 3[2,5,8,12,19] â¬‡ 4[3,6,9,16,22] large é“¾è¡¨ â­å¤šæŒ‡é’ˆâ­\n142. ç¯å½¢é“¾è¡¨ II æ‰¾ç¯çš„å…¥å£ =\u0026gt;\n1head =\u0026gt; ç¯å…¥å£ è®°ä¸ºx 2ç¬¬ä¸€æ¬¡ç›¸é‡ç‚¹ =\u0026gt; ç¯å…¥å£ è®°ä¸ºz 3ç¯å…¥å£ =\u0026gt; ç¬¬ä¸€æ¬¡ç›¸é‡ç‚¹ è®°ä¸ºy 4 5å¿«æ…¢æŒ‡é’ˆ 6slow(å•æ­¥)ï¼š x+y 7fast(åŒæ­¥)ï¼š x+y + n(y+z) // å¤šç»•äº†nåœˆ 8 9é€šè¿‡æ­¥æ•°å»ºç«‹ç­‰å¼ 10 112(x+y) = x+y + n(y+z) 12x+y = n(y+z) 13x = n(y+z) - y 14x = (n-1)(y+z) + z # å½“åªç»•ä¸€åœˆç›¸é‡æ—¶ n=1 15x = z 16 17ç¬¬ä¸€æ¬¡ç›¸é‡ç‚¹åˆ°å…¥å£çš„è·ç¦» == èµ·ç‚¹åˆ°å…¥å£çš„è·ç¦» â­â­â­ 1public ListNode detectCycle(ListNode head) { 2 ListNode fast = head; 3 ListNode slow = head; 4 while (fast != null \u0026amp;\u0026amp; fast.next != null) { 5 fast = fast.next.next; 6 slow = slow.next; 7 8 if (fast == slow) { 9 ListNode index1 = head; 10 ListNode index2 = fast; 11 while (index1 != index2) { 12 index1 = index1.next; 13 index2 = index2.next; 14 } 15 16 return index1; 17 } 18 } 19 return null; 20} 160. ç›¸äº¤é“¾è¡¨ ä»»åŠ¡ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªç›¸äº¤ç‚¹\n1// æš´åŠ› 2// for(nodeA: A) 3// for(nodeB: B) =\u0026gt; nodeA?nodeB 4// åˆ©ç”¨ç©ºé—´æ›¿æ¢æ—¶é—´ =\u0026gt; æŸ¥æ‰¾æ—¶é—´åˆ©ç”¨hashSet O(1) 5// All nodeA =\u0026gt; hashSet 6// for(nodeB:B) nodeB?hashSet å¡«å……é•¿åº¦ï¼Œ=\u0026gt; ç›¸ç­‰é•¿åº¦\n1X-?-?-âˆš-âˆš-âˆš 2?-?-?-âˆš-âˆš-âˆš 3åŒæ—¶éå† 4or 5ä»å°¾éƒ¨å¼€å§‹ï¼Ÿ çŸ¥é“ç¬¬ä¸€ä¸ªä¸ç›¸ç­‰çš„Nodeï¼Ÿ äº¤å‰éå†\n1-lenA- 2 -lenC- 3-lenB- 4// A+C+B =\u0026gt; å¾ªç¯å å¯è§†ä¸º B+A+C 5// B+C+A A+B+C 234. å›æ–‡é“¾è¡¨ åˆ¤æ–­å¯¹ç§°\næš´åŠ›ï¼š\nè¯»å‡ºæ¥=\u0026gt; array =\u0026gt; left,right=\u0026gt; è¿›è¡Œåˆ¤æ–­\nâ­ å¿«æ…¢æŒ‡é’ˆ\n1// å¿«æ…¢æŒ‡é’ˆï¼šå¿«ä¸€æ¬¡èµ°ä¸€æ­¥ï¼›æ…¢ä¸€æ¬¡èµ°ä¸¤æ­¥ 2head: 1-2-3-[3-2-1]-null å¶æ•° 3 p q 4head: 1-2-3-4-[3-2-1]-null å¥‡æ•° 5 p q 6 7head - [1-2-3] 8newHead - [1-2-3] // å¤´æ’ï¼Œé€†åº 9åˆ¤æ–­å®Œ 10å¤´æ’å›å»ï¼Œè¿›è¡Œå¤åŸ ç¿»è½¬é“¾è¡¨ å°¾æ’æ³•ï¼šé¡ºåºæ„å»ºé“¾è¡¨ å¤´æ’æ³•ï¼šé€†åºæ„å»ºé“¾è¡¨ å¯ä»¥æ„å»ºç©ºçš„å¤´ç»“ç‚¹ =\u0026gt; æ— éœ€åˆ¤æ–­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è¿˜æ˜¯åç»­èŠ‚ç‚¹\n138. éšæœºé“¾è¡¨çš„å¤åˆ¶ ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ random ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚\næ„é€ è¿™ä¸ªé“¾è¡¨çš„ æ·±æ‹·è´ã€‚ æ·±æ‹·è´åº”è¯¥æ­£å¥½ç”± n ä¸ª å…¨æ–° èŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªæ–°èŠ‚ç‚¹çš„å€¼éƒ½è®¾ä¸ºå…¶å¯¹åº”çš„åŸèŠ‚ç‚¹çš„å€¼ã€‚æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆå’Œ random æŒ‡é’ˆä¹Ÿéƒ½åº”æŒ‡å‘å¤åˆ¶é“¾è¡¨ä¸­çš„æ–°èŠ‚ç‚¹ï¼Œå¹¶ä½¿åŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨ä¸­çš„è¿™äº›æŒ‡é’ˆèƒ½å¤Ÿè¡¨ç¤ºç›¸åŒçš„é“¾è¡¨çŠ¶æ€ã€‚å¤åˆ¶é“¾è¡¨ä¸­çš„æŒ‡é’ˆéƒ½ä¸åº”æŒ‡å‘åŸé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ ã€‚\nâ­åˆ©ç”¨hashï¼Œç©ºé—´æ¢æ—¶é—´â­\næ€è·¯ï¼š\r1. é¡ºåºæ„å»ºæ·±æ‹·è´é“¾è¡¨ï¼Œåˆ©ç”¨hashMap (oldNode) -\u0026gt; (new Node)\r2. å¡«å……random point 146. LRU ç¼“å­˜ è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³ LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜ çº¦æŸçš„æ•°æ®ç»“æ„ã€‚\nå®ç° LRUCache ç±»ï¼š\nLRUCache(int capacity) ä»¥ æ­£æ•´æ•° ä½œä¸ºå®¹é‡ capacity åˆå§‹åŒ– LRU ç¼“å­˜ int get(int key) å¦‚æœå…³é”®å­— key å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› -1 ã€‚ void put(int key, int value) å¦‚æœå…³é”®å­— key å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ value ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„ key-value ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡ capacity ï¼Œåˆ™åº”è¯¥ é€å‡º æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚ å‡½æ•° get å’Œ put å¿…é¡»ä»¥ O(1) çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚\n## åˆ†æ:\nå‡½æ•° get å’Œ put å¿…é¡»ä»¥ O(1) çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œ =\u0026gt; ç›´æ¥å®šä½ è¦ä¹ˆæ•°ç»„è¦ä¹ˆhash æ•°é‡è¶…è¿‡ capacity ï¼Œåˆ™åº”è¯¥ é€å‡º æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­— ## åšæ³•\nhashMap \u0026lt;Key =\u0026gt; ObejectAddress\u0026gt; O(1)å®šä½èƒ½åŠ› è‡ªå®šä¹‰åŒå‘é“¾è¡¨ head(used)\u0026lt;=\u0026gt;tail(not use) 1class LRUCache { 2 class BiLinkedList { 3 int key,val; 4 BiLinkedList prev,next; 5 6 public BiLinkedList() { 7 } 8 9 public BiLinkedList(int key, int val) { 10 this.key = key; 11 this.val = val; 12 } 13 } 14 15 private Map\u0026lt;Integer, BiLinkedList\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); 16 private int capacity; // total 17 private int size; // current 18 private BiLinkedList head, tail; 19 20 public LRUCache(int capacity) { 21 this.capacity = capacity; 22 this.size = 0; 23 head = new BiLinkedList(); 24 tail = new BiLinkedList(); 25 head.next = tail; 26 tail.prev = head; 27 } 28 29 public int get(int key) { 30 // è®¿é—® =\u0026gt; æ”¾è¡¨å¤´ 31 if (map.containsKey(key)) { 32 BiLinkedList node = map.get(key); 33 move2Head(node); 34 return node.val; 35 } else { 36 return -1; 37 } 38 } 39 40 public void put(int key, int value) { 41 // ä¿®æ”¹ =\u0026gt; æ”¾è¡¨å¤´ 42 if (map.containsKey(key)) { 43 map.get(key).val = value; 44 move2Head(map.get(key)); 45 }else { 46 // æ–°å¢ 47 if (size \u0026gt;= capacity) { 48 BiLinkedList node = deleteTail();// map ä¹Ÿéœ€è¦åˆ é™¤å•Š 49 map.remove(node.key); 50 size -= 1; 51 } 52 // æ’å…¥åˆ°è¡¨å¤´ 53 BiLinkedList node = insert2Head(key, value); 54 map.put(key, node); 55 size += 1; 56 } 57 } 58 59 public void move2Head(BiLinkedList node) { 60 node.prev.next = node.next; 61 node.next.prev = node.prev; 62 63 node.next = head.next; 64 node.prev = head; 65 head.next.prev = node; 66 head.next = node; 67 } 68 69 public BiLinkedList deleteTail() { 70 BiLinkedList node = tail.prev; 71 tail.prev.prev.next = tail; 72 tail.prev = tail.prev.prev; 73 return node; 74 } 75 76 public BiLinkedList insert2Head(int key, int value) { 77 BiLinkedList node = new BiLinkedList(key, value); 78 node.next = head.next; 79 node.prev = head; 80 head.next.prev = node; 81 head.next = node; 82 return node; 83 } 84} äºŒå‰æ ‘ ç¿»è½¬äºŒå‰æ ‘ æ€è·¯ï¼š\né€’å½’éå† - è‡ªä¸Šè€Œä¸‹ æ¯æ¬¡éå†æŸä¸ªèŠ‚ç‚¹åï¼Œå°†å…¶å·¦å³å„¿å­æŒ‡é’ˆè°ƒæ¢ å¯¹ç§°äºŒå‰æ ‘ åˆ¤æ–­äºŒå‰æ ‘ä¸­å¿ƒè½´å¯¹ç§°\né€’å½’éå† - è‡ªä¸Šè€Œä¸‹\nåŒæŒ‡é’ˆï¼š\nå·¦å·¦ | å³å³ å·¦å³ | å³å·¦ 1TreeNode q=p=root; 2 3# func start 4eq1 = q.val==p.val 5eq2 = check(q.left, p.right); 6eq3 = check(q.right, p.left); 7 8eq1\u0026amp;\u0026amp;eq2\u0026amp;\u0026amp;eq3 9# func end äºŒå‰æ ‘ç›´å¾„ ä»»æ„ä¸¤ç»“ç‚¹çš„è¾¹æ•°\næ€è·¯ï¼š\nè€ƒè™‘æ¯ä¸ªç»“ç‚¹ä¸ºæ¢çº½ï¼Œå·¦ä¾§è·ç¦»+å³ä¾§è·ç¦»+æœ¬èº«\nåˆ©ç”¨æ·±åº¦\n1 2int deep(TreeNode node, int deep): 3\tif(node == null): 4\treturn 0; 5\tint leftDeep = deep(node.left); 6\tint rightDeep = deep(node.right); 7\tif(...) // ä¿å­˜æœ€å¤§æ·±åº¦ leftDeep+rightDeep+1 8 ... 9 return max(leftDeep, rightDeep) + 1; äºŒå‰æ ‘å±‚åºéå† åˆ©ç”¨é˜Ÿåˆ—\n1queue.add(root) 2while(!queue.isEmpty) { 3 node = queue.poll(); 4 ... 5 6} éªŒè¯äºŒå‰æœç´¢æ ‘ node.left.val \u0026lt; node.val \u0026lt; node.right.val\næ€è·¯ï¼š\n// é€’å½’ =\u0026gt; å½“å‰ç»“ç‚¹ + å·¦å­æ ‘ + å³å­æ ‘\nâ€‹\tè¯¥ç»“ç‚¹å¤§äºå·¦å­æ ‘æœ€å¤§\nâ€‹\tå°äºå³å­æ ‘æœ€å°\n1public boolean isValidBST(TreeNode node, long leftMax, long rightLower) { 2 if (node == null) 3 return true; 4 if (node.val \u0026lt;= leftMax || node.val \u0026gt;= rightLower) 5 return false; 6 7 return isValidBST(node.left, leftMax, node.val) \u0026amp;\u0026amp; isValidBST(node.right, node.val, rightLower); 8 } 230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬ K å°çš„å…ƒç´  æ€è·¯ï¼šäºŒå‰æœç´¢æ ‘\näºŒå‰æœç´¢æ ‘ä¸­åºéå†æ˜¯å‡åºç»“æœ\nä¸­åºéå†\n199. äºŒå‰æ ‘çš„å³è§†å›¾ å…ˆå³å­æ ‘=\u0026gt;å†è®¿é—®æ ¹ç»“ç‚¹ =\u0026gt;å·¦å­æ ‘\n=\u0026gt; ä½¿ç”¨è¾…åŠ©æ•°ç»„æ ‡è®°æ¯å±‚çš„è¾“å‡ºæƒ…å†µ\n114. äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨ æ¯æ¬¡æŠŠå·¦å­æ ‘æ’åœ¨å³å­æ ‘ä¸Šï¼Œè¿›è¡Œé€’å½’\n105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ æ€è·¯ï¼šå‰åºç¬¬ä¸€ä¸ªæ˜¯Root\nâ€‹ æŒ‰ç…§rootæŠŠä¸­åºåˆ†æˆå·¦å­æ ‘ç»“ç‚¹å’Œå³å­æ ‘ç»“ç‚¹\n437. è·¯å¾„æ€»å’Œ III ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œå’Œä¸€ä¸ªæ•´æ•° targetSum ï¼Œæ±‚è¯¥äºŒå‰æ ‘é‡ŒèŠ‚ç‚¹å€¼ä¹‹å’Œç­‰äº targetSum çš„ è·¯å¾„ çš„æ•°ç›®ã€‚\nè·¯å¾„ ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯å‘ä¸‹çš„ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰ã€‚\néå†Treeï¼Œå¹¶ä¸”æœ‰targetå’Œnode.valï¼Œå­˜å‚¨ä¸€ä¸‹preSumï¼Œå¾€ä¸‹æ‰¾target-preSumç»“ç‚¹\n1public int dfs(TreeNode node, long preSum, int targetSum) { 2 int ret = 0; 3 if (node != null) { 4 int val = node.val; 5 if (val+preSum == targetSum) { 6 ret++; 7 } 8 ret += dfs(node.left, val+preSum,targetSum); 9 ret += dfs(node.right, val+preSum,targetSum); 10 return ret; 11 } 12 return ret; 13} 14 15public int pathSum(TreeNode root, int targetSum) { 16 int ans = 0; 17 if (root == null){ 18 return 0; 19 } 20 int val = root.val; 21 ans += dfs(root, 0, targetSum); 22 ans += pathSum(root.left, targetSum); 23 ans += pathSum(root.right, targetSum); 24 return ans; 25} 236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ ä¸‰ç§æƒ…å†µ(å±€éƒ¨åŒ–)ï¼š\npqåˆ†å¸ƒåœ¨å·¦å³å­æ ‘ rootæœ‰ä¸ªæ˜¯q||p, å·¦orå³å­æ ‘å­˜åœ¨å¦ä¸€ä¸ª 1// ä¸‰ç§ 2boolean leftok = find(node.left) 3boolean rightok = find(node.right) 4if (leftok\u0026amp;\u0026amp;rightok)||(node.val==p||node.val==q)\u0026amp;\u0026amp;(leftok||rightok) 1private TreeNode ans = null; 2 3// å¦‚ä½•æ§åˆ¶æœ€è¿‘ç»„å…ˆ =\u0026gt; DFS, ä¼˜å…ˆä»åº•éƒ¨å¼€å§‹æœç´¢ 4// å½“æœ€è¿‘ç»„å…ˆè¢«å‘ç°åï¼Œæ¬¡ä¸€çº§ç»„å…ˆç”±äº(pqå‡åœ¨ä¸€ä¾§)ï¼Œæ•…ä¸æ»¡è¶³ifåˆ¤æ–­ã€‚ 5public boolean dfs(TreeNode root, TreeNode p, TreeNode q) { 6 if (root == null) 7 return false; 8 boolean l = dfs(root.left, p, q); 9 boolean r = dfs(root.right, p, q); 10 if ((l\u0026amp;\u0026amp;r) || ((root == p||root==q)\u0026amp;\u0026amp;(l||r))) 11 ans = root; 12 return l || r || (root==q || root==p); 13} 14 15// æš´åŠ› =\u0026gt; æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ…æ‹¬ä¿©ç›®æ ‡èŠ‚ç‚¹ âŒ æœ€è¿‘ï¼ï¼ï¼ 16public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) { 17 dfs(root, p, q); 18 return ans; 19} 124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ äºŒå‰æ ‘ä¸­çš„ è·¯å¾„ è¢«å®šä¹‰ä¸ºä¸€æ¡èŠ‚ç‚¹åºåˆ—ï¼Œåºåˆ—ä¸­æ¯å¯¹ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´éƒ½å­˜åœ¨ä¸€æ¡è¾¹ã€‚åŒä¸€ä¸ªèŠ‚ç‚¹åœ¨ä¸€æ¡è·¯å¾„åºåˆ—ä¸­ è‡³å¤šå‡ºç°ä¸€æ¬¡ ã€‚è¯¥è·¯å¾„ è‡³å°‘åŒ…å«ä¸€ä¸ª èŠ‚ç‚¹ï¼Œä¸”ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ã€‚\nè·¯å¾„å’Œ æ˜¯è·¯å¾„ä¸­å„èŠ‚ç‚¹å€¼çš„æ€»å’Œã€‚\nç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›å…¶ æœ€å¤§è·¯å¾„å’Œ ã€‚\nè€ƒè™‘æ¢çº½ç»“ç‚¹ä¸ºä¸­å¿ƒï¼Œä¸¤ä¾§å­æ ‘çš„æ­£å‘è´¡çŒ® 1int dfs(TreeNode node) { 2 if (node == null) 3 return 0; 4\tint lv = max(dfs(node.left), 0); 5 int rv = max(dfs(node.right), 0); 6 if(lv+r+rv \u0026gt; ans) 7 // save 8 return max(lv+r, rv+r); 9} å›¾è®º 200. å²›å±¿æ•°é‡ ç»™ä½ ä¸€ä¸ªç”± '1'ï¼ˆé™†åœ°ï¼‰å’Œ '0'ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚\nå²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚\næ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚\nè€ƒç‚¹\n=\u0026gt; é‚»æ¥çŸ©é˜µçš„è¿é€šåˆ†é‡(æœ‰å‡ ä¸ªä¸ç›¸è¿çš„å­å›¾)\nBFS\n1// BFS åˆ¤æ–­è¿é€šæ€§ =\u0026gt; answer == è¿é€šå­å›¾ä¸ªæ•° 2public void colorMap(char[][] grid, int i, int j) { 3 int h = grid.length; 4 int w = grid[0].length; 5 if (i\u0026lt;0 || j\u0026lt;0 || i\u0026gt;=h || j\u0026gt;=w || grid[i][j]==0) 6 return; 7 8 grid[i][j] = \u0026#39;0\u0026#39;; 9 colorMap(grid, i-1, j); 10 colorMap(grid, i+1, j); 11 colorMap(grid, i, j-1); 12 colorMap(grid, i, j+1); 13} 14 15public int numIslands(char[][] grid) { 16 int ans = 0; 17 int row = grid.length; 18 int col = grid[0].length; 19 for (int i = 0; i \u0026lt; row; i++) { 20 for (int j = 0; j \u0026lt; col; j++) { 21 if (grid[i][j] == 1){ 22 ans++; 23 colorMap(grid, i, j); 24 } 25 } 26 } 27 return ans; 28} 994. è…çƒ‚çš„æ©˜å­ åœ¨ç»™å®šçš„ m x n ç½‘æ ¼ grid ä¸­ï¼Œæ¯ä¸ªå•å…ƒæ ¼å¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼ä¹‹ä¸€ï¼š\nå€¼ 0 ä»£è¡¨ç©ºå•å…ƒæ ¼ï¼› å€¼ 1 ä»£è¡¨æ–°é²œæ©˜å­ï¼› å€¼ 2 ä»£è¡¨è…çƒ‚çš„æ©˜å­ã€‚ æ¯åˆ†é’Ÿï¼Œè…çƒ‚çš„æ©˜å­ å‘¨å›´ 4 ä¸ªæ–¹å‘ä¸Šç›¸é‚» çš„æ–°é²œæ©˜å­éƒ½ä¼šè…çƒ‚ã€‚\nè¿”å› ç›´åˆ°å•å…ƒæ ¼ä¸­æ²¡æœ‰æ–°é²œæ©˜å­ä¸ºæ­¢æ‰€å¿…é¡»ç»è¿‡çš„æœ€å°åˆ†é’Ÿæ•°ã€‚å¦‚æœä¸å¯èƒ½ï¼Œè¿”å› -1 ã€‚\nâ­ æ³¨æ„æ¯ä¸ªçƒ‚æ©˜å­åŒä¸€æ—¶åˆ»å‡å¼€å§‹\n=\u0026gt; queue : [111], =\u0026gt; [2222] =\u0026gt; [3333]\nBFSéå†\n207. è¯¾ç¨‹è¡¨ ä½ è¿™ä¸ªå­¦æœŸå¿…é¡»é€‰ä¿® numCourses é—¨è¯¾ç¨‹ï¼Œè®°ä¸º 0 åˆ° numCourses - 1 ã€‚\nåœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ å…ˆä¿®è¯¾ç¨‹æŒ‰æ•°ç»„ prerequisites ç»™å‡ºï¼Œå…¶ä¸­ prerequisites[i] = [ai, bi] ï¼Œè¡¨ç¤ºå¦‚æœè¦å­¦ä¹ è¯¾ç¨‹ ai åˆ™ å¿…é¡» å…ˆå­¦ä¹ è¯¾ç¨‹ bi ã€‚\nä¾‹å¦‚ï¼Œå…ˆä¿®è¯¾ç¨‹å¯¹ [0, 1] è¡¨ç¤ºï¼šæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ã€‚ è¯·ä½ åˆ¤æ–­æ˜¯å¦å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„å­¦ä¹ ï¼Ÿå¦‚æœå¯ä»¥ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚\næ–¹æ³•ä¸€ï¼š\næ£€æŸ¥æ‹“æ‰‘åºåˆ—æ˜¯å¦å­˜åœ¨ =\u0026gt; å…¥åº¦è¡¨ + map\u0026lt;edge, List\u0026lt;neighborEdge\u0026raquo; æ–¹æ³•äºŒï¼š\nDFSï¼ŒçŠ¶æ€0ï¼šæœªè®¿é—®è¿‡ï¼Œ1ï¼šéå†åˆ°æœªæ”¶å½•(ç”¨æ¥åˆ¤æ–­æ˜¯å¦é‡å¤éå†åˆ°)ï¼Œ2ï¼šéå†åˆ°ä¸”æ”¶å…¥å›Šä¸­ï¼› 208. å®ç° Trie (å‰ç¼€æ ‘) å­—å…¸æ ‘\n1class TreeNode { 2\tboolean isEnd; 3 TreeNode[] children; 4} 5 6children =\u0026gt; [abcd..xyz] 7 =\u0026gt; [abcd..xyz] å›æº¯ ç»„åˆé—®é¢˜ \u0026ndash; ä½¿ç”¨æ ‘å‹ç»“æ„åˆ†ææ‰€æœ‰å¯èƒ½æƒ…å†µ\n46. å…¨æ’åˆ— è¾“å…¥ï¼šnums = [1,2,3]\rè¾“å‡ºï¼š[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]] 1public void dfs(int[] nums, int depth, Deque\u0026lt;Integer\u0026gt; path, Set\u0026lt;Integer\u0026gt; used, List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; ans) { 2 if (depth == nums.length) { 3 ans.add(new ArrayList\u0026lt;\u0026gt;(path)); 4 return; 5 } 6 for (int i = 0; i \u0026lt; nums.length; i++) { 7 if (used.contains(nums[i])) { 8 continue; 9 } 10 path.addLast(nums[i]); 11 used.add(nums[i]); 12 dfs(nums, depth+1, path, used, ans); 13 // å›æº¯ 14 path.removeLast(); 15 used.remove(nums[i]); 16 } 17} 78. å­é›† è¾“å…¥ï¼šnums = [1,2,3]\rè¾“å‡ºï¼š[[],[1],[2],[1,2],[3],[1,3],[2,3],[1,2,3]] ä»{}å¼€å§‹ï¼Œéå†æ‰€æœ‰å…ƒç´ ï¼Œåˆ†åŠ å…¥æˆ–è€…ä¸åŠ å…¥\n1public void recur(int i, int[] nums, Deque\u0026lt;Integer\u0026gt; path) { 2 if (i == nums.length){ 3 ans.add(new ArrayList\u0026lt;\u0026gt;(path)); 4 return; 5 } 6 path.addLast(nums[i]); 7 recur(i+1, nums, path); 8 path.removeLast(); 9 recur(i+1, nums, path); 10} 17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ è¾“å…¥ï¼šdigits = \u0026#34;23\u0026#34;\rè¾“å‡ºï¼š[\u0026#34;ad\u0026#34;,\u0026#34;ae\u0026#34;,\u0026#34;af\u0026#34;,\u0026#34;bd\u0026#34;,\u0026#34;be\u0026#34;,\u0026#34;bf\u0026#34;,\u0026#34;cd\u0026#34;,\u0026#34;ce\u0026#34;,\u0026#34;cf\u0026#34;] è€ƒç‚¹ï¼šå¤šä¸ªé›†åˆçš„éšæœºç»„åˆ(æ¯ä¸ªé›†åˆä½¿ç”¨ä¸€æ¬¡)\n1// æ€è·¯ 2 3{a =\u0026gt; {e =\u0026gt; {? =\u0026gt; {# =\u0026gt; 4b f ?\t# 5c} g} ?}\t#} 6 7// é€’å½’å‡ºå£ num.len == path.len 1public void recur(int i, String str, String path) { 2 if (i == str.length()-1) { 3 for (char c : num2Letter.get(str.charAt(i))) { 4 ans.add(path.concat(\u0026#34;\u0026#34;+c)); 5 } 6 return; 7 } 8 // éå†é›†åˆ 9 for (char c : num2Letter.get(str.charAt(i))) { 10 path = path.concat(\u0026#34;\u0026#34;+c); // è¿½åŠ ä¸‹ä¸€ä¸ªä½ç½®çš„é›†åˆ 11 recur(i+1, str, path); 12 path = path.substring(0, path.length()-1); // æ’¤é”€è¿½åŠ çš„å…ƒç´  13 } 14} 39. ç»„åˆæ€»å’Œ ç»™ä½ ä¸€ä¸ª æ— é‡å¤å…ƒç´  çš„æ•´æ•°æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•´æ•° target ï¼Œæ‰¾å‡º candidates ä¸­å¯ä»¥ä½¿æ•°å­—å’Œä¸ºç›®æ ‡æ•° target çš„ æ‰€æœ‰ ä¸åŒç»„åˆ ï¼Œå¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›è¿™äº›ç»„åˆã€‚\ncandidates ä¸­çš„ åŒä¸€ä¸ª æ•°å­—å¯ä»¥ æ— é™åˆ¶é‡å¤è¢«é€‰å– ã€‚å¦‚æœè‡³å°‘ä¸€ä¸ªæ•°å­—çš„è¢«é€‰æ•°é‡ä¸åŒï¼Œåˆ™ä¸¤ç§ç»„åˆæ˜¯ä¸åŒçš„ã€‚\nå¯¹äºç»™å®šçš„è¾“å…¥ï¼Œä¿è¯å’Œä¸º target çš„ä¸åŒç»„åˆæ•°å°‘äº 150 ä¸ªã€‚\nè¾“å…¥ï¼šcandidates = [2,3,6,7], target = 7\rè¾“å‡ºï¼š[[2,2,3],[7]] è¦å»é‡å¤\n1public void help(int[] candidates, int start, int target, List\u0026lt;Integer\u0026gt; path) { 2 if (target \u0026lt; 0) 3 return; 4 else if (target == 0) { 5 ans.add(new ArrayList\u0026lt;\u0026gt;(path)); 6 return; 7 } 8 // åˆ©ç”¨iæ§åˆ¶èŒƒå›´ï¼Œåªçœ‹è‡ªå·±åŠå³ä¾§ 9 for (int i = start; i \u0026lt; candidates.length; i++) { 10 int num = candidates[i]; 11 path.add(num); 12 help(candidates, i, target - num, path); 13 path.remove(path.size()-1); 14 } 15} 22. æ‹¬å·ç”Ÿæˆ æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸” æœ‰æ•ˆçš„ æ‹¬å·ç»„åˆã€‚\nè¾“å…¥ï¼šn = 3\rè¾“å‡ºï¼š[\u0026#34;((()))\u0026#34;,\u0026#34;(()())\u0026#34;,\u0026#34;(())()\u0026#34;,\u0026#34;()(())\u0026#34;,\u0026#34;()()()\u0026#34;] 1ä»£è¡¨( 0ä»£è¡¨)\næ„å»ºé€‰æ‹©äºŒå‰æ ‘\n{} =\u0026gt; {1} =\u0026gt; {11} =\u0026gt; {111}\nâ€‹ =\u0026gt;{110} =\u0026gt; {1101}\nâ€‹ =\u0026gt; {1100} =\u0026gt; {11001}\u0026hellip;\nå†è¡¥å……å³æ‹¬å·\n1public void help(int num_1, int num_0, int n, String str) { 2 if (num_1 \u0026gt; n || num_1 \u0026lt; num_0) 3 return; 4 if (num_1 == n) { 5 ans.add(str); 6 return; 7 } 8 help(num_1+1, num_0, n, str+\u0026#34;(\u0026#34;); 9 help(num_1, num_0+1, n, str+\u0026#34;)\u0026#34;); 10} 131. åˆ†å‰²å›æ–‡ä¸² 1æ³¨æ„ï¼š result.add(new ArrayList\u0026lt;\u0026gt;(path)); // é‡æ–°å…‹éš†ä¸€ä»½ï¼Œé¿å…æµ…æ‹·è´çš„å¯¹è±¡åœ°å€ 2 3path.addLast path.removeLast path.push path.pop 4 a 0 a 0 b 0 a 0 5 a 1\ta 1 a 1 a 1 6 b 2 a 2 1private Deque\u0026lt;String\u0026gt; path = new ArrayDeque\u0026lt;\u0026gt;(); 2 private List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); 3 4 public List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; partition(String s) { 5 backtrack(s, 0); 6 return result; 7 } 8 9 public void backtrack(String s, int startIdx) { 10 if (startIdx \u0026gt;= s.length()) { 11 result.add(new ArrayList\u0026lt;\u0026gt;(path)); // æ”¶é›†å¶å­èŠ‚ç‚¹çš„ç»“æœ 12 } 13 for (int i = startIdx; i \u0026lt; s.length(); i++) { 14 if (!isValid(s.substring(startIdx, i+1))) 15 continue; 16 path.addLast(s.substring(startIdx, i+1)); 17 18 backtrack(s, i+1); 19 20 path.removeLast(); 21 } 22 23 } 24 25 private boolean isValid(String substring) { 26 int len = substring.length(); 27 for (int i = 0; i \u0026lt; len/2; i++) { 28 if (substring.charAt(i) != substring.charAt(len-i-1)) 29 return false; 30 } 31 return true; 32 } 79. å•è¯æœç´¢ ç»™å®šä¸€ä¸ª m x n äºŒç»´å­—ç¬¦ç½‘æ ¼ board å’Œä¸€ä¸ªå­—ç¬¦ä¸²å•è¯ word ã€‚å¦‚æœ word å­˜åœ¨äºç½‘æ ¼ä¸­ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚\nå•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚\n1public boolean exist(char[][] board, String word) { 2 int row = board.length; 3 int col = board[0].length; 4 for (int i = 0; i \u0026lt; row; i++) { 5 for (int j = 0; j \u0026lt; col; j++) { 6 if (ans==false\u0026amp;\u0026amp;board[i][j] == word.charAt(0)) { 7 board[i][j] = \u0026#39;#\u0026#39;; 8 help(board, i, j, word.substring(1)); 9 board[i][j] = word.charAt(0); // æ¢å¤ 10 } 11 } 12 } 13 return ans; 14} 15 16// æ·±åº¦æœç´¢ + å›æº¯ 17private void help(char[][] board, int i, int j, String word) { 18 if (word.equals(\u0026#34;\u0026#34;)||word.length()==0){ 19 ans = true; 20 return; 21 } 22 int row = board.length; 23 int col = board[0].length; 24 char target = word.charAt(0); 25 int[][] offsets = {{1,0},{-1,0},{0,1},{0,-1}}; 26 for (int[] offset : offsets) { 27 int r = i + offset[0]; 28 int c = j + offset[1]; 29 if (r\u0026lt;0||c\u0026lt;0||r\u0026gt;=row||c\u0026gt;=col) 30 continue; 31 if (board[r][c] == target\u0026amp;\u0026amp;board[r][c]!=\u0026#39;#\u0026#39;){ 32 board[r][c] = \u0026#39;#\u0026#39;; 33 help(board, r, c, word.substring(1)); 34 board[r][c] = target; // æ¢å¤ 35 } 36 } 37} 51. N çš‡å æŒ‰ç…§å›½é™…è±¡æ£‹çš„è§„åˆ™ï¼Œçš‡åå¯ä»¥æ”»å‡»ä¸ä¹‹å¤„åœ¨åŒä¸€è¡Œæˆ–åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šçš„æ£‹å­ã€‚\nn çš‡åé—®é¢˜ ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† n ä¸ªçš‡åæ”¾ç½®åœ¨ nÃ—n çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚\nç»™ä½ ä¸€ä¸ªæ•´æ•° n ï¼Œè¿”å›æ‰€æœ‰ä¸åŒçš„ n çš‡åé—®é¢˜ çš„è§£å†³æ–¹æ¡ˆã€‚\næ¯ä¸€ç§è§£æ³•åŒ…å«ä¸€ä¸ªä¸åŒçš„ n çš‡åé—®é¢˜ çš„æ£‹å­æ”¾ç½®æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¸­ 'Q' å’Œ '.' åˆ†åˆ«ä»£è¡¨äº†çš‡åå’Œç©ºä½ã€‚\n1{[????]} 2 â¬‡ï¸ check 3{[????]} 4... 1public static void backtracking(char[][] chessboard, int n, int row) { 2 if (row == n){ 3 ans.add(convert(chessboard)); 4 return; 5 } 6 for (int i = 0; i \u0026lt; n; i++) { 7 if (isValid(chessboard, row, i, n)) { 8 chessboard[row][i] = \u0026#39;Q\u0026#39;; 9 backtracking(chessboard, n, row+1); 10 chessboard[row][i] = \u0026#39;.\u0026#39;; 11 // break; 12 }//else 13 } 14} 15 16private boolean isValid(char[][] chessboard, int r, int c, int n) { 17 // check column 18 for (int i = 0; i \u0026lt; r; i++) { 19 if (chessboard[i][c] == \u0026#39;Q\u0026#39;) { 20 return false; 21 } 22 } 23 // check 45 degree 24 for (int i=r-1,j=c-1; i\u0026gt;=0\u0026amp;\u0026amp;j\u0026gt;=0; i--,j--) { 25 if (chessboard[i][j] == \u0026#39;Q\u0026#39;) { 26 return false; 27 } 28 } 29 // check 135 degree 30 for (int i=r-1,j=c+1; i\u0026gt;=0\u0026amp;\u0026amp;j\u0026lt;n; i--,j++) { 31 if (chessboard[i][j] == \u0026#39;Q\u0026#39;) { 32 return false; 33 } 34 } 35 return true; 36} 37 38public List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; solveNQueens(int n) { 39 ans = new ArrayList\u0026lt;\u0026gt;(); 40 char[][] chessboard = new char[n][n]; 41 for (char[] chars : chessboard) { 42 Arrays.fill(chars, \u0026#39;.\u0026#39;); 43 } 44 backtracking(chessboard, n, 0); 45 46 return ans; 47} äºŒåˆ†æŸ¥æ‰¾ 153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ è¾“å…¥ï¼šnums = [3,4,5,1,2]\rè¾“å‡ºï¼š1 1 l r 2[345 12] // å¤§ å° // ä¸”æ¯æ®µå‡é€’å¢ 3 m 41. mè½åœ¨å·¦æ®µ =\u0026gt; å¾€å³æ‰¾ 52. mè½åœ¨å³ç«¯ =\u0026gt; å¾€å·¦å­—æ®µæ‰¾ 63. ç»ˆæ­¢æ¡ä»¶ =\u0026gt; left-mid-right æœ‰åº 1public int findMin(int[] nums) { 2 int left = 0, right = nums.length-1; 3 while (left\u0026lt;=right) { 4 int mid = (left+right)/2; 5 if (nums[left]\u0026lt;=nums[mid] \u0026amp;\u0026amp; nums[mid]\u0026lt;=nums[right]) { 6 return nums[left]; 7 }else if(nums[left]\u0026lt;=nums[mid]) { 8 left = mid+1; 9 }else { 10 right = mid; 11 } 12 } 13 return 0; 14} 33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ 1 l r 2[345 12] // å¤§ å° // ä¸”æ¯æ®µå‡é€’å¢ 3 m 4 51. num[m] == target ç»ˆæ­¢æ¡ä»¶ 62. mè½åœ¨å·¦æ®µä¸Š 7 =\u0026gt; if(target \u0026lt; num[m]) =\u0026gt; [left, m-1] 8 else =\u0026gt; [m+1,right] 93. mè½åœ¨å³æ®µä¸Š 10 =\u0026gt; if(target \u0026lt; num[m]) =\u0026gt; [left, m-1] 11 else =\u0026gt; [m+1,right] 1public int search(int[] nums, int target) { 2 int left = 0, right = nums.length-1; 3 while (left \u0026lt;= right) { 4 int mid = (left + right) / 2; 5 if (nums[mid] == target) { 6 return mid; 7 } 8 9 if (nums[mid] \u0026gt;= nums[left]) { 10 if (nums[left]\u0026lt;=target \u0026amp;\u0026amp; nums[mid]\u0026gt;target) { 11 right = mid-1; 12 }else { 13 left = mid+1; 14 } 15 }else { 16 if (nums[right]\u0026gt;=target \u0026amp;\u0026amp; target\u0026gt;nums[mid]) { 17 left = mid+1; 18 }else { 19 right = mid-1; 20 } 21 } 22 } 23 return -1; 24} 34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½® ç¬¬ä¸€æ¬¡æŸ¥å·¦è¾¹ç•Œ =\u0026gt; ç¬¬äºŒæ¬¡æŸ¥å³è¾¹ç•Œ\né€’å¢åºåˆ—\n1è¾“å…¥ï¼šnums = [5,7,7,8,8,10], target = 8 2è¾“å‡ºï¼š[3,4] 3 4æ³¨æ„è¾¹ç•ŒåŒ…æ‹¬æƒ…å†µ 1public int[] searchRange(int[] nums, int target) { 2 if (nums.length == 0) 3 return new int[]{-1, -1}; 4 int[] ans = new int[2]; 5 Arrays.fill(ans, -1); 6 int a = searchFirstLoc(nums, target); 7 if (a != -1) { 8 ans[0] = a; 9 int b = searchSecondLoc(nums, target); 10 ans[1] = b; 11 } 12 return ans; 13} 14 15// æ±‚å³è¾¹ç•Œ 16private int searchSecondLoc(int[] nums, int target) { 17 int left = 0; 18 int right = nums.length-1; 19 while (left\u0026lt;right) { 20 int mid = (left+right+1) / 2; 21 if (nums[mid] == target) { 22 // [mid, right] 23 left = mid; 24 } 25 else if (nums[mid] \u0026gt; target) { 26 // [left, mid-1] 27 right = mid-1; 28 }else { 29 // [mid+1, right] 30 left = mid+1; 31 } 32 } 33 return left; 34} 35 36// è®¡ç®—å·¦è¾¹ç•Œ 37private int searchFirstLoc(int[] nums, int target) { 38 int left = 0; 39 int right = nums.length-1; 40 while (left\u0026lt;right) { 41 int mid = (left+right) / 2; 42 if (nums[mid] == target) { 43 // [left, mid] 44 right = mid; 45 } 46 else if (nums[mid] \u0026gt; target) { 47 // [left, mid-1] 48 right = mid-1; 49 }else { 50 // [mid+1, right] 51 left = mid+1; 52 } 53 } 54 if (nums[left]!=target) 55 return -1; 56 return left; 57} 74. æœç´¢äºŒç»´çŸ©é˜µ ç»™ä½ ä¸€ä¸ªæ»¡è¶³ä¸‹è¿°ä¸¤æ¡å±æ€§çš„ m x n æ•´æ•°çŸ©é˜µï¼š\næ¯è¡Œä¸­çš„æ•´æ•°ä»å·¦åˆ°å³æŒ‰éä¸¥æ ¼é€’å¢é¡ºåºæ’åˆ—ã€‚ æ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•´æ•°å¤§äºå‰ä¸€è¡Œçš„æœ€åä¸€ä¸ªæ•´æ•°ã€‚ ç»™ä½ ä¸€ä¸ªæ•´æ•° target ï¼Œå¦‚æœ target åœ¨çŸ©é˜µä¸­ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚\nåæ ‡i,j =\u0026gt; è½¬æ¢ä¸ºä¸€ç»´å·¦è¾¹ i*col+j\n1private int coordinate2Index(int i, int j, int col){ 2 return i*col+j; 3} 4public boolean searchMatrix(int[][] matrix, int target) { 5 int row = matrix.length; 6 int col = matrix[0].length; 7 int left_i = 0, left_j = 0; 8 int right_i = row-1, right_j = col-1; 9 while (coordinate2Index(left_i, left_j, col)\u0026lt;=coordinate2Index(right_i,right_j,col)){ 10 int mid_i = (coordinate2Index(left_i, left_j, col)+coordinate2Index(right_i,right_j,col))/col; 11 int mid_j = (coordinate2Index(left_i, left_j, col)+coordinate2Index(right_i,right_j,col))%col; 12 if (matrix[mid_i][mid_j] == target) 13 return true; 14 else if (matrix[mid_i][mid_j] \u0026gt; target) { 15 if (mid_j \u0026gt; 0) { 16 right_i = mid_i; 17 right_j = mid_j - 1; 18 }else { 19 right_i = mid_i-1; 20 right_j = col-1; 21 } 22 }else { 23 if (mid_j \u0026lt; col-1) { 24 left_i = mid_i; 25 left_j = mid_j+1; 26 }else { 27 left_i = mid_i+1; 28 left_j = 0; 29 } 30 } 31 } 32 return false; 33} å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•° ä¸¤ä¸ªæœ‰åºæ•°ç»„ï¼Œå¯»æ‰¾ä¸­ä½æ•° =\u0026gt; ç¬¬Kå°çš„å…ƒç´ \nåˆ åˆ åˆ ï¼Œæ¯æ¬¡åˆ æ‰ä¸€éƒ¨åˆ†[K/2ä¸ª] =\u0026gt; æ‰¾ç¬¬K-K/2å°çš„å…ƒç´ ã€‚\nâ­åˆ†åŒæ•°ä¸å¶æ•°æƒ…å†µ\n1public double findMedianSortedArrays(int[] nums1, int[] nums2) { 2 int n = nums1.length; 3 int m = nums2.length; 4 5 if ((n+m) % 2 == 0){ // å¶æ•° =\u0026gt; (left + right)/2 6 int a = getKth(nums1, 0, n-1, nums2, 0, m-1, (n+m)/2); 7 int b = getKth(nums1, 0, n-1, nums2, 0, m-1, (n+m)/2+1); 8 return (a+b)/2.0; 9 }else 10 return getKth(nums1, 0, n-1, nums2, 0, m-1, (n+m+1)/2); 11 12} 13 14private int getKth(int[] nums1, int start1, int end1, int[] nums2, int start2, int end2, int k) { 15 int len1 = end1 - start1 + 1; 16 int len2 = end2 - start2 + 1; 17 18 if (len1 \u0026gt; len2) 19 return getKth(nums2, start2, end2, nums1, start1, end1, k); 20 21 if (len1 == 0) 22 return nums2[start2 + k - 1]; 23 24 if (k == 1) 25 return Math.min(nums1[start1], nums2[start2]); 26 // å¿½ç•¥ä¹‹å‰åˆ é™¤çš„ // é˜²æ­¢è¶Šç•Œ 27 int i = start1 + Math.min(len1, k / 2) - 1; // ä¸‹æ ‡ä»0å¼€å§‹ 28 int j = start2 + Math.min(len2, k / 2) - 1; // ä¸‹æ ‡ä»0å¼€å§‹ 29 30 if (nums1[i] \u0026gt; nums2[j]) { // é‚£ä¹ˆnums2ä¸­ åŒ…å«jåŠå…¶ä¹‹å‰çš„å…ƒç´ ï¼Œéƒ½ä¸å¯èƒ½æ˜¯ç¬¬kå°çš„å…ƒç´ ï¼Œç›´æ¥é€»è¾‘åˆ é™¤ 31 return getKth(nums1, start1, end1, nums2, j + 1, end2, k - (j - start2 + 1)); 32 } 33 else { 34 return getKth(nums1, i + 1, end1, nums2, start2, end2, k - (i - start1 + 1)); 35 } 36} é€»è¾‘ï¼š\nåˆ†å¶æ•°ä¸å•æ•°ï¼Œ å¶æ•°çš„è¯ï¼Œåˆ†åˆ«æ±‚ ç¬¬Kä¸ªå’ŒK+1ä¸ªå…ƒç´ ï¼› å•æ•°å°±æ±‚ç¬¬Kä¸ªå…ƒç´ å°±å¥½ è®©nums1æ˜¯å…ƒç´ æ•°é‡å°çš„é‚£ä¸ª å¦‚æœnums1ä¸ºç©ºï¼Œè¿”å›nums2ä¸­çš„ç¬¬kå°çš„å…ƒç´  å¦‚æœkç­‰äº1(é€’å½’å…¥å£)ï¼Œè¿”å›ä¸¤ä¸ªæ•°ç»„ä¸­ï¼Œå¤´éƒ¨æœ€å°çš„å…ƒç´ ã€‚ æ ˆ 155 æœ€å°æ ˆ æ€è·¯ï¼š 1. æ™®é€šæ ˆ 2. è®°å½•æœ€å°å€¼çš„æ ˆ(å…ƒç´ å¤ç”¨)\nStack: 2431\nminStack: 2221 ï¼ˆå•è°ƒæ ˆï¼‰\n394 å­—ç¬¦ä¸²è§£ç  è¾“å…¥ï¼šs = \u0026#34;3[a]2[bc]\u0026#34;\rè¾“å‡ºï¼š\u0026#34;aaabcbc\u0026#34; NumStack: å­˜å‚¨æ¬¡æ•°\nStrStackï¼š å­˜å‚¨å­—ç¬¦\nåˆ†\u0026quot;[\u0026quot; å’Œ \u0026ldquo;]\u0026ldquo;æ—¶æœº\n739. æ¯æ—¥æ¸©åº¦ ä¸‹ä¸€ä¸ªæ›´é«˜æ¸©åº¦å‡ºç°åœ¨å‡ å¤©åã€‚å¦‚æœæ°”æ¸©åœ¨è¿™ä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ 0 æ¥ä»£æ›¿\nè¾“å…¥: temperatures = [73,74,75,71,69,72,76,73]\rè¾“å‡º: [1,1,4,2,1,1,0,0] ï¼ˆå•è°ƒæ ˆï¼‰\nindex: [ 0, 1, 2, 3, 4, 5, 6, 7]\ntemp = [73, 74, 75, 71, 69, 72,76,73]\nelement:[74, 75, 76, 72,72, 76,-1,-1] ä»å‰å¾€å ï¼ˆä¸€èµ·æ‰¾è€çˆ¸ï¼‰\ntarget :[ 1, 2, 6, 5, 5, 6, -1, -1]\noutput : [ 1, 1, 4, 2, 1, 1, 0, 0]\nè¿‡ç¨‹ï¼š\npreElstack: [73] 73\u0026lt;74 =\u0026gt; [74] 74\u0026lt;75 =\u0026gt; [75,71,69] 71,69\u0026lt;72=\u0026gt; [75,72] 75,72\u0026lt;76 =\u0026gt; [76] \u0026hellip;\nres:[74(1),75(2), 76(6), 72(5),72(5), 76(6), x, x]\n84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢\nä»è¯¥ç‚¹å‡ºå‘ =\u0026gt; å‘å·¦æ‰¾å·¦è¾¹ç•Œ \u0026gt;=è¯¥ç‚¹\nä»è¯¥ç‚¹å‡ºå‘ =\u0026gt; å‘å³æ‰¾å³è¾¹ç•Œ \u0026gt;=è¯¥ç‚¹\nS=wxh\nå † 215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´  ç»™å®šæ•´æ•°æ•°ç»„ nums å’Œæ•´æ•° kï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ **k** ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚\nè¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚\nä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚\n1# æ€è·¯ï¼š 2ç»´æŠ¤ä¸€ä¸ªæœ€å°å † 3ç„¶åæ¯æ¬¡æ¯”è¾ƒï¼Œå¦‚æ¯”(ä¹‹å‰æœ€å¤§çš„Kä¸ªå…ƒç´ çš„)æœ€å°çš„å¤§ï¼Œåˆ™Pollå †é¡¶ï¼Œaddè¯¥å…ƒç´  347. å‰ K ä¸ªé«˜é¢‘å…ƒç´  ç¤ºä¾‹ 1:\nè¾“å…¥: nums = [1,1,1,2,2,3], k = 2\rè¾“å‡º: [1,2] 1# æ€è·¯ï¼š 21. å…ˆç»Ÿè®¡è¯é¢‘ 32. è¯é¢‘æ’åº \u0026lt;= åªç»´æŠ¤éœ€è¦çš„kä¸ªæœ€å€¼å…ƒç´ å³å¯ï¼Œ æœ€å°å †\u0026lt;= 295. æ•°æ®æµçš„ä¸­ä½æ•° ä¸­ä½æ•°æ˜¯æœ‰åºæ•´æ•°åˆ—è¡¨ä¸­çš„ä¸­é—´å€¼ã€‚å¦‚æœåˆ—è¡¨çš„å¤§å°æ˜¯å¶æ•°ï¼Œåˆ™æ²¡æœ‰ä¸­é—´å€¼ï¼Œä¸­ä½æ•°æ˜¯ä¸¤ä¸ªä¸­é—´å€¼çš„å¹³å‡å€¼ã€‚\nä¾‹å¦‚ arr = [2,3,4] çš„ä¸­ä½æ•°æ˜¯ 3 ã€‚ ä¾‹å¦‚ arr = [2,3] çš„ä¸­ä½æ•°æ˜¯ (2 + 3) / 2 = 2.5 ã€‚ 1# æ€è·¯ï¼š 2O(1)æ—¶é—´è®¡ç®—ä¸­ä½æ•°ï¼Œ=\u0026gt; å›ºå®šå…¶ä½ç½®ï¼ŒO(1)æŸ¥è¯¢ =\u0026gt; å †é¡¶ 3 4å·¦å †(æœ€å¤§å †) ï¼š å³å †(æœ€å°å †) 5 6# æ’å…¥æƒ…å†µ 71. å¶æ•°æ—¶ï¼Œ ä¿æŒ ä¸­ä½æ•° =\u0026gt; å·¦å †é¡¶ 8 # åˆ¤æ–­æ’å…¥ä½ç½®ï¼Œ æ’å·¦è¾¹ï¼šå·¦å †.addï¼› æ’å³è¾¹: å³æœ€å°å€¼=\u0026gt;å·¦å †ï¼Œå·¦å †.add; 92. å¥‡æ•°æ—¶(å·¦å †æ¯”å³å †å¤šä¸€ä¸ªå…ƒç´ )ï¼Œ ä¿æŒ ä¸­ä½æ•° =\u0026gt; (å·¦å †é¡¶ + å³å †é¡¶) /2 10 # åˆ¤æ–­æ’å…¥ä½ç½®ï¼Œ æ’å·¦è¾¹ï¼šå·¦æœ€å¤§å€¼=\u0026gt;å³å †ï¼Œå·¦å †.addï¼› æ’å³è¾¹: å³å †.add; è´ªå¿ƒ 55. è·³è·ƒæ¸¸æˆ ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ nums ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ ç¬¬ä¸€ä¸ªä¸‹æ ‡ ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚\nåˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ï¼Œå¦‚æœå¯ä»¥ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [2,3,1,1,4]\rè¾“å‡ºï¼štrue\rè§£é‡Šï¼šå¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»ä¸‹æ ‡ 0 åˆ°è¾¾ä¸‹æ ‡ 1, ç„¶åå†ä»ä¸‹æ ‡ 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ã€‚ æ€è·¯ï¼š\n1nums = [2,3,1,1,4] 2 1. | . .| 3 2. | . . .| 4 5# æŸ¥çœ‹ä»å½“å‰ä½ç½®ï¼Œæ˜¯å¦èƒ½å¤Ÿçªå‡ºé‡å›´(è¦†ç›–èŒƒå›´) max(cover, i+nums[i]) \u0026lt;= å°½å¯èƒ½çš„å¾€è¿œè·³ 25/3/18 ç¬¬äºŒæ¬¡æ€è€ƒ\n45. è·³è·ƒæ¸¸æˆ II è·³è·ƒæ¸¸æˆé—®é¢˜çš„æœ€å°æ­¥æ•°\nç¤ºä¾‹ 1:\nè¾“å…¥: nums = [2,3,1,1,4]\rè¾“å‡º: 2\rè§£é‡Š: è·³åˆ°æœ€åä¸€ä¸ªä½ç½®çš„æœ€å°è·³è·ƒæ•°æ˜¯ 2ã€‚\rä»ä¸‹æ ‡ä¸º 0 è·³åˆ°ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼Œè·³ 1 æ­¥ï¼Œç„¶åè·³ 3 æ­¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚ 1# æ€è·¯ 2nums = [2,3,1,1,4] 3 | . .| 4 | . . .| âˆš \u0026lt;= ä¸‹ä¸€è½®å¾€è¿™è·³ # æ¯è½®å°½å¯èƒ½è·³çš„è¿œ 5 | .| Ã— 6 7curRoundDist = 0; 8nextRoundDist = 0; 9count = 0; 10for(int i=0; i\u0026lt;nums.length; i++) { 11 nextRoundDist = max(nextRoundDist, i+nums[i]) 12 if(i == curRoundDist){ # æ­¤è½®ç»“æŸ 13 curRoundDist = nextRoundDist 14 count += 1; 15 if(nextRoundDist \u0026gt;= nums.length-1) 16 break; 17 } 18} 763. åˆ’åˆ†å­—æ¯åŒºé—´ ç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šs = \u0026#34;[ababcbaca][defegde][hijhklij]\u0026#34;\rè¾“å‡ºï¼š[9,7,8]\rè§£é‡Šï¼š\råˆ’åˆ†ç»“æœä¸º \u0026#34;ababcbaca\u0026#34;ã€\u0026#34;defegde\u0026#34;ã€\u0026#34;hijhklij\u0026#34; ã€‚\r###æ¯ä¸ªå­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­ã€‚###\råƒ \u0026#34;ababcbacadefegde\u0026#34;, \u0026#34;hijhklij\u0026#34; è¿™æ ·çš„åˆ’åˆ†æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºåˆ’åˆ†çš„ç‰‡æ®µæ•°è¾ƒå°‘ã€‚ 1# æ€è·¯, æœ€ç®€å•æƒ…å†µï¼Œå·¦ç«¯ç‚¹ =\u0026gt; æœ€è¿œå³ç«¯ç‚¹ 2# å…¶ä¸­æœ‰å…ƒç´ è¿›è¡Œæ‰©å±•å³è¾¹ç•Œ =\u0026gt; æ›´æ–°æœ€è¿œå³ç«¯ç‚¹ \u0026lt;= ### 3 4int[] farthestIdx = new int[26] 5for(int i=0; i\u0026lt;s.length; i++) : 6 char c = s.charAt(i); 7 farthestIdx[c - \u0026#39;a\u0026#39;] = i 8 9left=0; right=0; 10for(int i=0; i\u0026lt;s.length; i++) : 11 char c = s.charAt(i); 12 right = max(right, farthestIdx[c-\u0026#39;a\u0026#39;]) # è´ªå¿ƒå¤„ 13 if(right == i){ 14 # save ans 15 left = right+1; 16 } åŠ¨æ€è§„åˆ’ çˆ¬æ¥¼æ¢¯ å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚\næ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ\n1# æ€è·¯ 2 3è€ƒè™‘å½“å‰å¤„äºç¬¬iå¤„å°é˜¶ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½åˆ°è¾¾ç°åœ¨çš„iå·å°é˜¶å‘¢ï¼Ÿ 4ä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š 51. ä»i-1é˜¶ èµ°ä¸€æ­¥ 62. ä»i-2é˜¶ èµ°ä¸¤æ­¥ 7 8=\u0026gt; dp[i]è¡¨ç¤ºèµ°åˆ°iå·å°é˜¶çš„æ‰€æœ‰å¯èƒ½æ–¹æ³•ï¼Œiè¡¨ç¤ºå°é˜¶ 9 10é€’æ¨å…³ç³»ï¼š 11dp[i] = dp[i-1] + dp[i-2] 118. æ¨è¾‰ä¸‰è§’ 1# æ€è·¯ 2 3preRow = [1, 2, 1] 4curRow = [1] 5for(i of preRow) 6\tcurRow.add(preRow[i] + preRow[i+1]) 7curRow.add(1) 198. æ‰“å®¶åŠ«èˆ ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½  ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä¸€å¤œä¹‹å†…èƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚\n# ä¸èƒ½ç›¸é‚»çš„é€‰æ‹©\n1# æ€è·¯ 2dp[i]è¡¨ç¤ºåŒ…å«ç¬¬iå·æˆ¿é—´æ‰€èƒ½å·å–çš„æœ€å¤§é‡‘é¢, iè¡¨ç¤ºæˆ¿é—´å· 3 4# è€ƒè™‘å½“å‰å·åˆ°ç¬¬iå·æˆ¿é—´ 5# é€‰æ‹©å¯èƒ½æ–¹æ¡ˆ 61. å· =\u0026gt; money[i] + dp[i-2] 72. ä¸å· =\u0026gt; dp[i-1] 8 9dp[i] = max(money[i] + dp[i-2], dp[i-1]) [322. é›¶é’±å…‘æ¢] ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ coins ï¼Œè¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼›ä»¥åŠä¸€ä¸ªæ•´æ•° amount ï¼Œè¡¨ç¤ºæ€»é‡‘é¢ã€‚\nè®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„ æœ€å°‘çš„ç¡¬å¸ä¸ªæ•° ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› -1 ã€‚\nä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„ã€‚\n# æœ€å°ç»„åˆä¸ªæ•°è£…æ»¡\n1# dp[i]è¡¨ç¤ºè£…æ»¡é‡‘é¢iéœ€è¦çš„é‡‘å¸æ•°é‡ï¼Œiè¡¨ç¤ºé‡‘é¢ 2 3# è€ƒè™‘å½“å‰ è¦è£…æ»¡çš„é‡‘é¢ä¸ºi 4# é‚£ä¹ˆå½“å‰èƒ½å¤Ÿé€‰æ‹©çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š 51. dp[i-CoinA] + 1 # è·³è·ƒ 62. dp[i-CoinB] + 1 73. dp[i-CoinC] + 1 8 9dp[i] = min(1., 2., 3.) 279. å®Œå…¨å¹³æ–¹æ•° ç»™ä½ ä¸€ä¸ªæ•´æ•° n ï¼Œè¿”å› å’Œä¸º n çš„å®Œå…¨å¹³æ–¹æ•°çš„æœ€å°‘æ•°é‡ ã€‚\nå®Œå…¨å¹³æ–¹æ•° æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå…¶å€¼ç­‰äºå¦ä¸€ä¸ªæ•´æ•°çš„å¹³æ–¹ï¼›æ¢å¥è¯è¯´ï¼Œå…¶å€¼ç­‰äºä¸€ä¸ªæ•´æ•°è‡ªä¹˜çš„ç§¯ã€‚ä¾‹å¦‚ï¼Œ1ã€4ã€9 å’Œ 16 éƒ½æ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼Œè€Œ 3 å’Œ 11 ä¸æ˜¯ã€‚\nå…ƒç´ ï¼š [1, 4, 9, 16 \u0026hellip;]\n# é¢˜ç›®è€ƒç‚¹å¦‚ä¸Š\n1# dp[i]è¡¨ç¤ºçš„æ˜¯ç»™ä¸çš„æ•´æ•°iæ‰€éœ€æœ€å°‘æ•°é‡çš„å®Œå…¨å¹³æ–¹æ•°ï¼Œiè¡¨ç¤ºè¯¥æ•´æ•°ã€‚ 2 3# è€ƒè™‘å½“å‰çš„æ•´æ•°ä¸ºi 4# é‚£ä¹ˆå½“å‰èƒ½å¤Ÿå‡‘åˆ°è¯¥æ•´æ•°çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š 51. dp[i-e1*e1]+1 61. dp[i-e2*e2]+1 # æœ€å°‘æ­¥æ•°è·³è·ƒï¼Œo.O 71. dp[i-e2*e2]+1 8 9dp[i] = min(1. 2. 3.) 139. å•è¯æ‹†åˆ† ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ wordDict ä½œä¸ºå­—å…¸ã€‚å¦‚æœå¯ä»¥åˆ©ç”¨å­—å…¸ä¸­å‡ºç°çš„ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯æ‹¼æ¥å‡º s åˆ™è¿”å› trueã€‚\n1# æ€è·¯ 2 3# dp[i]è¡¨ç¤ºé•¿åº¦ä¸ºiçš„å­—ä¸²æ˜¯å¦èƒ½å¤Ÿè¢«å‡‘å‡ºæ¥ï¼Œiè¡¨ç¤ºè¯¥å­—ä¸² 4 5# è€ƒè™‘å½“å‰çš„å­—ä¸²çš„èƒ½å¤Ÿé€‰æ‹©å‡‘å‡ºæ¥çš„å¯èƒ½æ–¹æ¡ˆå¦‚ä¸‹ï¼š 61. dp[i-len(word1)]==True \u0026amp;\u0026amp; subString(i-len(word1),i) in wordDict 7... â­â­â­ æ€»ä½“æ€è·¯ï¼šæ¦‚ç‡å½“å‰ä½ç½®çš„æ‰€æœ‰å¯èƒ½æ–¹æ¡ˆï¼Œå»ºç«‹çº¿æ€§çš„ä¾èµ–å…³ç³»ã€‚\n300. æœ€é•¿é€’å¢å­åºåˆ— ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚\nå­åºåˆ— æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ[3,6,2,7] æ˜¯æ•°ç»„ [0,3,1,6,2,2,7] çš„å­åºåˆ—ã€‚\n1# æ€è·¯ 2 3# è€ƒè™‘å½“å‰å…ƒç´  ä¸å…ˆå‰ æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ— ä»¬ çš„å…³ç³»ã€‚ 4 5# dp[i] è¡¨ç¤ºï¼Œç¬¬0-iä¸ªå…ƒç´ çš„æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—é•¿åº¦ï¼Œ iè¡¨ç¤ºè¯¥å…ƒç´ ã€‚ ç›¸å¯¹äºä»¥iç»“å°¾çš„æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—é•¿åº¦ 6 7# åˆå§‹åŒ–å…¨ä¸º1ï¼ŒåªåŒ…å«è‡ªèº«ã€‚ 8if[nums[i] \u0026gt; nums[j]] # é€’å¢ 9dp[i] = max(dp[i], dp[j]+1) 10 11 12for(int i=1; i\u0026lt;nums.length; i++) 13\tfor(int j=0; j\u0026lt;i; j++) 14 if(nums[i] \u0026gt; nums[j]) 15 dp[i] = max(dp[i], dp[j]+1) # åŠ¨æ€é€‰æ‹©ï¼Œè·³è·ƒ 152. ä¹˜ç§¯æœ€å¤§å­æ•°ç»„ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¯·ä½ æ‰¾å‡ºæ•°ç»„ä¸­ä¹˜ç§¯æœ€å¤§çš„éç©ºè¿ç»­ å­æ•°ç»„ï¼ˆè¯¥å­æ•°ç»„ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°å­—ï¼‰ï¼Œå¹¶è¿”å›è¯¥å­æ•°ç»„æ‰€å¯¹åº”çš„ä¹˜ç§¯ã€‚\n# è¿ç»­ã€‚å…ƒç´ ç›¸é‚» âœ”ï¸!= å…ƒç´ å€¼ç›¸é‚»âŒ\nç¤ºä¾‹ 1:\nè¾“å…¥: nums = [2,3,-2,4]\rè¾“å‡º: 6\rè§£é‡Š: å­æ•°ç»„ [2,3] æœ‰æœ€å¤§ä¹˜ç§¯ 6ã€‚ 1# ç”±äºæœ‰æ­£æœ‰è´Ÿ 2# å½“å‰å€¼è‹¥ä¸ºè´Ÿï¼Œä¸å…ˆå‰æœ€å¤§è´Ÿæ•°ç›¸ä¹˜ =\u0026gt; -- =\u0026gt; + 3 4# Min_dp[i] è¡¨ç¤º iå·å…ƒç´ åŠå…¶ä¹‹å‰ æœ€å°çš„ä¹˜ç§¯å’Œ 5# Max_dp[i] è¡¨ç¤º iå·å…ƒç´ åŠå…¶ä¹‹å‰ æœ€å¤§çš„ä¹˜ç§¯å’Œ 6 7Min_dp[i] = Min(nums[i], Min_dp[i-1]*nums[i], Max_dp[i-1]*nums[i]) # M??_dp[i-1]*nums[i] ä¿è¯è¿ç»­ 8Max_dp[i] = Max(nums[i], Min_dp[i-1]*nums[i], Max_dp[i-1]*nums[i]) # ç»Ÿä¸€æ­£è´Ÿ 9 10result = Max(Max_dp[0,...,n]) 0-1èƒŒåŒ…é—®é¢˜ (2ç»´) æœ‰nä»¶ç‰©å“å’Œä¸€ä¸ªæœ€å¤šèƒ½èƒŒé‡é‡ä¸ºw çš„èƒŒåŒ…ã€‚ç¬¬iä»¶ç‰©å“çš„é‡é‡æ˜¯weight[i]ï¼Œå¾—åˆ°çš„ä»·å€¼æ˜¯value[i] ã€‚æ¯ä»¶ç‰©å“åªèƒ½ç”¨ä¸€æ¬¡ï¼Œæ±‚è§£å°†å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…é‡Œç‰©å“ä»·å€¼æ€»å’Œæœ€å¤§ã€‚\ndp[i][j] è¡¨ç¤ºï¼Œ ä»»å–{0,i}ç‰©å“ï¼Œæ”¾è‡³å®¹é‡jçš„èƒŒåŒ…ä¸­çš„ æ€»ä»·å€¼ã€‚\ndpçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š\nä¸æ”¾ç‰©å“iï¼š dp[i][j] = dp[i-1][j] æ”¾ç‰©å“i : dp[i][j] = dp[i-1][j-weight[i]] + value[i] # ä»ä»»æ„æ”¾ç½®{0,\u0026hellip;,i-1}çš„çŠ¶æ€ä¸­è¿›è¡Œè¿ç§»ï¼Œè¦æ±‚å…¶èƒŒåŒ…å®¹é‡è¶³å¤Ÿè£…ä¸‹ç‰©å“i 1for (int i = 1; i \u0026lt; n; i++) { // ç‰©å“ 2 for (int j = 0; j \u0026lt;= bagweight; j++) { // èƒŒåŒ… 3 if (j \u0026lt; weight[i]) { // è£…ä¸ä¸‹ =\u0026gt; ä¸è£… 4 dp[i][j] = dp[i - 1][j]; 5 } else { 6 dp[i][j] = Math.max(dp[i - 1][j], dp[i - 1][j - weight[i]] + value[i]); // è£…æˆ–è€…ä¸è£…ä¸­ä»·å€¼æœ€å¤§ 7 } 8 } 9} éå†é¡ºåº=\u0026gt; dp[i][j] ä¾èµ–äº ä¸Šä¸€è¡Œ dp[i-1][0,\u0026hellip;,j]\n0-1èƒŒåŒ…é—®é¢˜ (1ç»´) 1 j 0, 1, 2, 3, 4 # èƒŒåŒ…å®¹é‡ 2dp[] = [0,15,15,15,15] # å½“å‰ä»·å€¼, åˆå§‹åŒ–æ”¾ç½®ç‰©å“1 3 [0,15,15,|20,35] # æ”¾ç½®ç‰©å“2 [âœ”ï¸âœ”ï¸] max(ä¸æ”¾,æ”¾) 4 [0,15,15,20,|35] # æ”¾ç½®ç‰©å“3 [âŒ] 5 6dp[j] = max(dp[j], dp[j-weight[i]]+value[i]) # 1. ä¸æ”¾ç½® 2.æ”¾ç½® 7 8 9 10# éå† 11for(int i = 0; i \u0026lt; weight.size(); i++) { // éå†ç‰©å“(å…³é”®æ˜¯é‡é‡)ï¼Œåªä½¿ç”¨ä¸€æ¬¡ 12 for(int j = bagWeight; j \u0026gt;= weight[i]; j--) { // éå†èƒŒåŒ…å®¹é‡ ä»å¤§åˆ°å° 13 dp[j] = max(dp[j], dp[j - weight[i]] + value[i]); 14 15# å½“èƒŒåŒ…å®¹é‡ j å°äºå½“å‰ç‰©å“çš„é‡é‡ weight[i] æ—¶ï¼Œæ ¹æœ¬ä¸å¯èƒ½æ”¾å…¥è¯¥ç‰©å“ï¼Œå› æ­¤ä¸éœ€è¦ç»§ç»­æ›´æ–° dp[j]ã€‚æˆ‘ä»¬åº”è¯¥è·³è¿‡è¿™äº›å®¹é‡å°äº weight[i] çš„æƒ…å†µ åˆ†å‰²ç­‰å’Œå­é›† ç»™ä½ ä¸€ä¸ª åªåŒ…å«æ­£æ•´æ•° çš„ éç©º æ•°ç»„ nums ã€‚è¯·ä½ åˆ¤æ–­æ˜¯å¦å¯ä»¥å°†è¿™ä¸ªæ•°ç»„åˆ†å‰²æˆä¸¤ä¸ªå­é›†ï¼Œä½¿å¾—ä¸¤ä¸ªå­é›†çš„å…ƒç´ å’Œç›¸ç­‰ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [1,5,11,5]\rè¾“å‡ºï¼štrue\rè§£é‡Šï¼šæ•°ç»„å¯ä»¥åˆ†å‰²æˆ [1, 5, 5] å’Œ [11] ã€‚ 0-1èƒŒåŒ…é—®é¢˜ï¼š å’Œç›¸ç­‰ =\u0026gt; å †ç§¯sumçš„ä¸€åŠä½œä¸ºç›®æ ‡\n1# 1. æ±‚å’Œ sum =\u0026gt; target == sum//2 2 3# dp[j] è¡¨ç¤ºjå®¹é‡çš„èƒŒåŒ…çš„æœ€å¤§ä»·å€¼ 4int[] dp = new int[target+1]; 5# èƒŒåŒ…å®¹é‡==0-target , ç›®æ ‡è£…æ»¡target =\u0026gt; dp[target] == target 6for(int i=0; i\u0026lt;nums.length; i++) 7\tfor(int j=target; j\u0026gt;=nums[i]; j--) # èƒŒåŒ…å®¹é‡å°äºå½“å‰ç‰©å“ï¼Œåç»­å®¹é‡çš„èƒŒåŒ…æ²¡æœ‰å¿…è¦å†è£…äº† 8 dp[j] = max(dp[j], dp[j-nums[i]]+nums[i]) # ä¸è£…ï¼Œè£… 9 10if(dp[target] == target) 11\treturn true 32 æœ€é•¿æœ‰æ•ˆæ‹¬å· 1// æ ˆçš„ä¾‹å­ 2-1 0 1 2 3 4 5 3 ( ( ) ( ) ) 4 x |.| Step: 1 5 x |.....| Step: 2 6 x |.........| Step: 3 7 8-1 0 1 2 3 4 5 9 ( ) ( ( ) ) 10 x |.| 11 x |.| 12 x |.........| 1public int longestValidParentheses(String s) { 2 Stack\u0026lt;Integer\u0026gt; stack = new Stack\u0026lt;\u0026gt;(); 3 int maxLen = 0; 4 stack.push(-1); 5 6 for (int i = 0; i \u0026lt; s.length(); i++) { 7 char c = s.charAt(i); 8 if (c == \u0026#39;(\u0026#39;) { 9 stack.push(i); 10 }else { 11 stack.pop(); // è¿™ä¸ªå¯èƒ½æ˜¯ ç›¸åŒ¹é…çš„ \u0026#34;(\u0026#34; or åŸºå‡†è¾¹ç•Œ 12 13 if (!stack.isEmpty()) { // ç›¸åŒ¹é…çš„ \u0026#34;(\u0026#34; 14 maxLen = Math.max(maxLen, i - stack.peek()); 15 }else { 16 stack.push(i); // æ›´æ–°åŸºå‡†è¾¹ç•Œ 17 } 18 } 19 } 20 return maxLen; 21} åŠ¨æ€è§„åˆ’åšæ³•\ndp[i] å­ä¸²é•¿åº¦ä¸ºiçš„ å­—ç¬¦ä¸² çš„ æœ€é•¿æœ‰æ•ˆæ‹¬å·\n1# æ¡ä»¶è½¬ç§»æ–¹ç¨‹ï¼š 2 1. if s[i] == \u0026#34;)\u0026#34; 3 if s[i-1] == \u0026#34;(\u0026#34; dp[i-2]+2 4\tdp[i] = dp[i-2] + 2 [xxx]() 5 else == \u0026#34;)\u0026#34; dp[i-dp[i-1]-2]+dp[i-1]+2 6 dp[i] = dp[i-dp[i-1]-2]+dp[i-1]+2 [xxx] ( [xxx] ) 7 idx i-dp[i-1]-1 8 9æƒ…å†µ1ï¼š [xxx]() dp[i]=2+dp[i-2] 10æƒ…å†µ2ï¼š [xxx]([xxx]) dp[i]=2+dp[i-1] + dp[i-2-dp[i-1]] 11 (çš„idxä¸ºi-dp[i-1]-1 1public int longestValidParentheses(String s) { 2 int[] dp = new int[s.length()+1]; 3 Arrays.fill(dp, 0); 4 int maxLen = 0; 5 for (int i = 1; i \u0026lt; s.length(); i++) { 6 char c = s.charAt(i); 7 if (c == \u0026#39;)\u0026#39;) { 8 if (s.charAt(i-1) == \u0026#39;(\u0026#39; \u0026amp;\u0026amp; i-2 \u0026gt;= 0) 9 dp[i] = dp[i-2] + 2; 10 else if (i-dp[i-1]-1 \u0026gt;= 0 \u0026amp;\u0026amp; s.charAt(i-dp[i-1]-1) == \u0026#39;(\u0026#39;){ 11 dp[i] = dp[i-1] + 2 + (i-2-dp[i-1]\u0026gt;=0 ? dp[i-2-dp[i-1]]:0); 12 13 } 14 if (dp[i] \u0026gt; maxLen) 15 maxLen = dp[i]; 16 } 17 } 18 return maxLen; 19} æŠ€å·§é¢˜ åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— å¼‚æˆ–\n1binary: 8 4 2 1 2eg. 4 2 2 1 1 3=\u0026gt; 0100 0010 0010 0001 0001 4java =\u0026gt; ^ (XOR ) 5 60100 70010 =\u0026gt; 0110 8 90110 100010 =\u0026gt; 0100 11 120100 130001 =\u0026gt; 0101 14 150101 160001 =\u0026gt; 0100 17 18# æ€æƒ³ï¼šå¯¹å¶åŒå½’äºå°½ å¤šæ•°å…ƒç´  æšä¸¾å½“å‰å¯èƒ½çš„å€™é€‰äºº ï¼ˆæ‘©å°”æŠ•ç¥¨ï¼‰\n1nums = [2,2,1,1,1,2,2] 2 3count = [1,2,1,0,1,0,1] # æ‹¥ä¸¾ç¥¨æ•° 4candidate=[2,2,2,2,1,1,2] # å½“å‰æœ€æœ‰å¯èƒ½çš„å€™é€‰å…ƒç´  é¢œè‰²åˆ†ç±» è·å…°å›½æ——é—®é¢˜\n[1,2,0,1,0,2] =\u0026gt; [0,0,1,1,2,2] å…ƒç´ åˆ†ç»„\nåŒæŒ‡é’ˆæ³•ï¼š\n[0,\u0026hellip;,0]P0\nP0[1,\u0026hellip;,1]P2\nP2[2,\u0026hellip;,2]\nåˆ¤æ–­iå½“å‰çš„å…ƒç´ è§†è§’ã€‚è¿›è¡Œäº¤æ¢\nä¸‹ä¸€ä¸ªæ’åº æ•°å­—ç»„åˆé€’å¢\n# 1 æ ‘çŠ¶ç»“æ„â­â­â­â—â—â—\n1# 1,2,3 2\t[] 3\t1 2 3 4\t2 3 1 3 1 2 5 3 2 3 1 2 1 æ‰¾[23541]ä¸‹ä¸€ä¸ªæ’åº [24135]\n1 å®šä½ 1å·å…ƒç´  [ä»åå¾€å‰éå†ï¼Œéé€’å¢çš„ç¬¬ä¸€ä¸ªå…ƒç´ ] =\u0026gt; 3\nâ€‹ [2]3[541]\n2 [541]ä¸­æ‰¾æ¯”3å¤§çš„æœ€å°å…ƒç´  =\u0026gt; 4 \u0026amp;\u0026amp; äº¤æ¢\nâ€‹ [2]4[531] =\u0026gt; é€†åº\n3 =\u0026gt; [2]4[135]\n1 .2] 2 .3 4] 3 1 4 .5 1] 4 [...] .4 3] 5 .1 5] 287. å¯»æ‰¾é‡å¤æ•° ç»™å®šä¸€ä¸ªåŒ…å« n + 1 ä¸ªæ•´æ•°çš„æ•°ç»„ nums ï¼Œå…¶æ•°å­—éƒ½åœ¨ [1, n] èŒƒå›´å†…ï¼ˆåŒ…æ‹¬ 1 å’Œ nï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚\nå‡è®¾ nums åªæœ‰ ä¸€ä¸ªé‡å¤çš„æ•´æ•° ï¼Œè¿”å› è¿™ä¸ªé‡å¤çš„æ•° ã€‚\nä½ è®¾è®¡çš„è§£å†³æ–¹æ¡ˆå¿…é¡» ä¸ä¿®æ”¹ æ•°ç»„ nums ä¸”åªç”¨å¸¸é‡çº§ O(1) çš„é¢å¤–ç©ºé—´ã€‚\n1idx: [0,1,2,3,4] 2input: [1,3,4,2,2] // é¡ºåºè¡¨ï¼Œæ•°ç»„ä½œä¸ºé“¾è¡¨ ç­‰ä»·äºæ‰¾ç¯çš„å…¥å£ã€‚\n1public int findDuplicate(int[] nums) { 2 int fast = 0; int slow = 0; 3 while(true) { 4 fast = nums[nums[fast]]; 5 slow = nums[slow]; 6 if(fast == slow) { 7 int idx1 = 0; 8 int idx2 = fast; 9 while(idx1 != idx2) { 10 idx1 = nums[idx1]; 11 idx2 = nums[idx2]; 12 } 13 return idx1; 14 } 15 } 16} åŸç†ï¼šç”±äºå­˜åœ¨çš„é‡å¤çš„æ•°å­— targetï¼Œå› æ­¤ target è¿™ä¸ªä½ç½®ä¸€å®šæœ‰èµ·ç ä¸¤æ¡æŒ‡å‘å®ƒçš„è¾¹ï¼Œå› æ­¤æ•´å¼ å›¾ä¸€å®šå­˜åœ¨ç¯ï¼Œä¸”æˆ‘ä»¬è¦æ‰¾åˆ°çš„ target å°±æ˜¯è¿™ä¸ªç¯çš„å…¥å£ â—â—â—ä»…æœ‰ä¸€ä¸ªé‡å¤ã€‚ é‡å¤ä½ç½® å…¥åº¦ä¸º2 =\u0026gt; ç¯çš„å…¥å£ä½ç½®\nå¤šç»´åŠ¨æ€è§„åˆ’ 62. ä¸åŒè·¯å¾„ ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œStartâ€ ï¼‰ã€‚\næœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œFinishâ€ ï¼‰ã€‚\né—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ\ndp[i][j]è¡¨ç¤ºåˆ°è¯¥ä½ç½®çš„å¯èƒ½çš„è·¯å¾„æ•°ï¼Œä»…å¯ä»¥å¾€å³å’Œä¸‹ç§»åŠ¨(è¿™ä¸ªé™åˆ¶ï¼Œåˆ›å»ºäº†è½¬ç§»æ–¹ç¨‹çš„æ¡ä»¶)\ndp[i][j] = dp[i-1][j] + dp[i][j-1] \\\\ ä»…ä»ä¸Šé¢å’Œå·¦è¾¹åˆ°è¯¥ä½ç½®\nåˆå§‹åŒ–\n1 1 1 1 21 31 41 64. æœ€å°è·¯å¾„å’Œ ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„ *m* x *n* ç½‘æ ¼ grid ï¼Œè¯·æ‰¾å‡ºä¸€æ¡ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„ä¸Šçš„æ•°å­—æ€»å’Œä¸ºæœ€å°ã€‚\n**è¯´æ˜ï¼š**æ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚\ndp[i][j]: åˆ°è¯¥ä½ç½®æœ€å°çš„æ•°å­—å’Œ(æœ€å°çš„ä»£ä»·)\n=Min(dp[i-1][j], dp[i][j-1]) + current_grid_value\nåˆå§‹åŒ–\n1 s0 s1 s2 // ç´¯åŠ  2t0 3t1 4t2 5. æœ€é•¿å›æ–‡å­ä¸² ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„ å›æ–‡ å­ä¸²ã€‚\ndp[i][j]: å­—ä¸²i-jæ˜¯å¦ä¸ºå›æ–‡å­—ä¸²ã€‚\nè½¬ç§»æ¡ä»¶{\nâ€‹\tå¦‚æœå­—ä¸²ä¸º ?? æˆ–è€… ?x? ä¸”é¦–å°¾å­—ç¬¦ç›¸ç­‰ =\u0026gt; True,\nâ€‹\tå¦‚æœå­—ä¸²ä¸º?xxx? ä¸”é¦–å°¾å­—ç¬¦ç›¸ç­‰ ä¸” dp[i+1][j-1]=True =\u0026gt; True\n}\nåˆå§‹åŒ–\n1s = \u0026#34;caddab\u0026#34; 2 3 0 1 2 3 4 5 40 T 51 T 62 T 73 T 84 T 95 T 10 11T ca cad cadd cadda caddab 12 T ad add a[dd]a addab \u0026lt;= 13 T [dd] dda ddab \u0026lt;= 14 T da dab 15 T ab 16 T 17 ^ 18 / è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸º[i+1][j-1]çš„åŸå› ï¼Œåˆ©ç”¨ä¹‹å‰çš„çŠ¶æ€ æœ€é•¿é‡å¤å­æ•°ç»„ è¾“å…¥ï¼šnums1 = [1,2,3,2,1], nums2 = [3,2,1,4,7]\rè¾“å‡ºï¼š3\rè§£é‡Šï¼šé•¿åº¦æœ€é•¿çš„å…¬å…±å­æ•°ç»„æ˜¯ [3,2,1] ã€‚ å­æ•°ç»„ä¸ºè¿ç»­çš„éƒ¨åˆ†\ndp[i][j] å«ä¹‰ï¼Œ (0 - i-1)å’Œ(0 - j-1)çš„æ•°ç»„çš„æœ€é•¿é‡å¤å­æ•°ç»„\nè½¬ç§»æ–¹ç¨‹ï¼š\nâ€‹\tif nums1[i-1] == nums2[j-1]:\nâ€‹\tdp[i][j] = dp[i-1][j-1] + 1 // åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šæœ€é•¿å­æ•°ç»„+1\nelse:\nâ€‹ 0 // å› ä¸ºå·²ç»ä¸è¿ç»­äº†\n1 \u0026#34;\u0026#34; \u0026#34;1\u0026#34; \u0026#34;12\u0026#34; \u0026#34;123\u0026#34; \u0026#34;1232\u0026#34; \u0026#34;12321\u0026#34; 2 \u0026#34;\u0026#34; 0 0 0 0 0 0 3 \u0026#34;3\u0026#34; 0 0 0 1 0 0 4 \u0026#34;32\u0026#34; 0 0 1 0 [2] 0 5 \u0026#34;321\u0026#34; 0 1 0 0 0 [3] 6 \u0026#34;3214\u0026#34; 0 0 0 0 0 0 7\u0026#34;32147\u0026#34; 0 0 0 0 0 0 dp[i][j] = dp[i-1][j-1] + 1 // åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šæœ€é•¿å­æ•°ç»„+1â­â­â­\n1143. æœ€é•¿å…¬å…±å­åºåˆ— è¾“å…¥ï¼štext1 = \u0026#34;abcde\u0026#34;, text2 = \u0026#34;ace\u0026#34; è¾“å‡ºï¼š3 è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ \u0026#34;ace\u0026#34; ï¼Œå®ƒçš„é•¿åº¦ä¸º 3 ã€‚ å­åºåˆ—ï¼Œç›¸å¯¹ä½ç½®ä¿æŒä¸å˜å°±è¡Œï¼Œä¸è¦æ±‚è¿ç»­\ndp[i][j] å«ä¹‰ï¼Œ (0 - i-1)å’Œ(0 - j-1)çš„æ•°ç»„çš„æœ€é•¿å…¬å…±å­åºåˆ—\nè½¬ç§»æ–¹ç¨‹ï¼š\nâ€‹\tif nums1[i-1] == nums2[j-1]:\nâ€‹\tdp[i][j] = dp[i-1][j-1] + 1 // åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šæœ€é•¿å­æ•°ç»„+1\nelse:\nâ€‹ dp[i][j] = Max(dp[i-1][j], dp[i][j-1]) // ä¸è¦æ±‚è¿ç»­\nåˆå§‹åŒ–ï¼š\n1 \u0026#34;\u0026#34; \u0026#34;a\u0026#34; \u0026#34;ab\u0026#34; \u0026#34;abc\u0026#34; \u0026#34;abcd\u0026#34; \u0026#34;abcde\u0026#34; 2 \u0026#34;\u0026#34; 0 0 0 0 0 0 3 \u0026#34;a\u0026#34; 0 1 1 1 1 1 4 \u0026#34;ac\u0026#34; 0 1 1 2 2 2 5\u0026#34;ace\u0026#34; 0 1 1 2 2 3 72. ç¼–è¾‘è·ç¦» åªèƒ½æ‰§è¡Œ æ–°å¢ï¼Œåˆ é™¤ï¼Œæ›¿æ¢ä¸‰ä¸ªæ“ä½œã€‚\nè¾“å…¥ï¼šword1 = \u0026#34;horse\u0026#34;, word2 = \u0026#34;ros\u0026#34;\rè¾“å‡ºï¼š3\rè§£é‡Šï¼š\rhorse -\u0026gt; rorse (å°† \u0026#39;h\u0026#39; æ›¿æ¢ä¸º \u0026#39;r\u0026#39;)\rrorse -\u0026gt; rose (åˆ é™¤ \u0026#39;r\u0026#39;)\rrose -\u0026gt; ros (åˆ é™¤ \u0026#39;e\u0026#39;) dp[i][j] å«ä¹‰ï¼Œ å°†(0 - i-1) å˜ä¸º (0 - j-1)çš„æœ€å°æ“ä½œã€‚\nçŠ¶æ€è½¬ç§»ï¼š\nâ€‹\tif word1[i-1] == word2[j-1]:\nâ€‹\tdp[i][j] = dp[i-1][j-1] // ä»€ä¹ˆéƒ½ä¸éœ€è¦åšï¼Œå¿½ç•¥æ‰è¿™ä¸ªå•è¯\nâ€‹\telse:\nâ€‹ dp[i][j] = Min(Min( dp[i-1][j], dp[i][j-1] ), dp[i-1][j-1])\nä»ä¸Šorå³ï¼Œæ–°å¢ä¸€ä¸ªå…ƒç´ ï¼Œorå·¦ä¸Šè§’ä¿®æ”¹ä¸€ä¸ªå…ƒç´ \né€’æ¨æ–¹å‘ï¼š\n1i-1,j-1 i-1,j 2 â†˜ï¸ â¬‡ï¸ 3i,j-1 â¡ï¸ i,j 4 5â¬‡ï¸â¡ï¸ï¼š æ–°å¢ä¸€ä¸ªå…ƒç´  ä»¥åŒ¹é… 6â†˜ï¸ï¼š ä¿®æ”¹ä¸€ä¸ªå…ƒç´ ï¼Œä»¥åŒ¹é… åˆå§‹åŒ–ï¼š\n1 \u0026#34;\u0026#34; \u0026#34;h\u0026#34; \u0026#34;ho\u0026#34; \u0026#34;hor\u0026#34; \u0026#34;hors\u0026#34; \u0026#34;horse\u0026#34; 2 \u0026#34;\u0026#34; 0 1 2 3 4 5 3 \u0026#34;r\u0026#34; 1 4 \u0026#34;ro\u0026#34; 2 5\u0026#34;ros\u0026#34; 3 ","permalink":"http://longcoding.top/posts/leetcode/leetcode_hot100/","summary":"\u003ch2 id=\"çƒ­é¢˜100\"\u003eçƒ­é¢˜100\u003c/h2\u003e\n\u003ch3 id=\"å“ˆå¸Œ\"\u003eå“ˆå¸Œ\u003c/h3\u003e\n\u003ch5 id=\"1-ä¸¤æ•°ä¹‹å’Œ\"\u003e\u003ca href=\"https://leetcode.cn/problems/two-sum/\"\u003e1. ä¸¤æ•°ä¹‹å’Œ\u003c/a\u003e\u003c/h5\u003e\n\u003cp\u003eç»™å®šï¼š æ•°ç»„nums å’Œtarget\u003c/p\u003e\n\u003cp\u003eè¦æ±‚ï¼šæ‰¾å‡ºä¸¤å…ƒç´ ä¹‹å’Œä¸ºtargetçš„æ•°ç»„ä¸‹æ ‡\u003c/p\u003e\n\u003cp\u003eæš´åŠ›ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# O(n^2)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé¢˜è§£ï¼š\u003c/p\u003e\n\u003cp\u003eé—®é¢˜åˆ†è§£ =\u0026gt;  ç»™å®šx å¯»æ‰¾ target-x(è¿™æ˜¯å¤æ‚åº¦çš„ä¸»è¦éƒ¨åˆ†)\u003c/p\u003e\n\u003cp\u003eç”¨é¢å¤–ç»“æ„è®°å½•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ehashtable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edict\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e3\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ehashtable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e4\u003c/span\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehashtable\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]]]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e5\u003c/span\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e6\u003c/span\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ehashtable\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä¿å­˜éå†è¿‡çš„å…ƒç´ ï¼Œå‚è€ƒè¿‡å»\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"49-å­—æ¯å¼‚ä½è¯åˆ†ç»„\"\u003e\u003ca href=\"https://leetcode.cn/problems/group-anagrams/\"\u003e49. å­—æ¯å¼‚ä½è¯åˆ†ç»„\u003c/a\u003e\u003c/h5\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eè¾“å…¥: strs = [\u0026#34;eat\u0026#34;, \u0026#34;tea\u0026#34;, \u0026#34;tan\u0026#34;, \u0026#34;ate\u0026#34;, \u0026#34;nat\u0026#34;, \u0026#34;bat\u0026#34;]\r\nè¾“å‡º: [[\u0026#34;bat\u0026#34;],[\u0026#34;nat\u0026#34;,\u0026#34;tan\u0026#34;],[\u0026#34;ate\u0026#34;,\u0026#34;eat\u0026#34;,\u0026#34;tea\u0026#34;]]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ€è·¯ï¼šcondition =\u0026gt; [\u0026hellip;]\u003c/p\u003e\n\u003cp\u003eHashTable,  Key=æ’åºåçš„Str, Value=List\u0026lt;String\u0026gt;\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eHashMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ehashTable\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eHashMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estrs\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e[]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003echarArray\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etoCharArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eArrays\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003esort\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echarArray\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// å¯¹å­—ç¬¦æ•°ç»„è¿›è¡Œæ’åº\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eorderStr\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echarArray\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehashTable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003econtainsKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eorderStr\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003ehashTable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eorderStr\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"na\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003ehashTable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eorderStr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003ehashTable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eorderStr\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"na\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e12\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e13\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e14\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e15\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e16\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eEntry\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eentry\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ehashTable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eentrySet\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e17\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e18\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e19\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"128-æœ€é•¿è¿ç»­åºåˆ—\"\u003e\u003ca href=\"https://leetcode.cn/problems/longest-consecutive-sequence/\"\u003e128. æœ€é•¿è¿ç»­åºåˆ—\u003c/a\u003e\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eInteger\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ehashSet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e// å»é‡å¤ï¼Œå¹¶ä¸”æŸ¥è¯¢O(1)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003ehashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eInteger\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estart_nums\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e// æ‰¾æ‰€æœ‰ä¸ºèµ·ç‚¹çš„æ•°\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eInteger\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ehashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eiterator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ehasNext\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e12\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ehashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)){\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e13\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003estart_nums\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e14\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e15\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e16\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e17\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e// éå†èµ·ç‚¹x, éå† x+1, x+2, ...\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e18\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003elongest_length\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e19\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estart_nums\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e20\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_length\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e21\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estart_i\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e22\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estart_i\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e23\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_length\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e+=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e24\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003estart_i\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e+=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e25\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e26\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_length\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003elongest_length\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e27\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003elongest_length\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_length\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e28\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e29\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e30\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003elongest_length\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e31\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"åŒæŒ‡é’ˆ\"\u003eåŒæŒ‡é’ˆ\u003c/h3\u003e\n\u003ch5 id=\"283-ç§»åŠ¨é›¶\"\u003e\u003ca href=\"https://leetcode.cn/problems/move-zeroes/\"\u003e283. ç§»åŠ¨é›¶\u003c/a\u003e\u003c/h5\u003e\n\u003cp\u003eç»™å®šä¸€ä¸ªæ•°ç»„ \u003ccode\u003enums\u003c/code\u003eï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ \u003ccode\u003e0\u003c/code\u003e ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„\u003cstrong\u003eç›¸å¯¹é¡ºåº\u003c/strong\u003e(åŸå§‹æ•°ç»„ä½ç½®ï¼Œéä¸æ˜¯é‡æ–°æ’åº)ã€‚\u003c/p\u003e","title":"LeetCodeHot100åˆ·é¢˜ç¬”è®°"},{"content":"è®ºæ–‡ â­IM-ECG - 2023 IM-ECG: An interpretable framework for arrhythmia detection using multi-lead ECG - Expert Systems With Applications sci-1\nåˆ›æ–°ç‚¹:\nConv2Dæ¨¡å‹ä¸Grad-CAMçš„é€‚é…æ›´å¥½ - å®æ—¶æ ‡æ³¨ç—…ç†åŒºåŸŸ è§£é‡Šæ€§\nåŒæ ¸æ®‹å·®å— - æ¨ªè½´ä¸ç«–è½´+é¢ ä¸‰ç§æ‰«ææ–¹å¼\nk * n(åŒºåŸŸæ‰«æ)å†…æ ¸æœå‘ä¸­å¿ƒå‹ç¼©ECGä»¥æ›´ç›´æ¥åœ°æ•è·å¯¼è”é—´ç‰¹å¾ï¼Œè€Œ1 * n(æ¨ªè½´æ‰«æ)å†…æ ¸æ²¿ç€æ—¶é—´ç»´åº¦å‹ç¼©ECGå¹¶ä¸”å› æ­¤æ›´å…³æ³¨å¯¼è”å†…ç‰¹å¾\næµç¨‹å›¾ç¤º\næ¨¡å‹ç»“æ„\nBlock\nLightweight Transformer - 2022 Enhancing dynamic ECG heartbeat classification with lightweight transformer model\nArtificial Intelligence In Medicine sci-1\nåˆ›æ–°ç‚¹ï¼š\nä¸¤çº§æ³¨æ„åŠ›æœºåˆ¶ï¼š å±€éƒ¨ + å…¨å±€ // å±€éƒ¨æ³¨æ„åŠ› == é€šé“æ³¨æ„åŠ› SEBlock || å…¨å±€æ³¨æ„åŠ› == Transformer Encoder\nå·ç§¯ç»“æ„æ¥ä»£æ›¿è‡ªæ³¨æ„\nInput: æ£€æµ‹Rå³°åˆ†æ®µ\næ¨¡å‹æ¡†æ¶\rCNN Block\rCNN+Attentionæ¥æå–å¿ƒè·³å†…éƒ¨çš„ç‰¹å¾\nlight-Conv Attention\rGLU: gated linear unit\nLconv: depth-wise Convolution\nSE-ECGNet - 2020 SE-ECGNet: A Multi-scale Deep Residual Network with Squeeze-and-Excitation Module for ECG Signal Classification\n2020 IEEE International Conference on Bioinformatics and Biomedicine (BIBM)\nåˆ©ç”¨ECGä¿¡å·ä¸­çš„å¤šå¯¼è”ä¿¡æ¯ï¼Œå°†å¤šå°ºåº¦äºŒç»´å·ç§¯å—ä¸ä¸€ç»´å·ç§¯å—ç»“åˆèµ·æ¥è¿›è¡Œç‰¹å¾æå–\nåˆ›æ–°ç‚¹\næä¾›å¯¹å¿ƒç”µæ•°æ®çš„ä¸åŒè§†è§’ å°†ECGä¿¡å·è§†ä¸ºäºŒç»´å›¾ç‰‡(å•é€šé“ç°åº¦å›¾)\næ¨¡å‹æ¡†æ¶\rCNN Block\rå‰æœŸè¾ƒå¤§çš„å·ç§¯æ ¸å¯ä»¥æ‰©å¤§æ„Ÿå—é‡ï¼Œæå–æ›´åŠ å¹¿æ³›çš„ä¿¡æ¯ï¼ŒåæœŸè¿›è¡Œä¿¡æ¯æµ“ç¼©æå–\nâ­MVMS-ECG - 2023 A Multi-View Multi-Scale Neural Network for Multi-Label ECG Classification\nIEEE Transactions on Emerging Topics in Computational Intelligence sci-2\nåˆ›æ–°ç‚¹ï¼š\nå°†å¯¼è”æŒ‰ç…§è¿æ¥è§‚æµ‹è§’åº¦åˆ†ç»„ åˆ†è§†å›¾çš„èåˆç½‘ç»œä¸ºæ•™å®¤ç½‘ç»œ(å‚æ•°å¤§) =è’¸é¦\u0026gt; å•è§†å›¾çš„å­¦ç”Ÿç½‘ç»œ\næ¨¡å‹ç»“æ„\nCNN Layers\nFusion Layer\nå¦‚æœæ˜¯å¤šè§†å›¾ï¼Œé‚£ä¹ˆå°±ä¸è¦æœ€åçš„FCå°†æœ€åç‰¹å¾æ˜ å°„ä¸ºç±»åˆ«æ•°ï¼›\næºç  =\u0026gt; æ¯ä¸ªè§†å›¾outputéƒ½æ˜¯ [B, 128] =\u0026gt; é‡æ–°åŠ æƒ(128=\u0026gt;1çš„linearå……å½“è°ƒå’Œå™¨) =\u0026gt; è¿‡å¤šè§†å›¾çš„FC(128 =\u0026gt; num_class)\nMulti-scale Conv Block\nç½‘ç»œçš„å¤šå°ºåº¦è¡¨ç¤ºåœ¨æ›´ç»†ç²’åº¦çš„çº§åˆ«ä¸Šå¾—åˆ°å¢å¼º - é‡‡ç”¨Res2Block\nCoordinate Attention 1D\næ—¢å»ºç«‹äº†ç‰¹å¾é€šé“é—´çš„å…³ç³»ï¼Œå¯¹å„é€šé“çš„é‡è¦æ€§è¿›è¡Œé‡æ–°åŠ æƒï¼Œåˆè·å¾—äº†ç‰¹å¾ç©ºé—´ä¸­çš„ç©ºé—´ä¿¡æ¯\nMVKT-ECG - 2023 MVKT-ECG: Efficient single-lead ECG classification for multi-label arrhythmia by multi-view knowledge transferring\nComputers in Biology and Medicine sci-2\nåˆ›æ–°ç‚¹ï¼š\nâ€‹\t# å¤šå¯¼è”ä¿¡æ¯å¦‚ä½•è’¸é¦åˆ°å•å¯¼è”ä¸­\nä¸åŒå¯¼è”æ˜¯æ£€æµ‹å¿ƒè„çŠ¶å†µçš„ä¸åŒè§†è§’ï¼Œæä¾›å¯¹ç›®æ ‡ç–¾ç—…çš„å¤šç§è§‚æµ‹ç‚¹å’Œå¤šç§å¤–è²Œ\n=\u0026gt; ç›®æ ‡ï¼šæ˜¯æ•™ä¼šç½‘ç»œä»å•å¯¼è”ECGä¿¡å·ä¸­æ¢å¤å°½å¯èƒ½å¤šçš„å…¨å¯¼è”ä¿¡æ¯\nå¯¼è”å…±åŒä¿¡æ¯çš„çŸ¥è¯†è’¸é¦ è™½ç„¶æœ‰äº›ç–¾ç—…ä¸èƒ½ä»å•å¯¼è”ECGä¿¡å·ä¸­æ¨æ–­å‡ºæ¥ï¼Œä½†æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°½å¯èƒ½ç¼©çŸ­å•å¯¼è”ECGè§£é‡Šæ¨¡å‹å’Œå¤šå¯¼è”ECGè§£é‡Šæ¨¡å‹ä¹‹é—´çš„ä¿¡æ¯å·®è·ï¼Œé¼“åŠ±å­¦ç”Ÿæ›´å¤šåœ°å…³æ³¨æŸäº›ç‰¹å®šç–¾ç—…çš„å…³é”®ç»†èŠ‚ï¼Œæœ€å¤§é™åº¦åœ°åˆ©ç”¨å•å¯¼è”ECGè§£é‡Šæ¨¡å‹å’Œå¤šå¯¼è”ECGè§£é‡Šæ¨¡å‹ä¹‹é—´çš„ç–¾ç—…ä¿¡æ¯ã€‚\n=\u0026gt; é€šè¿‡ç¼©çŸ­å­¦ç”Ÿæ¨¡å‹å’Œæ•™å¸ˆæ¨¡å‹å¯¹ç§¯æå¯¹çš„è¡¨ç¤ºå¹¶å°†â€œæ¶ˆæ\u0026quot;å¯¹ä¹‹é—´çš„è¡¨ç¤ºåˆ†å¼€æ¥å®ç°çš„\nâ­â­â­æœ€å¤§åŒ–å•å¯¼è”ECGä¿¡å·å’Œå¤šå¯¼è”ECGä¿¡å·ä¹‹é—´çš„äº’(å…±åŒ)ä¿¡æ¯æ¥ä¼ é€’æœ‰ç”¨çš„ç–¾ç—…ä¿¡æ¯ã€‚\nå› ä¸ºï¼šä»å•å¯¼è”ECGä¿¡å·ä¸­æå–çš„ç–¾ç—…ä¿¡æ¯æ¯”12å¯¼è”ECGä¿¡å·å°‘ï¼Œä½†ä»åŒ…å«éƒ¨åˆ†ç–¾ç—…ä¿¡æ¯ã€‚\nâ—â—â— å¼•å‡ºCLT-Loss å¤ªéš¾äº†ï¼Œæ²¡çœ‹\né¢å‘ç‰¹å¾ä¸ç‰¹å¾çš„ç›¸ä¼¼åº¦ ä¸ æœ€ç»ˆé¢„æµ‹å’Œæ ‡ç­¾çš„Lossç›®çš„ä¸ä¸€æ ·\nå¤šæ ‡ç­¾çŸ¥è¯†è’¸é¦çš„ä¼˜åŒ– ä»¿ç…§CE-Loss å’Œ BCE-Loss\nMulti-Modal + Instance - 2023 Multimodal multi-instance learning for long-term ECG classification - Knowledge-Based Systems\nèŠ‚æ‹ è§†ä¸º å®ä¾‹\nåŒæ¨¡æ€ï¼šä¸€ç»´ä¿¡å· + äºŒç»´å›¾ç‰‡\nå¤šæ¨¡æ€ä¿¡æ¯èåˆ ä¼ ç»Ÿï¼š\næ–°æ–¹æ³•\nâ€‹\té€šè¿‡ä½¿ç”¨æœ€å¤§æ± åŒ–æ“ä½œä»æ¯ä¸ªæ¨¡æ€çš„å®ä¾‹ç‰¹å¾ä¸­é€‰æ‹©é¡¶éƒ¨æ¿€æ´»å®ä¾‹ç‰¹å¾(ä»£è¡¨)ã€‚ç„¶åè®¡ç®—é¡¶éƒ¨æ¿€æ´»å®ä¾‹ç‰¹å¾å’Œæ‰€æœ‰å‰©ä½™å®ä¾‹ç‰¹å¾ä¹‹é—´çš„ç›¸å…³æ€§åˆ†æ•°ä»¥è·å¾—ç‰¹å¾å‘é‡ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªä¸¤ç§æ¨¡æ€çš„ä¿¡æ¯ã€‚æœ€åï¼Œå°†ç‰¹å¾å‘é‡å’Œé¡¶éƒ¨æ¿€æ´»å®ä¾‹ç‰¹å¾å‘é‡èåˆï¼Œå¾—åˆ°æ¯ä¸ªæ¨¡æ€çš„bagç‰¹å¾ã€‚æ¯ç§æ¨¡æ€çš„è¢‹å­ç‰¹å¾é€šè¿‡çº¿æ€§å±‚æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¾—åˆ°æœ€ç»ˆçš„è¢‹å­ç‰¹å¾ã€‚\nMulti Res Trans Net - 2023 Multi-scale SE-ResBlock + Transformer Encoder\nMulti-scale SE-residual network with transformer encoder for myocardial infarction classification Applied Soft Computing sci-1\næå–å±€éƒ¨ç‰¹å¾å’Œå…¨å±€ç‰¹å¾\næ¨¡å‹ç»“æ„\nåˆ†æ®µ - ç”¨å…·æœ‰é‡å çš„æ»‘åŠ¨çª—å£\nMulti-scale sample layer\nå¤šå°ºåº¦é‡‡æ ·æ¨¡å— åç§°ä¸é”™\nSE-Resnet Block\nCPC\nGAP(å…¨å±€å¹³å‡æ± åŒ–)å®šä½çš„æ˜¯æ•´ä½“åŒºåŸŸï¼Œè€ŒGMP(å…¨å±€æœ€å¤§æ± åŒ–)å®šä½çš„æ˜¯ç›®æ ‡åŒºåŸŸä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚\nâ­Dual-Branch CNN-Trans + Select - 2023 A token selection-based multi-scale dual-branch CNN-transformer network for 12-lead ECG signal classification\nKnowledge-Based Systems sci-1\næ¨¡å‹ç»“æ„\nRRè¡¨ç¤ºè®¡ç®—ä¸¤ä¸ªåˆ†æ”¯ä¸­CLS tokenä¹‹é—´çš„ç›¸å…³ç³»æ•° =\u0026gt; RR-Loss è¿«ä½¿ä¸¤ä¸ªåˆ†æ”¯æœç€æœ€ç»ˆé¢„æµ‹åŒå‘è€Œè¡Œ\nCNN Blocks\nâƒ+ is element-wise addition\nMSEL\nä¸€èˆ¬é‡‡ç”¨ViTä¸­çš„åµŒå…¥, Conv1Då®ç°\né€šè¿‡ä¸åŒå¤§å°çš„TokenåµŒå…¥,æˆ–è®¸å¯ä»¥æ•è·åˆ°ä¸åŒçš„æ¨¡å¼\nToken Select\nåˆ æ‰å†—ä½™çš„Token,æˆ–è®¸å¯ä»¥åœ¨è®ºæ–‡ä¸­å¯è§†åŒ–ä¸€ä¸‹è‡ªæ³¨æ„åŠ›å›¾,ç›´è§‚çš„æè¿°å†—ä½™\nECGNet - 2018 ECGNet: Deep Network for Arrhythmia Classification\nInception Block + Conv Block Ã— N\nMulti module: LSTM + CNN + AutoEncoder Multi-module Recurrent Convolutional Neural Network with Transformer Encoder for ECG Arrhythmia Classification\nECG Dual-path RNN - 2022/8 Single-lead ECG recordings modeling for end-to-end recognition of atrial fibrillation with dual-path RNN\nBiomedical Signal Processing and Control äºŒåŒº\nSegmentation:\n[batch, 1, L] =\u0026gt; [batch, num_seg, len_seg]\né‡å 50%\nOverlap-Add:\nâ€‹\tSegmentationçš„é€†æ“ä½œï¼Œé‡å ç›¸åŠ \nRNNä¸ºBi-LSTM\nLSTM è¾“å…¥æ•°æ®æ ¼å¼ Batch, num_seq, len_seq\næ®µé—´å»ºæ¨¡ + æ®µå†…å»ºæ¨¡\nå›¾ä¾‹ï¼š\nç±»ä¼¼MLP-Mixerï¼Œç”¨RNNå»ºæ¨¡ä¿¡æ¯èåˆï¼ŒéšçŠ¶æ€ä¼ é€’æ—¶åºä¿¡æ¯\nâ­MINA - Signal Processing 2019 MINA: Multilevel Knowledge-Guided Attention for Modeling Electrocardiography Signals\nåšæ³•ï¼š\nç‰¹å¾å·¥ç¨‹ï¼šä»å¿ƒç”µå›¾æ³¢å½¢ä¸­æå–ä¿¡æ¯ç‰¹å¾ =\u0026gt; ä¼ ç»Ÿæœºå™¨å­¦ä¹ è¿›è¡Œå¤„ç† =\u0026gt; ç»“æœ\næ¢ç´¢P-QRS-T æ³¢çš„å„ç§å¹…åº¦å’ŒæŒç»­æ—¶é—´ç‰¹å¾ï¼ŒåŒ…æ‹¬ç”¨äºåˆ†ç±»çš„å½¢æ€å­¦ å’Œ RR é—´æœŸç‰¹å¾ // Hermiteå˜æ¢å’Œå°æ³¢å˜æ¢\nâ—â—â—ä¾èµ–äºæå–çš„ç‰¹å¾ï¼Œå¾ˆå®¹æ˜“å—åˆ°å™ªå£°å¹²æ‰°ï¼Œç‰¹å¾æ²¡æå–å¥½ï¼Œåç»­å·¥ä½œå¾ˆéš¾è¿›å±•\næ³¨æ„åŠ›å¼•å¯¼ç½‘ç»œå…³æ³¨é‡ç‚¹ ï¼ˆé€šç”¨è‡ªå­¦ä¹ æ³¨æ„åŠ›ï¼‰å’Œï¼ˆèåˆé¢†åŸŸçŸ¥è¯†çš„æ³¨æ„åŠ›ï¼‰\n3çº§æ³¨æ„åŠ›ï¼šï¼ˆèŠ‚æ‹çº§ã€èŠ‚å¾‹çº§å’Œé¢‘ç‡çº§ï¼‰é¢†åŸŸçŸ¥è¯†ç‰¹å¾\nâ­æå–ç‰¹å®šçº§åˆ«çš„é¢†åŸŸçŸ¥è¯†ç‰¹å¾å¹¶ä½¿ç”¨å®ƒä»¬æ¥å¼•å¯¼æ³¨æ„åŠ›ï¼ŒåŒ…æ‹¬å¼•å¯¼æ³¨æ„åŠ›CNNçš„èŠ‚æ‹å½¢æ€çŸ¥è¯†å’Œå¼•å¯¼æ³¨æ„åŠ›RNNçš„èŠ‚å¥çŸ¥è¯†\nâ­è·¨æ—¶åŸŸå’Œé¢‘åŸŸè¿›è¡Œæ³¨æ„åŠ›èåˆ\nèŠ‚æ‹çº§ï¼šä¸»è¦è€ƒè™‘å¼‚å¸¸çš„æ³¢å½¢æˆ–è¾¹ç¼˜ã€‚çŸ¥è¯†å¼•å¯¼çš„æ³¨æ„åŠ›æ¥èšåˆè¿™äº›ç‰¹å¾å¹¶è·å¾—èŠ‚æ‹çº§åˆ«æ³¨æ„åŠ›\nâ€‹\tå·ç§¯ç¥ç»ç½‘ç»œ (CNN) ç”¨äºå­¦ä¹ èŠ‚æ‹çº§åˆ«æ¨¡å¼\nèŠ‚å¾‹çº§ï¼šè€ƒè™‘å¼‚å¸¸èŠ‚å¾‹å˜åŒ–\nâ€‹\tå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰é€‚åˆæ•è·èŠ‚å¾‹ç‰¹å¾\næå–ç‰¹å®šçº§åˆ«çš„é¢†åŸŸçŸ¥è¯†ç‰¹å¾å¹¶ä½¿ç”¨å®ƒä»¬æ¥å¼•å¯¼æ³¨æ„åŠ›ï¼ŒåŒ…æ‹¬æŒ‡å¯¼æ³¨æ„åŠ› CNN çš„èŠ‚æ‹å½¢æ€çŸ¥è¯†å’ŒæŒ‡å¯¼æ³¨æ„åŠ› RNN çš„èŠ‚å¥çŸ¥è¯†\nè¯†åˆ«å…³é”®èŠ‚æ‹ä½ç½®ã€æ˜¾ç€çš„èŠ‚å¾‹å˜åŒ–ã€é‡è¦çš„é¢‘ç‡åˆ†é‡\nçŸ¥è¯†ç‰¹å¾ ä½œç”¨äº ç½‘ç»œç‰¹å¾\nç‰¹å®šçº§åˆ«çš„é¢†åŸŸçŸ¥è¯†ç‰¹å¾ - å¼•å¯¼æ³¨æ„åŠ›\nBeat Level\râ€‹\tä¸»è¦è€ƒè™‘å¼‚å¸¸æ³¢å½¢æˆ–æ€¥å‰§å˜åŒ–çš„ç‚¹ =\u0026gt; è®¡ç®—ä¸€é˜¶å·®åˆ† Î” å’Œæ¯ä¸ªç‰‡æ®µ s ä¸Šçš„å·ç§¯è¿ç®—\nâ€‹\tä¸€é˜¶å·®åˆ†ï¼š ç”¨æ¥æå–ä¿¡å·çš„å˜åŒ–è¶‹åŠ¿å’Œç‰¹å¾\nâ€‹\tRhythm Level\râ€‹\tè®¡ç®—æ¯ä¸ªç‰‡æ®µçš„æ ‡å‡†å·®ï¼Œä»¥æå–èŠ‚å¥æ°´å¹³çŸ¥è¯†ç‰¹å¾å‘é‡\nâ€‹\tæ ‡å‡†å·®ï¼šè¡¡é‡ä¿¡å·çš„ç¨³å®šæ€§ã€æ£€æµ‹å¼‚å¸¸å€¼ã€æè¿°ä¿¡å·æ³¢åŠ¨æ€§ã€æ¯”è¾ƒä¸åŒä¿¡å·ä¹‹é—´çš„æ³¢åŠ¨ç¨‹åº¦\nFrequency Level\râ€‹\tèƒ½é‡è¶Šå¤§çš„ä¿¡å·åŒ…å«çš„ä¿¡æ¯è¶Šå¤šï¼ŒåŠŸç‡è°±å¯†åº¦ï¼ˆPSDï¼‰æ¥æå–é¢‘ç‡çº§çŸ¥è¯†ç‰¹å¾å‘é‡\nâ€‹\té¢‘è°±åˆ†æå¯ä»¥è¾…åŠ©äº†è§£ä¿¡å·åœ¨ä¸åŒé¢‘ç‡ä¸‹çš„æˆåˆ†å’Œèƒ½é‡åˆ†å¸ƒæƒ…å†µ\nâ€‹\tåŠŸç‡è°±å¯†åº¦ä¼°è®¡æ˜¯è®¡ç®—ä¿¡å·åŠŸç‡åœ¨é¢‘åŸŸä¸Šçš„åˆ†å¸ƒ\nâ€‹\tä¾‹ï¼š100HzECGæ®µæ•°æ® =\u0026gt; periodogram(ä¼°è®¡ä¿¡å·çš„åŠŸç‡è°±å¯†åº¦çš„å‡½æ•°) =\u0026gt; è¿”å›é¢‘ç‡èŒƒå›´(0-50Hz)å’Œå¯¹åº”çš„åŠŸç‡å€¼ =\u0026gt; sum() æ€»é¢‘è°±å¯†åº¦\næ¨¡å‹æ¡†æ¶ï¼š\nInput: å•å¯¼è”å¿ƒç”µä¿¡å·\nFrequency Transformation Layer: å°†ä¿¡å·æŒ‰ç…§é¢‘ç‡åŒºåˆ†å¼€ï¼Œåˆ©ç”¨é«˜é€šæ»¤æ³¢å™¨ã€å¸¦é€šæ»¤æ³¢å™¨ï¼› 0-0.5Hz: ä½é¢‘æ¼‚ç§»ï¼›0.5-50hzï¼šä¸»è¦æˆåˆ†; \u0026gt;50Hz: å™ªå£°\n1### candidate channels for ECG 2P_wave = (0.67, 5) 3QRS_complex = (10, 50) 4T_wave = (1, 7) 5muscle = (5, 50)\t# è‚Œè‚‰å¹²æ‰° 6resp = (0.12, 0.5)\t# å‘¼å¸ä¿¡å· 7! 8 9ECG_preprocessed = (0.5, 50) # ï¼ï¼ï¼ ECGä¸»è¦éƒ¨åˆ† 10wander = (0.001, 0.5)\t# åŸºçº¿æ¼‚ç§» 11noise = 50 12 13# low (wander), middle (ECG_preprocessed) and high (noise) 14bandpass_list = [wander, ECG_preprocessed] 15highpass_list = [noise] Sliding Window Segmentation: å›ºå®šçª—å£ï¼Œé‡å åˆ†æ®µï¼ˆä¸ç”¨å…ˆå®šä½Rå³°å†åˆ†æ®µï¼‰\nè®¡ç®—ä¸€é˜¶å·®å•†ã€æ ‡å‡†å·®ã€åŠŸç‡è°±å¯†åº¦ä¼°è®¡ä½œä¸ºç»Ÿè®¡ç‰¹å¾\nå°†ç»Ÿè®¡ä¿¡æ¯ä½œä¸ºæ³¨æ„åŠ›å¼•å¯¼åµŒå…¥æ¨¡å‹ä¸­ï¼š\nLï¼š ç»è¿‡Convæå–æ®µå†…ä¿¡æ¯åçš„æ•°æ®\nHï¼šç»è¿‡RNNèåˆæ®µé—´ä¿¡æ¯åçš„æ•°æ®\n$$ V^{T} âˆˆ R^{1Ã—D_{Î±}} $$\nå†å°†Î±ä½œç”¨äºç‰¹å¾\næœ€åå°†ä¸åŒé¢‘ç‡åŒºåŸŸçš„è¾“å‡ºConcat é€šé“åœ¨ä¸€èµ·ï¼Œè¿‡é¢‘ç‡æ³¨æ„åŠ›é‡æ–°åŠ æƒ\nSelf-supervised - 2022 Self-supervised representation learning from 12-lead ECG data\nComputers in Biology and Medicine\né—®é¢˜ï¼š\nåŒ»å­¦é«˜è´¨é‡æ ‡ç­¾å¾ˆéš¾è·å¾—ï¼Œæˆæœ¬æ˜‚è´µ å…¬å¼€æ•°æ®é›†ä¸å¤Ÿå¤§ æœªæ ‡è®°æ•°æ®çš„æ•°é‡é€šå¸¸è¿œè¿œè¶…è¿‡æ ‡è®°æ•°æ®çš„æ•°é‡ ç»“åˆNLPã€è§†è§‰ã€è¯­éŸ³åœ¨æ— ç›‘ç£å­¦ä¹ çš„æˆåŠŸ\nâ¬‡ï¸\nåˆ›æ–°ï¼š\nä½¿ç”¨è‡ªç›‘ç£çš„æ–¹æ³•ï¼Œå®ç°ECGè¡¨å¾å­¦ä¹  å¯¹æ¯”å­¦ä¹ CPCæ¡†æ¶ç»“æ„\nä¸ºä»€ä¹ˆç”¨MLPä¸ç”¨CNNï¼Œå› ä¸ºECGé‡‡æ ·é¢‘ç‡ä¸º100Hzæ¯”éŸ³é¢‘å…¸å‹é‡‡ç”¨é¢‘ç‡10 kHzç²—ç³™ï¼Œä½¿ç”¨MLPè¿›è¡Œéçº¿æ€§æ˜ å°„\næ•°æ®é›†ï¼š\nç»“æœ\nè¯„ä»·æŒ‡æ ‡macro AUC\nçº¿æ€§è¯„ä¼°-å†»ç»“æ¨¡å‹å‚æ•°ï¼Œå°†åˆ†ç±»å¤´æ”¹ä¸ºçº¿æ€§å±‚ï¼ŒéªŒè¯æ¨¡å‹å­¦åˆ°çš„ç‰¹å¾è¡¨ç¤ºï¼›\nå¾®è°ƒ-åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šè¿›è¡Œå¾®è°ƒåˆ†ç±»å¤´å’Œéƒ¨åˆ†å‚æ•°ã€‚\né¢„è®­ç»ƒçš„è¡¨ç¤ºä¸ä¸‹æ¸¸åˆ†ç±»ä»»åŠ¡é«˜åº¦ç›¸å…³\nè‡ªç›‘ç£é¢„è®­ç»ƒæé«˜äº†ä¸‹æ¸¸åˆ†ç±»å™¨çš„ç¨³å¥æ€§\nè¡¨æ˜åœ¨å¤§æ•°æ®é›†ä¸Šé¢„è®­ç»ƒï¼Œåœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­ï¼Œéœ€è¦æ›´å°‘çš„æ ‡ç­¾æ•°æ®å°±å¯ä»¥è¾¾åˆ°æœ‰ç›‘ç£è®­ç»ƒçš„æ•ˆæœ\nMulti-scale Progressive Gated Transformer Multi-scale Progressive Gated Transformer for Physiological Signal Classification\nåˆ†ä¸¤æ­¥ï¼š\nç»†ç²’åº¦æ•è·å±€éƒ¨æ³¢å½¢å˜åŒ– ç²—ç²’åº¦æ•è·å…¨å±€è¶‹åŠ¿å˜åŒ– æ¡†æ¶ï¼š\nä½¿ç”¨Conv-MaxPool-Conv-AvgPool å®ç°åµŒå…¥\nå †å  MHSA-FFN-TCN-FFN æ¨¡å— (Temporal Convolution Net)\nåˆ†æ”¯èåˆï¼šx1 â¨‚ sigmoid(tanh(fc(x1))) + x2\nCLOCS - ICML 2021 Contrastive Learning of Cardiac Signals Across Space, Time, and Patients\nå¯¹æ¯”ï¼šæ—¶é—´-ç©ºé—´-æ‚£è€…\nFigureï¼šï¼ˆå·¦ï¼‰å¯¹æ¯”å¤šæ®µç¼–ç ã€ï¼ˆä¸­ï¼‰å¯¹æ¯”å¤šå¯¼è”ç¼–ç å’Œï¼ˆå³ï¼‰å¯¹æ¯”å¤šæ®µå¤šå¯¼è”ç¼–ç ä¸­çš„Kä¸ªå®ä¾‹çš„å°æ‰¹é‡çš„ç›¸ä¼¼æ€§çŸ©é˜µã€‚å°†åŸºäºæ‰€æœ‰åº”ç”¨çš„å˜æ¢è¿ç®—ç¬¦TAå’ŒTBå¯¹ç”Ÿæˆé™„åŠ çŸ©é˜µã€‚æ²¿ç€è¾¹ç¼˜æ²¿ç€ç¤ºå‡ºäº†ç¤ºä¾‹æ€§å˜æ¢çš„ECGå®ä¾‹ã€‚ä¸ºäº†è¯†åˆ«é˜³æ€§å¯¹ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå®ä¾‹ä¸å…¶æ‚£è€…IDç›¸å…³è”ã€‚é€šè¿‡è®¾è®¡ï¼Œå¯¹è§’å…ƒç´ ï¼ˆç»¿è‰²ï¼‰å¯¹åº”äºåŒä¸€æ‚£è€…ï¼Œæœ‰åŠ©äºç­‰å¼2.ç±»ä¼¼åœ°ï¼Œå®ä¾‹1å’Œå®ä¾‹50ï¼ˆé»„è‰²ï¼‰å±äºåŒä¸€æ‚£è€…ï¼Œæœ‰åŠ©äºç­‰å¼ï¼ˆ1ï¼‰ã€‚3.è“è‰²åŒºåŸŸå¯¹åº”äºé˜´æ€§ç¤ºä¾‹ï¼Œå› ä¸ºå®ƒä»¬æ¶‰åŠæ¥è‡ªä¸åŒæ‚£è€…çš„å®ä¾‹ã€‚\næ•°æ®åˆ’åˆ†ï¼š\n1frame = torch.tensor(input_frame,dtype=torch.float) 2label = torch.tensor(label,dtype=torch.float) 3frame = frame.unsqueeze(0) #(1,5000,12) #SxL = Samples x Leads 4frame_views = torch.empty(1,2500,self.nviews*2) #nviews = nleads in this case (1x2500x12*nsegments) 5nsegments = frame.shape[1]//2500 6fcount = 0 7for n in range(self.nviews): #nviews = # of leads 8 for s in range(nsegments): 9 start = s*2500 10 current_view = frame[0,start:start+2500,n] 11 current_view = self.obtain_perturbed_frame(current_view) 12 current_view = self.normalize_frame(current_view) 13 frame_views[0,:,fcount] = current_view 14 fcount += 1 15# =\u0026gt; (1, 2500, 24) â­CMSMLC(Contrastive Multi-segment Multi-lead Coding)\nLossåˆ†æï¼š\n1pids = [\u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;, \u0026#39;1\u0026#39;, \u0026#39;3\u0026#39;] # patient id 2data = [4, feature_dim, 4] # batch, dim_feature, nviews 3 4# 1. å…ˆæ ‡è®°ç›¸åŒæ‚£è€…çš„æ ·æœ¬ 5 6# 2. è®¡ç®—å„ä¸ªè§†å›¾çš„ç›¸ä¼¼æ€§ 7view_combinations = combinations(nviews,2) 8# (0,1), (0,2), (0,3) 9# (1,2), (1,3) 10# (2,3) 11loss = 0 12ncombinations = 0 13for combination in view_combinations: 14 view1 = data[:, :, combination[0]] 15 view2 = data[:, :, combination[1]] 16 norm1_vector = view1_array.norm(dim=1).unsqueeze(0) 17 norm2_vector = view2_array.norm(dim=1).unsqueeze(0) 18 sim_matrix = torch.mm(view1,view2.transpose(0,1)) 19 norm_matrix = torch.mm(norm1_vector.transpose(0, 1), norm2_vector) 20 argument = sim_matrix / (norm_matrix * temperature) # temperature=0.1 21 sim_matrix_exp = torch.exp(argument) 22 23 # obtain element 24 triu_elements = sim_matrix_exp[rows1,cols1] # upper triangle 25 tril_elements = sim_matrix_exp[rows2,cols2] # lower triangle 26 diag_elements = torch.diag(sim_matrix_exp) # ä¸»å¯¹è§’ 27 28 triu_sum = torch.sum(sim_matrix_exp,1) 29 tril_sum = torch.sum(sim_matrix_exp,0) 30 31 loss_diag1 = -torch.mean(torch.log(diag_elements/triu_sum)) # A =\u0026gt; B 32 loss_diag2 = -torch.mean(torch.log(diag_elements/tril_sum)) # B =\u0026gt; A 33 34 loss_triu = -torch.mean(torch.log(triu_elements/triu_sum[rows1])) # ä¸Šä¸‰è§’å¯¹åº”çš„è¡Œ 35 loss_tril = -torch.mean(torch.log(tril_elements/tril_sum[cols2])) # ä¸‹ä¸‰è§’å¯¹åº”çš„åˆ— 36 37 loss = loss_diag1 + loss_diag2 38 loss_terms = 2 39 40 if len(rows1) \u0026gt; 0: 41 loss += loss_triu #technically need to add 1 more term for symmetry 42 loss_terms += 1 43 44 if len(rows2) \u0026gt; 0: 45 loss += loss_tril #technically need to add 1 more term for symmetry 46 loss_terms += 1 47 48ncombinations += 1 49loss = loss/(loss_terms*ncombinations) # loss/(4*6) æ¯ä¸ªè§†å›¾4ä»½lossï¼Œæ€»å…±ç®—6å¯¹ GUIDING MASKED REPRESENTATION LEARNING - ICLR 2024 â­å¿ƒç”µå›¾è¿›è¡Œç®€å•çš„æ•°æ®å¢å¼ºä¹Ÿå¯èƒ½ä¼šä¸¥é‡æ”¹å˜ç—…ç†ä¿¡æ¯\nâœ”ï¸åˆ©ç”¨MAEæ–¹æ³•ï¼Œç”Ÿæˆå¼è‡ªç›‘ç£å­¦ä¹ \n3ç§åµŒå…¥æ–¹å¼ï¼Œæ—¶é—´-ç©ºé—´-æ—¶ç©º\næ¨¡å‹ï¼š\nposition embeddingsï¼š ä½¿ç”¨åŒä¸€ç»„ä½ç½®-å…±äº«\nlead-embeddings: æ¯ä¸ªå¯¼è”ä¸“ç”¨-æ ‡è®°å¯¼è”ç¼–å·\n[SEP]: åŒºåˆ†å„ä¸ªå¯¼è”Patch\nä¸ºäº†å¢åŠ é‡å»ºéš¾åº¦ï¼š\nDecoderéƒ¨åˆ†åªçœ‹åŒä¸€å¯¼è”çš„Patchï¼›=\u0026gt; ç¡®ä¿é‡å»ºæ—¶ä¸ä¼šæ˜¾å¼ä½¿ç”¨å…¶ä»–å¯¼è”çš„åµŒå…¥ =\u0026gt; è¿«ä½¿æ¨¡å‹æœ‰æ•ˆåœ°å­¦ä¹ æ—¶ç©ºè¡¨ç¤º ä»£ç åˆ†æï¼š\n1# x: [batch, 12, 2250] 2x = series 3# === forward_encoder === 4x = patch_embedding(x) # segment-\u0026gt;LN-\u0026gt;Linear-\u0026gt;LN, =\u0026gt; [batch, 12, 30, 75] 5x = x + pos_embedding[:, 1:n + 1, :].unsqueeze(1) # lead-inter shared pos embedding 6 7# mask 8len_keep = int(n * (1 - mask_ratio)) 9ids_shuffle # [batch, 12, 30] æ®µç¼–å·æ‰“ä¹± 10ids_restore # æ®µç¼–å·åŸå§‹é¡ºåº 11 12ids_keep = ids_shuffle[:, :, :len_keep] 13x_masked = torch.gather(x, dim=2, index=ids_keep.unsqueeze(-1).repeat(1, 1, 1, d)) 14mask = torch.ones([b, num_leads, n], device=x.device) 15mask[:, :, :len_keep] = 0 16# === x_masked, mask, ids_restore === 17 18# embedding 19x = torch.cat([left_sep, x, right_sep], dim=2) 20lead_embeddings = lead_embeddings.unsqueeze(2).expand(b, -1, n_masked_with_sep, -1) 21x = x + lead_embeddings # lead-intra shared lead embedding 22 23# Transformer Encoder x 12 24x = encoder(x) 25 26# === forward_decoder === 27x = self.to_decoder_embedding(x) # ç»´åº¦æ˜ å°„ 28 29# åˆå§‹åŒ–è¢«maskæ‰çš„patch 30mask_embeddings = self.mask_embedding.unsqueeze(1) 31mask_embeddings = mask_embeddings.repeat(b, self.num_leads, n + 2 - n_masked_with_sep, 1) 32 33x_wo_sep = torch.cat([x[:, :, 1:-1, :], mask_embeddings], dim=2) # [X..,masked,..] 34x_wo_sep = torch.gather(x_wo_sep, dim=2, index=ids_restore.unsqueeze(-1).repeat(1, 1, 1, d)) # æ¢å¤ä½ç½® 35 36x_wo_sep = x_wo_sep + self.decoder_pos_embed[:, 1:n + 1, :].unsqueeze(1) # é‡æ–°æ·»åŠ ä½ç½®ä¿¡æ¯ 37left_sep = x[:, :, :1, :] + self.decoder_pos_embed[:, :1, :].unsqueeze(1) 38right_sep = x[:, :, -1:, :] + self.decoder_pos_embed[:, -1:, :].unsqueeze(1) 39x = torch.cat([left_sep, x_wo_sep, right_sep], dim=2) 40 41x_decoded = [] 42for i in range(self.num_leads): 43 x_lead = x[:, i, :, :] 44 for block in self.decoder_blocks: # Transformer Encoder x 6 45 x_lead = block(x_lead) 46 x_lead = self.decoder_norm(x_lead) 47 x_lead = self.decoder_head(x_lead) 48 x_decoded.append(x_lead[:, 1:-1, :]) 49pred = torch.stack(x_decoded, dim=1) 50 51# === loss === 52target = self.patchify(series) 53 54loss = (pred - target) ** 2 55loss = loss.mean(dim=-1) # (batch_size, num_leads, n), mean loss per patch 56 57loss = (loss * mask).sum() / mask.sum() # mean loss on removed patches 58# mask: [batch, 12, 30], å…¶ä¸­1ä»£è¡¨è¢«maskï¼Œ0è¡¨ç¤ºæ²¡æœ‰è¢«mask å¾®è°ƒæ—¶å–Encoderéƒ¨åˆ†\nå®éªŒ InceptionFormer InceptionNeXt + SMT\nå›¾ç¤ºä»¿ç…§SMTé£æ ¼ç»˜åˆ¶\nä»¿ç…§SMTçš„æ¸è¿›èåˆç½‘ç»œç»“æ„ å‰åŠéƒ¨åˆ†ä½¿ç”¨ InceptionNeXtç»“æ„å—ï¼ŒDConvå·ç§¯ä»£æ›¿MHSA 1# æ¨¡å‹ FLOPs: 2.14G 2# æ¨¡å‹å‚æ•°æ•°é‡: 12.45M 3 4cnnblock = StemConv() # 1, 12, 1000 5# æ¨¡å‹ FLOPs: 36.74M 6# æ¨¡å‹å‚æ•°æ•°é‡: 36.72K 7CNNBlock1 = getattr(model, \u0026#39;block0\u0026#39;) # 1, 64, 1000 8# æ¨¡å‹ FLOPs: 35.07M 9# æ¨¡å‹å‚æ•°æ•°é‡: 35.07K 10CNNBlock2 = getattr(model, \u0026#39;block1\u0026#39;) # 1, 128, 500 11# æ¨¡å‹ FLOPs: 135.68M 12# æ¨¡å‹å‚æ•°æ•°é‡: 271.36K 13MixBlock = getattr(model, \u0026#39;block2\u0026#39;) # 1, 256, 250 14# æ¨¡å‹ FLOPs: 793.09M 15# æ¨¡å‹å‚æ•°æ•°é‡: 3.18M 16MHSABlock = getattr(model, \u0026#39;block3\u0026#39;) # 1, 512, 125 17# æ¨¡å‹ FLOPs: 1.05G 18# æ¨¡å‹å‚æ•°æ•°é‡: 8.41M æ¨¡å‹æ¡†æ¶ æ¨¡å‹æ¡†æ¶\rStem æ¨¡å—ï¼š\nå‚è€ƒï¼šA token selection-based multi-scale dual-branch CNN-transformer ä¸€åŒºè®ºæ–‡\næ ‡å‡†ä¸€ç»´å·ç§¯ï¼Œå¤šå°ºåº¦æå–ç‰¹å¾ï¼Œæå–ECGå½¢æ€ä¿¡æ¯ã€‚å…¨é¢æå–ï¼ˆæºå¸¦å†—ä½™ä¿¡æ¯ï¼‰ # shape: 12, 1000 =\u0026gt; 128ï¼Œ1000\nBlockï¼š\nPatch Fusion:\nâ€‹\tä½¿ç”¨Conv1Dï¼Œkernel_size=3ï¼Œstride=2, padding=1 =\u0026gt; é‡å å¼åµŒå…¥ï¼Œå‡å°‘Tokenæ•°é‡ï¼Œå¢åŠ Tokenç»´åº¦(å¢åŠ Tokenæºå¸¦ä¿¡æ¯çš„ä¸°å¯Œåº¦)\nå›¾ç¤ºï¼š â‘ Tokené—´ â‘¡Tokenå†…\nè‡ªæ³¨æ„åŠ› åœ¨InceptionFormerä¸Šå®éªŒ\nMulti Head Self Attention 1Test\tBest F1: 0.8410 2Validate Best F1: 0.8184 SR-MHSA ä½¿ç”¨Conv1D stride=2 ç¼©å°Kï¼ŒVçš„TokenMapï¼Œå‡å°‘Tokenæ•°é‡\nsr-ratio = 2\n1Test\tBest F1: 0.8137 2Validate Best F1: 0.8216 Bi-Routing Attention \u0026ndash; SRä¸æ ‡å‡†çš„æŠ˜ä¸­\nè¶…å‚ï¼šnum_window=25ï¼Œtopk=10\n1Test\tBest F1: 0.8344 2Validate Best F1: 0.8199 Window Attention \u0026ndash; å•çº¯çª—å£çº§\tâŒå¤šä½™çš„ç‰ˆæœ¬ - ä¸å¦‚MobileViTBlock â—æ²¡åŠ CNNå…ˆå±€éƒ¨èåˆ\n1Test\tBest F1: 0.8261 2Validate Best F1: 0.8148 Shift Window Attention æ„Ÿè§‰æœ‰ç‚¹é—®é¢˜ï¼Œæ•ˆæœä¸å¦‚ WAï¼Œæ··åˆç»“æ„çš„é—®é¢˜ï¼Ÿå‰é¢è¿›è¡Œçš„äº¤é”™çš„CNNå’ŒMHSAï¼Ÿ\n1Test\tBest F1: 0.8129 2Validate Best F1: 0.8100 çº§è”åˆ é™¤Tokenå’Œä¿®å‰ªHead å»æ‰å†—ä½™çš„ â—æœªæµ‹è¯•\nä½ç½®åµŒå…¥ å‰æœŸç›´æ¥èè¿›Tokenä¸­ \u0026ndash; ViT ä»…ä¸€æ¬¡ â€‹\tä¾‹ï¼šdata: [batch, num_token, dim_token] learnable_pos_embed: [batch, num_token, dim_token]\nâ€‹\tdata + pos_embed\næ³¨æ„åŠ›è®¡ç®—ä¸­å¼•å…¥ \u0026ndash; SwinT æ¯æ¬¡ â€‹\tä¾‹ï¼š att:[num_token, num_token] + relative_pos_bias:[num_token, num_token]\nâ€‹\tè®©ç›¸å¯¹ä½ç½®ä¿¡æ¯(è‡ªå­¦ä¹ )å½±å“æ³¨æ„åŠ›æƒé‡\nDWConv å¼•å…¥å±€éƒ¨ä½ç½®ä¿¡æ¯ / åœ¨è®¡ç®—å®Œè‡ªæ³¨æ„åŠ›å‰ \u0026ndash; Bi-Routing-Attention æ¯æ¬¡ â€‹\tä¾‹ï¼š DWConv(x) + EncoderBlock(x)\nDWConvå¢å¼ºä½ç½®ä¿¡æ¯ / åœ¨è®¡ç®—å®Œè‡ªæ³¨æ„åŠ›ä¸­ \u0026ndash; Bi-Routing-Attention æ¯æ¬¡ â€‹\tä¾‹ï¼š SoftMax(Q@K.T/âˆšd)@ (V + DWConv(V) )\nç°å­˜é—®é¢˜ â­æ²¡æœ‰ä¸ºMHSAè®¡ç®—æ—¶æ·»åŠ ä½ç½®ä¿¡æ¯\nDWConv ä»£æ›¿ä½ç½®ç¼–ç  MHSAä¹‹å‰åŠ å…¥å¯å­¦ä¹ çš„ä½ç½®å‘é‡ æ¸è¿›å¼æ¨¡å—èåˆç­–ç•¥\näº¤é”™ å¹¶è¡Œï¼Ÿ æ²¡æœ‰ä¼˜åŒ–è‡ªæ³¨æ„åŠ›çš„è®¡ç®—\nDConvçš„ä¼˜åŒ–\nInceptionFormer + å·ç§¯è°ƒåˆ¶ InceptionNeXtBlock =\u0026gt; ConvModulation =\u0026gt; MHSA\nå·ç§¯ =\u0026gt; å·ç§¯Ã—è°ƒåˆ¶ =\u0026gt; è°ƒåˆ¶Ã—è‡ªæ³¨æ„åŠ› =\u0026gt; è‡ªæ³¨æ„åŠ›\nx2 x4 x8 x4\n1acc: 0.8299, f1: 0.8418, macro_auc: 0.9679 2classes: [\u0026#39;I-AVB\u0026#39; \u0026#39;AF\u0026#39; \u0026#39;LBBB\u0026#39; \u0026#39;RBBB\u0026#39; \u0026#39;NORM\u0026#39; \u0026#39;PAC\u0026#39; \u0026#39;STD\u0026#39; \u0026#39;STE\u0026#39; \u0026#39;PVC\u0026#39;] 3test f1s: [0.9252, 0.9231, 0.902, 0.9477, 0.8261, 0.6733, 0.8161, 0.7805, 0.782] å…¨å±€å¹³å‡æ± åŒ– =\u0026gt; CLS Token\nâ—Validate F1 score only 0.8185\t# ç¨³å¥æ€§ä¸€èˆ¬\n1acc: 0.8343, f1: 0.8488, macro_auc: 0.9677 threshold: 0.8 2classes: [\u0026#39;I-AVB\u0026#39; \u0026#39;AF\u0026#39; \u0026#39;LBBB\u0026#39; \u0026#39;RBBB\u0026#39; \u0026#39;NORM\u0026#39; \u0026#39;PAC\u0026#39; \u0026#39;STD\u0026#39; \u0026#39;STE\u0026#39; \u0026#39;PVC\u0026#39;] 3F1 Scores: [0.9028, 0.9587, 0.9412, 0.9444, 0.7861, 0.7308, 0.8046, 0.7895, 0.7813 âŒPAC ä»ç„¶æ”¹å–„ä¸äº†\næ³¨æ„åŠ›å¯è§†åŒ– InceptionFormer + Shunt Shunt Self Attention =\u0026gt; InceptionFormer\nåœ¨å¤šå¤´éƒ¨åˆ†åµŒå…¥å¤šå°ºåº¦ã€‚8å¤´è‡ªæ³¨æ„åŠ›ï¼Œ 1/2å¤´æ‰§è¡Œåƒç´ çº§è‡ªæ³¨æ„åŠ›ï¼Œ1/4å¤´æ‰§è¡Œä¸‹é‡‡æ ·2å€çš„å—çº§è‡ªæ³¨æ„åŠ›ï¼Œ1/4å¤´æ‰§è¡Œä¸‹é‡‡æ ·4å€çš„åŸŸçº§è‡ªæ³¨æ„åŠ›\nåœ¨è®¡ç®—è‡ªæ³¨æ„åŠ›æ—¶ï¼Œå®ç°å¤šå°ºåº¦\n1acc: 0.8154, f1: 0.8389, macro_auc: 0.9682 2classes: [\u0026#39;I-AVB\u0026#39; \u0026#39;AF\u0026#39; \u0026#39;LBBB\u0026#39; \u0026#39;RBBB\u0026#39; \u0026#39;NORM\u0026#39; \u0026#39;PAC\u0026#39; \u0026#39;STD\u0026#39; \u0026#39;STE\u0026#39; \u0026#39;PVC\u0026#39;] 3F1 Scores: [0.9065, 0.9283, 0.8511, 0.9296, 0.7865, 0.6531, 0.8193, 0.8421, 0.8333] â—PAC\nInceptionFormer: MS-DWConv + MHSA\n1éªŒè¯é›†: 9-Fold, æµ‹è¯•é›†: 10-Fold. 2 3Acc: 0.8328, F1: 0.8530, Auc: 0.9701, Threshold: 0.4, Test_loss: 0.2225 4F1s: [\u0026#39;0.8936\u0026#39;, \u0026#39;0.9219\u0026#39;, \u0026#39;0.9200\u0026#39;, \u0026#39;0.9505\u0026#39;, \u0026#39;0.8298\u0026#39;, \u0026#39;0.6972\u0026#39;, \u0026#39;0.8315\u0026#39;, \u0026#39;0.8000\u0026#39;, \u0026#39;0.8321\u0026#39;] 5 6Acc: 0.7918, F1: 0.8247, Auc: 0.9564, Threshold: 0.9, Vali_loss: 0.2764 7F1s: [\u0026#39;0.8971\u0026#39;, \u0026#39;0.9160\u0026#39;, \u0026#39;1.0000\u0026#39;, \u0026#39;0.9020\u0026#39;, \u0026#39;0.7831\u0026#39;, \u0026#39;0.6981\u0026#39;, \u0026#39;0.7600\u0026#39;, \u0026#39;0.6154\u0026#39;, \u0026#39;0.8504\u0026#39;] 8 9# æ­¤å¤„ï¼Œä»…å–å¹³å‡ï¼Œæœ€ç»ˆåº”è¯¥ç»„åˆåœ¨ä¸€èµ·è¿›è¡Œæµ‹è¯•ï¼Œå› ä¸ºé˜ˆå€¼ä¸ä¸€è‡´ 10Acc: 0.8123, F1: 0.8388, Auc: 0.9633 Average Test and Validate 11F1s: [\u0026#39;0.8953\u0026#39;, \u0026#39;0.9189\u0026#39;, \u0026#39;0.9600\u0026#39;, \u0026#39;0.9263\u0026#39;, \u0026#39;0.8064\u0026#39;, \u0026#39;0.6977\u0026#39;, \u0026#39;0.7957\u0026#39;, \u0026#39;0.7077\u0026#39;, \u0026#39;0.8413\u0026#39;] 12 13# æ¨¡å‹ FLOPs: 2.14G 14# æ¨¡å‹å‚æ•°æ•°é‡: 12.45M InceptionFormer: MS-DWConv + S-MHSA\nâŒæ•°æ®æ•æ„Ÿ\n1éªŒè¯é›†: 9-Fold, æµ‹è¯•é›†: 10-Fold. 2 3Acc: 0.8125, F1: 0.8204, Auc: 0.9686, Threshold: 0.6, Test_loss: 0.2426 4F1s: [\u0026#39;0.8467\u0026#39;, \u0026#39;0.9143\u0026#39;, \u0026#39;0.8800\u0026#39;, \u0026#39;0.9344\u0026#39;, \u0026#39;0.8021\u0026#39;, \u0026#39;0.6355\u0026#39;, \u0026#39;0.8452\u0026#39;, \u0026#39;0.7368\u0026#39;, \u0026#39;0.7883\u0026#39;] 5 6Acc: 0.7918, F1: 0.8163, Auc: 0.9556, Threshold: 0.8, Vali_loss: 0.2814 7F1s: [\u0026#39;0.8841\u0026#39;, \u0026#39;0.8934\u0026#39;, \u0026#39;0.9778\u0026#39;, \u0026#39;0.9091\u0026#39;, \u0026#39;0.7340\u0026#39;, \u0026#39;0.7037\u0026#39;, \u0026#39;0.7925\u0026#39;, \u0026#39;0.5946\u0026#39;, \u0026#39;0.8571\u0026#39;] 8 9Acc: 0.8022, F1: 0.8183, Auc: 0.9621 Average Test and Validate 10F1s: [\u0026#39;0.8654\u0026#39;, \u0026#39;0.9039\u0026#39;, \u0026#39;0.9289\u0026#39;, \u0026#39;0.9218\u0026#39;, \u0026#39;0.7681\u0026#39;, \u0026#39;0.6696\u0026#39;, \u0026#39;0.8188\u0026#39;, \u0026#39;0.6657\u0026#39;, \u0026#39;0.8227\u0026#39;] InceptionFormer: MS-DWConv-SE + MHSA\nè‡ªåŠ¨é‡æ–°æ ¡å‡† - é€šé“é‡è¦æ€§\n1Validate: Acc:0.788937409\tF1:0.819458854\t2Test : Acc:0.827034884\tF1:0.835588466 InceptionFormer: MS-DWConv-CA + MHSA\nåŒæ—¶æ ¡å‡† é€šé“ + ç©ºé—´ é‡è¦æ€§\n1Validate: Acc:0.7991\tF1:0.8315 2Test : Acc:0.8096\tF1:0.8194 InceptionFormer: only front 3 stage\nåˆ é™¤ç¬¬å››stageï¼Œé™ä½å‚æ•°\n1# Best F1: 0.8395 Only front 3 layer 2# æ¨¡å‹ FLOPs: 1.04G 3# æ¨¡å‹å‚æ•°æ•°é‡: 3.64M InceptionFormer: stage depth [2, 4, 8, 4] =\u0026gt; [2, 4, 8, 2]\nå‡å°‘stage4å±‚æ•°\n1# stage depths = [2, 4, 8, 2] 2# Best F1: 0.8422 3# æ¨¡å‹ FLOPs: 1.61G 4# æ¨¡å‹å‚æ•°æ•°é‡: 8.25M InceptionFormer + SparseSemanticToken\nå‡å°‘Token\n1# Best F1: 0.8312 sparse token -- DW-SpatialPool 2# æ¨¡å‹ FLOPs: 1.53G 3# æ¨¡å‹å‚æ•°æ•°é‡: 17.19M 4 5SparseAttentionBlock: 6# æ¨¡å‹ FLOPs: 236.95M 7# æ¨¡å‹å‚æ•°æ•°é‡: 4.74M InceptionFormerTiny\nå‡å°‘Tokené•¿åº¦ dim_token: [64, 128, 256, 512] =\u0026gt; [32, 64, 128, 256]\n1# Best F1: 0.8265 2# æ¨¡å‹ FLOPs: 536.07M 3# æ¨¡å‹å‚æ•°æ•°é‡: 3.13M â­â­â­\nBaseline\n1# resnet18 2æ¨¡å‹ FLOPs: 176.57M 3æ¨¡å‹å‚æ•°æ•°é‡: 3.85M 4Best F1: 0.8168 5 6# resnet34 7æ¨¡å‹ FLOPs: 357.74M 8æ¨¡å‹å‚æ•°æ•°é‡: 7.23M 9Best F1: 0.8185 10 11# mobilenetv2 12æ¨¡å‹ FLOPs: 96.60M 13æ¨¡å‹å‚æ•°æ•°é‡: 2.19M 14Best F1: 0.7967\tPTB-XL - æ¨è9æŠ˜éªŒè¯ 10æŠ˜æµ‹è¯•\nCPSC - (æ¯”èµ›) 9æŠ˜éªŒè¯ 10æŠ˜æµ‹è¯•\nä¼˜åŒ–å™¨è°ƒæ•´\nAdamw + StepLR =\u0026gt; Adamw + CosineAnnealingLR\nå›ºå®šæ­¥é•¿è¡°å‡å­¦ä¹ ç‡ =\u0026gt; ä½™å¼¦é€€ç«è°ƒæ•´å­¦ä¹ ç‡\nAdamw + StepLRï¼š\n1# scheduler 2lr = 1e-3 3step_size = 20 4step_gamma = 0.1 Adamw + CosineAnnealingLR\nPASS\né¢‘åŸŸç‰¹å¾ æ•°æ®çš„å¦ä¸€ç§è¡¨è¾¾å½¢å¼ï¼Œæˆ–è€…åœ¨è¿™ä¸ªæ ¼å¼ä¸­ï¼ŒæŸäº›ç‰¹å¾ä¼šè¢«æ”¾å¤§ï¼Œä½¿å¾—å¯ä»¥è¢«è¯†åˆ«åˆ°\ntime domain I-AVB AF LBBB LBBB NORM PAC STD PVC STE å¹³å‡ æè¿° F1 0.8844 0.9231 0.8800 0.9500 0.7514 0.6392 0.8024 0.7692 0.7669 0.8185 æ—¶åºä¿¡å· \u0026amp; ä¸€ç»´æ¨¡å‹ frequency domain 1# [batch_size, num_leads, data_length] =STFT=\u0026gt; [batch_size, num_leads, W, H] 2# =\u0026gt; resnet34 3# =\u0026gt; output I-AVB AF LBBB LBBB NORM PAC STD PVC STE å¹³å‡ æè¿° F1 0.7763 0.9180 0.8511 0.8889 0.7684 0.6393 0.7500 0.7671 0.7805 0.7933 æ—¶åºä¿¡å·é€šè¿‡STFTè½¬ä¸ºé¢‘è°±å›¾(æ±‰æ˜çª—å£100) two-stream: time and frequency domain I-AVB AF LBBB LBBB NORM PAC STD PVC STE å¹³å‡ æè¿° F1 0.8993 0.9255 0.9020 0.9326 0.7817 0.7040 0.8000 0.7805 0.7619 0.8319 æ—¶åºä¿¡å·é€šè¿‡STFTè½¬ä¸ºé¢‘è°±å›¾(çª—å£100) InceptionNeXt + Shunted-Self Attention ï¼ˆCross-Stackï¼‰ 1ï¸âƒ£\nInception depthwise convlution\n2ï¸âƒ£\nSelf-Attention å†…éƒ¨å®ç°ç²—ç»†ç²’åº¦\n3ï¸âƒ£\nç‰¹å¾å›¾ =\u0026gt; é‡‘å­—å¡”ç»“æ„ ï¼ˆä¸­é—´CNNå’ŒTransformerèåˆï¼Œäº¤å‰å †å ï¼‰\n1classes: 2 [\u0026#39;I-AVB\u0026#39; \u0026#39;AF\u0026#39; \u0026#39;LBBB\u0026#39; \u0026#39;RBBB\u0026#39; \u0026#39;NORM\u0026#39; \u0026#39;PAC\u0026#39; \u0026#39;STD\u0026#39; \u0026#39;STE\u0026#39; \u0026#39;PVC\u0026#39;] 3 4 5Test set: 6Acc: 0.9706, F1: 0.8547, Auc: 0.9666, Threshold: 0.5, Test_loss: 0.1813 7Acc: [\u0026#39;0.9797\u0026#39;, \u0026#39;0.9782\u0026#39;, \u0026#39;0.9913\u0026#39;, \u0026#39;0.9738\u0026#39;, \u0026#39;0.9506\u0026#39;, \u0026#39;0.9549\u0026#39;, \u0026#39;0.9593\u0026#39;, \u0026#39;0.9913\u0026#39;, \u0026#39;0.9564\u0026#39;] 8F1s: [\u0026#39;0.9028\u0026#39;, \u0026#39;0.9388\u0026#39;, \u0026#39;0.8846\u0026#39;, \u0026#39;0.9511\u0026#39;, \u0026#39;0.8132\u0026#39;, \u0026#39;0.7207\u0026#39;, \u0026#39;0.8391\u0026#39;, \u0026#39;0.8500\u0026#39;, \u0026#39;0.7917\u0026#39;] 9 10Validate set: 11Acc: 0.9596, F1: 0.8105, Auc: 0.9657, Threshold: 0.5, Vali_loss: 0.2111 12F1s: [\u0026#39;0.8750\u0026#39;, \u0026#39;0.9333\u0026#39;, \u0026#39;0.9787\u0026#39;, \u0026#39;0.9016\u0026#39;, \u0026#39;0.6989\u0026#39;, \u0026#39;0.6504\u0026#39;, \u0026#39;0.7545\u0026#39;, \u0026#39;0.6818\u0026#39;, \u0026#39;0.8201\u0026#39;] 13Train[650 1099 212 1675 826 554 782 198 629] 14Acc: [\u0026#39;0.9738\u0026#39;, \u0026#39;0.9767\u0026#39;, \u0026#39;0.9985\u0026#39;, \u0026#39;0.9476\u0026#39;, \u0026#39;0.9185\u0026#39;, \u0026#39;0.9374\u0026#39;, \u0026#39;0.9403\u0026#39;, \u0026#39;0.9796\u0026#39;, \u0026#39;0.9636\u0026#39;] CPSC - æ‚£è€…é—´\nè®­ç»ƒé›†åŒ…å« 6,877 ä¸ªï¼ˆå¥³æ€§ï¼š3178 ä¸ª;ç”·æ€§ï¼š3699 ä¸ªï¼‰12 å¯¼è”å¿ƒç”µå›¾è®°å½•ï¼ŒæŒç»­æ—¶é—´ä» 6 ç§’åˆ° 60 ç§’ä¸ç­‰ã€‚\nè®ºæ–‡ä¸­æ˜¯ 1-8 è®­ç»ƒï¼›9 éªŒè¯ï¼›10 æµ‹è¯•ï¼›\nPTB-XL - æ‚£è€…é—´\nåŒ…å«æ¥è‡ª 18885 å 10 ç§’é•¿åº¦æ‚£è€…çš„ 21837 ä¸ªä¸´åºŠ 12 å¯¼è”å¿ƒç”µå›¾\nâ­ ç‰¹å®šæ‚£è€…çš„æ‰€æœ‰è®°å½•éƒ½åˆ†é…ç»™åŒä¸€æŠ˜ã€‚æŠ˜ 9 å’Œ 10 ä¸­çš„è®°å½•è‡³å°‘ç»è¿‡ä¸€æ¬¡äººå·¥è¯„ä¼°ï¼Œå› æ­¤å…·æœ‰ç‰¹åˆ«é«˜çš„æ ‡ç­¾è´¨é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ 1-8 æŠ˜ ä½œä¸ºè®­ç»ƒé›†ï¼ŒæŠ˜å  9 ä½œä¸ºéªŒè¯é›†ï¼ŒæŠ˜å  10 ä½œä¸ºæµ‹è¯•é›†ã€‚\nChapman-Shaoxin ECG Data - æ‚£è€…é—´\nåŒ…å« 10,646 åæ‚£è€…çš„ 12 å¯¼è”å¿ƒç”µå›¾ï¼Œé‡‡æ ·ç‡ä¸º 500 Hzï¼Œ11 ç§å¸¸è§å¿ƒå¾‹\nç±»åˆ«åˆ†ç»„ï¼š\nResult\ndataset Task F1_macro AUC_macro CPSC arrhythmia | multi-label 0.8547 0.9666 PTB-XL arrhythmia | multi-label 0.5370 0.9552 dataset Task AUC_macro F1_macro Accuracy Recall Precision chapman arrhythmia | multi-class 0.9966 0.9660 0.9699 0.9652 0.9671 multi-label: sigmoidè½¬0-1åŒºé—´ï¼Œç”¨é˜ˆå€¼è¿›è¡Œé¢„æµ‹å€¼äºŒå€¼åŒ–ï¼Œç”Ÿæˆæ ‡ç­¾\nmulti-class: softmaxè½¬æ¦‚ç‡ï¼Œå–æ¦‚ç‡æœ€å¤§çš„ä¸‹æ ‡ä½œä¸ºé¢„æµ‹æ ‡ç­¾\næ•°æ®å¢å¼ºï¼š\néšæœºmaskæŸå¯¼è”\néšæœºmaskæŸæ®µ(ä»…å¼€å¤´æˆ–ç»“å°¾)\nå¢åŠ éšæœºå™ªå£°\næ²¡å•¥ç”¨\næ±‡æ€» å®éªŒç»“æœ 1ï¸âƒ£ CNNï¼šä¼˜åŠ¿=\u0026gt;å¼ºå¤§çš„æå–å±€éƒ¨æ¨¡å¼çš„èƒ½åŠ›ï¼› =\u0026gt; æå‡ºå±€éƒ¨ç»†èŠ‚ï¼Œè¾¹ç¼˜ï¼Œçº¹ç†æ¨¡å¼ä¿¡æ¯ã€‚ â­ é«˜é¢‘ä¿¡æ¯\nâ€‹ ä¸è¶³=\u0026gt;éœ€è¦å †å å¾ˆæ·±ï¼Œæ„Ÿå—èŒƒå›´æ‰èƒ½å»¶ç”³åˆ°å…¨å±€ï¼› =\u0026gt; æ„ŸçŸ¥å…¨å±€å¼±åŠ¿\n2ï¸âƒ£ Transformerï¼š ä¼˜åŠ¿=\u0026gt;å…¨å±€æ„Ÿå—é‡ï¼Œä¸å¤Ÿæ•´ä½“å¤–è²Œèƒ½åŠ›å¾ˆå¼º; â­ ä½é¢‘ä¿¡æ¯\nâ€‹\tä¸è¶³=\u0026gt;çœ‹çš„å¤ªå¤šï¼Œå¹²æ‰°å¤ªå¤šï¼Œå¯¹å±€éƒ¨ç»†èŠ‚æ¨¡å¼æ•è·èƒ½åŠ›è¾ƒå¼±ã€‚\næ¨¡å‹æ’å›¾ BlockåŸºæœ¬ç»“æ„ InceptionNext DConv: æ ¹æ®é€šé“åˆ†ç»„ï¼Œæ¯ç»„ä½¿ç”¨ä¸åŒå·ç§¯æ ¸å¤§å°çš„DWConv\nInceptionMHSALinear Local Block å’Œ Global Block çº¿æ€§æ‹¼æ¥\nInceptionFormer Local Block å’Œ Global Block äº¤å‰å †å è¿›è¡Œèåˆ\nInceptionShuntSA ä¸€åŠæ³¨æ„åŠ›å¤´æ‰§è¡Œç»†ç²’åº¦æ³¨æ„åŠ›ï¼Œå¦ä¸€åŠå¤´æ‰§è¡Œç²—ç²’åº¦æ³¨æ„åŠ›\nInceptionHiLoSA ä¸€åŠæ³¨æ„åŠ›å¤´æ‰§è¡Œã€çª—å£çº§æ³¨æ„åŠ›ã€‘ï¼Œå¦ä¸€åŠå¤´æ‰§è¡Œã€æ± åŒ–æ³¨æ„åŠ›ã€‘\nğŸ§è¦è°ƒæ•´çª—å£å¤§å° ï¼\nSandwichNet **InceptionFormer, M-DWConv åŠ å…¥å€’æ®‹å·®ç»“æ„ ** (Inverted residual block) åœ¨å¤šå°ºåº¦DWConvå‰åµŒå…¥Conv1Ã—1 æ‰©å¼ é€šé“æ•°ï¼ŒååµŒå…¥Conv1Ã—1 è¿›è¡Œé™ç»´ã€‚\né£æ ¼éå¸¸ç»Ÿä¸€ =\u0026gt; ç®€å•\nSandwichProNet Channel Mixerï¼šGLUï¼Œ DW-FFN\nToken Mixer: ç»†ç²’åº¦å±€éƒ¨ + ç²—ç²’åº¦å…¨å±€\nå †å æ–¹å¼\næ•°æ® Arrhythmia Task\n10s + 100Hz sampling rate\nPTB-XL - Rhythm Task\n1[\u0026#39;AFIB\u0026#39;, \u0026#39;AFLT\u0026#39;, \u0026#39;BIGU\u0026#39;, \u0026#39;PACE\u0026#39;, \u0026#39;PSVT\u0026#39;, \u0026#39;SARRH\u0026#39;, \u0026#39;SBRAD\u0026#39;, \u0026#39;SR\u0026#39;, \u0026#39;STACH\u0026#39;, \u0026#39;SVARR\u0026#39;, \u0026#39;SVTAC\u0026#39;, \u0026#39;TRIGU\u0026#39;] 2- 12 class 3 4[ 1362 66 74 266 22 695 573 15074 744 143 24 18] # Train 5[ 152 7 8 28 2 77 64 1674 82 14 3 2] # Test 6 7Train: 18932 8Test : 2098 9Total: 21030 Chapman\n1[\u0026#39;AFIB\u0026#39;, \u0026#39;GSVT\u0026#39;, \u0026#39;SB\u0026#39;, \u0026#39;SR\u0026#39;] 2- 4 class 3 4Train [1996. 2069. 3498. 2000.] 5Test [222. 231. 389. 222. ] 6 7Train: 9563 8Test : 1064 9Total: 10627 CPSC-2018\n1[\u0026#39;I-AVB\u0026#39; \u0026#39;AF\u0026#39; \u0026#39;LBBB\u0026#39; \u0026#39;RBBB\u0026#39; \u0026#39;NORM\u0026#39; \u0026#39;PAC\u0026#39; \u0026#39;STD\u0026#39; \u0026#39;STE\u0026#39; \u0026#39;PVC\u0026#39;] 2- 9 class 3 4Train [ 650 1099 212 1675 826 554 782 198 629] 5Test [ 72 122 24 181 92 61 87 22 70] 6 7Train: 6187 8Test : 688 9Total: 6875 ","permalink":"http://longcoding.top/posts/learning/ecg_exp/","summary":"\u003ch2 id=\"è®ºæ–‡\"\u003eè®ºæ–‡\u003c/h2\u003e\n\u003ch3 id=\"im-ecg----2023\"\u003eâ­IM-ECG  - 2023\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eIM-ECG: An interpretable framework for arrhythmia detection using  multi-lead ECG\u003c/strong\u003e   \u003cem\u003e- Expert Systems With Applications  sci-1\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eåˆ›æ–°ç‚¹:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eConv2Dæ¨¡å‹ä¸Grad-CAMçš„é€‚é…æ›´å¥½  - å®æ—¶æ ‡æ³¨ç—…ç†åŒºåŸŸ  \u003cstrong\u003eè§£é‡Šæ€§\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eåŒæ ¸æ®‹å·®å—  - æ¨ªè½´ä¸ç«–è½´+é¢ ä¸‰ç§æ‰«ææ–¹å¼\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"image-20231008222054322\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/Fs6z6MvcLx6Jgu0ZSJQQhP_ELsED\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ek * n\u003c/strong\u003e(åŒºåŸŸæ‰«æ)å†…æ ¸æœå‘ä¸­å¿ƒå‹ç¼©ECGä»¥æ›´ç›´æ¥åœ°æ•è·\u003cstrong\u003eå¯¼è”é—´\u003c/strong\u003eç‰¹å¾ï¼Œè€Œ\u003cstrong\u003e1 * n\u003c/strong\u003e(æ¨ªè½´æ‰«æ)å†…æ ¸æ²¿ç€æ—¶é—´ç»´åº¦å‹ç¼©ECGå¹¶ä¸”å› æ­¤æ›´å…³æ³¨\u003cstrong\u003eå¯¼è”å†…\u003c/strong\u003eç‰¹å¾\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæµç¨‹å›¾ç¤º\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240327154037056\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/Foik_oJeDo9NKImyPhkZ5ga6ZRKr\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæ¨¡å‹ç»“æ„\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240327153836525\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FpbYbRq6Dec9rkOSDKeD_5zMzfa5\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eBlock\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240327153914172\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/Fv2Ky4pSh8O5sTf5Pm79Ea8BR_P6\"\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"lightweight-transformer----2022\"\u003eLightweight Transformer  - 2022\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eEnhancing dynamic ECG heartbeat classification with lightweight transformer model\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eArtificial Intelligence In Medicine\u003c/em\u003e  \u003cem\u003esci-1\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eåˆ›æ–°ç‚¹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eä¸¤çº§æ³¨æ„åŠ›æœºåˆ¶ï¼š å±€éƒ¨ + å…¨å±€ // å±€éƒ¨æ³¨æ„åŠ› == é€šé“æ³¨æ„åŠ› SEBlock  || å…¨å±€æ³¨æ„åŠ› == Transformer Encoder\u003c/p\u003e","title":"ECGè®ºæ–‡å’Œå®éªŒ"},{"content":"Java åå°„ å®ƒæä¾›äº†åŠ¨æ€æ€§å’Œçµæ´»æ€§ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åŠ è½½ç±»ã€è°ƒç”¨æ–¹æ³•ã€è®¿é—®å­—æ®µç­‰ï¼Œè€Œä¸éœ€è¦åœ¨ç¼–è¯‘æ—¶ç¡®å®šè¿™äº›æ“ä½œã€‚\n1. åŠ¨æ€åŠ è½½ç±»\nåœ¨è¿è¡Œæ—¶æ ¹æ®ç±»ååŠ¨æ€åŠ è½½ç±»ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡¬ç¼–ç ç±»åã€‚ \u0026ndash; æ’ä»¶åŒ–æ¶æ„ï¼šæ ¹æ®é…ç½®æ–‡ä»¶æˆ–ç”¨æˆ·è¾“å…¥åŠ¨æ€åŠ è½½ç±»ã€‚\n2. åˆ›å»ºå¯¹è±¡\né€šè¿‡åå°„å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼Œå³ä½¿ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ã€‚\nå·¥å‚æ¨¡å¼ï¼šæ ¹æ®é…ç½®åŠ¨æ€åˆ›å»ºå¯¹è±¡ã€‚ ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼šSpring é€šè¿‡åå°„åˆ›å»º Bean å®ä¾‹ã€‚ 3. è°ƒç”¨æ–¹æ³•\né€šè¿‡åå°„å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œå³ä½¿æ–¹æ³•æ˜¯ç§æœ‰çš„ã€‚\næµ‹è¯•æ¡†æ¶ï¼šJUnit é€šè¿‡åå°„è°ƒç”¨æµ‹è¯•æ–¹æ³•ã€‚ 4. è®¿é—®å­—æ®µ\né€šè¿‡åå°„å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¿é—®å¯¹è±¡çš„å­—æ®µï¼Œå³ä½¿å­—æ®µæ˜¯ç§æœ‰çš„\nåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼šé€šè¿‡åå°„è®¿é—®å¯¹è±¡çš„å­—æ®µã€‚ å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰ï¼šHibernate é€šè¿‡åå°„è®¿é—®å®ä½“ç±»çš„å­—æ®µã€‚ 7. æ³¨è§£å¤„ç†\né€šè¿‡åå°„å¯ä»¥è·å–ç±»ã€æ–¹æ³•ã€å­—æ®µä¸Šçš„æ³¨è§£ï¼Œå¹¶æ ¹æ®æ³¨è§£æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚\n24/4/14\n1ï¸âƒ£ åå°„çš„ä½œç”¨\nè·å–ç±»ä¸­çš„æ‰€æœ‰ä¿¡æ¯(e.g.æŒä¹…åŒ–ã€IDEçš„ä»£ç æç¤º) 1Field[] fields = cls.getDeclaredFields(); 2for (int i = 0; i \u0026lt; fields.length; i++) { 3 fields[i].setAccessible(true); 4 // String name = fields[i].getName(); // å±æ€§å ç¬¬ä¸€æ¬¡å…ˆç”Ÿæˆåˆ—å 5 Object value = fields[i].get(obj); 6 bw.append(value.toString()); 7 if (i \u0026lt; fields.length - 1) { 8 bw.append(\u0026#34;, \u0026#34;); 9 } 10} 11bw.newLine(); ç»“åˆé…ç½®æ–‡ä»¶åŠ¨æ€åˆ›å»ºå¯¹è±¡ 1Properties prop = new Properties(); 2 3String filename = \u0026#34;prop.properties\u0026#34;; 4FileInputStream is = new FileInputStream(filename); 5 6prop.load(is); 7 8String classname = prop.getProperty(\u0026#34;classname\u0026#34;); 9String method = prop.getProperty(\u0026#34;method\u0026#34;); 10String name = prop.getProperty(\u0026#34;name\u0026#34;); 11 12Class cls = Class.forName(classname); 13Constructor con = cls.getDeclaredConstructor(); 14Object o = con.newInstance(); 15 16Method setName = cls.getMethod(\u0026#34;setName\u0026#34;, String.class); 17setName.invoke(o, name); 18 19Method met = cls.getDeclaredMethod(method); 20met.invoke(o); 2ï¸âƒ£ è·å–Classçš„ä¸‰ç§æ–¹å¼\nClass.forname(\u0026ldquo;å…¨ç±»å\u0026rdquo;) ç±»å.class å¯¹è±¡.getClass() 3ï¸âƒ£ å¸¸ç”¨ä¿¡æ¯\nConstructor(æ„é€ å™¨) Parameter(æ–¹æ³•å‚æ•°) Field(æˆå‘˜å˜é‡) Modifiers(æƒé™ä¿®é¥°ç¬¦) Method(æˆå‘˜æ–¹æ³•) Declared(ç”¨äºè·å–ç§æœ‰ä¿¡æ¯) Java åŠ¨æ€ä»£ç† æ— ä¾µå…¥çš„ç»™ä»£ç æ·»åŠ é¢å¤–çš„åŠŸèƒ½\næµç¨‹ï¼š\nå‡†å¤‡ï¼šå…·ä½“è¡Œä¸ºå¯¹è±¡ + æŠ½è±¡è¡Œä¸ºæ¥å£ + ä»£ç†ç±» æ‰§è¡Œï¼šæ•°æ® =\u0026gt; ä»£ç†ç±»(æŠ½è±¡è¡Œä¸ºæ¥å£) =\u0026gt; InvocationHandler.invoke é’©å­ä¹‹ç±»çš„ï¼Œæ’å…¥ä»£ç \n1public interface Star (æŠ½è±¡æ¥å£ï¼Œå®šä¹‰è¡Œä¸º) 2public class BigStar implements Star (å…·ä½“ç±»åï¼Œå®ç°è¡Œä¸º) 3 4 5/* 6* ClassLoader: ç”¨äºåŠ è½½ä»£ç†ç±»çš„ç±»åŠ è½½å™¨ (å…·ä½“) 7* Interface : ä»£ç†ç±»éœ€è¦å®ç°çš„æ¥å£åˆ—è¡¨ (æŠ½è±¡) 8* InvocationHandler: execute proxy task 9*/ 10Star star = (Star) Proxy.newProxyInstance( 11 bigStar.getClass().getClassLoader(), 12 new Class[]{Star.class}, 13 new InvocationHandler() { 14 @Override 15 public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { 16 if (method.getName().equals(\u0026#34;sing\u0026#34;)) { 17 System.out.println(\u0026#34;å‡†å¤‡è¯ç­’ï¼Œæ”¶é’±\u0026#34;); 18 }else if (method.getName().equals(\u0026#34;dance\u0026#34;)) { 19 System.out.println(\u0026#34;å‡†å¤‡èˆå°ï¼Œæ”¶é’±\u0026#34;); 20 } 21 22 return method.invoke(bigStar, args); 23 } 24 } 25); 26 27// ä½¿ç”¨ä»£ç† 28BigStar kun = new BigStar(\u0026#34;KunKun\u0026#34;); 29Star proxy = ProxyUtil.createProxy(kun); 30String result = proxy.sing(\u0026#34;åªå› ä½ å¤ªç¾\u0026#34;); 31System.out.println(result); Java æ³›å‹ ç±»å‹å‚æ•°åŒ–\n1ï¸âƒ£ ç¼–è¯‘æ—¶æ£€æŸ¥\nä¸ç¬¦åˆçš„ç¼–è¯‘é€šè¿‡ä¸äº†\n2ï¸âƒ£ ä»£ç å¤ç”¨\n1public static \u0026lt;T extends Number\u0026gt; Double add(T a, T b) { 2 return a.doubleValue() + b.doubleValue(); 3} 4 5// å‡½æ•°ç­¾å \u0026lt;T extends Number\u0026gt; ç”¨äºé™å®šå‚æ•°ç±»å‹ 6// int float double éƒ½OK æ³›å‹ç±» 1// ClassæŒ‡å®šçš„Tä¼šä¼ é€’ç»™æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³• 2public class GenericClass \u0026lt;T\u0026gt;{ 3 private T good; 4 5 public T getGood(T var) { 6 System.out.println(var); 7 return this.good; 8 } 9 10 public void setGood(T good) { 11 this.good = good; 12 } 13} 14 15// æŒ‡å®šå¤šä¸ªæ³›å‹ç±»å‹ 16public class MultiGenericClass\u0026lt;K, V\u0026gt; { 17 private K key; 18 private V value; 19 20 public K getKey() { 21 return key; 22 } 23 24 public void setKey(K key) { 25 this.key = key; 26 } 27 28 public V getValue(K key) { 29 return value; 30 } 31 32 public void setValue(V value) { 33 this.value = value; 34 } 35} æ³›å‹æ¥å£ 1// å°±æ˜¯å®ä¾‹åŒ–å¯¹è±¡æ—¶ å†æŒ‡å®šå‚æ•°ç±»å‹ 2public interface GenericInterface \u0026lt;K, V\u0026gt;{ 3 public abstract V getValue(K key); 4} 5 6class myMap\u0026lt;K, V\u0026gt; implements GenericInterface\u0026lt;K, V\u0026gt; { 7 8 private HashMap\u0026lt;K, V\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); 9 10 @Override 11 public V getValue(K key) { 12 return map.get(key); 13 } 14 15 public void put(K key, V value) { 16 map.put(key, value); 17 } 18} æ³›å‹æ–¹æ³• å‡½æ•°ç­¾åè¡¨ç¤ºæ­¤æ–¹æ³•æ˜¯æ³›å‹æ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸ªä¸Classçš„æ— å…³ï¼Œé™å®šåœ¨æ–¹æ³•éƒ¨åˆ† ä½œç”¨èŒƒå›´ï¼ï¼ï¼\n1// æ³›å‹ç»“åˆåå°„ï¼ŒåŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼Œå¯ä»¥è¿›è¡Œåˆå§‹åŒ– 2public \u0026lt;T\u0026gt; T getObject(Class\u0026lt;T\u0026gt; c) throws NoSuchMethodException { 3 Constructor\u0026lt;T\u0026gt; constructor = c.getConstructor(); 4 T t = constructor.newInstance(); 5 return t; 6} 7 8public static \u0026lt;T extends Number\u0026gt; Double add(T a, T b) { 9 return a.doubleValue() + b.doubleValue(); 10} æ³›å‹è¾¹ç•Œ 1// ï¼Ÿ æ˜¯ çˆ¶ç±» - ä¸‹ç•Œ 2public static void funcAAA(List\u0026lt;? super Student\u0026gt; sList){ 3 System.out.println(sList); 4} 5 6// ï¼Ÿ æ˜¯ å­ç±» - ä¸Šç•Œ 7public static void funcAA(List\u0026lt;? extends Person\u0026gt; pList){ 8 System.out.println(pList); 9} æ³›å‹æ“¦é™¤ï¼š\nâ€‹\tä¸ºäº†å…¼å®¹javaæ²¡æœ‰æ³›å‹ç‰¹æ€§çš„è€ç‰ˆæœ¬ã€‚åœ¨ç¼–è¯‘é˜¶æ®µä¼šè¿›è¡Œæ‰€è°“çš„â€œç±»å‹æ“¦é™¤â€ã€‚å°†æ‰€æœ‰çš„æ³›å‹è¡¨ç¤ºï¼ˆå°–æ‹¬å·ä¸­çš„å†…å®¹ï¼‰éƒ½æ›¿æ¢ä¸ºå…·ä½“çš„ç±»å‹ï¼ˆå…¶å¯¹åº”çš„åŸç”Ÿæ€ç±»å‹ï¼‰ã€\næ¶ˆé™¤ç±»å‹å‚æ•°å£°æ˜ï¼Œå³åˆ é™¤\u0026lt;\u0026gt;åŠå…¶åŒ…å›´çš„éƒ¨åˆ†ã€‚ æ®ç±»å‹å‚æ•°çš„ä¸Šä¸‹ç•Œæ¨æ–­å¹¶æ›¿æ¢æ‰€æœ‰çš„ç±»å‹å‚æ•°ä¸ºåŸç”Ÿæ€ç±»å‹(å¾€çˆ¶ç±»è½¬ï¼Œæ›´åŒ…å®¹) è‡ªåŠ¨äº§ç”Ÿâ€œæ¡¥æ¥æ–¹æ³•â€ä»¥ä¿è¯æ“¦é™¤ç±»å‹åçš„ä»£ç ä»ç„¶å…·æœ‰æ³›å‹çš„â€œå¤šæ€æ€§â€ â€‹\næ— é™åˆ¶ç±»å‹æ“¦é™¤ - \u0026lt;T\u0026gt;å’Œ\u0026lt;?\u0026gt;çš„ç±»å‹å‚æ•°éƒ½è¢«æ›¿æ¢ä¸ºObject\næœ‰é™åˆ¶ç±»å‹æ“¦é™¤ - \u0026lt;T extends Number\u0026gt;å’Œ\u0026lt;? extends Number\u0026gt;çš„ç±»å‹å‚æ•°è¢«æ›¿æ¢ä¸ºNumberï¼Œ\nâ€‹\t\u0026lt;? super Number\u0026gt;è¢«æ›¿æ¢ä¸ºObject\næ¡¥æ¥ - ç¼–è¯‘é˜¶æ®µç±»å‹æ“¦é™¤æ—¶æ‰§è¡Œ\nä¿è¯å¤šæ€ç‰¹æ€§ - å› ä¸ºå¯ä»¥å¤šä¸ªå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œçˆ¶ç±»çš„ç±»å‹åˆæ˜¯æ³›å‹ï¼Œä¸èƒ½è¢«æŸä¸ªå­ç±»çš„æ³›å‹é™åˆ¶ä½ï¼\n1// çˆ¶ç±»å®šä¹‰ 2class Pair\u0026lt;T\u0026gt; { 3 private T value; 4 public T getValue() { 5 return value; 6 } 7 public void setValue(T value) { 8 this.value = value; 9 } 10} 11 12// å­ç±»å®šä¹‰ 13class DateInter extends Pair\u0026lt;Date\u0026gt; { 14 15 @Override 16 public void setValue(Date value) { 17 super.setValue(value); 18 } 19 20 @Override 21 public Date getValue() { 22 return super.getValue(); 23 } 24} 25 26// ç¼–è¯‘æ—¶ ç±»å‹æ“¦é™¤å 27class Pair { 28 private Object value; 29 public Object getValue() { 30 return value; 31 } 32 public void setValue(Object value) { 33 this.value = value; 34 } 35} ç”Ÿæˆä¸­é—´çš„æ¡¥æ¥æ–¹æ³•ï¼Œè¿›è¡Œè¿æ¥ï¼Œç»´æŠ¤å¤šæ€æ€§ã€‚\nJava æ³¨è§£ 1@Target({ElementType.METHOD, ElementType.PARAMETER})\t// æ”¾ç½®åœ¨å“ª 2@Retention(RetentionPolicy.RUNTIME)\t// å­˜æ´»æ—¶é—´ 3public @interface Log { 4 // æ¨¡å— 5 String title() default \u0026#34;\u0026#34;; 6 7 // åŠŸèƒ½ 8 BusinessType businessType() default BusinessType.OTHER; 9 10 // æ“ä½œäººå‘˜ 11 OperatorType operatorType() default OperatorType.MANGE; 12 13 // æ˜¯å¦ä¿å­˜è¯·æ±‚å‚æ•° 14 boolean isSaveRequestData() default true; 15} ä¸AOPç»“åˆï¼Œå®ç°åˆ‡å…¥\n1@Aspect\t// ç»™Springæ‰˜ç®¡ï¼Œå¹¶ä¸”æ­¤æ³¨è§£æ ‡è¯†è¿™ä¸ªç±»å®ç°åˆ‡å…¥åŠŸèƒ½ 2@Component 3public class LogAspect { 4 5 @Pointcut(\u0026#34;@annotation(log_aop.Log)\u0026#34;)\t// æ£€æµ‹å¸¦æœ‰@Logæ³¨è§£çš„éƒ¨åˆ† 6 public void logPointCut(){} 7 8 9 @Before(\u0026#34;logPointCut()\u0026#34;)\t// åœ¨åˆ‡å…¥ç‚¹å‰æ‰§è¡Œæ“ä½œ 10 public void logPointCutBefore(JoinPoint joinPoint) { 11 System.out.println(\u0026#34;åœ¨åˆ‡å…¥ç‚¹å‰å…ˆæ‰§è¡Œ\u0026#34;); 12 MethodSignature signature = (MethodSignature) joinPoint.getSignature(); 13 Method method = signature.getMethod(); 14 15 System.out.println(method.getName()); 16 Log annotation = method.getAnnotation(Log.class); 17 if (annotation != null) { 18 System.out.println(annotation.title()); 19 System.out.println(annotation.isSaveRequestData()); 20 System.out.println(annotation.businessType()); 21 System.out.println(annotation.operatorType()); 22 } else { 23 System.err.println(\u0026#34;æ²¡æœ‰è·å–åˆ°æ³¨è§£ä¿¡æ¯\u0026#34;); 24 } 25 } 26} Spring Boot ç®€å•å®ç°\n1@RestController 2public class Controller { 3 4 @Log(title = \u0026#34;æ¨¡æ‹ŸæŸ¥è¯¢ä¿¡æ¯\u0026#34;, businessType = BusinessType.SELECT, operatorType = OperatorType.PERSON) 5 @GetMapping(\u0026#34;/test\u0026#34;) 6 public Map\u0026lt;String, Object\u0026gt; test() { 7 System.out.println(\u0026#34;æ‰§è¡Œå¤„ç†è¯·æ±‚æ“ä½œ\u0026#34;); 8 HashMap\u0026lt;String, Object\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); 9 map.put(\u0026#34;code\u0026#34;, 200); 10 map.put(\u0026#34;msg\u0026#34;, \u0026#34;success\u0026#34;); 11 12 return map; 13 } 14 15} Java å¤šçº¿ç¨‹ åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼ - å•ç»§æ‰¿å¤šå®ç°\n1public class ThreadFirstWay extends Thread{ 2 3 @Override 4 public void run() { 5 for (int i = 0; i \u0026lt; 20; i++) { 6 System.out.println(this.getName() + \u0026#34; print : \u0026#34; + i); 7 } 8 } 9} 10 11new ThreadFirstWay().start() 12 13// æ›´çµæ´» 14------------------------------------------------------- 15public class ThreadSecondWay implements Runnable{ 16 17 @Override 18 public void run() { 19 for (int i = 0; i \u0026lt; 20; i++) { 20 Thread thread = Thread.currentThread(); 21 System.out.println(thread.getName() + \u0026#34; print : \u0026#34; + i); 22 } 23 } 24} 25 26new Thread(new ThreadSecondWay()).start() 27 28// è¿”å›ç»“æœ 29------------------------------------------------------- 30class MyCallable implements Callable\u0026lt;Integer\u0026gt; { 31 32 @Override 33 public Integer call() throws Exception { 34 int sum = 0; 35 for (int i = 0; i \u0026lt; 20; i++) { 36 sum += i; 37 } 38 return sum; 39 } 40} 41 42MyCallable callable = new MyCallable(); 43FutureTask\u0026lt;Integer\u0026gt; task = new FutureTask\u0026lt;\u0026gt;(callable); 44 45Thread thread1 = new Thread(task); 46thread1.start(); 47 48Integer result = task.get(); 49System.out.println(result); çº¿ç¨‹æ±  1// newCachedThreadPool: ä¼šå¤ç”¨ä¹‹å‰çš„çº¿ç¨‹(ç©ºé—², è¶…å‡ºæ—¶é—´ä¼šå…³é—­) 2// newFixedThreadPool: å›ºå®šçº¿ç¨‹æ•°ï¼Œä»»åŠ¡åœ¨é˜»å¡é˜Ÿåˆ—ä¸­æ’é˜Ÿ 3 4ExecutorService threadPool = Executors.newFixedThreadPool(2); 5threadPool.submit(new MyRunnable(\u0026#34;@Run 1\u0026#34;)); 6 7// æ›´è¯¦ç»† 8------------------------------------------------------- 9ThreadPoolExecutor threadPool = new ThreadPoolExecutor( 10 corePoolSize=2,\t// æ ¸å¿ƒçº¿ç¨‹ 11 maximumPoolSize=3, // ä¸´æ—¶çº¿ç¨‹ 12 KeepAliveTime=60, // ä¸´æ—¶çº¿ç¨‹å­˜æ´»æ—¶é—´ 13 TimeUnit.SECONDS, 14 new ArrayBlockingQueue\u0026lt;\u0026gt;(3), // é˜»å¡é˜Ÿåˆ— 15 new ThreadPoolExecutor.AbortPolicy() // é»˜è®¤æŠ›å‡ºå¼‚å¸¸ 16); 17 18threadPool.execute(new TestRunnable(\u0026#34;@Runnable 1\u0026#34;)); å•ç”Ÿäº§å•æ¶ˆè´¹è€… ä½¿ç”¨ synchronized(å”¯ä¸€å¯¹è±¡) å®ç°ä¸´ç•ŒåŒº\n1// å•ç”Ÿäº§å•æ¶ˆè´¹çš„åŒæ­¥ 2class Desk { 3 // ç®€åŒ–ç‰ˆ 1æœ‰ï¼Œ0æ—  4 public static int foodFlag = 0; 5 6 // æ€»ä¸ªæ•° 7 public final static int total = 10; 8 9 // å‰©ä½™æ•° 10 public static int count = 10; 11 12 // é” 13 public static Object lock = new Object(); 14} 15 16// æ¶ˆè´¹è€… 17class Consumer extends Thread { 18 19 @SneakyThrows 20 @Override 21 public void run() { 22 while (true) { 23 synchronized (Desk.lock) { 24 // ç¾é£Ÿå®¶æ˜¯å¦åƒé¥± 25 if (Desk.count == 0) { 26 break; 27 } else { 28 // æ˜¯å¦åšå¥½é£Ÿç‰© 29 if(Desk.foodFlag == 0) { 30 // ç­‰å¾…ç”Ÿäº§è€…åˆ¶ä½œé£Ÿç‰© 31 Desk.lock.wait(); 32 }else { 33 // æ¶ˆè€—æ‰ä¸€ä»½é£Ÿç‰© 34 Desk.count--; 35 36 // åƒé£Ÿç‰© 37 System.out.println(\u0026#34;æ¶ˆè´¹è€…æ­£åœ¨åƒç¬¬\u0026#34; + (Desk.total-Desk.count) + \u0026#34;ç¢—é£Ÿç‰©\u0026#34;); 38 39 // é€šçŸ¥ç”Ÿäº§è€…åˆ¶ä½œé£Ÿç‰© 40 Desk.lock.notifyAll(); 41 42 // æ˜¯å¦å­˜åœ¨é£Ÿç‰© 43 Desk.foodFlag = 0; 44 } 45 } 46 } 47 } 48 } 49 50} 51 52 53class Producer extends Thread { 54 @SneakyThrows 55 @Override 56 public void run() { 57 while (true) { 58 // å ç”¨æ¡Œå­ 59 synchronized (Desk.lock) { 60 // ç¾é£Ÿå®¶æ˜¯å¦åƒé¥± 61 if(Desk.count == 0) { 62 break; 63 }else { 64 // ä¸Šä»½é£Ÿç‰©æ˜¯å¦å­˜åœ¨ 65 if(Desk.foodFlag == 1) { 66 // ç­‰é£Ÿç‰©è¢«åƒ 67 Desk.lock.wait(); 68 } else { // åˆ¶ä½œé£Ÿç‰© 69 System.out.println(\u0026#34;ç”Ÿäº§è€…åˆ¶ä½œç¬¬\u0026#34; + (Desk.total - Desk.count + 1) + \u0026#34;ä»½é£Ÿç‰©\u0026#34;); 70 71 Desk.foodFlag = 1; 72 73 Desk.lock.notifyAll(); 74 } 75 } 76 } 77 } 78 } 79} ç®€å•æŠ½å¥– 1// ç®€å•è€ƒè™‘ 100%ä¸­å¥– 2class LotteryBox extends Thread { 3 public final static int[] Pond = {2, 5, 10, 20, 50, 100, 200, 300, 500, 1000}; 4 5 public static int[] count = {10, 9, 8, 7, 6, 5, 4, 3, 2, 1}; 6 7 public static int totalNumber = 100; 8 public static Set\u0026lt;Integer\u0026gt;[] winningNumber = new Set[count.length]; 9 public static List\u0026lt;Integer\u0026gt; number = new ArrayList\u0026lt;\u0026gt;(); 10 11 public static int numberIdx = 0; 12 13 public static ReentrantLock lock = new ReentrantLock(); 14 15 public static void initData() { 16 // åˆå§‹åŒ–æ•°ç»„ä¸­çš„æ¯ä¸ª Set 17 for (int i = 0; i \u0026lt; winningNumber.length; i++) { 18 winningNumber[i] = new HashSet\u0026lt;\u0026gt;(); 19 } 20 21 for (int i = 1; i \u0026lt;= totalNumber; i++) { 22 number.add(i); 23 } 24 25 Collections.shuffle(number); 26 27 int idx = 0; 28 // æŒ‡å®šä¸­å¥–å·ç  29 for (int i = 0; i \u0026lt; count.length; i++) { 30 for (int j = 0; j \u0026lt; count[i]; j++) { 31 winningNumber[i].add(number.get(idx)); 32 idx += 1; 33 } 34 } 35 36 Collections.shuffle(number); 37 } 38 39 40 @Override 41 public void run() { 42 while (true) { 43 LotteryBox.lock.lock(); 44 if (LotteryBox.numberIdx \u0026lt; LotteryBox.totalNumber) { 45 46 int n = number.get(LotteryBox.numberIdx); 47 LotteryBox.numberIdx += 1; 48 LotteryBox.lock.unlock(); 49 50 int rank = -1; 51 for (int j = 0; j \u0026lt; winningNumber.length; j++) { 52 if (winningNumber[j].contains(n)) { 53 rank = j; 54 } 55 } 56 57 if (rank == -1) { 58 System.out.println(getName() + \u0026#34;æŠ½åˆ°çš„\u0026#34; + n + \u0026#34;å·ç æ²¡æœ‰ä¸­å¥–ï¼\u0026#34;); 59 } else { 60 System.out.println(getName() + \u0026#34;æŠ½åˆ°çš„\u0026#34; + n + \u0026#34;å·ç ä¸­äº†\u0026#34; + Pond[rank] + \u0026#34;å…ƒ\u0026#34;); 61 } 62 } else { 63 LotteryBox.lock.unlock(); 64 System.out.println(getName() + \u0026#34;: å¥–æ± å·²ç»æŠ½å–å®Œæ¯•ï¼\u0026#34;); 65 break; 66 } 67 } 68 } 69} é‚®ä»¶æœåŠ¡ ArrayBlockingQueue èµ„æºä¸å¤Ÿï¼Œä¼šè‡ªåŠ¨é˜»å¡å’Œå”¤é†’çº¿ç¨‹\n1package thread; 2 3import lombok.AllArgsConstructor; 4import lombok.Data; 5import lombok.NoArgsConstructor; 6import lombok.SneakyThrows; 7 8import java.io.Serializable; 9import java.util.concurrent.ArrayBlockingQueue; 10import java.util.concurrent.ExecutorService; 11import java.util.concurrent.Executors; 12 13/** 14 * Date: 2024/4/19 15 */ 16public class EmailServer { 17 public static void main(String[] args) throws InterruptedException { 18 MailService service = new MailService(); 19 20 ExecutorService threadPool = Executors.newFixedThreadPool(2); 21 22 ConsumeEmailQueue runnable1 = new ConsumeEmailQueue(\u0026#34;@æœåŠ¡1\u0026#34;, service); 23 ConsumeEmailQueue runnable2 = new ConsumeEmailQueue(\u0026#34;$æœåŠ¡2\u0026#34;, service); 24 threadPool.submit(runnable1); 25 threadPool.submit(runnable2); 26 27 for (int i = 0; i \u0026lt; 5; i++) { 28 Email email = new Email(\u0026#34;title\u0026#34;+i, \u0026#34;content\u0026#34;+i); 29 MailQueue.getMailQueue().produce(email); 30 Thread.sleep(3000); 31 } 32 } 33} 34 35 36class MailService { 37 public void sendEmail(Email email) { 38 System.out.println(\u0026#34;-------------------------\u0026#34;); 39 System.out.println(\u0026#34;æ¥æ–°é‚®ä»¶äº†ï¼\u0026#34;); 40 System.out.println(email); 41 System.out.println(\u0026#34;-------------------------\u0026#34;); 42 } 43} 44 45class ConsumeEmailQueue implements Runnable { 46 private MailService mailService; 47 private String name; 48 49 public ConsumeEmailQueue(String name, MailService mailService) { 50 this.name = name; 51 this.mailService = mailService; 52 } 53 54 @SneakyThrows 55 @Override 56 public void run() { 57 while (true) { 58 Email email = MailQueue.getMailQueue().consume(); 59 if (email != null) { 60 System.out.println(name + \u0026#34;å–èµ°äº†ä¸€å°é‚®ä»¶\u0026#34;); 61 System.out.println(\u0026#34;å‰©ä½™é‚®ä»¶: \u0026#34; + MailQueue.getMailQueue().size()); 62 mailService.sendEmail(email); 63 } 64 System.out.println(\u0026#34;æ¶ˆè´¹è€…æ£€æŸ¥äº†ä¸€è½®\\n\u0026#34;); 65 } 66 } 67} 68 69@Data 70@NoArgsConstructor 71@AllArgsConstructor 72class Email implements Serializable { 73 private String title; 74 private String content; 75} 76 77class MailQueue { 78 // é˜Ÿåˆ—å¤§å° 79 public static int QUEUE_MAX_SIZE = 1000; 80 81 // é˜»å¡é˜Ÿåˆ— 82 public static ArrayBlockingQueue\u0026lt;Email\u0026gt; blockingQueue = new ArrayBlockingQueue\u0026lt;\u0026gt;(100); 83 84 // ç§æœ‰åŒ–æ„é€ å™¨ 85 private MailQueue() { 86 } 87 // å®ç°å•ä¾‹æ¨¡å¼ 88 private static class SingletonHolder { 89 private static MailQueue mailQueue = new MailQueue(); 90 } 91 92 public static MailQueue getMailQueue() { 93 return SingletonHolder.mailQueue; 94 } 95 96 // ç”Ÿäº§ 97 public void produce(Email email) throws InterruptedException { 98 blockingQueue.put(email); 99 } 100 101 // æ¶ˆè´¹ 102 public Email consume() throws InterruptedException { 103 return blockingQueue.take(); 104 } 105 106 public int size() { 107 return blockingQueue.size(); 108 } 109} Java Websocket ç®€æ˜“å…±äº«èŠå¤©å®¤ æœåŠ¡ç«¯ 1// è‡ªå®šä¹‰ç»ˆç«¯é…ç½®ç±»ï¼Œç›®çš„å°±æ˜¯åœ¨å»ºç«‹è¿æ¥æ—¶ï¼Œä¿å­˜ä¸€äº›æ•°æ®ä»¥ä¾›è®¿é—® - httpSession ä¿å­˜äº†è¯·æ±‚çš„ä¿¡æ¯ 2public class GetHttpSessionConfigurator extends ServerEndpointConfig.Configurator { 3 @Override 4 public void modifyHandshake(ServerEndpointConfig sec, HandshakeRequest request, HandshakeResponse response) { 5 HttpSession httpSession = (HttpSession) request.getHttpSession(); 6 sec.getUserProperties().put(HttpSession.class.getName(), httpSession); 7 } 8} 1// ä¸€ä¸ªEndpoint == ä¸€ä¸ªå®¢æˆ·ç«¯ 2// æœåŠ¡ç»ˆç«¯å¯¹è±¡ï¼Œ configuratorå…³è”è‡ªå®šä¹‰çš„é…ç½®å™¨ç±»ï¼Œç›®çš„æ˜¯è®© WebSocket ä¼šè¯èƒ½å¤Ÿè®¿é—®å­˜å‚¨åœ¨ HTTP ä¼šè¯ä¸­çš„æ•°æ® 3@ServerEndpoint(value = \u0026#34;/chat\u0026#34;, configurator = GetHttpSessionConfigurator.class) 4@Component 5public class ChatEndpoint { 6 // ç»´æŠ¤ä¸€ä»½å…±äº«çš„è¿æ¥ç»ˆç«¯åœ¨çº¿ä¿¡æ¯ã€‚ å¤šä¸ªçº¿ç¨‹é¢‘ç¹åœ°è®¿é—®å’Œä¿®æ”¹å…±äº«çš„é”®å€¼å¯¹é›†åˆæ—¶ï¼ŒConcurrentHashMap æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹© 7 private static Map\u0026lt;String, ChatEndpoint\u0026gt; onlineUsers= new ConcurrentHashMap\u0026lt;\u0026gt;(); // user =\u0026gt; endpoint 8 9 // ç”¨æ¥å‘é€ä¿¡æ¯ç»™å¯¹åº”ç»ˆç«¯ 10 private Session session; 11 12 // ç”¨æ¥è·å–è¯·æ±‚çš„ä¿¡æ¯ï¼Œæ ‡è¯†å‘é€å¯¹è±¡ 13 private HttpSession httpSession; 14 15 // é¦–æ¬¡è¿æ¥ï¼Œ åœ¨HTTPæ¡æ‰‹è¿æ¥æ—¶å·²ç»æŠŠ\u0026lt;username, HttpSession\u0026gt;æ”¾å…¥configä¸­ 16 @OnOpen 17 public void onOpen(Session session, EndpointConfig config) { 18 // åˆå§‹åŒ–æ•°æ® 19 this.session = session; 20 HttpSession httpSession = (HttpSession) config.getUserProperties().get(HttpSession.class.getName()); 21 this.httpSession = httpSession; 22 23 String user = (String) httpSession.getAttribute(\u0026#34;user\u0026#34;); 24 onlineUsers.put(user, this); 25 26 // å¹¿æ’­é€šçŸ¥ æ›´æ–°åœ¨çº¿ç”¨æˆ·ï¼Œè®©åˆ«äººçŸ¥é“ä½ ä¸Šçº¿äº† 27 String message = MessageUtils.getMessage(true, null, getAllOnlineUsers()); 28 broadcastAllUsers(message); 29 } 30 31 // å¹¿æ’­ä¿¡æ¯ç»™æ‰€æœ‰åœ¨çº¿ç”¨æˆ· 32 private void broadcastAllUsers(String message) { 33 try { 34 Set\u0026lt;String\u0026gt; names = onlineUsers.keySet(); 35 for (String name : names) { 36 ChatEndpoint chatEndpoint = onlineUsers.get(name); 37 chatEndpoint.session.getBasicRemote().sendText(message); // @@@ æ ¸å¿ƒå‘é€ä¿¡æ¯çš„ä»£ç  38 } 39 } catch (IOException e) { 40 e.printStackTrace(); 41 } 42 } 43 44 // è·å–æ‰€æœ‰åœ¨çº¿ç”¨æˆ· 45 private Set\u0026lt;String\u0026gt; getAllOnlineUsers() { 46 return onlineUsers.keySet(); 47 } 48 49 // @@@ æ ¸å¿ƒ =\u0026gt; è½¬å‘ä¿¡æ¯ 50 @OnMessage 51 public void onMessage(String message, Session session) { 52 try { 53 ObjectMapper mapper = new ObjectMapper(); 54 Message msg = mapper.readValue(message, Message.class); 55 String toName = msg.getToName(); 56 String data = msg.getMessage(); 57 String user = (String) httpSession.getAttribute(\u0026#34;user\u0026#34;); 58 String resultMsg = MessageUtils.getMessage(false, user, data); 59 60 onlineUsers.get(toName).session.getBasicRemote().sendText(resultMsg); 61 } catch (IOException e) { 62 e.printStackTrace(); 63 } 64 } 65 66 @OnClose 67 public void onClose(Session session) { 68 String user = (String) httpSession.getAttribute(\u0026#34;user\u0026#34;); 69 onlineUsers.remove(user); 70 71 String message = MessageUtils.getMessage(true, null, getAllOnlineUsers()); 72 broadcastAllUsers(message); 73 } 74} å®¢æˆ·ç«¯ 1var ws = new WebSocket(\u0026#34;ws://localhost:8080/chat\u0026#34;); 2 ws.onopen = function (e) { 3 $(\u0026#34;#username\u0026#34;).html(\u0026#34;ç”¨æˆ·ï¼š\u0026#34;+ username +\u0026#34;\u0026lt;span\u0026gt;åœ¨çº¿\u0026lt;/span\u0026gt;\u0026#34;); 4 } 5 //æ¥å—æ¶ˆæ¯ 6 ws.onmessage = function (ev) { 7 var datastr = ev.data; 8 var res = JSON.parse(datastr); 9 //åˆ¤æ–­æ˜¯å¦æ˜¯ç³»ç»Ÿæ¶ˆæ¯ 10 if(res.system){ 11 //å¥½å‹åˆ—è¡¨ 12 //ç³»ç»Ÿå¹¿æ’­ 13 var names = res.message; 14 var userlistStr = \u0026#34;\u0026#34;; 15 var broadcastListStr = \u0026#34;\u0026#34;; 16 for (var name of names){ 17 if (name != username){ 18 userlistStr += \u0026#34;\u0026lt;a onclick=\u0026#39;showChat(\\\u0026#34;\u0026#34;+name+\u0026#34;\\\u0026#34;)\u0026#39;\u0026gt;\u0026#34;+ name +\u0026#34;\u0026lt;/a\u0026gt;\u0026lt;/br\u0026gt;\u0026#34;; 19 broadcastListStr += \u0026#34;\u0026lt;p\u0026gt;\u0026#34;+ name +\u0026#34;ä¸Šçº¿äº†\u0026lt;/p\u0026gt;\u0026#34;; 20 } 21 }; 22 $(\u0026#34;#hylist\u0026#34;).html(userlistStr); 23 $(\u0026#34;#xtlist\u0026#34;).html(broadcastListStr); 24 25 }else { 26 //ä¸æ˜¯ç³»ç»Ÿæ¶ˆæ¯ 27 var str = \u0026#34;\u0026lt;span id=\u0026#39;mes_left\u0026#39;\u0026gt;\u0026#34;+ res.message +\u0026#34;\u0026lt;/span\u0026gt;\u0026lt;/br\u0026gt;\u0026#34;; 28 if (toName == res.fromName) 29 $(\u0026#34;#content\u0026#34;).append(str); 30 31 var chatdata = sessionStorage.getItem(res.fromName); 32 if (chatdata != null){ 33 str = chatdata + str; 34 } 35 sessionStorage.setItem(res.fromName, str); 36 37 }; 38 } 39 40 ws.onclose = function (ev) { 41 $(\u0026#34;#username\u0026#34;).html(\u0026#34;ç”¨æˆ·ï¼š\u0026#34;+ username +\u0026#34;\u0026lt;span\u0026gt;ç¦»çº¿\u0026lt;/span\u0026gt;\u0026#34;); 42 } 43 44 showChat = function(name){ 45 // alert(\u0026#34;dsaad\u0026#34;); 46 toName = name; 47 //æ¸…ç©ºèŠå¤©åŒº 48 $(\u0026#34;#content\u0026#34;).html(\u0026#34;\u0026#34;); 49 $(\u0026#34;#new\u0026#34;).html(\u0026#34;å½“å‰æ­£ä¸\u0026#34;+toName+\u0026#34;èŠå¤©\u0026#34;); 50 var chatdata = sessionStorage.getItem(toName); 51 if (chatdata != null){ 52 $(\u0026#34;#content\u0026#34;).html(chatdata); 53 } 54 }; 55 //å‘é€æ¶ˆæ¯ 56 $(\u0026#34;#submit\u0026#34;).click(function () { 57 //è·å–è¾“å…¥çš„å†…å®¹ 58 var data = $(\u0026#34;#input_text\u0026#34;).val(); 59 $(\u0026#34;#input_text\u0026#34;).val(\u0026#34;\u0026#34;); 60 var json = {\u0026#34;toName\u0026#34;: toName ,\u0026#34;message\u0026#34;: data}; 61 //å°†æ•°æ®å±•ç¤ºåœ¨èŠå¤©åŒº 62 var str = \u0026#34;\u0026lt;span id=\u0026#39;mes_right\u0026#39;\u0026gt;\u0026#34;+ data +\u0026#34;\u0026lt;/span\u0026gt;\u0026lt;/br\u0026gt;\u0026#34;; 63 $(\u0026#34;#content\u0026#34;).append(str); 64 65 var chatdata = sessionStorage.getItem(toName); 66 if (chatdata != null){ 67 str = chatdata + str; 68 } 69 sessionStorage.setItem(toName,str); 70 //å‘é€æ•°æ® 71 ws.send(JSON.stringify(json)); 72 }) ä¼ªä»£ç æ¡†æ¶ æœåŠ¡å™¨ç«¯\n1public class GetHttpSessionConfigurator extends ServerEndpointConfig.Configurator { 2 @Override 3 public void modifyHandshake() { 4\t// ä¿å­˜è¯·æ±‚çš„ä¿¡æ¯ï¼Œåç»­è®¿é—® 5 } 6} 7 8// ä¸€ä¸ªEndpoint == ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œ value==url 9// æœåŠ¡ç»ˆç«¯ configuratorå…³è”è‡ªå®šä¹‰çš„é…ç½®å™¨ç±»ï¼Œç›®çš„æ˜¯è®© WebSocket ä¼šè¯èƒ½å¤Ÿè®¿é—®å­˜å‚¨åœ¨ HTTP ä¼šè¯ä¸­çš„æ•°æ® 10@ServerEndpoint(value = \u0026#34;/chat\u0026#34;, configurator = GetHttpSessionConfigurator.class) 11@Component 12public class ChatEndpoint { 13 14 // é¦–æ¬¡è¿æ¥ï¼Œ åœ¨HTTPæ¡æ‰‹è¿æ¥æ—¶å·²ç»æŠŠ\u0026lt;username, HttpSession\u0026gt;æ”¾å…¥configä¸­ 15 @OnOpen 16 public void onOpen(Session session, EndpointConfig config) { 17 // ä¼šè¯å»ºç«‹é€»è¾‘ 18 } 19 20 // @@@ æ ¸å¿ƒ =\u0026gt; è½¬å‘ä¿¡æ¯ chatEndpoint.session.getBasicRemote().sendText(message); @@@ æ ¸å¿ƒå‘é€ä¿¡æ¯çš„ä»£ç  21 @OnMessage 22 public void onMessage(String message, Session session) { 23 // æ¥å—ç»ˆç«¯æ¶ˆæ¯é€»è¾‘ 24 } 25 26 @OnClose 27 public void onClose(Session session) { 28\t// ä¼šè¯å…³é—­é€»è¾‘ 29 } 30} å®¢æˆ·ç«¯\n1var ws = new WebSocket(\u0026#34;ws://localhost:8080/chat\u0026#34;); 2 3ws.onopen = function (e) { 4 // ä¼šè¯å»ºç«‹é€»è¾‘ 5} 6 7ws.onmessage = function (ev) { 8 // æ¶ˆæ¯æ¥æ”¶é€»è¾‘ 9} 10 11ws.onclose = function (ev) { 12 // ä¼šè¯å…³é—­é€»è¾‘ 13} 14 15// ä¸»åŠ¨å‘é€æ•°æ® 16// ws.send(JSON.stringify(data)); Nginx 1# æ­£å‘ä»£ç† 2Client Server 3X1 \\\\ 4X2 == =\u0026gt; T(VPN) =\u0026gt; Y 5X3 // 6 7# åå‘ä»£ç† 8 // Y1 9X == =\u0026gt; T(Nginx) =\u0026gt; == Y2 10 \\\\ Y3 nginxå¯åœ\næ³¨æ„linuxæƒé™ï¼Œè‹¥æ— æƒé™ï¼Œåˆ™åŠ sudo\n1nginx -s ${signal} 2quit: åœæ­¢ 3reload: é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ nginx é…ç½®\n1# å…¨å±€é…ç½®ä¿¡æ¯ 2worker_processes auto; # mainè¿›ç¨‹ { å¤šä¸ªworkerè¿›ç¨‹ } 3 4events { 5\tworker_connections 1024; # ç½‘ç»œè¿æ¥æ•° 6} 7 8http { 9\t... 10\tserver{ ... } 11\tserver{ ... } 12} 1server { 2 listen 80 default_server;\t# ç›‘å¬ipv4-ç«¯å£(80) 3 listen [::]:80 default_server;\t# ç›‘å¬ipv6-ç«¯å£(80) 4 5\troot /var/www/html;\t# ä¸ºè¯·æ±‚æä¾›æ–‡ä»¶çš„æ ¹ç›®å½• 6\tindex index.html index.htm index.nginx-debian.html; # å®šä¹‰äº†å½“è¯·æ±‚ä¸ºç›®å½•æ—¶ï¼Œé»˜è®¤å°è¯•è¿”å›çš„æ–‡ä»¶åˆ—è¡¨ 7 8\tserver_name _; 9\tlocation / {\t# å¯¹äºæ ¹URLï¼ˆå³/ï¼‰çš„è¯·æ±‚çš„å¤„ç†è§„åˆ™ 10 # å°è¯•æŒ‰é¡ºåºæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œåˆ™è¿”å›404é”™è¯¯ï¼ˆæœªæ‰¾åˆ°ï¼‰ 11 try_files $uri $uri/ =404; 12 } åå‘ä»£ç†\n1# nginx.config ä¸­ 2 3http { 4\t... 5\tupstream backend {\t# default weight=1, é»˜è®¤è¿›è¡Œè½®è¯¢ 6\tip_hash; // ç»ˆç«¯ipå’ŒæœåŠ¡å™¨ipç»‘å®šåˆ°ä¸€èµ· 7\tserver ?.?.?.?:? weight=?; 8\tserver ?.?.?.?:?; 9\tserver ?.?.?.?:?; 10\t} 11\t12\tserver { 13\t... 14\tlocation /app { 15\tproxy_pass http://backend/; 16\t} 17\t} 18\t... 19} è§£é‡Šï¼šâ­upstream ? { \u0026hellip; } å®šä¹‰äº†ä¸Šæ¸¸æœåŠ¡å™¨ä¿¡æ¯ï¼Œip_hashçš„ä½œç”¨å°±æ˜¯è®©ç»ˆç«¯å’ŒæŸä¸ªæœåŠ¡å™¨ç»‘å®š(è§£å†³sessioné—®é¢˜)ï¼Œweightå‚æ•°æ˜¯åˆ†å‘æ•°é‡çš„æƒé‡ï¼Œé»˜è®¤1ï¼Œè¶Šå¤§å¾€è¿™ä¸ªæœåŠ¡å™¨åˆ†å‘çš„ä»»åŠ¡è¶Šå¤šã€‚ â­serverä¸­æ·»åŠ æ˜ å°„ location /app å°†è®¿é—®nginx.ip:80/appçš„è¯·æ±‚è½¬å‘ç»™ http ://backend/ çš„æœåŠ¡ï¼Œè¿›è¡Œå‡è¡¡è´Ÿè½½ã€‚\nç»ƒä¹ \n1ï¸âƒ£ 0.0.0.0 è¡¨ç¤ºæœ¬æœº127.0.0.1å’Œip-v4\n2ï¸âƒ£ åˆ›å»ºå¤šä¸ªFlaskæœåŠ¡ï¼Œæ¨¡æ‹Ÿå¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œå®éªŒå‡è¡¡è´Ÿè½½\n1from flask import Flask 2 3app = Flask(__name__) 4 5@app.route(\u0026#39;/\u0026#39;) 6def hello_world(): 7 return \u0026#39;Hello, 800?\u0026#39; 8 9if __name__ == \u0026#39;__main__\u0026#39;: 10 app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=800?) 11 12# ç»ˆç«¯è¿è¡Œ python .\\main8000.py --port=8000 MybatisPlus springboot application.yaml é…ç½®\n1mybatis-plus: 2 type-aliases-package: com/yoo/entity 3 mapper-locations: classpath:/mapper/**.xml 4 configuration: 5 map-underscore-to-camel-case: true Mapperæ¨¡æ¿å¢å¼ºï¼šSQLè¯­å¥ï¼šæŸ¥è¯¢å­—æ®µã€ç­›é€‰æ¡ä»¶ - SQLç‰‡æ®µåˆ†ç¦»\n1@TableName(\u0026#34;user\u0026#34;) // ç±»-ç»‘å®šæ•°æ®åº“-è¡¨ 2Class User{...} 3 4// BaseMapper å†…ç½®å¤§é‡åŸºæœ¬çš„SQLæ¨¡æ¿ 5@Mapper 6public interface UserMapper extends BaseMapper\u0026lt;User\u0026gt; {} 7 8// example 9QueryWrapper wrapper = new QueryWrapper();\t// æ¡ä»¶åŒ…è£…å™¨ 10wrapper.select(\u0026#34;name, age, email\u0026#34;);\t// æ˜¾ç¤ºæŒ‡å®šæŸ¥è¯¢å­—æ®µ 11wrapper.ge(\u0026#34;age\u0026#34;, 23);\t// æ¡ä»¶ greater than 12List list = userMapper.selectList(wrapper); æ··åˆè‡ªå®šä¹‰SQL.xml é…ç½®å’Œæ¨¡æ¿\n1@Mapper 2public interface UserMapper extends BaseMapper\u0026lt;User\u0026gt; { 3 Type methodID(...params); 4 int UPDATEID(@Param(Constants.WRAPPER) LambdaQueryWrapper\u0026lt;User\u0026gt; wrapper, ...params); 5} 6 7// Associated XML file 8\u0026lt;? id=\u0026#34;methodID\u0026#34; resultType=\u0026#34;Type\u0026#34;\u0026gt; 9 SQL Segment 10\u0026lt;/?\u0026gt; 11 12// use Wrapper to build condition 13\u0026lt;update id=\u0026#34;UPDATEID\u0026#34;\u0026gt; 14 UPDATE `table_name` 15 SET ... 16\t${ew.customSqlSegment} 17\u0026lt;/update\u0026gt; Serviceæ¨¡æ¿å¢å¼º\n1// interface extends template abstract method 2@Service 3public interface IUserService extends IService\u0026lt;User\u0026gt; {} 4 5// class extends template implement method 6@Service 7public class UserPOServiceImpl extends ServiceImpl\u0026lt;UserPOMapper, UserPO\u0026gt; implements IUserPOService { 8 @Override 9 public List\u0026lt;UserPO\u0026gt; queryUserByBalance(int minBalance, int maxBalance) { 10 // lambdaQuery is method in ServiceImpl super class IService 11 return lambdaQuery() 12 .between(UserPO::getBalance, (double)minBalance, (double)maxBalance) 13 .list(); 14 } 15} knife4j æ¥å£è¯´æ˜æ–‡æ¡£\n1@Api() 2@RestController 3@RequestMapping() 4class Controller { 5 6 @ApiOperation() 7 @RequestMapping() 8 public void method() {} 9 10} 11 12@ApiModel() 13class Bean{ 14 @ApiModelProperty() 15 private Type Field; 16} æ‰¹é‡æ“ä½œ\n1MySQL connection URL: add parameter rewriteBatchedStatements=true 2 3userSerivice.saveBatch() 4 5// MySQLå¼€å¯æ‰¹é‡æ“ä½œï¼ŒMybatisPluså†æ‰§è¡Œbatchçº§çš„SQL â­ é™æ€çš„SQLï¼Œé¿å…Serviceä¸­ç›¸äº’ä¾èµ–\n1Db.lambdaQuery(AddressPO.class) 2 .eq(AddressPO::getUserId, user.getId()) 3 .list(); 4 5// =\u0026gt; æœ€ç»ˆè°ƒç”¨AddressPOMapperæ‰§è¡ŒåŸºæœ¬SQLæ“ä½œ 6 7// AddressPO @TableName(\u0026#34;address\u0026#34;) =\u0026gt; å…³è”æ•°æ®åº“è¡¨ï¼Œä¸‹åˆ’çº¿è½¬é©¼å³° 8 9// iService å’Œ ServiceImpl å°è£…äº†åŸºæœ¬çš„SQLæ“ä½œ æšä¸¾\n1// application.yaml 2mybatis-plus: 3 configuration: 4 default-enum-type-handler: com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler 1// å®šä¹‰çŠ¶æ€ 2@Getter 3public enum UserStatus { 4 NORMAL(1, \u0026#34;æ­£å¸¸\u0026#34;), 5 FREEZE(2, \u0026#34;å†»ç»“\u0026#34;); 6 7 @EnumValue\t// ä¸æ•°æ®åº“çš„è½¬æ¢ 8 private final int value; 9 @JsonValue // å“åº”ç»“æœçš„è½¬æ¢ 10 private final String desc; 11 12 UserStatus(int value, String desc) { 13 this.value = value; 14 this.desc = desc; 15 } 16} 17 18// e.g. Freeze user 19lambdaUpdate() 20 .eq(UserPO::getId, id) 21 .set(UserPO::getStatus, UserStatus.FREEZE) 22 .update(); â­ åˆ†é¡µ\n1// æ³¨å…¥åˆ†é¡µé…ç½®ï¼Œæ·»åŠ åˆ†é¡µæ‹¦æˆªå™¨ 2@Configuration 3public class MyBatisConfig { 4 5 @Bean 6 public MybatisPlusInterceptor mybatisPlusInterceptor() { 7 MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor(); 8 9 PaginationInnerInterceptor paginationInnerInterceptor = new PaginationInnerInterceptor(); 10 paginationInnerInterceptor.setDbType(DbType.MYSQL); 11 paginationInnerInterceptor.setMaxLimit(1000L); 12 13 mybatisPlusInterceptor.addInnerInterceptor(paginationInnerInterceptor); 14 15 return mybatisPlusInterceptor; 16 } 17 18} 1// å‡†å¤‡Pageä¿¡æ¯æ¡ä»¶ 2Page\u0026lt;AddressPO\u0026gt; page = Page.of(pageNum, pageSize); 3page.addOrder(OrderItem.desc(\u0026#34;id\u0026#34;)); // æ ¹æ®xxxé™åº/å‡åº 4// æ‰§è¡ŒæŸ¥è¯¢ 5Page\u0026lt;AddressPO\u0026gt; addressPOPage = lambdaQuery().page(page); 6 7return addressPOPage.getRecords(); å°è£…PageQueryå’ŒPageDTO\n1@Data 2class PageQuery { 3 // properity: 4 pageSize, pageNum, sortBy, isAsc ... 5 // method: 6 public \u0026lt;PO\u0026gt; Page\u0026lt;PO\u0026gt; toMpPage(){ 7 // 1. åˆ†é¡µæ¡ä»¶ 8 Page\u0026lt;PO\u0026gt; page = Page.of(pageNum, pageSize); 9 // 2. æ’åºæ¡ä»¶ 10 if (StrUtil.isNotBlank(sortBy)) { 11 page.addOrder(new OrderItem().setColumn(sortBy).setAsc(isAsc)); 12 } 13 return page; 14 } 15 16 ... // å¤šæ€æ€§è´¨ 17 public \u0026lt;PO\u0026gt; Page\u0026lt;PO\u0026gt; toMpPage(String sortBy, Boolean isAsc) { 18 return toMpPage(new OrderItem().setColumn(sortBy).setAsc(isAsc)); 19 } 20 ... // é»˜è®¤æ’åº... 21} 22 23@Data 24class UserQuery extends PageQuery { 25 // properity: æŸ¥è¯¢æ¡ä»¶ 26 name, id, xxx 27} 28 29// use example 30æ„å»ºUserQuery, åˆå§‹åŒ–å¥½æŸ¥è¯¢å‚æ•° =\u0026gt; è°ƒç”¨UserService.method(userQuery) 31method(userQuery) =\u0026gt; userQuery.toMpPage() =\u0026gt; Page\u0026lt;PO\u0026gt; p =\u0026gt; lambdaQuery.condition().page(p) =\u0026gt; getRecords() 32åˆ†æ­¥æ„å»ºï¼šé¡µé¢é…ç½®(å¤ç”¨) + æŸ¥è¯¢æ¡ä»¶(ç»§æ‰¿é¢å¤–åŠ ) 1@Data 2public class PageDTO\u0026lt;T\u0026gt; { 3 4 private Long total; 5 6 private Long pages; 7 8 private List\u0026lt;T\u0026gt; list; 9 10 // æ³›å‹ä¸æŒ‡å®šå‚æ•°ç±»å‹ï¼Œ PO=\u0026gt;VOè½¬æ¢å™¨ä¼ å…¥ 11\tpublic static \u0026lt;PO, VO\u0026gt; PageDTO\u0026lt;VO\u0026gt; of (Page\u0026lt;PO\u0026gt; p, Class\u0026lt;VO\u0026gt; clazz, Function\u0026lt;PO, VO\u0026gt; converter) { 12 PageDTO\u0026lt;VO\u0026gt; voPageDTO = new PageDTO\u0026lt;\u0026gt;(); 13 // åŸºæœ¬ä¿¡æ¯ 14 voPageDTO.setTotal(p.getTotal()); 15 voPageDTO.setPages(p.getPages()); 16 17 List\u0026lt;PO\u0026gt; poList = p.getRecords(); 18 if (CollectionUtils.isEmpty(poList)) { 19 voPageDTO.setList(Collections.emptyList()); 20 return voPageDTO; 21 } 22 23 // æ‹·è´æ•°æ® 24 List\u0026lt;VO\u0026gt; list = poList.stream().map(converter).collect(Collectors.toList()); 25 voPageDTO.setList(list); 26 27 return voPageDTO; 28 } Spring Cloud çˆ¶ pom\n1\u0026lt;properties\u0026gt; 2 \u0026lt;maven.compiler.source\u0026gt;11\u0026lt;/maven.compiler.source\u0026gt; 3 \u0026lt;maven.compiler.target\u0026gt;11\u0026lt;/maven.compiler.target\u0026gt; 4 \u0026lt;project.build.sourceEncoding\u0026gt;UTF-8\u0026lt;/project.build.sourceEncoding\u0026gt; 5 \u0026lt;project.reporting.outputEncoding\u0026gt;UTF-8\u0026lt;/project.reporting.outputEncoding\u0026gt; 6 \u0026lt;org.projectlombok.version\u0026gt;1.18.20\u0026lt;/org.projectlombok.version\u0026gt; 7 \u0026lt;spring-cloud.version\u0026gt;2021.0.3\u0026lt;/spring-cloud.version\u0026gt; 8 \u0026lt;spring-cloud-alibaba.version\u0026gt;2021.0.4.0\u0026lt;/spring-cloud-alibaba.version\u0026gt; 9 \u0026lt;mybatis-plus.version\u0026gt;3.4.3\u0026lt;/mybatis-plus.version\u0026gt; 10 \u0026lt;hutool.version\u0026gt;5.8.25\u0026lt;/hutool.version\u0026gt; 11 \u0026lt;mysql.version\u0026gt;8.0.23\u0026lt;/mysql.version\u0026gt; 12 \u0026lt;knife4j.version\u0026gt;4.3.0\u0026lt;/knife4j.version\u0026gt; 13\u0026lt;/properties\u0026gt; 14 15\u0026lt;!-- å¯¹ä¾èµ–åŒ…è¿›è¡Œç®¡ç† --\u0026gt; 16\u0026lt;dependencyManagement\u0026gt; 17 \u0026lt;dependencies\u0026gt; 18 \u0026lt;dependency\u0026gt; 19 ... 20 \u0026lt;/dependency\u0026gt; 21 \u0026lt;/dependencies\u0026gt; 22\u0026lt;/dependencyManagement\u0026gt; å­é¡¹ç›® pom\n1\u0026lt;parent\u0026gt; 2 \u0026lt;artifactId\u0026gt;super artifactId\u0026lt;/artifactId\u0026gt; 3 \u0026lt;groupId\u0026gt;com.yoo\u0026lt;/groupId\u0026gt; 4 \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; 5\u0026lt;/parent\u0026gt; ç»Ÿä¸€dependency version\nå‚ç›´åˆ’åˆ†é¡¹ç›®\nUser-Service nacosæ‰˜ç®¡å¾®æœåŠ¡IPåœ°å€\n1java: 2\tcom: 3 yoo: 4 controller: SpringMVC 5 service: IService + ServiceImpl 6 mapper: BaseMapper 7 client: @Openfeign, remote call 8 domain: 9 po: properity object reflex database table 10 vo: value object, only show required properity 11 12---------------------------------- 13 14resource: 15\tapplication.yaml: 16\tserver: 17 port: 18 19 spring: 20 application: 21 name: user-service # service-name 22 profiles: 23 active: dev 24 datasource: 25 url: 26 driver-class-name: 27 username: 28 password: 29\t# â­ cloud service ip address 30 cloud: 31 nacos: 32 server-addr: 127.0.0.1 33 34 mybatis-plus: 35 configuration: 36\t# æšä¸¾å­—æ®µç±»å‹æ˜ å°„åˆ°æ•°æ®åº“è¡¨æŒ‡å®šç±»å‹ï¼Œ ä¸‹åˆ’çº¿è½¬é©¼å³° 37 default-enum-type-handler: com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler 38 global-config: 39 db-config: 40 update-strategy: not_null 41 id-type: auto 42 43 knife4j: 44 enable: true 45 openapi: 46 title: ç”¨æˆ·æœåŠ¡æ¥å£æ–‡æ¡£ 47 description: \u0026#34;ä¿¡æ¯\u0026#34; 48 email: 1410124534@qq.com 49 concat: longwei 50 group: 51 default: 52 group-name: default 53 api-rule: package 54 api-rule-resources: 55 - com.yoo.controller OpenFeign è¿œç¨‹è°ƒç”¨å¾®æœåŠ¡ Step 1. pomæ·»åŠ å¯¹åº”ä¾èµ–\n1\u0026lt;!-- openfeign --\u0026gt; 2\u0026lt;dependency\u0026gt; 3 \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; 4 \u0026lt;artifactId\u0026gt;spring-cloud-starter-openfeign\u0026lt;/artifactId\u0026gt; 5\u0026lt;/dependency\u0026gt; 6 7\u0026lt;!-- loadbalancer --\u0026gt; 8\u0026lt;dependency\u0026gt; 9 \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; 10 \u0026lt;artifactId\u0026gt;spring-cloud-starter-loadbalancer\u0026lt;/artifactId\u0026gt; 11\u0026lt;/dependency\u0026gt; Step 2. å¼€å¯OpenfeignåŠŸèƒ½\n1@EnableFeignClients 2... 3public class xxxApplicaiotn { 4 ... 5} Step 3. ç¼–å†™Openfeignè°ƒç”¨æ¥å£\n1@FeignClient(value = \u0026#34;order-service\u0026#34;) 2public interface OrderClient { 3 4 @GetMapping(\u0026#34;/order/{id}\u0026#34;) 5 List\u0026lt;OrderVO\u0026gt; getOrderByUserId(@PathVariable(\u0026#34;id\u0026#34;) Long userId); 6 7} 8 9// @Interface : @XXXMapping(\u0026#34;/{param}\u0026#34;) \u0026lt;=== 10// || 11// Method : (@PathVariable(\u0026#34;param\u0026#34;) Type name) Gateway setup å‰ç«¯ç»Ÿä¸€è¯·æ±‚ =\u0026gt;8080ç½‘å…³ =\u0026gt; åˆ†å‘è°ƒåº¦ç»™å¾®æœåŠ¡ ç±»ä¼¼nginx\ndependencies\n1\u0026lt;!--ç½‘å…³--\u0026gt; 2\u0026lt;dependency\u0026gt; 3 \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; 4 \u0026lt;artifactId\u0026gt;spring-cloud-starter-gateway\u0026lt;/artifactId\u0026gt; 5\u0026lt;/dependency\u0026gt; 6\u0026lt;!--nacos discovery--\u0026gt; 7\u0026lt;dependency\u0026gt; 8 \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; 9 \u0026lt;artifactId\u0026gt;spring-cloud-starter-alibaba-nacos-discovery\u0026lt;/artifactId\u0026gt; 10\u0026lt;/dependency\u0026gt; 11\u0026lt;!--è´Ÿè½½å‡è¡¡--\u0026gt; 12\u0026lt;dependency\u0026gt; 13 \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; 14 \u0026lt;artifactId\u0026gt;spring-cloud-starter-loadbalancer\u0026lt;/artifactId\u0026gt; 15\u0026lt;/dependency\u0026gt; â­â­â­application.yaml é…ç½®è½¬å‘æ¥å£æ˜ å°„\n1server: 2 port: 8080 3 4spring: 5 application: 6 name: gateway-service 7 cloud: 8 nacos: 9 server-addr: 127.0.0.1 10 gateway: 11 routes: ### è·¯ç”± 12 - id: item 13 uri: lb://user-service 14 predicates: 15 - Path=/user/** 16 17 - id: order 18 uri: lb://order-service 19 predicates: 20 - Path=/order/** StarterClass\n1@SpringBootApplication 2public class GatewayApplication { 3 public static void main(String[] args) { 4 SpringApplication.run(GatewayApplication.class, args); 5 } 6} ç½‘å…³ç™»å½•ç»Ÿä¸€æ‹¦æˆª å¥½æ¯”äºå®ˆå«ï¼Œç»Ÿä¸€æ ¡éªŒç™»å½•Tokenï¼Œè¿›è¡Œæ”¾è¡Œæˆ–è€…æ‹¦æˆª\npom ä¾èµ– æ”¯æŒyamlè¯»å–é…ç½®\n1\u0026lt;dependency\u0026gt; 2 \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; 3 \u0026lt;artifactId\u0026gt;spring-boot-configuration-processor\u0026lt;/artifactId\u0026gt; 4 \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; 5\u0026lt;/dependency\u0026gt; application.yaml\n1hm: 2 auth: 3 excludePaths: # æ— éœ€ç™»å½•æ ¡éªŒçš„è·¯å¾„ 4 - /user/login 5 - /item/search 6 - /test/** å±æ€§ç±»\n1@Data 2@Component 3@ConfigurationProperties(prefix = \u0026#34;hm.auth\u0026#34;) 4public class AuthProperties { 5 private List\u0026lt;String\u0026gt; includePaths; 6 private List\u0026lt;String\u0026gt; excludePaths; 7} GlobalFilter å…¨å±€æ‹¦æˆª\nå…ˆæ ¹æ®é…ç½®æ–‡ä»¶ï¼Œå†³å®šæ˜¯å¦æ‹¦æˆªï¼Œæ‹¦=\u0026gt;æ£€æŸ¥Token=\u0026gt;å­˜å…¥ä¿¡æ¯åœ¨Header =\u0026gt; å¾®æœåŠ¡(ä»Headerä¸­æ‹¿å–ä¿¡æ¯)\n1@Component 2@RequiredArgsConstructor 3public class AuthGlobalFilter implements GlobalFilter, Ordered { 4 // å·²åŠ å…¥Springå®¹å™¨ 5 private final AuthProperties authProperties; 6 // æœªåŠ å…¥ï¼Œæ‰‹åŠ¨new 7 private final AntPathMatcher antPathMatcher = new AntPathMatcher(); 8 9 @Override 10 public Mono\u0026lt;Void\u0026gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { 11 // è·å–requestå¯¹è±¡ 12 ServerHttpRequest request = exchange.getRequest(); 13 // åˆ¤æ–­è·¯å¾„æ˜¯å¦éœ€è¦æ‹¦æˆª 14 if(isExclude(request.getPath().toString())) { 15 // æ”¾è¡Œ 16 return chain.filter(exchange); 17 } 18 // è·å–Headerä¸­çš„Token 19 String token = null; 20 List\u0026lt;String\u0026gt; headers = request.getHeaders().get(\u0026#34;authorization\u0026#34;); 21 if(!CollUtil.isEmpty(headers)) { 22 token = headers.get(0); 23 } 24 Long userId = null; 25 // ç®€å•æ¨¡æ‹ŸJwtTokenæ ¡éªŒ 26 if(token != null \u0026amp;\u0026amp; token.equals(\u0026#34;hello\u0026#34;)) { 27 // æ ¡éªŒæˆåŠŸ 28 userId = 1L; 29 } else { 30 // æ ¡éªŒå¤±è´¥ =\u0026gt; ç›´æ¥è¿”å›UNAUTHORIZEDçŠ¶æ€ç  31 ServerHttpResponse response = exchange.getResponse(); 32 response.setStatusCode(HttpStatus.UNAUTHORIZED); 33 return response.setComplete(); 34 } 35 36 String userInfo = userId.toString(); 37 38 // å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨è½¬å‘è¯·æ±‚å¤´ä¸­ 39 ServerWebExchange ex = exchange.mutate() 40 .request(builder -\u0026gt; { 41 builder.header(\u0026#34;user-info\u0026#34;, userInfo); 42 }) 43 .build(); 44 45 return chain.filter(ex); 46 } 47 48 private boolean isExclude(String path) { 49 for (String pathPattern : authProperties.getExcludePaths()) { 50 if (antPathMatcher.match(pathPattern, path)) { 51 return true; 52 } 53 } 54 return false; 55 } 56 57 @Override 58 public int getOrder() { 59 return 0; 60 } 61} Service Interceptor ThreadLocalï¼Œçº¿ç¨‹è‡ªå·±çš„ç‹¬äº«ç©ºé—´ï¼Œç”¨æ¥å­˜å‚¨è¯·æ±‚ä¸­æºå¸¦çš„ä¿¡æ¯\n1public class UserContext { 2 3 private static final ThreadLocal\u0026lt;Long\u0026gt; tl = new ThreadLocal\u0026lt;\u0026gt;(); 4 5 public static void setUserId(Long userId) { 6 tl.set(userId); 7 } 8 9 public static Long getUserId() { 10 return tl.get(); 11 } 12 13 public static void removeUserId(){ 14 tl.remove(); 15 } 16 17} æ‰§è¡ŒæœåŠ¡å‰ï¼Œå°†request headerä¸­æºå¸¦çš„ä¿¡æ¯å–å‡ºæ¥\n1public class UserInfoInterceptor implements HandlerInterceptor { 2 3 @Override 4 public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { 5 String userId = request.getHeader(\u0026#34;user-info\u0026#34;); 6 if (StrUtil.isNotBlank(userId)) { 7 UserContext.setUserId(Long.parseLong(userId)); 8 } 9 return true; 10 } 11 12 @Override 13 public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { 14 UserContext.removeUserId(); 15 } 16} æŠ½å–å…¬å…±éƒ¨åˆ† common-service 1com.yoo.common.xxx å…¶ä»–moduleåªè¦åœ¨pomå†…å¼•ç”¨å°±è¡Œ\nå…¬å…±éƒ¨åˆ†å¦‚ä½•åŒºåˆ«ä¸åŒçš„æœåŠ¡ - æœ‰äº›å­æ¨¡å—éœ€è¦ä½†å¦ä¸€äº›å­æ¨¡å—ä¸éœ€è¦çš„Classï¼ˆè¿™ä¸ªç±»ä¼šè¢«Springæ‰˜ç®¡ï¼Œä½†ä¸æƒ³æ³¨å…¥Springå®¹å™¨ä¸­ï¼‰\n1@ConditionalOnClass(DispatherServlet.class) åœ¨å…¶ä»–å¾®æœåŠ¡åŠ ä¸Šï¼Œæ˜¾ç¤ºæŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®\nspring.factories\n1org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.yoo.common.config.MvcConfig RabbitMQ 1publisher =\u0026gt; exchanger =\u0026gt; queue =\u0026gt; consumer exchanger:\nfanout exchanger: å¹¿æ’­ direct exchangerï¼šæ ¹æ®keyå‘é€ç»™å¯¹åº”queue topic exchanger: æ ¹æ®keyè¿›è¡ŒåŒ¹é…ä¸€ç»„ç¬¦åˆçš„queue æ¶ˆæ¯è®¢é˜…\n1@RabbitListener(queues = \u0026#34;???\u0026#34;) 2public T method(...) { 3 // 4} æ¶ˆæ¯å‘å¸ƒ\n1# ç›´æ¥å‘é€ç»™Queue 2rabbitTemplate.convertAndSend(queueName, message) 3 4# å‘é€ç»™äº¤æ¢æœº 5rabbitTemplate.convertAndSend(ExchangeName, \u0026#34;RoutingKey\u0026#34;, MessageObject) æ¶ˆæ¯æ ¼å¼è½¬æ¢\nObject =\u0026gt; Binary å°†å‘é€çš„å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²ï¼Ÿ\n1@Bean 2... 3return new Jackson2JSONMessageConverter() é˜Ÿåˆ—äº¤æ¢æœºå’Œç»‘å®š\n1@Bean 2public Queue orderQueue() { 3 return new Queue(\u0026#34;orderQueue\u0026#34;, true); 4} 5 6// Spring å®¹å™¨ä¼šç¡®ä¿åŒä¸€ä¸ª @Bean æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›çš„å¯¹è±¡ä¼šè¢«ç¼“å­˜å¹¶é‡å¤ä½¿ç”¨ 7@Bean 8public DirectExchange orderExchange() { 9 return new DirectExchange(\u0026#34;orderExchange\u0026#34;, true, false); 10} 11 12@Bean 13public Binding binding() { 14 return BindingBuilder.bind(orderQueue()).to(orderExchange()).with(\u0026#34;orderRoutingKey\u0026#34;); 15} å¯é ä¼ è¾“\n1# å‘é€ç¡®è®¤ 2publisher-confirm-type: none|correlated|simple 3 4none: æ— ç¡®è®¤æœºåˆ¶ï¼Œæ€§èƒ½æœ€å¥½ï¼Œä¸å¯é  5correlated: å¼‚æ­¥å…³è”ç¡®è®¤,ä¸é˜»å¡çº¿ç¨‹,é«˜å¯é æ€§,æ€§èƒ½ä¸­ã€å¼‚æ­¥å›è°ƒåœºæ™¯ 6simple: åŒæ­¥é˜»å¡ç¡®è®¤,é˜»å¡çº¿ç¨‹,æ€§èƒ½åº•ï¼Œå¯é ã€‚ 7 8# æ¥æ”¶ç¡®è®¤ 9ackknowledge-mode: none|manual|auto 10none: æ— ç¡®è®¤æœºåˆ¶ 11manual: æ‰‹å·¥ack 12auto: è‡ªåŠ¨ackï¼Œæ ¹æ®æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ï¼Œå†³å®šé‡å‘è¿˜æ˜¯reject 13 14 15# é‡è¿é…ç½® 16retry: 17\tenabled: true # å¯ç”¨é‡è¯•æœºåˆ¶ 18\tinitial-interval: 1000ms # ç¬¬ä¸€æ¬¡å¤±è´¥ç­‰å¾…çš„æ—¶é•¿ 19\tmultiplier: 1 # æ¯æ¬¡å¤±è´¥ç­‰å¾…æ—¶é—´æˆxå€å¢é•¿ 20\tmax-attempts: 3 # æœ€å¤§é‡è¯•æ¬¡æ•° 21\tstateless: false # 22\t23# å¦‚æœæ¥å£å¹‚ç­‰(è°ƒç”¨å¤šæ¬¡éƒ½ä¸ä¼šé‡å¤æ‰£æ¬¾) =\u0026gt; stateless:true æ¯æ¬¡é‡è¯•éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¿ç•™çŠ¶æ€ â­æ€§èƒ½é«˜ 24# éå¹‚ç­‰æ“ä½œï¼ˆå¤šæ¬¡æ‰§è¡Œå¯èƒ½æœ‰å‰¯ä½œç”¨ï¼‰ 25stateless:false # å¸¦çŠ¶æ€ æ­»ä¿¡äº¤æ¢æœº\nå®šä¹‰äº¤æ¢æœºå’Œé˜Ÿåˆ—\n1@Bean 2public DirectExchange createDLExchanger() { 3 return ExchangeBuilder.directExchange(\u0026#34;dl.direct\u0026#34;).build(); 4} 5 6@Bean 7public Queue createDLQueue() { 8 // é˜Ÿåˆ—ä¿¡æ¯æ˜¯å¦æŒä¹…åŒ–åˆ°ç£ç›˜? durable(æŒä¹…åŒ–?) 9 return QueueBuilder.nonDurable(\u0026#34;dl.queue\u0026#34;).build(); 10} 11 12@Bean 13public Binding toBindingDL() { 14 return BindingBuilder.bind(createDLQueue()).to(createDLExchanger()).with(\u0026#34;dlRoutingKey\u0026#34;); 15} 16 17// ----------------------- 18 19@Bean 20public FanoutExchange createTTLExchanger() { 21 return ExchangeBuilder.fanoutExchange(\u0026#34;ttl.fanout\u0026#34;).build(); 22} 23 24@Bean 25public Queue createTTLQueue() { 26 // é˜Ÿåˆ—ä¿¡æ¯æ˜¯å¦æŒä¹…åŒ–åˆ°ç£ç›˜? durable(æŒä¹…åŒ–?) 27 return QueueBuilder.nonDurable(\u0026#34;ttl.queue\u0026#34;).deadLetterExchange(\u0026#34;dl.direct\u0026#34;).deadLetterRoutingKey(\u0026#34;dlRoutingKey\u0026#34;).build(); 28} 29 30@Bean 31public Binding toBinding() { 32 return BindingBuilder.bind(createTTLQueue()).to(createTTLExchanger()); 33} æ­¥éª¤1ï¼šå‘é€ä¿¡æ¯å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´\n1// 1:æœªä»˜æ¬¾; 2.å·²ä»˜æ¬¾ ... 2// æ¨¡æ‹Ÿç”¨æˆ·ä¸‹å• 3redisTemplate.opsForValue().set(\u0026#34;order:userId:status\u0026#34;, \u0026#34;1\u0026#34;); 4// ... æ‰£è´§ç‰©åº“å­˜ -1 5 6MessageProperties properties = new MessageProperties(); 7properties.setExpiration(\u0026#34;20000\u0026#34;); // 20ç§’è¿‡æœŸï¼Œè¿‡æœŸåè¿›å…¥æ­»ä¿¡é˜Ÿåˆ— 8 9Map\u0026lt;String, String\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); 10map.put(\u0026#34;code\u0026#34;, \u0026#34;200\u0026#34;); 11map.put(\u0026#34;msg\u0026#34;, \u0026#34;Hi, RabbitMQ. This is a dead letter.\u0026#34;); 12 13ObjectMapper mapper = new ObjectMapper(); 14 15String msgContent = mapper.writeValueAsString(map); 16Message message = new Message(msgContent.getBytes(), properties); 17rabbitTemplate.convertAndSend(\u0026#34;ttl.fanout\u0026#34;, \u0026#34;\u0026#34;, message); æ­¥éª¤2ï¼šç”¨æˆ·è°ƒç”¨æ¥å£è¿›è¡Œä»˜æ¬¾\n1// æ•°æ®åº“ 2// .... 3 4// æ¨¡æ‹Ÿä»˜æ¬¾æˆåŠŸ 5redisTemplate.opsForValue().set(\u0026#34;order:userId:status\u0026#34;, \u0026#34;2\u0026#34;); æ­¥éª¤3ï¼šæ­»ä¿¡é˜Ÿåˆ— å¤„ç†é€»è¾‘\n1@RabbitListener(queues = \u0026#34;dl.queue\u0026#34;) 2public void deadLetterQueue(Message message) throws IOException { 3 ObjectMapper mapper = new ObjectMapper(); 4 Map\u0026lt;String, String\u0026gt; msg = mapper.readValue(message.getBody(), Map.class); 5 6 System.out.println(\u0026#34;receive Msg ... @@@\u0026#34;); 7 System.out.println(msg.get(\u0026#34;code\u0026#34;)); 8 System.out.println(msg.get(\u0026#34;msg\u0026#34;)); 9 10 String status = redisTemplate.opsForValue().get(\u0026#34;order:userId:status\u0026#34;); 11 if (status.equals(\u0026#34;1\u0026#34;)) { 12 // ... è¿˜åŸè´§ç‰©åº“å­˜ +1 13 return; 14 }else if (status.equals(\u0026#34;2\u0026#34;)){ 15 // è®¢å•æ”¯ä»˜å®Œæˆï¼Œå®ç°æ”¶å°¾å·¥ä½œ 16 System.out.println(\u0026#34;è®¢å•å·²æ”¯ä»˜ï¼Œç”Ÿæˆåç»­...\u0026#34;); 17 } 18} è§£è€¦å„ä¸ªéƒ¨åˆ†ã€‚\nè‹ç©¹å¤–å– AOPä½¿ç”¨-è‡ªåŠ¨è¡¥å…¨å‚æ•°å…±åŒä¿¡æ¯ 1// è‡ªå®šä¹‰æ³¨è§£ 2@Target(ElementType.METHOD) 3@Retention(RetentionPolicy.RUNTIME) 4public @interface AutoFill { 5 OperationType value(); 6} 1@Aspect // !!! äº¤ç»™Springæ‰˜ç®¡ 2@Component 3public class AutoFillAspect { 4 5 // ä»»ä½• returnType package.?.class.method(params) \u0026amp;\u0026amp; with annotation 6 @Pointcut(\u0026#34;execution(* com.hmwm.service.*.*(..)) \u0026amp;\u0026amp; @annotation(com.hmwm.common.AutoFill)\u0026#34;) 7 public void autoFillPointCut(){} 8 9 @Before(\u0026#34;autoFillPointCut()\u0026#34;) 10 public void autoFill(JoinPoint joinPoint) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException { 11 System.err.println(\u0026#34;Start fill common field.\u0026#34;); 12 13 // get method annotation value 14 MethodSignature signature = (MethodSignature) joinPoint.getSignature(); 15 AutoFill annotation = signature.getMethod().getAnnotation(AutoFill.class); 16 OperationType operationType = annotation.value(); 17 18 // æ‹¦æˆªçš„methodçš„å‚æ•°åˆ—è¡¨ 19 Object[] args = joinPoint.getArgs(); 20 if (args==null \u0026amp;\u0026amp; args.length==0) { 21 System.out.println(\u0026#34;current method not params\u0026#34;); 22 return; 23 } 24 // ç¬¬ä¸€ä¸ªâ­å‚æ•°â­ éœ€è¦å¡«å……çš„å¯¹è±¡. æå‰äº¤æµæŒ‡å®š:è¿™é‡Œä¸ºUser Obj 25 Object arg = args[0]; 26 27 LocalDateTime now = LocalDateTime.now(); 28 // Long currentId = BaseContext.getCurrentId(); 29 30 // ç»™è¿™ä¸ªargå¡«å……å€¼ 31 if (operationType == OperationType.INSERT) { 32 // getDeclaredMethod(method_name, params_type) 33 Method setCreateTime = arg.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME.getMethodName(), Date.class); 34 Method setUpdateTime = arg.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME.getMethodName(), Date.class); 35 36 // method-obj: invoke(object, params) æ–¹æ³•(å¯¹è±¡, å‚æ•°) 37 setCreateTime.invoke(arg, Date.from(now.atZone(ZoneId.systemDefault()).toInstant())); 38 setUpdateTime.invoke(arg, Date.from(now.atZone(ZoneId.systemDefault()).toInstant())); 39 } 40 41 } 1@AutoFill(OperationType.INSERT) 2public String addUser(User user) { 3 return user.toString(); 4} æšä¸¾ç±»\n1// æšä¸¾ç±»åœ¨ Java ä¸­æ˜¯é€šè¿‡ enum å…³é”®å­—å®šä¹‰çš„ï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç±»ã€‚æ¯ä¸ªæšä¸¾å¸¸é‡éƒ½æ˜¯è¯¥æšä¸¾ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚ 2public enum AutoFillConstant { 3 SET_CREATE_TIME(\u0026#34;setCreateTime\u0026#34;), 4 SET_UPDATE_TIME(\u0026#34;setUpdateTime\u0026#34;); 5 6 private String methodName; // å­˜å‚¨æ–¹æ³•åçš„å­—æ®µ 7 8 // æ„é€ å‡½æ•° 9 AutoFillConstant(String methodName) { 10 this.methodName = methodName; 11 System.out.println(\u0026#34;AutoFillConstant: \u0026#34; + methodName); 12 } 13 14 // è·å–æ–¹æ³•å 15 public String getMethodName() { 16 return methodName; 17 } 18} å®šæ—¶ä»»åŠ¡ åˆ©ç”¨@Scheduledæ³¨è§£\n1@Component 2public class ScheduledTask { 3 // ç§’ åˆ† æ—¶ å¤© å‘¨ æœˆ å¹´ å¹´/æœˆ/æ—¥ æ—¶/åˆ†/ç§’ 4 @Scheduled(cron = \u0026#34;0 * * * * ? \u0026#34;) // è¿™é‡Œ xxxx/xx/xx xx:xx:x0 æ‰§è¡Œ 5 public void processTimeOutOrder() { 6 System.err.println(\u0026#34;process Timeout task ...\u0026#34;); 7 } 8 9} ThreadLocal-çº¿ç¨‹ä¸“äº«èµ„æº å¯ä»¥è¯·æ±‚æ¥çš„æ—¶å€™å­˜å‚¨ä¸€äº› ç¯å¢ƒå˜é‡ ThreadLocal\u0026lt;Object\u0026gt;\n1public class BaseContext { 2 public static ThreadLocal\u0026lt;Long\u0026gt; threadLocal = new ThreadLocal\u0026lt;\u0026gt;(); 3 4 public static void setCurrentId(Long id) { 5 threadLocal.set(id); 6 } 7 8 public static Long getCurrentId() { 9 return threadLocal.get(); 10 } 11 12 public static void removeCurrentId() { 13 threadLocal.remove(); 14 } 15} Websocket 1@Component 2@ServerEndpoint(\u0026#34;/websocket\u0026#34;) 3public class MyWebSocketEndpoint { 4 5 // ä¼šè¯å¯¹è±¡ server:client == 1:n 6 private static Map\u0026lt;String, Session\u0026gt; sessionMap = new HashMap\u0026lt;\u0026gt;(); 7 8 9 @OnOpen 10 public void onOpen(Session session) { 11 System.out.println(\u0026#34;onOpen: \u0026#34; + session.getId()); 12 sessionMap.put(session.getId(), session); 13 sendMsg(\u0026#34;Hi, can I help you?\u0026#34;, session.getId()); 14 } 15 16 @OnMessage 17 public void onMessage(String message, Session session) { 18 System.out.println(\u0026#34;receive Message: \u0026#34; + message); 19 sendMsg(\u0026#34;Yse! I am thinking ... this question!\u0026#34;, session.getId()); 20 } 21 22 @OnClose 23 public void OnClose(Session session) { 24 sendMsg(\u0026#34;Bye!\u0026#34;, session.getId()); 25 System.out.println(\u0026#34;OnClose: \u0026#34; + session.getId()); 26 sessionMap.remove(session.getId()); 27 } 28 29 public void sendMsg(String msg, String sid) { 30 try { 31 sessionMap.get(sid).getBasicRemote().sendText(msg); // å‘sessionå¯¹è±¡sendTest 32 } catch (IOException e) { 33 e.printStackTrace(); 34 } 35 } 36 37} æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ å¾ˆç®€å•ï¼Œåˆ©ç”¨Responseè¿›è¡Œã€‚ éœ€è¦è®¾ç½®responseå†…å®¹æ ¼å¼å’Œresponse-header\n1ClassPathResource resource = new ClassPathResource(\u0026#34;static/file_name.zip\u0026#34;); 2if (!resource.exists()) { 3 System.err.println(\u0026#34;file not exists!\u0026#34;); 4 return ResponseEntity.notFound().build(); 5} 6 7HttpHeaders headers = new HttpHeaders(); 8headers.add(HttpHeaders.CONTENT_DISPOSITION, \u0026#34;attachment; filename=\\\u0026#34;file_name.zip\\\u0026#34;\u0026#34;); // attachment é™„ä»¶ 9 10return ResponseEntity.ok() 11 .headers(headers) // \u0026lt;= header 12 .contentType(MediaType.APPLICATION_OCTET_STREAM) // \u0026lt;= contentType streamæµå¼ 13 .body(resource); // \u0026lt;= file Excelå¤„ç† 1org.apache.poi // åˆ©ç”¨è¿™ä¸ªApache POI package 1XSSFWorkbook excel = new XSSFWorkbook(); // ç±»ä¼¼excelæ–‡ä»¶ 2XSSFSheet sheet = excel.createSheet(\u0026#34;sheet1\u0026#34;); // sheet 3 4XSSFRow row1 = sheet.createRow(0); 5row1.createCell(1).setCellValue(\u0026#34;å§“å\u0026#34;); 6row1.createCell(2).setCellValue(\u0026#34;å¹´çºª\u0026#34;); 7row1.createCell(3).setCellValue(\u0026#34;åŸå¸‚\u0026#34;); 8 9XSSFRow row2 = sheet.createRow(1); 10row2.createCell(1).setCellValue(\u0026#34;éŸ¦é¾™\u0026#34;); 11row2.createCell(2).setCellValue(23); 12row2.createCell(3).setCellValue(\u0026#34;æ¡‚æ—\u0026#34;); 13 14XSSFRow row3 = sheet.createRow(2); 15row3.createCell(1).setCellValue(\u0026#34;å¼ ä¸‰\u0026#34;); 16row3.createCell(2).setCellValue(23); 17row3.createCell(3).setCellValue(\u0026#34;æ­å·\u0026#34;); 18 19File file = new File(\u0026#34;static/staff_info.xlsx\u0026#34;); 20FileOutputStream stream = new FileOutputStream(file); 21excel.write(stream); 22 23stream.close(); 24excel.close(); ","permalink":"http://longcoding.top/posts/learning/java_learning/","summary":"\u003ch3 id=\"java-åå°„\"\u003eJava åå°„\u003c/h3\u003e\n\u003cp\u003eå®ƒæä¾›äº†åŠ¨æ€æ€§å’Œçµæ´»æ€§ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åŠ è½½ç±»ã€è°ƒç”¨æ–¹æ³•ã€è®¿é—®å­—æ®µç­‰ï¼Œè€Œä¸éœ€è¦åœ¨ç¼–è¯‘æ—¶ç¡®å®šè¿™äº›æ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1. åŠ¨æ€åŠ è½½ç±»\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eåœ¨è¿è¡Œæ—¶æ ¹æ®ç±»ååŠ¨æ€åŠ è½½ç±»ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡¬ç¼–ç ç±»åã€‚ \u0026ndash; æ’ä»¶åŒ–æ¶æ„ï¼šæ ¹æ®é…ç½®æ–‡ä»¶æˆ–ç”¨æˆ·è¾“å…¥åŠ¨æ€åŠ è½½ç±»ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2. åˆ›å»ºå¯¹è±¡\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eé€šè¿‡åå°„å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼Œå³ä½¿ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå·¥å‚æ¨¡å¼ï¼šæ ¹æ®é…ç½®åŠ¨æ€åˆ›å»ºå¯¹è±¡ã€‚\u003c/li\u003e\n\u003cli\u003eä¾èµ–æ³¨å…¥æ¡†æ¶ï¼šSpring é€šè¿‡åå°„åˆ›å»º Bean å®ä¾‹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e3. è°ƒç”¨æ–¹æ³•\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eé€šè¿‡åå°„å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œå³ä½¿æ–¹æ³•æ˜¯ç§æœ‰çš„ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæµ‹è¯•æ¡†æ¶ï¼šJUnit é€šè¿‡åå°„è°ƒç”¨æµ‹è¯•æ–¹æ³•ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e4. è®¿é—®å­—æ®µ\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eé€šè¿‡åå°„å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¿é—®å¯¹è±¡çš„å­—æ®µï¼Œå³ä½¿å­—æ®µæ˜¯ç§æœ‰çš„\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼šé€šè¿‡åå°„è®¿é—®å¯¹è±¡çš„å­—æ®µã€‚\u003c/li\u003e\n\u003cli\u003eå¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰ï¼šHibernate é€šè¿‡åå°„è®¿é—®å®ä½“ç±»çš„å­—æ®µã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e7. æ³¨è§£å¤„ç†\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eé€šè¿‡åå°„å¯ä»¥è·å–ç±»ã€æ–¹æ³•ã€å­—æ®µä¸Šçš„æ³¨è§£ï¼Œå¹¶æ ¹æ®æ³¨è§£æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e24/4/14\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e1ï¸âƒ£ \u003cstrong\u003eåå°„çš„ä½œç”¨\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè·å–ç±»ä¸­çš„æ‰€æœ‰ä¿¡æ¯(e.g.æŒä¹…åŒ–ã€IDEçš„ä»£ç æç¤º)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eField\u003c/span\u003e\u003cspan class=\"o\"\u003e[]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efields\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetDeclaredFields\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003esetAccessible\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c1\"\u003e// String name = fields[i].getName();  // å±æ€§å ç¬¬ä¸€æ¬¡å…ˆç”Ÿæˆåˆ—å\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003ebw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etoString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elength\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003ebw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;, \u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ebw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003enewLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eç»“åˆé…ç½®æ–‡ä»¶åŠ¨æ€åˆ›å»ºå¯¹è±¡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 1\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eProperties\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eprop\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eProperties\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 2\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 3\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;prop.properties\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 4\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eFileInputStream\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eis\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eFileInputStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 5\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 6\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eprop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 7\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 8\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eclassname\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eprop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;classname\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e 9\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003emethod\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eprop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;method\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e10\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eprop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e11\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e12\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eforName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eclassname\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e13\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eConstructor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetDeclaredConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e14\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003enewInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e15\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e16\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eMethod\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003esetName\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;setName\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e17\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003esetName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003einvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e18\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e19\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eMethod\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003emet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetDeclaredMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"ln\"\u003e20\u003c/span\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003emet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003einvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e2ï¸âƒ£ \u003cstrong\u003eè·å–Classçš„ä¸‰ç§æ–¹å¼\u003c/strong\u003e\u003c/p\u003e","title":"Javaå­¦ä¹ ç¬”è®°"},{"content":"å›¾ç¤º å·ç§¯æ³¨æ„åŠ› è‡ªæ³¨æ„åŠ› å­¦ä¹  Norm Loss Cross Entropy $$ Loss = -\\sum_{i}^{C}y_ilog(p(x_{i})), where \\ y_i\\ is label,p(x_i)\\ is\\ predict. $$\nBCE Loss $$ Loss = âˆ’\\sum_{i}^{c}(y_ilog(p(x_i)+(1âˆ’y_i)log(1âˆ’p(x_i)) \\ where \\ y_i \\in [0, 1] \\\npos_partition = -log(p(x_i))\\ neg_partition = -log(1-p(x_i)) $$\nFocal Loss $$ Loss = -Î±_t(1-p_t)^Î³log(p_t)\\\n# Multi-Label:\\ 1.\\ pos_loss = Î±(1-p(x_i))^Î³\\ \\ -log(p_t)\\ 2.\\ neg_loss = (1-Î±)p(x_i)^Î³\\ \\ -log(1-p_t) $$\nè®ºæ–‡ Mlp-mixer - NIPS 2021 title: Mlp-mixer: An all-mlp architecture for vision\nâ­ channel-mixing MLPs and token-mixing MLPs.\nâ‘  èåˆPatchesé—´çš„ç‰¹å¾ä¿¡æ¯\nâ‘¡ èåˆPatcheså†…çš„ç‰¹å¾ä¿¡æ¯\nâŒ æ˜“è¿‡æ‹Ÿåˆ\n**Transformer ** - NIPS 2017 Transformer Encoder\nMulti-Head Self Attention â­æ¯æ®µç”¨ä¸ä¸€æ ·çš„Î±æƒé‡\t\u0026ndash; åˆ†æ®µèåˆTokené—´ä¿¡æ¯\nâ€‹\tå¤šç»„æ³¨æ„åŠ›æƒé‡Î±\nTokenåˆ†æ®µï¼Œå¹¶è¡Œè®¡ç®—æ¯æ®µçš„æƒé‡Î±ï¼Œå¤šå¤´æ³¨æ„åŠ›å…è®¸æ¨¡å‹å…±åŒå…³æ³¨æ¥è‡ªä¸åŒä½ç½®çš„ä¸åŒè¡¨ç¤ºå­ç©ºé—´çš„ä¿¡æ¯ã€‚\nâ­â­â­ å¹¶è¡Œå¤šä¸ªå¤´ï¼Œå¢å¼ºè¡¨ç¤ºèƒ½åŠ›ï¼Œèåˆä¸åŒå­ç©ºé—´(ä½çº¬ç©ºé—´)\nTokené—´ä¿¡æ¯èåˆï¼Œæ¯”ä¾‹æ˜¯ç›¸ä¼¼åº¦æƒé‡\nFeed-Forward Networks å·ç§¯ æ·±åº¦å¯åˆ†ç¦»å·ç§¯è®¡ç®—æˆæœ¬æ¯”æ ‡å‡†å·ç§¯å° 8 åˆ° 9 å€ï¼Œè€Œç²¾åº¦ä»…ç•¥æœ‰é™ä½ - MobileNetV2\nâœ¨ä½¿ç”¨å…±äº«å†…æ ¸åœ¨å±€éƒ¨åŒºåŸŸå†…è¿›è¡Œä¿¡æ¯äº¤äº’\næ ‡å‡†å·ç§¯ è¾“å…¥ç‰¹å¾å›¾å’Œæ¨¡æ¿å·ç§¯æ ¸\nè¾“å‡ºåƒç´  - èåˆå±€éƒ¨ç©ºé—´é€šé“ä¿¡æ¯\nç“¶é¢ˆç»“æ„ - Resnet å‡å°‘å‚æ•°æ•°é‡\né€ç‚¹å·ç§¯é™ç»´ -\u0026gt; æ ‡å‡†å·ç§¯ -\u0026gt; é€ç‚¹å·ç§¯å‡ç»´\nâ€‹\tæ®‹å·®è¿æ¥\nå‹ç¼© - å·ç§¯ - æ‰©å¼ \næ·±åº¦å¯åˆ†ç¦»å·ç§¯ å€’æ®‹å·®ç»“æ„ - MobileNet æ‰©å……é€šé“çš„åŸå› ï¼Œæ˜¯ä¸ºäº†èƒ½å¤Ÿæå–åˆ°æ›´å¤šçš„ä¿¡æ¯\nReLU æ¿€æ´»å‡½æ•°å¯èƒ½ä¼šå´©æºƒæ‰æŸäº›é€šé“ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šé€šé“ï¼Œé‚£ä¹ˆä¿¡æ¯å¯èƒ½ä»ç„¶ä¿ç•™åœ¨å…¶ä»–é€šé“ä¸­ã€‚\né€ç‚¹å·ç§¯å‡ç»´ -\u0026gt; åˆ†ç»„å·ç§¯ -\u0026gt; é€ç‚¹å·ç§¯é™ç»´\nâ€‹\tæ®‹å·®è¿æ¥\næ‰©å¼ - å·ç§¯ - å‹ç¼©\nLinear ä½œç”¨ç­‰åŒäº1Ã—1é€ç‚¹å·ç§¯ï¼Œå®ç°çº¿æ€§æ˜ å°„\nViT - CVPR 2020/10 Vision Transformer - Patching åŒ–ä¸ºäº’ä¸é‡å çš„åŒºåŸŸï¼Œè¾“å‡ºé€šé“æ•°ä¸ºTokençš„é•¿åº¦ã€‚â­ å°†imageæ‹†åˆ†ä¸º16Ã—16Ã—3çš„patch\nç»è¿‡Conv2Dæå–Tokenï¼Œ# Tokenä¸­æ¯å…ƒç´ å‡æœ‰å±€éƒ¨å®½é«˜åŠé€šé“ä¿¡æ¯\næ‰€æœ‰æ ‡è®°ä¹‹é—´çš„ç›²ç›®ç›¸ä¼¼æ€§æ¯”è¾ƒ\nPVT - ICCV 2021 Pyramid Vision Transformer A Versatile Backbone for Dense Prediction without Convolutions\nåˆ›æ–°ç‚¹ï¼šåœ¨ViTï¼ˆpatch embedå¤§å°å›ºå®šï¼‰åŸºç¡€ä¸Šï¼Œä»¿ç…§CNNç½‘ç»œçš„ç‰¹å¾å›¾å˜åŒ–\nâ­ä½¿ç”¨â€œæ¸è¿›â€æ”¶ç¼©ç­–ç•¥é€šè¿‡è¡¥ä¸åµŒå…¥å±‚æ¥æ§åˆ¶ç‰¹å¾å›¾çš„å°ºåº¦\nCNNs: ç‰¹å¾å›¾å˜åŒ– é€šé“Ã—2ï¼Œå®½é«˜Ã·2\nViT: patch embedä¸å˜\nPVTï¼š æ¸è¿›å¼ç¼©å°ç‰¹å¾å›¾ï¼Œå‡å°‘tokenæ•°é‡\nPVTæ¡†æ¶ï¼š\nâ‘ ç‰¹å¾å›¾ - patch_embed -\u0026gt; token token map -\u0026gt; token -\u0026gt; token map\nâ€‹\tâ­proj = Conv2d(in_channel, dim_token[i], kernel_size[i], stride[i])\ndim_token = [64, 128, 256, 512]\nkernel_size = [4, 2, 2, 2]\nstride= [4, 2, 2, 2]\t@ æ¸è¿›å¼ç¼©å°ç‰¹å¾å›¾\t\u0026ndash; èåˆå±€éƒ¨tokençš„æ„Ÿè§‰\ntokenæ•°é‡â¬‡ï¼Œtokenç»´åº¦â¬†(ä¿¡æ¯æ›´åŠ ä¸°å¯Œ)\nå¤šæ¬¡Patch Embed\nâ‘¡Transformer Encoder å¯¹ token è¿›è¡Œä¿¡æ¯æå– MHSAå¤„è¿›è¡Œè°ƒæ•´ï¼šå¼•å…¥Spacial Reductionæ“ä½œ\nSpacial Reductionï¼šå°†tokenæŠ˜å å›ç‰¹å¾å›¾ï¼Œä½¿ç”¨Conv2då¯¹ç‰¹å¾å›¾è¿›è¡Œå±€éƒ¨ä¿¡æ¯èåˆçš„å¤„ç†ï¼Œå†ä¿æŒé€šé“ç»´åº¦ä¸å˜çš„æƒ…å†µä¸‹ï¼Œç¼©å°å®½é«˜ç©ºé—´å¤§å°ï¼Œå†æ‹†åˆ†æˆtokenï¼Œå‡å°‘tokenæ•°é‡ã€‚\nå¯¹Token Keyå’ŒValueçš„éƒ¨åˆ†è¿›è¡ŒSRå¤„ç†ï¼Œshape=(*num_token, dim_token)\nQuery shape=(num_token, dim_token)\nÎ± = softmax(Q@SR(K).T / âˆšd) shape=(num_token, *num_token)\nÎ±@V\tshape=(num_token, dim_token)\nâ­å›¾ç¤ºæ“ä½œï¼š\nåˆ©ç”¨convå±€éƒ¨æ€§ï¼Œå°†ç›¸é‚»çš„Tokenè¿›è¡Œåˆå¹¶ | æˆ–è€…åˆ©ç”¨Poolè¿›è¡Œçª—å£å†…Tokenåˆå¹¶ ï¼ˆå›¾ç¤ºç¨å¾®æœ‰ç‚¹é—®é¢˜ï¼‰\nè®¡ç®—é‡é™ä½sr_ratioå¹³æ–¹å€ \u0026ndash; Conv2Dä¸­çš„stride\nâ‘¢å°†tokenæŠ˜å å›ç‰¹å¾å›¾\nCvT - ICCV 2021 CvT: Introducing Convolutions to Vision Transformers\nå¾ˆåƒPVT - å‰ç½®è®ºæ–‡Bottle neck Transformer @ åœ¨resnetæœ«å°¾å°†åä¸‰å±‚Conv3Ã—3æ›¿æ¢ä¸ºMHSA ï¼ˆConvç»“æ„ä¸­å¼•å…¥Attensionå…¨å±€å»ºæ¨¡ï¼‰\nç›®çš„ï¼š\nâ‘ å°†å·ç§¯ç¥ç»ç½‘ç»œ (CNN) çš„ç†æƒ³ç‰¹æ€§å¼•å…¥ ViT æ¶æ„ï¼ˆå³ç§»ä½ã€å°ºåº¦å’Œå¤±çœŸä¸å˜æ€§ï¼‰ï¼ŒåŒæ—¶ä¿æŒ Transformer çš„ä¼˜ç‚¹ï¼ˆå³åŠ¨æ€æ³¨æ„åŠ›ã€å…¨å±€ä¸Šä¸‹æ–‡å’Œæ›´å¥½çš„æ³›åŒ–ï¼‰\nâ‘¡å°†å…·æœ‰å›¾åƒåŸŸç‰¹å®šå½’çº³åå·®çš„å·ç§¯å¼•å…¥ Transformer æ¥å®ç°ä¸¤å…¨å…¶ç¾\nâ‘¢ç©ºé—´ç»´åº¦ä¸‹é‡‡æ ·ï¼Œé€šé“å¢åŠ ã€‚Tokenæ•°é‡å°‘äº†ï¼Œä½†æ¯ä¸ªTokenå˜é•¿äº†ï¼Œå¢å¼ºäº†æºå¸¦ä¿¡æ¯çš„è¡¨ç¤ºçš„ä¸°å¯Œæ€§\nâ­åˆ é™¤ä½ç½®åµŒå…¥ï¼šä¸ºæ¯ä¸ª Transformer å—å¼•å…¥å·ç§¯æŠ•å½±ï¼Œå¹¶ç»“åˆå·ç§¯ä»¤ç‰ŒåµŒå…¥ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ç½‘ç»œå¯¹å±€éƒ¨ç©ºé—´å…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚ä½¿å…¶å…·æœ‰é€‚åº”éœ€è¦å¯å˜è¾“å…¥åˆ†è¾¨ç‡çš„å„ç§è§†è§‰ä»»åŠ¡çš„æ½œåœ¨ä¼˜åŠ¿ã€‚\næ€»ä½“ç»“æ„\rConvolutional Token Embedding é‡å å¼çš„åµŒå…¥ï¼Œä½¿ç”¨æ ‡å‡†Conv2D\nå¹¶ä¸”åœ¨æ¯ä¸ªStageæœ€åï¼Œå°†Tokené›†åˆæŠ˜å å›Token Map\nConvolutional Projection \u0026ndash; Convç”ŸæˆQKV è€Œéé€šå¸¸çš„nn.Linear åˆ©ç”¨ åˆ†ç»„å·ç§¯ å°†Kä¸Vçš„Token Mapä¸‹é‡‡æ ·ï¼Œæ€§èƒ½æ¢æ•ˆç‡\nå±€éƒ¨ç©ºé—´ä¸Šä¸‹æ–‡çš„é™„åŠ å»ºæ¨¡ï¼Œç›¸æ¯”äºæ™®é€šå·ç§¯(æ›´å¤æ‚çš„è®¾è®¡å’Œé¢å¤–çš„è®¡ç®—æˆæœ¬)ï¼ŒDWConvæ€§ä»·æ¯”æ›´é«˜\n(b): å¯å‚è€ƒMobileViTï¼Œå…ˆåˆ©ç”¨å·ç§¯å±€éƒ¨èåˆä¿¡æ¯ï¼Œå†æ‰§è¡Œçª—å£çº§æ³¨æ„åŠ›\nSwin - ICCV 2021 Swin transformer: Hierarchical vision transformer using shifted windows\nå±‚çº§å¼ViT\nåˆ›æ–°ç‚¹ï¼š\nâ‘ patch embedå°ºå¯¸é€æ­¥å¢å¤§ï¼Œæ£€æµ‹å°ç›®æ ‡æ›´å¥½\næ€»ä½“ç»“æ„\nçª—å£çº§çš„Tokenç‰¹å¾èåˆæ“ä½œï¼š Swin Transformer Block æ•°é‡ä¸ºå¶æ•° â‘ çª—å£å†…çš„Tokenä¿¡æ¯èåˆ\nMHSAé™åˆ¶åœ¨çª—å£å†…è¿›è¡Œ \u0026ndash; é™ä½è®¡ç®—å¤æ‚åº¦\nâ‘¡çª—å£é—´çš„Tokenä¿¡æ¯èåˆ \u0026ndash; æ»‘åŠ¨çª—å£ç­–ç•¥ \u0026ndash; é—´æ¥çœ‹åˆ°å…¨å±€ä¿¡æ¯\nè“çº¿è¡¨ç¤ºçª—å£å†…Tokenä¿¡æ¯èåˆï¼Œçº¢çº¿è¡¨ç¤ºçª—å£é—´ä¿¡æ¯èåˆ\nâ—â—â—â­â­â­MHSAä¾ç„¶é™åˆ¶åœ¨çª—å£å†…è¿›è¡Œ\nâ—ä¸ºäº†è§„æ•´ç»Ÿä¸€çª—å£å¤§å°ï¼Œä¾¿äºæ‰¹é‡è®¡ç®—\nè¿›è¡Œä¸€æ¬¡å¾ªç¯ä½ç§»ï¼Œä½¿çª—å£å¤§å°ç»Ÿä¸€\nâ­ä½¿ç”¨window-maskå°†æœ¬è¯¥ä¸è¿›è¡Œè‡ªæ³¨æ„è®¡ç®—çš„éƒ¨åˆ†é®æŒ¡æ‰ï¼Œåœ¨è®¡ç®—æ³¨æ„åŠ›Î±æ—¶ï¼Œåœ¨å…¶ä¸­softmaxä¸­ï¼Œå°†maskçš„å€¼è®¾ä¸º-100ï¼Œåˆ™e^{-100} / Î£ e^{i} ä¸º 0\næ»‘åŠ¨çª—å£Maskç¤ºä¾‹ï¼š\nç»™çª—å£ç¼–å·ï¼Œå†ä½¿ç”¨torch.roll æ»‘åŠ¨ ï¼ˆ window_size // 2 ï¼‰ ä¸ªåƒç´ \n$$ \\text{softmax}(z)i = \\frac{e^{z_i}}{\\sum{j=1}^{K} e^{z_j}}, \\quad \\text{for } i = 1, 2, \\ldots, K \\\\e^{-100} â‰ˆ 0 $$\nç›¸å¯¹ä½ç½®ç¼–ç ï¼š å› ä¸ºè®¡ç®—Window-MHSAæ˜¯å¹¶è¡Œçš„ï¼Œæ²¡æœ‰ä½ç½®é¡ºåºä¿¡æ¯\nâ­æ³¨æ„åŠ›æƒé‡ åŠ ä¸Š ç›¸å¯¹ä½ç½®åç½®\nâœ¨ç›¸å¯¹ä½ç½®ä¿¡æ¯ \u0026ndash; å‹ç¼©\u0026amp;å¤ç”¨\nâ‘  relative position bias table è‡ªå­¦ä¹ çš„ä½ç½®æ ‡é‡åç½® \u0026ndash; å‹ç¼©\nâ‘¡ relative position bias index ç´¢å¼• \u0026ndash; ä¸åŒä½ç½®çš„tokenä½¿ç”¨ç›¸åŒçš„ç›¸å¯¹ä½ç½®åç½® \u0026ndash; å¤ç”¨\nç»™å®šçª—å£å¤§å°ï¼Œindexæ˜¯å›ºå®šå€¼ï¼Œtableæ˜¯å¯å­¦ä¹ çš„ä½ç½®ä¿¡æ¯\nä¸€ç»´æƒ…å†µï¼š\nPatch Mergeing ç›®çš„ï¼š å®½é«˜å‡åŠï¼Œé€šé“ç¿»å€\næ•´å¹…ç‰¹å¾å›¾åˆ†4éƒ¨åˆ†ï¼Œåˆå¹¶ä¸åŒéƒ¨åˆ†ï¼Œç›¸åŒä½ç½®çš„Token\nMobilevit - CVPR 2021 title: Mobilevit: light-weight, general-purpose, and mobile-friendly vision transformer\nåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šè¿è¡ŒViT \u0026ndash; æ··åˆCNNå’ŒTransformer\nMV2: MobileNetv2 ä¸­çš„å€’æ®‹å·®å— â¬‡2ï¼š ä¸‹é‡‡æ ·2å€ï¼Œæ§åˆ¶strideæ­¥å¹…\nMobileViT Block:\t\u0026ndash; é—´æ¥èåˆ ç”¨äºŒç»´å·ç§¯å±€éƒ¨èåˆ(é‡å åŒºåŸŸ)ï¼Œè¾“å‡ºçš„ç‰¹å¾å›¾ä¸­æ¯ä¸ªåƒç´ éƒ½ä¼šçœ‹åˆ° MobileViT å—ä¸­çš„æ‰€æœ‰å…¶ä»–åƒç´ \nçº¢è‰²åƒç´ ä½¿ç”¨å˜å‹å™¨å…³æ³¨è“è‰²åƒç´ \nç”±äºè“è‰²åƒç´ å·²ç»ä½¿ç”¨å·ç§¯å¯¹æœ‰å…³ç›¸é‚»åƒç´ çš„ä¿¡æ¯è¿›è¡Œäº†ç¼–ç ï¼Œå› æ­¤çº¢è‰²åƒç´ å¯ä»¥å¯¹å›¾åƒä¸­æ‰€æœ‰åƒç´ çš„ä¿¡æ¯è¿›è¡Œç¼–ç \nunfoldå’Œfold å°†ç‰¹å¾å›¾è½¬ä¸ºTokené›†åˆï¼Œæ”¹æ’åºï¼Œä¸ç­‰äºpatch embed(ç”¨conv2d)\nåŸè®ºæ–‡ æœ€åçš„é€šé“ç»´åº¦èåˆï¼Œä½¿ç”¨çš„Conv3x3å·ç§¯ã€‚ # æ¨¡å—å¯¹ç§°ã€‚\nCrossViT - ICCV 2021 CrossViT: Cross-Attention Multi-Scale Vision Transformer for Image Classification\nåŒåˆ†æ”¯ - å¤šå°ºåº¦patchåµŒå…¥\näº’æ¢åˆ†æ”¯çš„CLS Token å®ç°åˆ†æ”¯é—´çš„ä¿¡æ¯é€šä¿¡\næ€»ä½“ç»“æ„\räº¤äº’ç¤ºä¾‹\rè¯¦ç»†\rDeiT - CVPR 2021 Training data-efficient image transformers \u0026amp; distillation through attention\nâ­çº¯Transformerç‰ˆæœ¬çš„çŸ¥è¯†è’¸é¦\nå¼•å…¥distillation tokenæ¥è¿›è¡ŒçŸ¥è¯†è’¸é¦ï¼Œæ‰§è¡Œçš„ç›®æ ‡ä¸åŒã€‚ä¸€ä¸ªä¸labelè®¡ç®—lossï¼Œä¸€ä¸ªä¸Teacher labelè®¡ç®—è’¸é¦æŸå¤±ã€‚åå‘ä¼ æ’­ä¼˜åŒ–æ—¶ï¼Œæ¢¯åº¦ä¸ä¸€æ ·\nT2T - ICCV 2021 Tokens-to-Token ViT: Training Vision Transformers from Scratch on ImageNet\né‡å åµŒå…¥ï¼Œä¿¡æ¯æ›´å…¨é¢ã€‚èåˆTokenï¼Œåˆ é™¤å†—ä½™\nsoft split\té‡å èåˆ(å›¾ç¤ºæ˜¯å †å åœ¨é€šé“ç»´åº¦)\nBiFormer - CVPR 2023 BiFormer: Vision Transformer with Bi-Level Routing Attention\nä¸€ç§åŠ¨æ€çš„ã€æŸ¥è¯¢æ„ŸçŸ¥çš„ç¨€ç–æ³¨æ„åŠ›æœºåˆ¶ã€‚ å…³é”®æ€æƒ³æ˜¯åœ¨ç²—ç³™åŒºåŸŸçº§åˆ«è¿‡æ»¤æ‰å¤§éƒ¨åˆ†ä¸ç›¸å…³çš„é”®å€¼å¯¹ï¼Œä»¥ä¾¿åªä¿ç•™ä¸€å°éƒ¨åˆ†è·¯ç”±åŒºåŸŸï¼Œå†è¿›è¡Œç»†ç²’åº¦çš„æ³¨æ„åŠ›è®¡ç®—\næ³¨æ„åŠ›åŒºåŸŸå¯¹æ¯”\rè·¯ç”±æ–¹å¼å»ºç«‹è·¨çª—å£ä¿¡æ¯äº¤äº’\né€šè¿‡åŒ–ä¸ºwindowï¼Œå„Tokenå‡å€¼ä¸ºä»£è¡¨æ•´windowçš„Tokenï¼Œè®¡ç®—åŒºåŸŸç›¸ä¼¼æ€§å…³ç³»å›¾ï¼Œå€Ÿæ­¤ä¸ºçª—å£é—´é“¾æ¥é€šä¿¡\nå°†çª—å£ä¸²èµ·æ¥\nBi-Routing Self-Attention\ræ€»ä½“ç»“æ„\rDWConv 3Ã—3 ä½œç”¨ï¼š\nâ€‹\tåœ¨å¼€å§‹æ—¶ä½¿ç”¨ 3Ã—3 æ·±åº¦å·ç§¯æ¥éšå¼ç¼–ç ç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚\nSMT - ICCV 2023 Scale-Aware Modulation Meet Transformer\nâ€œæ¨¡æ‹Ÿéšç€ç½‘ç»œå˜å¾—æ›´æ·±è€Œä»æ•è·å±€éƒ¨ä¾èµ–å…³ç³»åˆ°å…¨å±€ä¾èµ–å…³ç³»çš„è½¬å˜â€œï¼ˆä¸²è¡Œæ¸å˜ç»“æ„ï¼‰ =è”æƒ³åˆ°=\u0026gt; æµ…å±‚ç½‘ç»œæ•è·å½¢æ€ç‰¹å¾ï¼Œæ·±å±‚éƒ¨åˆ†æ•è·é«˜çº§èŠ‚å¾‹ç‰¹å¾\nSMT1D ç”Ÿç¡¬çš„è®­ç»ƒECG ä¸­ç­‰æ•ˆæœï¼Œä½†è®¡ç®—é‡å°ï¼\nå±‚çº§å¼ViTç»“æ„\næ€»ä½“ç»“æ„\rEvolutionary Hybrid Network ç»“æ„å–åä¸ºâ€œè¿›åŒ–æ··åˆç½‘ç»œâ€ Evolutionary Hybrid Network - å±€éƒ¨åˆ°å…¨å±€å»ºæ¨¡çš„è¿‡æ¸¡\nä¸¤ç§èåˆæ¨¡å—çš„å †å æ–¹å¼\ræ€§èƒ½å¯¹æ¯”\rSAM Block scale-aware modulation\rMulti-Head Mixed Convolution å°†é€šé“åˆ†å‰²ä¸ºå¤šä¸ªå¤´(ç»„)ï¼Œæ¯ä¸ªå¤´ä½¿ç”¨ä¸åŒå¤§å°çš„å·ç§¯æ ¸ï¼ˆç›®çš„ï¼šæ•æ‰å¤šä¸ªå°ºåº¦çš„å„ç§ç©ºé—´ç‰¹å¾ã€‚å¢å¼ºç½‘ç»œçš„å»ºæ¨¡èƒ½åŠ›â€œå±€éƒ¨è¿œç¨‹ä¾èµ–â€ï¼‰\nä¾‹ï¼š\nScale-Aware Aggregation å€’æ®‹å·®ç»“æ„ - èåˆé€šé“\nåœ¨MHMCç»“æ„ä¸­ï¼Œå¤šå¤´ç”±äºå·ç§¯æ ¸å¤§å°ä¸åŒï¼Œæ›´å¤§çš„å·ç§¯æ ¸çœ‹åˆ°çš„æ„Ÿå—é‡æ›´å¤§ã€‚ å°†å¤šå¤´å„ä¸ªå·ç§¯ä¾æ¬¡æ‰“åŒ…æˆç»„ï¼Œè¿›è¡Œç»„é—´é€šé“èåˆï¼Œæ¯ç»„æ—¢æœ‰å°æ„Ÿå—é‡çš„ä¿¡æ¯ï¼Œåˆæœ‰å¤§æ„Ÿå—é‡ä¿¡æ¯ï¼Œå¤šæ · multi-scale\nå¯è§†åŒ–æ¨¡å—æ•ˆæœ \u0026ndash; ç”»çš„å·ç§¯è°ƒåˆ¶æƒé‡ æ·±åº¦å¯åˆ†ç¦»å·ç§¯ä½œä¸ºæ³¨æ„åŠ›æƒé‡\nâ‘  æ¯ä¸ªä¸åŒçš„å·ç§¯ç‰¹å¾å›¾éƒ½å­¦ä¹ ä»¥è‡ªé€‚åº”æ–¹å¼å…³æ³¨ä¸åŒçš„ç²’åº¦ç‰¹å¾\nâ‘¡å¤šå¤´æ›´å‡†ç¡®åœ°æç»˜å‰æ™¯å’Œç›®æ ‡å¯¹è±¡\nâ‘¢ç½‘ç»œå˜æ·±ï¼Œå¤šå¤´ä»ç„¶å¯ä»¥å‘ˆç°ç›®æ ‡ç‰©ä½“çš„æ•´ä½“å½¢çŠ¶ã€‚ä¸ç»†èŠ‚ç›¸å…³çš„ä¿¡æ¯åœ¨å•å¤´å·ç§¯ä¸‹ä¼šä¸¢å¤±\nâ­â­è¡¨æ˜ MHMC åœ¨æµ…å±‚é˜¶æ®µæœ‰èƒ½åŠ›æ¯”å•å¤´æ›´å¥½åœ°æ•è·å±€éƒ¨ç»†èŠ‚ï¼ŒåŒæ—¶éšç€ç½‘ç»œå˜å¾—æ›´æ·±ï¼Œä¿æŒç›®æ ‡å¯¹è±¡çš„è¯¦ç»†å’Œè¯­ä¹‰ä¿¡æ¯ã€‚\nå¢å¼ºäº†è¯­ä¹‰ç›¸å…³çš„ä½é¢‘ä¿¡å·ï¼Œç²¾ç¡®åœ°èšç„¦äºç›®æ ‡å¯¹è±¡æœ€é‡è¦çš„éƒ¨åˆ†ã€‚\næ›´å¥½çš„æ•è·å’Œè¡¨ç¤ºè§†è§‰è¯†åˆ«ä»»åŠ¡çš„åŸºæœ¬ç‰¹å¾çš„èƒ½åŠ›ã€‚\nConv2Former - CVPR 2022 Conv2Former: A Simple Transformer-Style ConvNet for Visual Recognition\nåˆ›æ–°ç‚¹ï¼š ç”¨å·ç§¯æ“ä½œ æ¨¡æ‹Ÿè¿‘ä¼¼ æ³¨æ„åŠ› \u0026ndash; æ›´ä½çš„è®¡ç®—ä»£ä»· ç•¥ä½çš„æ€§èƒ½ä¸‹é™\nHadamard product == çŸ©é˜µæŒ‰å…ƒç´ ç›¸ä¹˜\nä½¿å¾—æ¯ä¸ªç©ºé—´ä½ç½®(h,w)èƒ½å¤Ÿä¸ä»¥(h,w)ä¸ºä¸­å¿ƒçš„kÃ—kæ­£æ–¹å½¢åŒºåŸŸå†…çš„æ‰€æœ‰åƒç´ ç›¸å…³ã€‚é€šé“ä¹‹é—´çš„ä¿¡æ¯äº¤äº’å¯ä»¥é€šè¿‡çº¿æ€§å±‚æ¥å®ç°ã€‚\nâ€»é‡ç‚¹ï¼š ConvNeXtä¸­è¡¨æ˜ï¼Œå·ç§¯æ ¸ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œè¶…è¿‡7x7ï¼Œè®¡ç®—ä»£ä»·è¿œè¿œå¤§äºæ€§èƒ½æ”¶ç›Š\nâ­æœ¬æ–‡å®éªŒæå‡ºï¼Œå°†å·ç§¯ç‰¹å¾ä½œä¸ºæƒé‡ï¼Œèƒ½æ¯”ä¼ ç»Ÿæ–¹å¼æ›´æœ‰æ•ˆåœ°åˆ©ç”¨å¤§å†…æ ¸\nConvNeXt - CVPR 2022 ConvNeXt å°†CNNæ­å»ºæˆSwinTçš„é£æ ¼ï¼Œæ€§èƒ½è¶…è¶ŠSwinT\nInceptionNext å¤šå°ºåº¦ç‰ˆæœ¬çš„ConvNeXt\nShunted SA - CVPR 2022 Shunted Self-Attention via Multi-Scale Token Aggregation\nPVT å’Œç±»ä¼¼çš„æ¨¡å‹å¾€å¾€ä¼šåœ¨è¿™ç§ç©ºé—´ç¼©å‡ä¸­åˆå¹¶å¤ªå¤šçš„æ ‡è®°ï¼Œä½¿å¾—å°ç‰©ä½“çš„ç»†ç²’åº¦ä¿¡æ¯ä¸èƒŒæ™¯æ··åˆå¹¶æŸå®³æ¨¡å‹çš„æ€§èƒ½ï¼›\nåŒæ—¶ä¿ç•™ç²—ç²’åº¦å’Œç»†ç²’åº¦çš„ç»†èŠ‚ï¼ŒåŒæ—¶ä¿æŒå¯¹å›¾åƒæ ‡è®°çš„å…¨å±€ä¾èµ–æ€§å»ºæ¨¡ï¼›\nè§‚å¯Ÿåˆ°PVTå’ŒViTåœ¨åŒä¸€ä¸ªEncoderä¸­tokenå°ºåº¦æ˜¯å›ºå®šçš„ï¼Œåˆ›æ–°ç»“åˆäºŒè€…ã€‚ç”¨Convå°†Token Mapå±€éƒ¨èåˆæˆå¤šå¹…Token Mapï¼Œä½¿æ¯ä¸ªæ±‡èšçš„Tokenä»£è¡¨ç€ä¸åŒåŒºåŸŸï¼Œä¸ä»…è§‚å¯Ÿåˆ°å°ç‰©ä½“ï¼Œä¹Ÿèƒ½çœ‹åˆ°å¤§ç‰©ä½“ã€‚ ViTï¼šå°åŒºåŸŸ\nPVTï¼š å¤§åŒºåŸŸ\nShunted : ç»“åˆå¤§å°åŒºåŸŸ\nçµæ„Ÿæºäºï¼š\nåšæ³•ï¼š\nâ€‹\tä¸åŒå¤´çš„é•¿åº¦ä¸åŒï¼Œä»¥æ•è·ä¸åŒç²’åº¦çš„ä¿¡æ¯ã€‚\nåŸå§‹ç‰¹å¾å›¾xï¼Œå·ç§¯å±€éƒ¨èåˆå¾—åˆ°x1ï¼Œ x2 (HWå‡å˜å°)\nâ—æ³¨æ„ï¼šQçš„çº¿æ€§æ˜ å°„ç»´åº¦ä¸å˜ï¼Œè€Œä¸åŒå°ºåº¦çš„KVé€šè¿‡çº¿æ€§æ˜ å°„æ—¶ç»´åº¦ç¼©å‡ç‡ä¸ºSRç‰¹å¾å›¾çš„æ•°é‡ï¼ˆQKVç»´åº¦ä¸€è‡´ï¼‰\nä¸¤ç§åšæ³•\nç»†ç²’åº¦ - pixel token || ç²—ç²’åº¦ - patch token\nGC-ViT - ICML 2023 Global Context Vision Transformers\nä¸SwinTçš„åŒºåˆ«ï¼š\nä¸é€šè¿‡æ»‘åŠ¨çª—å£å®ç°å…¨å±€ä¿¡æ¯å»ºæ¨¡ =\u0026gt; ç›´æ¥ç”Ÿæˆå…¨å±€ä¿¡æ¯Tokenï¼Œä½¿ç”¨è¿™ç»„æºå¸¦å…¨å±€ä¿¡æ¯çš„TokenSetæ¥å®ç°å…¨å±€ä¿¡æ¯å»ºæ¨¡ SwinT å±‚æ•°å †ä¸å¤Ÿçš„è¯ï¼Œå…¨å±€ä¿¡æ¯å»ºæ¨¡ä¸å¼º ä¸SwinTçš„å…±åŒç‚¹ï¼š\néƒ½å±äºwindow-wise attention\nä½ç½®ç¼–ç éƒ½é‡‡ç”¨ç›¸å¯¹ä½ç½®åç½®bias\nåŸºæœ¬å•å…ƒï¼šå±€éƒ¨çª—å£å†…è®¡ç®— + å…¨å±€ä¿¡æ¯å»ºæ¨¡ï¼›ï¼ˆçª—å£å†… + çª—å£é—´ï¼‰\næ€è·¯ï¼š\nGlobal query tokens generation\nMBConv - FeatureExtract\nä»£ç åˆ†æ\n1X: [batch, num_token, dim_token] 2x-window: [batch*num_windows, num_token//num_windows, dim_token] 3x-window-head:[batch*num_windows, num_heads, num_token//num_windows, dim_token//num_heads] 4 5 6Query: [batch Ã— num_window, num_heads, num_tokens, dim_head] 7Key-Global: [batch, repeat , num_heads, num_tokens, dim_head] å›¾ç¤ºæœ€åçš„å¤åˆ¶ï¼Œæ˜¯è®©æ¯ä¸ªçª—å£å†…çš„tokenä¸å…¨å±€tokenè¡¨ç¤ºè¿›è¡Œä¿¡æ¯èåˆ ï¼ˆå¤åˆ¶çª—å£ç»´åº¦çš„å¤§å°ï¼‰\nfunny: å…¬å¸{å¤šéƒ¨é—¨} =\u0026gt; [éƒ¨é—¨å†…éƒ¨æˆå‘˜è¿›è¡Œè®¨è®º] =\u0026gt; [éƒ¨é—¨ä¹‹é—´é¢†å¯¼è¿›è¡Œè®¨è®º]\nToken Sparsification - CVPR 2023 Making Vision Transformers Efficient from A Token Sparsification View\nåŠ¨æœºï¼š\n*è§‚å¯Ÿåˆ°æ³¨æ„åŠ›åæœŸï¼Œä»…éƒ¨åˆ†æ ¸å¿ƒTokenèµ·ç€ä¸»è¦ä½œç”¨*![image-20240407143751781](http://sthda9dn6.hd-bkt.clouddn.com/Fq2bA5CegUx5LXr1CkJytYjIeE4d)\rå¯¹Tokenè¿›è¡Œç˜¦èº« - ä¸åˆ©ç”¨CLS Tokenè¿›è¡Œçº§è”åˆ é™¤ä¸ç”¨çš„ç­–ç•¥\næ–¹æ³•ï¼š\tSparse Token Vision Transformer\nSemantic Token Generation Module 1ï¸âƒ£ Base Module å­¦ä¹ æµ…å±‚ç‰¹å¾\n2ï¸âƒ£ è¿›è¡ŒSpatial PoolingèšåˆåŒºåŸŸï¼Œç”Ÿäº§ç©ºé—´ç°‡ä¸­å¿ƒTokenSet\n**Conv( GELU( LayerNorm( DWConv( X ))))** *- æ·±åº¦å¯åˆ†ç¦»*\råˆ›æ–°ï¼š**Intra and inter-window** spatial pooling\rç›®çš„ï¼šèšåˆçª—å£ä¿¡æ¯(ä»£è¡¨) + ç–è¿œçª—å£é—´ä¿¡æ¯(ä¸å¯è¢«æ›¿ä»£)\r3ï¸âƒ£ èåˆç”ŸæˆSemantic Token Set\t- Global Initial Center G æ˜¯å¯å­¦ä¹ çš„å‚æ•° $$ \\overline{S^{1}} = MHA(P, X, X) + P,\\ \\ \\ S^{1} = FFN(\\overline{S^{1}}) + \\overline{S^{1}} \\\\ \\overline{S^{2}} = MHA(S^{1} + G, Concat(S^{1}, X), Concat(S^{1}, X)) + P,\\ \\ \\ S^{2} = FFN(\\overline{S^{2}}) + \\overline{S^{2}} \\ S^{2} = Semantic\\ \\ Token $$\nRecovery Module $$ \\overline{X} = MHA(X, S, S) + P,\\ \\ \\ X = FFN(\\overline{X}) + \\overline{X} $$ èåˆæ“ä½œçš„é€†è¿‡ç¨‹\nä»è¯­ä¹‰çº§TokenSetä¸­æ¢å¤ç©ºé—´ä¿¡æ¯\nFirst layer attention maps\nHiLo Attention - NeurIPS 2022 Fast Vision Transformers with HiLo Attention\nå›¾åƒä¸­çš„é«˜é¢‘æ•è·å±€éƒ¨ç²¾ç»†ç»†èŠ‚ï¼Œä½é¢‘å…³æ³¨å…¨å±€ç»“æ„ï¼Œè€Œå¤šå¤´è‡ªæ³¨æ„åŠ›å±‚å¿½ç•¥äº†ä¸åŒé¢‘ç‡çš„ç‰¹å¾ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®é€šè¿‡å°†å¤´éƒ¨åˆ†ä¸ºä¸¤ç»„æ¥è§£å¼€æ³¨æ„åŠ›å±‚ä¸­çš„é«˜é¢‘/ä½é¢‘æ¨¡å¼ï¼Œå…¶ä¸­ä¸€ç»„é€šè¿‡æ¯ä¸ªå±€éƒ¨çª—å£å†…çš„è‡ªæ³¨æ„åŠ›å¯¹é«˜é¢‘è¿›è¡Œç¼–ç ï¼Œå¦ä¸€ç»„é€šè¿‡åœ¨æ¯ä¸ªå±€éƒ¨çª—å£å†…æ‰§è¡Œå…¨å±€æ³¨æ„åŠ›æ¥å¯¹ä½é¢‘è¿›è¡Œç¼–ç ï¼Œè¾“å…¥ç‰¹å¾å›¾ä¸­æ¯ä¸ªçª—å£å’Œæ¯ä¸ªæŸ¥è¯¢ä½ç½®çš„å¹³å‡æ± åŒ–ä½é¢‘é”®å’Œå€¼ã€‚\nåˆ›æ–°ç‚¹ï¼š\nå°†è‡ªæ³¨æ„åŠ›åˆ†ä¸ºé«˜é¢‘å’Œä½é¢‘ é«˜é¢‘æ•æ‰å±€éƒ¨ç²¾ç»†ç»†èŠ‚ï¼ˆè½®å»“ã€è¾¹ç¼˜ï¼‰ ä½é¢‘æ•è·æ•´ä½“ç»“æ„orè¶‹åŠ¿ highéƒ¨åˆ†æ˜¯windowçº§åˆ«çš„attn lowéƒ¨åˆ†æ˜¯space reduce(ç»è¿‡pool)çš„ç²—ç³™çº§åˆ«çš„attn å›¾ç¤ºï¼š\nä¼ªä»£ç ï¼š\n1HiLoAttention(): 2 def high(x): 3 # window-partition 4 [batch, num_token, dim_token] =\u0026gt; [batch, num_window, window_size, dim_token] 5 # multi-head 6 [batch, num_window, window_size, dim_token] =\u0026gt; [batch, num_window, num_head, window_size, dim_head] 7 8 # do attention 9 # reshape to restore 10 11 def low(x): 12 B, L, C = x.shape 13 x_ = x.transpose(-2, -1)\t# [batch, channel, length] 14 x_ = self.sr_cnn(x_) # [batch, channel, _length] reduce length || avgpool or dwconv 15 16 q = self.q(x).reshape() =\u0026gt; [batch, num_head, num_token, dim_head] 17 k, v = self.kv(x).reshape()[...] =\u0026gt; [batch, num_head, *num_token, dim_head] 18 19 # do attention 20 # reshape to restore 21 22 def forward(x): 23 x1 = high(x) 24 x2 = low(x) 25 26 x = torch.cat([x1, x2], dim=-1) 27 x = self.proj(x) CMT - CVPR 2022 CMT: Convolutional Neural Networks Meet Vision Transformers\næ³¨é‡ç‚¹ï¼šä¸ä¹‹å‰åŸºäº CNN å’ŒåŸºäº Transformer çš„æ¨¡å‹ç›¸æ¯”ï¼Œåœ¨å‡†ç¡®æ€§å’Œæ•ˆç‡æ–¹é¢è·å¾—äº†æ›´å¥½çš„æƒè¡¡ã€‚\nâ­ ç”±äº patch å¤§å°å›ºå®šï¼ŒTransformer å¾ˆéš¾æ˜¾å¼åœ°æå–ä½åˆ†è¾¨ç‡å’Œå¤šå°ºåº¦ç‰¹å¾ =\u0026gt; å›¾åƒæ˜¯äºŒç»´çš„ï¼ˆå³å…·æœ‰å®½åº¦å’Œé«˜åº¦ï¼‰ï¼Œå¹¶ä¸”åœ¨å›¾åƒä¸­çš„æ¯ä¸ªåƒç´ ä½ç½®éƒ½ä¸å…¶å‘¨å›´çš„åƒç´ æœ‰å…³ã€‚è¿™ç§ç©ºé—´å±€éƒ¨ä¿¡æ¯éå¸¸é‡è¦ï¼Œä¾‹å¦‚ï¼Œè¾¹ç¼˜æ£€æµ‹ã€çº¹ç†åˆ†æç­‰éƒ½ä¾èµ–äºè¿™ç§å±€éƒ¨å…³ç³»ã€‚=\u0026gt; Patchfiy åå‰Šå¼±äº†pixelä¹‹é—´çš„å…³ç³»ï¼Œåªè¡¥å……äº†Patché—´çš„ä½ç½®ä¿¡æ¯ã€‚\nCNNã€Transformer ã€CNN\u0026amp;Transformer\nåœ¨æ¯ä¸ªé˜¶æ®µï¼Œäº§ç”Ÿå±‚æ¬¡è¡¨ç¤º \u0026ndash; é‡‘å­—å¡”ç»“æ„\nå®šåˆ¶çš„Stem Blockå†…éƒ¨æ··åˆCNNå’ŒMHSA â¤ï¸ [DWConv(Skip-con) + SR-MHSA(Skip-con) + IRFFN(Skip-Conv)] Conformer - 2020 Conformer: Convolution-augmented Transformer for Speech Recognition\né›†æˆäº† CNN å’Œ Transformer ç»„ä»¶ä»¥è¿›è¡Œç«¯åˆ°ç«¯è¯†åˆ«çš„æ¶æ„\nåˆ†æï¼š\nè™½ç„¶ Transformer æ“…é•¿å¯¹è¿œç¨‹å…¨å±€ä¸Šä¸‹æ–‡è¿›è¡Œå»ºæ¨¡ï¼Œä½†å®ƒä»¬æå–ç»†ç²’åº¦å±€éƒ¨ç‰¹å¾æ¨¡å¼çš„èƒ½åŠ›è¾ƒå·®ï¼› å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰åˆ©ç”¨å±€éƒ¨ä¿¡æ¯ï¼Œåœ¨æœ¬åœ°çª—å£ä¸Šå­¦ä¹ å…±äº«çš„åŸºäºä½ç½®çš„å†…æ ¸ï¼Œèƒ½å¤Ÿæ•è·è¾¹ç¼˜å’Œå½¢çŠ¶ç­‰ç‰¹å¾ã€‚ä½¿ç”¨æœ¬åœ°è¿æ¥çš„é™åˆ¶ä¹‹ä¸€æ˜¯éœ€è¦æ›´å¤šçš„å±‚æˆ–å‚æ•°æ¥æ•è·å…¨å±€ä¿¡æ¯ã€‚ â­ å°†å·ç§¯ä¸è‡ªæ³¨æ„åŠ›æœ‰æœºç»“åˆèµ·æ¥ã€‚ æˆ‘ä»¬å‡è®¾å…¨å±€å’Œå±€éƒ¨äº¤äº’å¯¹äºå‚æ•°æ•ˆç‡éƒ½å¾ˆé‡è¦ã€‚ ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§è‡ªæ³¨æ„åŠ›å’Œå·ç§¯çš„æ–°é¢–ç»„åˆï¼Œå°†å®ç°ä¸¤å…¨å…¶ç¾\narchitecture\nConvolution Module\nFeed Forward Module\nPathFormer - ICLR 2024 PATHFORMER: MULTI-SCALE TRANSFORMERS WITH ADAPTIVE PATHWAYS FOR TIME SERIES FORECASTING\narchitecture\nDual-Attention\nMobile-Former - CVPR 2022 Mobile-Former: Bridging MobileNet and Transformer\nåŠ¨æœºï¼š\nå¦‚ä½•è®¾è®¡é«˜æ•ˆçš„ç½‘ç»œæ¥æœ‰æ•ˆåœ°ç¼–ç æœ¬åœ°å¤„ç†å’Œå…¨å±€äº¤äº’ï¼Ÿ\næœ€è¿‘å·¥ä½œï¼šä¸²è”ç»„åˆå·ç§¯å’Œè§†è§‰å˜æ¢å™¨çš„å¥½å¤„ï¼Œæ— è®ºæ˜¯åœ¨å¼€å§‹æ—¶ä½¿ç”¨å·ç§¯è¿˜æ˜¯å°†å·ç§¯äº¤ç»‡åˆ°æ¯ä¸ªå˜æ¢å™¨å—ä¸­\nè§†è§‰å˜æ¢å™¨ï¼ˆViTï¼‰[10,34]å±•ç¤ºäº†å…¨å±€å¤„ç†çš„ä¼˜åŠ¿ï¼Œå¹¶å®ç°äº†æ¯” CNN æ˜¾ç€çš„æ€§èƒ½æå‡ï¼Œå¦‚ä½•åœ¨è®¡ç®—èµ„æºæˆ–è€…å‚æ•°é‡æœ‰é™çš„æƒ…å†µä¸‹å……åˆ†æŒ–æ˜ç»“åˆä¸¤è€…çš„ä¼˜åŠ¿ï¼Œ=\u0026gt; parameters efficient\nè´¡çŒ®ï¼š\nå¹¶è¡Œè®¾è®¡ + åŒè·¯æ¡¥æ¥ï¼› åˆ©ç”¨äº† MobileNet åœ¨æœ¬åœ°å¤„ç†å’Œ Transformer åœ¨å…¨å±€äº¤äº’æ–¹é¢çš„ä¼˜åŠ¿ï¼›å®ç°å±€éƒ¨å’Œå…¨å±€ç‰¹å¾çš„åŒå‘èåˆ å…¨å±€Tokenåªæœ‰åˆå§‹åŒ–ä¸º0çš„å¾ˆå°‘çš„Tokenï¼Œåˆ©ç”¨Cross Attention è¿›è¡Œäº¤äº’ â­å¤§æ¦‚å°±æ˜¯åœ¨MobileNetä¸ºä¸»å¹²çš„åŸºç¡€ä¸Šæ·»åŠ ViTå…¨å±€Tokençš„ä¿¡æ¯æ³¨å…¥ architecture\nInteraction\npseudo code\n1q = FC(token).view(), k, v = x.view()\t# shape =\u0026gt; batch, num_token, dim_token; 2do Local2Global-CrossAttn() 3 4token =\u0026gt; MHSA() 5 6x = MobileNetBlock() 7 8q = x.view(), k, v = FC(token).view() 9do Global2Local-CrossAttn() ViT Adapter - ICLR 2023 VISION TRANSFORMER ADAPTER FOR DENSE PREDICTIONS\nåŠ¨æœº\nåœ¨ä¸æ”¹å˜åŸæœ‰ViTçš„åŸºç¡€ä¸Š(åˆ©ç”¨å¤§è§„æ¨¡é¢„è®­ç»ƒå‚æ•°)ï¼Œæ·»åŠ è¾…åŠ©å™¨å¸®åŠ©Transformerå­¦ä¹ å¼±é¡¹ï¼›ã€ä½¿ç”¨ç°æˆçš„é¢„è®­ç»ƒ ViT é€‚åº”å¯†é›†çš„é¢„æµ‹ä»»åŠ¡ã€‘\nViT å•å°ºåº¦å’Œä½åˆ†è¾¨ç‡è¡¨ç¤ºçš„å¼±ç‚¹ =\u0026gt; æ³¨å…¥ä¸€äº›å¤šå°ºåº¦ç‰¹å¾(CNN)ç»™å•å°ºåº¦çš„ViT\n\u0026hellip;è¡¨æ˜å·ç§¯å¯ä»¥å¸®åŠ© Transformer æ›´å¥½åœ°æ•è·å±€éƒ¨ç©ºé—´ä¿¡æ¯ï¼Œå¯¹ä¸è¡¥ä¸åµŒå…¥å±‚å¹¶è¡Œçš„å›¾åƒçš„å±€éƒ¨ç©ºé—´ä¸Šä¸‹æ–‡è¿›è¡Œå»ºæ¨¡ï¼Œä»¥å…æ”¹å˜ ViT çš„åŸå§‹æ¶æ„ã€‚\nè´¡çŒ®\nViT Adapter: [Spatial Prior Module, Spatial Feature Injector, Multi-Scale Feature Extractor] paradigm compare\narchitecture\nï¼ˆcï¼‰ç”¨äºæ ¹æ®è¾“å…¥å›¾åƒå¯¹å±€éƒ¨ç©ºé—´ä¸Šä¸‹æ–‡è¿›è¡Œå»ºæ¨¡çš„ç©ºé—´å…ˆéªŒæ¨¡å—ï¼Œ Adapter: Spatial feature token set; ViT: origin feature map; ï¼ˆdï¼‰ç”¨äºå°†ç©ºé—´å…ˆéªŒå¼•å…¥ViTçš„ç©ºé—´ç‰¹å¾æ³¨å…¥å™¨ ï¼ˆeï¼‰ç”¨äºä»å•ä¸ªå›¾åƒé‡æ–°ç»„ç»‡å¤šå°ºåº¦ç‰¹å¾çš„å¤šå°ºåº¦ç‰¹å¾æå–å™¨ -ViT çš„å°ºåº¦ç‰¹å¾ é‡‡ç”¨ç¨€ç–æ³¨æ„åŠ›æ¥é™ä½è®¡ç®—æˆæœ¬\npseudo code\n1# Spatial prior module 2X_vit = ResnetBlock(x) 3x1 = PointConv(Conv(X_vit))\t# down-sample: HW/8^2 and project channel to D dimension 4x2 = PointConv(Conv(x2))\t# down-sample: HW/16^2\tto D dimension 5x3 = PointConv(Conv(x3))\t# down-sample: HW/32^2\tto D dimension 6X_vit = torch.cat([x1, x2, x3], dim=num_token) 7 8# injector // spatial feature to ViT 9q = FC(X_vit).view(...), k, v = FC(X_spm).view(...)\t# spm: spatial prior module 10do Cross-Attn() 11 12# Multi-Scale Feature Extractor 13q = FC(X_spm).view(...), k, v = FC(X_vit).view(...)\t# analyzeï¼š\nâ­ ç ”ç©¶è¡¨æ˜ï¼ŒViT å‘ˆç°å‡ºå­¦ä¹ ä½é¢‘å…¨å±€ä¿¡å·çš„ç‰¹å¾(æ•´ä½“ã€æ¨¡ç³Šå’Œç²—ç³™)ï¼Œè€Œ CNN åˆ™å€¾å‘äºæå–é«˜é¢‘ä¿¡æ¯ï¼ˆä¾‹å¦‚å±€éƒ¨è¾¹ç¼˜å’Œçº¹ç†ï¼‰ visualize\nå‚…é‡Œå¶å˜æ¢ç‰¹å¾å›¾çš„å‚…é‡Œå¶é¢‘è°±å’Œç›¸å¯¹å¯¹æ•°å¹…åº¦ï¼ˆè¶…è¿‡ 100 å¼ å›¾åƒçš„å¹³å‡å€¼ï¼‰ =\u0026gt; è¡¨æ˜ ViT-Adapter æ¯” ViT æ•è·æ›´å¤šçš„é«˜é¢‘ä¿¡å·\næˆ‘ä»¬è¿˜å¯è§†åŒ–äº†å›¾5ï¼ˆbï¼‰ï¼ˆcï¼‰ä¸­çš„stride-8ç‰¹å¾å›¾ï¼Œè¿™è¡¨æ˜ViTçš„ç‰¹å¾æ˜¯æ¨¡ç³Šå’Œç²—ç³™çš„\nInception Transformer - NeurIPS 2022 Inception Transformer\nåŠ¨æœºï¼š\nTransformer å…·æœ‰å¾ˆå¼ºçš„å»ºç«‹è¿œç¨‹ä¾èµ–å…³ç³»çš„èƒ½åŠ›ï¼Œä½†æ— æ³•æ•è·ä¸»è¦ä¼ è¾¾å±€éƒ¨ä¿¡æ¯çš„é«˜é¢‘ï¼›\nViT åŠå…¶å˜ä½“éå¸¸æœ‰èƒ½åŠ›æ•è·è§†è§‰æ•°æ®ä¸­çš„ä½é¢‘ï¼Œä¸»è¦åŒ…æ‹¬åœºæ™¯æˆ–å¯¹è±¡çš„å…¨å±€å½¢çŠ¶å’Œç»“æ„ï¼Œä½†å¯¹äºå­¦ä¹ é«˜é¢‘ï¼ˆä¸»è¦åŒ…æ‹¬å±€éƒ¨è¾¹ç¼˜å’Œçº¹ç†ï¼‰ä¸æ˜¯å¾ˆå¼ºå¤§(CNNså¾ˆæ“…é•¿ï¼Œå®ƒä»¬é€šè¿‡æ„Ÿå—é‡å†…çš„å±€éƒ¨å·ç§¯è¦†ç›–æ›´å¤šçš„å±€éƒ¨ä¿¡æ¯ï¼Œä»è€Œæœ‰æ•ˆåœ°æå–é«˜é¢‘è¡¨ç¤º)ï¼›\næœ€è¿‘çš„ç ”ç©¶[21-25]è€ƒè™‘åˆ°CNNå’ŒViTçš„äº’è¡¥ä¼˜åŠ¿ï¼Œå°†å®ƒä»¬é›†æˆèµ·æ¥ã€‚ ä¸€äº›æ–¹æ³•[21,22,24,25]ä»¥ä¸²è¡Œæ–¹å¼å †å å·ç§¯å±‚å’Œæ³¨æ„åŠ›å±‚ï¼Œä»¥å°†å±€éƒ¨ä¿¡æ¯æ³¨å…¥å…¨å±€ä¸Šä¸‹æ–‡ä¸­ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§ä¸²è¡Œæ–¹å¼ä»…åœ¨ä¸€å±‚ä¸­å¯¹ä¸€ç§ç±»å‹çš„ä¾èµ–å…³ç³»ï¼ˆå…¨å±€æˆ–å±€éƒ¨ï¼‰è¿›è¡Œå»ºæ¨¡ï¼Œå¹¶ä¸”åœ¨å±€éƒ¨æ€§å»ºæ¨¡æœŸé—´ä¸¢å¼ƒå…¨å±€ä¿¡æ¯ï¼Œåä¹‹äº¦ç„¶ã€‚â¤ï¸ æ¯ä¸ªæ¨¡å—éƒ½ä¸å¤Ÿå…¨é¢=\u0026gt;æ¨¡å‹è¦ä¹ˆåªæœ‰å±€éƒ¨æ„ŸçŸ¥èƒ½åŠ›ï¼Œè¦ä¹ˆåªæœ‰å…¨å±€å»ºæ¨¡èƒ½åŠ› =\u0026gt; åœ¨ECGä¸­ï¼Œæœ‰äº›ç–¾ç—…ä¸ä»…ä»…æ˜¯å±€éƒ¨æˆ–å…¨å±€çš„ç—…ç†ç‰¹å¾ï¼Œè€Œä¸”æ˜¯èŠ‚å¾‹å¼‚å¸¸ä¼´éšç€æ³¢å½¢å½¢æ€å¼‚å¸¸ï¼›ä»è¿™ä¸€è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå……åˆ†çš„åˆ©ç”¨Transformerçš„å…¨å±€ä¾èµ–æ„ŸçŸ¥èƒ½åŠ›å’ŒCNNçš„å¼ºå¤§çš„å±€éƒ¨æ„ŸçŸ¥èƒ½åŠ›ï¼Œäº¤äº’èåˆæœ‰åŠ›ç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼› ã€å°±åƒåœ¨äººç±»è§†è§‰ç³»ç»Ÿä¸­ä¸€æ ·ï¼Œé«˜é¢‘åˆ†é‡çš„ç»†èŠ‚æœ‰åŠ©äºè¾ƒä½å±‚æ•è·è§†è§‰åŸºæœ¬ç‰¹å¾ï¼Œå¹¶é€æ¸æ”¶é›†å±€éƒ¨ä¿¡æ¯ä»¥å¯¹è¾“å…¥æœ‰å…¨å±€çš„ç†è§£ã€‘\nå±‚çº§å¼ç½‘ç»œï¼Œå¤šå°ºåº¦åˆ†è¾¨ç‡ç‰¹å¾å›¾ï¼Œæ¯éƒ¨åˆ†å‡èƒ½å…¨å±€+å±€éƒ¨æ„ŸçŸ¥ï¼›å¹¶ä¸”è®¾è®¡é¢‘ç‡æ–œå¡ç»“æ„ =\u0026gt; åº•å±‚æ›´æ³¨é‡é«˜é¢‘ä¿¡æ¯(ç»†èŠ‚ä¿¡æ¯ï¼Œå±€éƒ¨æ¨¡å¼ã€çº¹ç†è¾¹ç¼˜)ï¼›é«˜å±‚æ›´æ³¨é‡ä½é¢‘ä¿¡æ¯(æ•´ä½“è½®å»“ï¼Œå…¨å±€)\nåˆ›æ–°ç‚¹ï¼š\nTransformerä¸­çš„Multi-Head Self-Attention =\u0026gt; Inception Mixer ; æŒ‰channelåˆ†ä¸¤ç»„ï¼š1. ä½é¢‘ç»„ï¼›2. é«˜é¢‘ç»„ï¼› ä½é¢‘ç»„ æ± åŒ–ç¨€ç–æ³¨æ„åŠ›ï¼Œä½†ä»…æœ€ä½ä¸¤å—ç”¨ï¼› é«˜é¢‘ç»„ [MaxPool, DWConv]ï¼› é¢‘ç‡æ–œå¡ç»“æ„: é«˜é¢‘ç»„\u0026gt;ä½é¢‘ç»„ =\u0026gt; é«˜é¢‘ç»„\u0026lt;ä½é¢‘ç»„ åº•å±‚åœ¨æ•è·é«˜é¢‘ç»†èŠ‚æ–¹é¢å‘æŒ¥æ›´å¤šä½œç”¨ï¼Œè€Œé¡¶å±‚åœ¨å»ºæ¨¡ä½é¢‘å…¨å±€ä¿¡æ¯æ–¹é¢å‘æŒ¥æ›´å¤šä½œç”¨ architecture\nInception Mixer\npseudo code\n1# x : [batch, channel, width, hight] 2x_h, x_l = torch.chunk(x, chunks=2, dim=1) 3x_h1, x_h2 = torch.chunk(x_h, chunks=2, dim=1) 4 5y_h1 = FC(MaxPool(x_h1)) 6y_h2 = DWConv(FC(x_h2)) 7y_l = MSA(AvePooling (X_l)) 8 9Y = X + ITM(LN(X)) # ITM : Inception Mixer 10H = Y + FFN(LN(Y)) å±€éƒ¨|é«˜é¢‘ \u0026amp; å…¨å±€|ä½é¢‘ - å‚…é‡Œå¶è°±\nTransNeXt - CVPR 2024 TransNeXt: Robust Foveal Visual Perception for Vision Transformers\nanalysis\nç›®å‰çš„ç¨€ç–Attentionï¼š Local Attention[é™åˆ¶è®¡ç®—é‡ï¼ŒnÃ—å›ºå®šçª—å£è®¡ç®—é‡]: window-level attention, =\u0026gt; cross-window attn information exchange éœ€è¦å †å å¾ˆæ·±æ‰èƒ½å®ç°å…¨å±€æ„ŸçŸ¥ patially downsamplesã€é™ä½è®¡ç®—çš„Tokenæ•°é‡ã€‘: pool or dwconv =\u0026gt; ä¿¡æ¯ä¸¢å¤±é—®é¢˜ï¼› ã€ç»†ç²’åº¦(ä¸¢å¤±)=\u0026gt; ç²—ç²’åº¦ã€‘ motivation\nâ­ è§‚å¯Ÿï¼šç”Ÿç‰©è§†è§‰å¯¹è§†è§‰ç„¦ç‚¹å‘¨å›´çš„ç‰¹å¾å…·æœ‰è¾ƒé«˜çš„æ•é”åº¦ï¼Œè€Œå¯¹è¿œå¤„çš„ç‰¹å¾å…·æœ‰è¾ƒä½çš„æ•é”åº¦ã€‚ ç»“åˆwindow-level attn \u0026amp; spatial downsample attnï¼Œä¸´è¿‘çš„tokenæ‰§è¡Œpixel-level attnï¼Œç¨è¿œçš„åŒºåŸŸæ‰§è¡Œpool-level attn, å®ç°è§†è§‰ä»¿ç”Ÿèšç„¦attn contribution\nfocus attn ã€å±€éƒ¨ç»†ç²’åº¦ï¼Œå…¨å±€ç²—ç²’åº¦ã€‘\nfocus attn å‡çº§ aggregated attention ã€QKV æ³¨æ„åŠ›ã€LKV æ³¨æ„åŠ›å’Œ QLV æ³¨æ„åŠ›ç»Ÿä¸€ã€‘\nQLV ä¸ä¼ ç»Ÿçš„ QKV æ³¨æ„åŠ›æœºåˆ¶ä¸åŒï¼Œå®ƒç ´åäº†é”®å’Œå€¼ä¹‹é—´çš„ä¸€å¯¹ä¸€å¯¹åº”å…³ç³»ï¼Œä»è€Œä¸ºå½“å‰æŸ¥è¯¢å­¦ä¹ æ›´å¤šéšå«çš„ç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚ LKVï¼šå¢å¼ºè¡¨è¾¾èƒ½åŠ›ï¼Œé€šè¿‡å¼•å…¥å¯å­¦ä¹ çš„é”®å’Œå€¼ï¼Œæ¨¡å‹å¯ä»¥å­¦ä¹ åˆ°æ›´å¤šæœ‰ç”¨çš„ç‰¹å¾ï¼Œå¢å¼ºäº†å¯¹å¤æ‚å…³ç³»çš„å»ºæ¨¡èƒ½åŠ› length-scaled cosine attention ã€åŒè·¯æ³¨æ„åŠ›concatç»è¿‡åŒä¸€ä¸ªsoftmaxã€‘\nconvolutional GLUæ›¿æ¢MLP\narchitecture\nleft figure: focus attn; right figure: aggregated attn(add QKV-attnã€LKV-attnã€QLV-attn)\nå…±äº«åŒä¸€ä¸ªSoftmaxï¼ˆä½œç”¨å¯èƒ½æ˜¯è¿™é‡Œè¿›è¡Œå¤šæ³¨æ„åŠ›çš„åˆ¶çº¦äº¤äº’ï¼‰\nConvGLU: å·ç§¯ GLU (ConvGLU) ä¸­çš„æ¯ä¸ªæ ‡è®°éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„é—¨æ§ä¿¡å·ï¼ŒåŸºäºå…¶æœ€æ¥è¿‘çš„ç»†ç²’åº¦ç‰¹å¾ã€‚ è¿™è§£å†³äº†SEæœºåˆ¶ä¸­å…¨å±€å¹³å‡æ± åŒ–è¿‡äºç²—ç²’åº¦çš„ç¼ºç‚¹ã€‚ å®ƒè¿˜æ»¡è¶³äº†ä¸€äº›æ²¡æœ‰ä½ç½®ç¼–ç è®¾è®¡ã€éœ€è¦æ·±åº¦å·ç§¯æä¾›ä½ç½®ä¿¡æ¯çš„ViTæ¨¡å‹çš„éœ€æ±‚ã€‚\nEfficientViT - CVPR 2023 EfficientViT Memory Efficient Vision Transformer with Cascaded Group Attention\næƒè¡¡æ€§èƒ½å’Œä»£ä»·\nmotivation\nå‘ç°ç°æœ‰ Transformer æ¨¡å‹çš„é€Ÿåº¦é€šå¸¸å—åˆ°å†…å­˜ä½æ•ˆæ“ä½œçš„é™åˆ¶ï¼Œå°¤å…¶æ˜¯ MHSA ä¸­çš„å¼ é‡æ•´å½¢å’Œé€å…ƒç´ å‡½æ•°; è™½ç„¶Transformeræ€§èƒ½å¾ˆå¥½ï¼Œä½†æ˜¯ä»£ä»·å¾ˆé«˜ï¼Œä¸é€‚åˆå®æ—¶åº”ç”¨; =\u0026gt;ä¼˜åŒ–;\nå‘ç°æ³¨æ„åŠ›å›¾åœ¨å¤´éƒ¨ä¹‹é—´å…·æœ‰é«˜åº¦ç›¸ä¼¼æ€§ï¼Œå¯¼è‡´è®¡ç®—å†—ä½™ã€‚// æ˜¾å¼åˆ†è§£æ¯ä¸ªå¤´çš„è®¡ç®—å¯ä»¥ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼ŒåŒæ—¶æé«˜è®¡ç®—æ•ˆç‡\ncontribution\nè®¾è®¡äº†ä¸€ç§å…·æœ‰ä¸‰æ˜æ²»å¸ƒå±€çš„æ–°æ„å»ºå—ï¼Œå³åœ¨é«˜æ•ˆ FFN å±‚ä¹‹é—´ä½¿ç”¨å•ä¸ªå†…å­˜ç»‘å®šçš„ MHSAï¼Œä»è€Œæé«˜å†…å­˜æ•ˆç‡ï¼ŒåŒæ—¶å¢å¼ºé€šé“é€šä¿¡; æå‡ºäº†ä¸€ä¸ªçº§è”çš„ç»„æ³¨æ„åŠ›æ¨¡å—ï¼Œä¸ºæ³¨æ„åŠ›å¤´æä¾›å®Œæ•´ç‰¹å¾çš„ä¸åŒåˆ†å‰²ï¼Œè¿™ä¸ä»…èŠ‚çœäº†è®¡ç®—æˆæœ¬ï¼Œè€Œä¸”æé«˜äº†æ³¨æ„åŠ›å¤šæ ·æ€§ã€‚ architecture\nToken Interactionï¼šDWConvï¼Œå¢å¼ºå±€éƒ¨äº¤äº’èƒ½åŠ›ï¼Œå¼•å…¥å±€éƒ¨ç»“æ„ä¿¡æ¯çš„å½’çº³åå·®æ¥å¢å¼ºæ¨¡å‹èƒ½åŠ›\nä¸‰æ˜æ²»ç»“æ„ä¸­ï¼Œå±€éƒ¨å»ºæ¨¡å’Œå…¨å±€Attn, å³[Token Interaction, FFN][Cascaded Group Attention][Token Interaction, FFN]å †å ä¸æ˜¯1:1:1, è€Œæ˜¯N:1:N, Why? because Attention è®¡ç®—é‡å¤ªå¤§äº†ï¼Œèƒ½å°‘ç”¨å°±å°‘ç”¨ã€‚\nCascaded Group Attention pseudo code\n1feature_group = x.chunk(len(self.qkv_group), dim=1) # split head 2feature = feature_group[0]\t# first head 3 4feature_out = [] 5for i, qkv in enumerate(self.qkv_group): 6 if i \u0026gt; 0: 7 feature = feature + feature_group[i] # Cascaded Group 8 Q, K, V = qkv(feature).view().permute() # shape: B, H, N, C/H 9 Q = DWConv[i](Q) # enhance Query Token Set 10\tout = (Q@K.transpose(-2, -1) Ã— scale)@V 11 feature_out.append(out) 12out = torch.cat(feature_out, 1) 13FC(out) ä¸åŒäºä¼ ç»ŸAttnï¼Œè¿™é‡Œå…ˆåˆ†å¤´å†çº¿æ€§æ˜ å°„ï¼Œå¤´çš„ä¿¡æ¯ä¼šè¶Šæ¥è¶Šä¸°å¯Œã€‚ å¹¶ä¸”å®ç°ä¸­(Cascaded Group Attention in Window-level Attention )\nEMO - ICCV 2023 Rethinking Mobile Block for Efficient Attention-based Models\nç›®æ ‡ï¼šè½»é‡çº§ CNN è®¾è®¡é«˜æ•ˆçš„æ··åˆæ¨¡å‹ï¼Œå¹¶åœ¨æƒè¡¡ç²¾åº¦ã€å‚æ•°å’Œ FLOP çš„æƒ…å†µä¸‹è·å¾—æ¯”åŸºäº CNN çš„æ¨¡å‹æ›´å¥½çš„æ€§èƒ½\nå‡ºå‘ç‚¹ï¼šæˆ‘ä»¬èƒ½å¦ä¸ºä»…ä½¿ç”¨åŸºæœ¬ç®—å­çš„åŸºäºæ³¨æ„åŠ›çš„æ¨¡å‹æ„å»ºä¸€ä¸ªè½»é‡çº§çš„ç±»ä¼¼ IRB çš„åŸºç¡€è®¾æ–½ï¼Ÿ\nåŸºæœ¬ç®—å­ç»“æ„å¯¹æ¯”\nMulti-head self attention: çº¿æ€§æ˜ å°„qkvï¼ŒMHSA, æŠ•å½±å›æ¥\nFeed Forward Network: Linear-Linear\nInverted Residual Block: Conv1x1-DWConv-Conv1x1\n=\u0026gt; ç»¼åˆè€ƒé‡ æå‡ºåŸºæœ¬ç®—å­Meta Mobile Block\nMeta Former Block vs Inverted Residual Block\næ›´åŠ ç»†è‡´çš„æŠ½è±¡\niRMBï¼ˆInverted Residual Mobile Blockï¼‰\nï¼ï¼ï¼ ç”±äº MHSA æ›´é€‚åˆå¯¹æ›´æ·±å±‚çš„è¯­ä¹‰ç‰¹å¾è¿›è¡Œå»ºæ¨¡ï¼Œå› æ­¤æˆ‘ä»¬ä»…åœ¨ä¹‹å‰çš„å·¥ä½œä¹‹åçš„ stage-3/4 ä¸­æ‰“å¼€å®ƒ ã€‚\nConv:\nBN+SiLUä¸DWConvç»“åˆï¼› W-MHSA(window-level attention æ›´åŠ é«˜æ•ˆ):\nLN+GeLUä¸EW-MHSAç»“åˆã€‚\nè§£é‡ŠEW-MHSA\nå› ä¸ºiRMBï¼Œä¼šå…ˆå‡ç»´ï¼Œå¯¼è‡´MHSAè®¡ç®—é‡å˜é«˜ï¼Œ Q,Kç»´åº¦ä¸å˜ï¼Œè€ŒVçš„ç»´åº¦å˜é•¿äº†ï¼Œæ‹¿attn-scoreåŠ æƒæ±‚å’Œæ—¶åº”ç”¨çš„æ˜¯æ‰©å±•V æ·±åº¦è®¾è®¡ï¼Œçµæ´»çš„è®¾è®¡\nFocal Attention - NeurIPS 2021 Focal Attention for Long-Range Interactions in Vision Transformers\nè§‚å¯Ÿï¼š\nå›¾ 1ï¼šå·¦ï¼šDeiT-Tiny æ¨¡å‹ [55] ç¬¬ä¸€å±‚ä¸­ç»™å®šæŸ¥è¯¢å—ï¼ˆè“è‰²ï¼‰å¤„ä¸‰ä¸ªå¤´çš„æ³¨æ„åŠ›å›¾çš„å¯è§†åŒ–ã€‚ å³å›¾ï¼šç„¦ç‚¹æ³¨æ„åŠ›æœºåˆ¶çš„è¯´æ˜æ€§æè¿°ã€‚ ä½¿ç”¨ä¸‰ä¸ªç²’åº¦çº§åˆ«æ¥ç»„æˆè“è‰²æŸ¥è¯¢çš„æ³¨æ„åŒºåŸŸã€‚\nåˆ›æ–°ç‚¹ï¼š\nClose =\u0026gt; Far Fine =\u0026gt; Coarse å›¾ç¤ºï¼š\nä¼ªä»£ç ï¼š\n11. ä½¿ç”¨torch.roll å†æŒ‰çª—å£åˆ’åˆ† =\u0026gt; æ”¶é›†ç»†ç²’åº¦å‘¨è¾¹Token, å†ä½¿ç”¨maskæ©ç æ‰å¤šä½™ä¸éœ€è¦çš„Token 22. å…ˆåˆ†çª—å£ï¼Œæ‰§è¡Œçª—å£å†…Poolï¼Œç”Ÿæˆè¶…ç²—ç²’åº¦Token 3 4Q: çª—å£å†…Token 5K, V: çª—å£å†…Token + å‘¨è¾¹ç»†ç²’åº¦Token + Pool-Token CloFormer - CVPR 2023 Rethinking Local Perception in Lightweight Vision Transformer\narchitecture\nå±€éƒ¨+å…¨å±€ æ„ŸçŸ¥å¹¶è¡Œ\nå±€éƒ¨æ„ŸçŸ¥ï¼Œç±»ä¼¼äºCNNä¸­çš„å·ç§¯æ³¨æ„åŠ›ç”¨åœ¨è‡ªæ³¨æ„åŠ›åˆ†æ”¯ä¸­\nFFN å†…è¿½åŠ å±€éƒ¨æ„ŸçŸ¥å¢å¼ºæ¨¡å—\nMetaFormer - 2023 æˆ‘ä»¬å¹¶ä¸è¯•å›¾å¼•å…¥æ–°é¢–çš„ä»¤ç‰Œæ··åˆå™¨ï¼Œè€Œåªæ˜¯å°†ä»¤ç‰Œæ··åˆå™¨æŒ‡å®šä¸ºæœ€åŸºæœ¬æˆ–å¸¸ç”¨çš„è¿ç®—ç¬¦æ¥æ¢æµ‹ MetaFormer çš„èƒ½åŠ›\nâ­æ¢ç´¢Meta Blockçš„æ½œåŠ›ï¼\n1X = X + TokenMixer(Norm(X)) 2X = X + ChannelMixer(Norm(X)) MaxViT - ECCV 2022 MaxViT: Multi-Axis Vision Transformer\nåŠ¨æœºï¼šè§£å†³Self-Attentionå¹³æ–¹å¤æ‚åº¦é—®é¢˜\næ¡†æ¶ï¼š\n1ï¸âƒ£ MobileNetV2ä¸­çš„å€’æ®‹å·®å— =\u0026gt; æä¾›å¢å¼ºå±€éƒ¨æ„ŸçŸ¥ \u0026amp; éšå¼ç¼–ç ä½ç½®ä¿¡æ¯\n2ï¸âƒ£ Block-Attention =\u0026gt; window-level attention âŒ é™åˆ¶æ„Ÿå—é‡ â­ é™ä½è®¡ç®—é‡\n3ï¸âƒ£ Grid-Attention =\u0026gt; æ„Ÿå—é‡éåŠå…¨å±€çš„æ‰©å¼ å·ç§¯åšæ³• 1. åˆ†çª—å£ 2. æ”¶é›†æ¯ä¸ªçª—å£ç›¸åŒæ¬¡åºçš„Tokenæˆç»„. 3. ç»„å†…è®¡ç®—æ³¨æ„åŠ›\nAttention illustration\nCiT - ICCV 2021 Incorporating Convolution Designs into Visual Transformers\nå±€éƒ¨å¢å¼º\nå°±æ˜¯Inverted Resiual Block [Conv1Ã—1 =\u0026gt; Depth-wise Conv3Ã—3 =\u0026gt; Conv1Ã—1] å¯¹Tokenè¿›è¡Œå±€éƒ¨ä¿¡æ¯å¢å¼º\næ¡†æ¶ï¼š\nâ­åˆ©ç”¨äº†æ¯ä¸ªStageä¸­çš„Class Tokenï¼Œè¿™æ ·å¯ä»¥æœ‰å±‚çº§å¼ä¿¡æ¯ï¼Œè€Œä¸”æ¢¯åº¦ä¼šé€šè¿‡è¿™ä¸ªCLS Tokenç›´æ¥ä¼ é€’ç»™å‰é¢éƒ¨åˆ†\nBi-Interaction Light-ViT Lightweight Vision Transformer with Bidirectional Interaction\nå›¾ç¤ºï¼š\næ¡†æ¶ï¼š\nâ­æƒ³æ³•å¾ˆè¶…å‰â­\nå±€éƒ¨ä¸å…¨å±€çš„ç›¸äº’è°ƒåˆ¶\nUniRepLKNet UniRepLKNet: A Universal Perception Large-Kernel ConvNet for Audio, Video, Point Cloud, Time-Series and Image Recognition\nâ­è¶…å¤§å·ç§¯æ ¸ Conv winwinwin\nå½“æˆ‘ä»¬å‘å°å†…æ ¸ ConvNet æ·»åŠ  3Ã—3 å·ç§¯æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›å®ƒåŒæ—¶äº§ç”Ÿä¸‰ç§æ•ˆæœ\nä½¿æ„Ÿå—é‡æ›´å¤§ï¼Œ å¢åŠ ç©ºé—´æ¨¡å¼çš„æŠ½è±¡å±‚æ¬¡ï¼ˆä¾‹å¦‚ï¼Œä»è§’åº¦å’Œçº¹ç†åˆ°ç‰©ä½“çš„å½¢çŠ¶ï¼‰ é€šè¿‡ä½¿å…¶æ›´æ·±ï¼Œå¼•å…¥æ›´å¤šå¯å­¦ä¹ çš„å‚æ•°å’Œéçº¿æ€§æ¥æé«˜æ¨¡å‹çš„ä¸€èˆ¬è¡¨ç¤ºèƒ½åŠ› ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸ºå¤§å†…æ ¸æ¶æ„ä¸­çš„è¿™ä¸‰ç§å½±å“åº”è¯¥æ˜¯è§£è€¦çš„ï¼Œå› ä¸ºæ¨¡å‹åº”è¯¥åˆ©ç”¨å¤§å†…æ ¸çš„å¼ºå¤§ä¼˜åŠ¿â€”â€”èƒ½å¤Ÿçœ‹åˆ°å¹¿æ³›è€Œä¸æ·±å…¥çš„èƒ½åŠ›\nç”±äºåœ¨æ‰©å¤§ ERF(æ„Ÿå—é‡) æ–¹é¢ï¼Œå¢åŠ å†…æ ¸å¤§å°æ¯”å †å æ›´å¤šå±‚æ›´æœ‰æ•ˆï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å°‘é‡å¤§å†…æ ¸å±‚æ„å»ºè¶³å¤Ÿçš„ ERFï¼Œä»è€Œå¯ä»¥èŠ‚çœè®¡ç®—é¢„ç®—ä»¥ç”¨äºå…¶ä»–é«˜æ•ˆç»“æ„ åœ¨å¢åŠ ç©ºé—´æ¨¡å¼çš„æŠ½è±¡å±‚æ¬¡æˆ–æ€»ä½“ä¸Šå¢åŠ æ·±åº¦æ–¹é¢æ›´æœ‰æ•ˆã€‚\næ¡†æ¶ï¼š\né‡å‚æ•°åŒ–\nå—è®¾è®¡\nEdgeViTs - ECCV 2022 EdgeViTs: Competing Light-weight CNNs on Mobile Devices with Vision Transformers\næ¶æ„ï¼š\n# ç±»ä¼¼MobileViT\n1X = LocalAgg(Norm(X)) + X # 2Y = FFN(Norm(X)) + X 3Z = LocalProp(GlobalSparseAttn(Norm(Y))) + Y 4Xout = FFN(Norm(Z)) + Z å›¾ç¤ºï¼š ï¼ˆé€‰ä¸¾ =\u0026gt; ç²¾è‹± =\u0026gt; åˆ†å‘ï¼‰\nShuffleNet - CVPR 2018 å‡ºå‘ç‚¹ï¼šæ„å»ºé«˜æ•ˆæ¨¡å‹\nâ­V1â­\nç¼ºç‚¹å‘ç°ï¼š\n1=\u0026gt; Conv1x1 _ Norm+ReLU # Point-wise 2=\u0026gt; DWConv3x3 _ Norm # Depth-wise 3=\u0026gt; Conv1x1 _ Norm+ReLU # Point-wise 4 5# ä¸ºäº†é«˜æ•ˆ =\u0026gt; åªæ˜¯å°†Conv3x3 =\u0026gt; Conv1x1 6# =\u0026gt; ä½†æ˜¯Conv1x1å æ®äº†93.4%çš„ä¹˜æ³•-åŠ æ³• 7 8# =\u0026gt; ç›®æ ‡ï¼Œä¼˜åŒ–PWConv æ“ä½œå›¾ç¤ºï¼š\nå·ç§¯åˆ†ç»„å‡å°‘è®¡ç®—é‡ ï¼ˆâ­ä¼˜åŒ–ç»„é—´é€šä¿¡â­ï¼‰\nShuffleNet Basic Block\n(a) ResNet bottleneck unit \u0026lt;= DWConv (b) ä¼˜åŒ–PWConvï¼ˆGroup Convï¼‰ï¼Œå¹¶ä¸”Channel Shuffleï¼Œæ‰§è¡ŒGroup communication # æ— ä¸‹é‡‡æ ·ï¼Œè¾“å…¥è¾“å‡ºshapeä¸€è‡´ (c) æ’ç­‰æ˜ å°„å æ®ä¸€åŠçš„Channelï¼Œå¦ä¸€åŠç²¾ä¿®è¿‡çš„Feature Map â­V2â­\n=\u0026gt; åˆ†æå„ä¸ªç±»å‹æ“ä½œå æ®çš„è®¡ç®—æˆæœ¬\né™¤äº†FLOPSæŒ‡æ ‡ï¼Œååé‡å’Œé€Ÿåº¦æ›´ä¸ºç›´æ¥ç›´è§‚ï¼Œç¬¦åˆçœŸå®è´´åˆ‡\n(ä½¿ç”¨FLOPä½œä¸ºè®¡ç®—å¤æ‚æ€§çš„å”¯ä¸€åº¦é‡æ˜¯ä¸å¤Ÿçš„ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´æ¬¡ä¼˜è®¾è®¡)\n(å…·æœ‰ç›¸åŒFLOPçš„æ“ä½œå¯èƒ½å…·æœ‰ä¸åŒçš„è¿è¡Œæ—¶é—´)\nè®¿å­˜æ—¶é—´ \u0026lt;= å¹¶è¡Œåº¦ \u0026lt;= (a) basic shuffle net block -v1 (b) basic shuffle net block with downsample -v1 (c) v2 (d) v2 with downsample 1# shape equivalence 2x.shape = (B, 64, H, W) 3x1, x2 = channel-split(x) # =\u0026gt; (B, 32, H, W), (B, 32, H, W) 4# x1 ä½œä¸ºæ’ç­‰æ˜ å°„ï¼Œæ®‹å·®è¿æ¥ï¼Ÿ ç‰¹å¾å¤ç”¨ï¼Ÿ 5out = concat(x1, block(x2)) 6out = channel-shuffle(out) 7 8# with downsample 9x.shape = (B, 64, H, W) 10x1, x2 = x, x # =\u0026gt; (B, 64, H, W), (B, 64, H, W) 11out = concat(branch1(x1), branch2(x2)) 12out = channel-shuffle(out) ç‰¹å¾å¤ç”¨ç¤ºæ„å›¾ï¼š\n$$ l1-norm = \\sum_{i=1}^n{|v_i|} $$ ç›¸é‚»å±‚æ›´é«˜æ•ˆ\nå‡†ç¡®ç‡å‚æ•°è´¡çŒ®âœ”ï¸\nRepVGG - ReParams - CVPR 2021 ç»“æ„åˆ†æ\nå†…å­˜åˆ†æï¼š\n=\u0026gt; æƒè¡¡ï¼šæ€§èƒ½å’Œè®¡ç®—å†…å­˜æˆæœ¬\nTrainï¼šå¤šåˆ†æ”¯ç»“æ„ï¼Œæ€§èƒ½å¥½\nTestï¼š å•åˆ†æ”¯ç»“æ„ï¼Œé€Ÿåº¦å¿«ï¼Œå†…å­˜å°‘\nâ­â­â­é‡å‚åŒ–ï¼š\nç»†èŠ‚ï¼š\nä¸¾ä¾‹ç¬¬ä¸€ä¸ªå·ç§¯åçš„å…ƒç´ \nAgent Attention - ECCV 2024 Attnå›¾ç¤ºï¼š\nåšæ³•ï¼š\ncodeï¼š\n1q, k, v = qkv[0], qkv[1], qkv[2] 2 3agent_token = pool(q) 4 5agent_attn = softmax(agent_token * scale @ k.T + position_bias) 6agent_v = agent_attn @ v 7 8q_attn = self.softmax((q * self.scale) @ agent_tokens.T + agent_bias) 9x = q_attn @ agent_v 10 11x = x + self.dwc(v) 12 13 14# å¤æ‚åº¦ 15o(N * K) + o(N * K) äº«å— =\u0026gt; é«˜è¡¨è¾¾æ€§å’Œä½è®¡ç®—å¤æ‚åº¦çš„ä¼˜åŠ¿\nCF-ViT CF-ViT: A General Coarse-to-Fine Method for Vision Transformer\nå¯¹äºåˆ†ç±»ä»»åŠ¡ - ä¸éœ€è¦é‚£ä¹ˆç²¾ç»†çš„patch\nä¸¤æ­¥ç­–ç•¥ï¼š\nç²—ç²’åº¦patch=\u0026gt;ViT =\u0026gt; é¢„æµ‹å¾—åˆ† =è‹¥å¾—åˆ†å°äºè®¾å®šçš„ç½®ä¿¡åº¦\u0026gt; å°†é‡è¦åŒºåŸŸç»†åˆ† =ViT\u0026gt; æœ€ç»ˆé¢„æµ‹ ç‰¹å¾å¤ç”¨\nä¸é‡è¦åŒºåŸŸ =\u0026gt; å¤§å°ºåº¦ç²—ç•¥çš„Patch (å¯èƒ½æœ‰ä¸ç›¸å…³çš„èƒŒæ™¯å¹²æ‰°) é‡è¦åŒºåŸŸ =\u0026gt; å°å°ºåº¦ç²¾ç»†çš„patch(æ›´å¤šè¾¹ç¼˜ç»†èŠ‚) \u0026lt;= ç¬¬ä¸€é˜¶æ®µç²—ç•¥çš„Patchå……å½“åŒºåŸŸåµŒå…¥ åˆ©ç”¨ViTä¸­[CLS] Tokenä¸å…¶ä»–Tokençš„Attnç´¯è®¡åŒºåŸŸçš„é‡è¦æ€§\nGlobal-Attn = Î±Attn_l + (1-Î±)Attn_l+1\nTraining\nloss = CE(pf, y) + KL(pc,pf)\nè®­ç»ƒæ—¶æ¯æ¬¡å‡è¿›è¡ŒPatchç²¾ç»†æ¨ç†ã€‚ä½¿ç”¨ç²¾ç»†æ¨¡å‹æŒ‡å¯¼ç²—ç•¥Patchæ¨ç†\nConformer: ResNet + ViT å¹¶è¡Œç»“æ„ =\u0026gt; åŒæ—¶ä¿ç•™å±€éƒ¨å’Œå…¨å±€ç‰¹å¾ (ä¿æŒCNNå’ŒViTæ¶æ„çš„ä¼˜åŠ¿)\nTwinsï¼š [Local-Global] [LSA-FFN] =\u0026gt; [GSA-FFN]\nwindow-self-attention =\u0026gt; global-self-attention\nMSG-Transformer æ¶æ„\næœ‰è¶£ç‚¹ - Shuffle-Net ?\nå±€éƒ¨ä¿¡ä½¿ - ä¼ é€’ä¿¡æ¯\nDilateFormer IEEE TRANSACTIONS ON MULTIMEDIA \u0026ndash; sci-1\noverview\nnovel\nä¸åŒæ³¨æ„åŠ›å¤´éƒ¨ï¼Œè¿›è¡Œç»†å¾®çš„è°ƒæ•´\nScopeViT Pattern Recognition\nArchitecture\nnovel\nä¸²è¡Œäº¤å‰ï¼š[å¤šå°ºåº¦, å¤šä»½KV]+[dilated Attention] $$ ğ = ğ‘‹ğ–_ğ‘„,ğŠ_ğ‘– = ğ‘ƒ_ğ‘–ğ–^ğ¾_ğ‘–, ğ•_ğ‘– = ğ‘ƒ_ğ‘–ğ–^V_ğ‘– $$ 1 Queryä¸å˜ï¼Œ KVé€šè¿‡å¤šä¸ªä¸åŒå†…æ ¸å¤§å°çš„DWConvç”Ÿæˆå¤šå°ºåº¦ KV (ç²—ç²’åº¦)\n2 Stride Attention (ç»†ç²’åº¦)\nFastViT - ICCV overview\nStem:\n1reparams-conv å‰ä¸‰é˜¶æ®µï¼š\n1x = x + BN(DWConv(X)) # re-params 2x = x + (DWConv-\u0026gt;BN-\u0026gt;Conv1x1-\u0026gt;GELU-\u0026gt;Conv1x1) # ConvFFN æœ€åé˜¶æ®µï¼š\n1x = x + DWConv(X) # CPE convolution position embedding 2x = x + BN(Attention(X)) # Attention 3x = x + (DWConv-\u0026gt;BN-\u0026gt;Conv1x1-\u0026gt;GELU-\u0026gt;Conv1x1) # ConvFFN Integration of CNN + Attention Revisiting the Integration of Convolution and Attention for Vision Backbone\nnovel\n1Conv-part: [Conv1x1-\u0026gt;DWConv5x5-\u0026gt;Conv1x1] =\u0026gt; X_conv # ConvFFN ? 2Attn-part: 31. [èšç°‡] Clusteringï¼šX -\u0026gt; pooling -\u0026gt; cluster 42. [æç‚¼] cluster@X.T -\u0026gt; score@X -\u0026gt; cluster$ {è¿™é‡Œç”¨ç‚¹ç§¯ç›¸ä¼¼åº¦ä¸¾ä¾‹} 53. [å…¨å±€] cluster$ -\u0026gt; MHSA -\u0026gt; cluster$ 64. [åˆ†å‘] cluster$ -\u0026gt; cluster@score.T =\u0026gt; X_attn 7 8Y = X_conv + X_attn RepNeXt overview\n1Token-Mixer: 2 1. nn.Identity() 3 2. DWConv3x3 + (DWConv1x3 + DWConv3x1) 4 3. DWConv7x7 + DWConv3x5 + DWConv5x3 + (DWConv1x5 -\u0026gt; DWConv5x1) + (DWConv1x7 -\u0026gt; DWConv7x1) 5 4. (DWConv1x11 -\u0026gt; DWConv11x1) 6 7nn.Conv2d(in_channels, out_channels, kernel_size=(3, 5), padding=(1, 2), bias=bias, stride=stride) 8# Fusion =\u0026gt; é‡å‚æ•°åŒ–èåˆ InceptionNeXt\n1Block: [Token-Mixer -\u0026gt; Norm -\u0026gt; FFN] 2025/1/14 Tidying up\nViT with Deformable Attn Vision Transformer with Deformable Attention\nå…¨éƒ¨é‡‡æ ·ç‚¹å¦‚ä¸‹ï¼š\né«˜å¾—åˆ†keyé‡‡æ ·ç‚¹å¦‚ä¸‹\n1# 1. ç”Ÿæˆ query 2q = Conv1x1(X) 3offset = ConvKxK(q).conv1x1()=\u0026gt; // å°†é€šé“æ˜ å°„ä¸º2ï¼Œå¹¶ä¸”ä¸ºäº†æé«˜é‡‡æ ·ç‚¹çš„å¤šæ ·æ€§ï¼Œå°†é€šé“åˆ†ç»„ï¼Œæ¯ç»„è·å–ä¸ä¸€æ ·çš„ä¿¡æ¯ã€‚ 4reference = è§„æ•´çš„ç½‘æ ¼ 5pos = reference + offset // å›ºå®šç‚¹ + åç§» 6x_sampled = F.grid_sample(X, pos) 7 8k = Conv1x1(x_sampled) 9v = Conv1x1(x_sampled) 10 11MHSA(q, k, v) â­â­â­\nPVTä¸‹é‡‡æ ·æŠ€æœ¯å¯¼è‡´ä¸¥é‡çš„ä¿¡æ¯ä¸¢å¤±â—ï¼Œè€ŒSwin-Tçš„shiftwindowæ³¨æ„åŠ›å¯¼è‡´æ„Ÿå—é‡çš„å¢é•¿è¦æ…¢å¾—å¤šâ—ï¼Œè¿™é™åˆ¶äº†å¯¹å¤§å‹ç‰©ä½“å»ºæ¨¡çš„æ½œåŠ›ã€‚Deformable DETRå·²ç»é€šè¿‡åœ¨æ¯ä¸ªå°ºåº¦ä¸Šè®¾ç½®Nk = 4çš„è¾ƒä½æ•°é‡çš„é”®æ¥å‡å°‘è¿™ç§å¼€é”€ï¼Œå¹¶ä¸”ä½œä¸ºæ£€æµ‹å¤´å·¥ä½œè‰¯å¥½ï¼Œä½†æ˜¯ç”±äºä¸å¯æ¥å—çš„ä¿¡æ¯ä¸¢å¤±ï¼Œåœ¨éª¨å¹²ç½‘ç»œä¸­å…³æ³¨å¦‚æ­¤å°‘çš„é”®æ˜¯ä¸å¥½â—\nè¿™ä¸å°±æ˜¯æ­¥å¹…Attentionï¼Œæ·»åŠ äº†å¯å˜å˜›\n","permalink":"http://longcoding.top/posts/learning/paper_reading1/","summary":"\u003ch2 id=\"å›¾ç¤º\"\u003eå›¾ç¤º\u003c/h2\u003e\n\u003ch3 id=\"å·ç§¯æ³¨æ„åŠ›\"\u003eå·ç§¯æ³¨æ„åŠ›\u003c/h3\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240322202245497\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FnOSHW83hKtIFxFdU34DDsMiOeWO\"\u003e\u003c/p\u003e\n\u003ch3 id=\"è‡ªæ³¨æ„åŠ›\"\u003eè‡ªæ³¨æ„åŠ›\u003c/h3\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240322202200571\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FvUxt8fwO3J-k8UzUsCI30aE2lRp\"\u003e\u003c/p\u003e\n\u003ch2 id=\"å­¦ä¹ \"\u003eå­¦ä¹ \u003c/h2\u003e\n\u003ch3 id=\"norm\"\u003eNorm\u003c/h3\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305205407153\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FoDS7JLx483eH0OReKVsf9Rx-4tZ\"\u003e\u003c/p\u003e\n\u003ch3 id=\"loss\"\u003eLoss\u003c/h3\u003e\n\u003ch4 id=\"cross-entropy\"\u003eCross Entropy\u003c/h4\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240302160358957\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FsuefQxQF9qmKbSUd94pmTsYId_D\"\u003e\n$$\nLoss = -\\sum_{i}^{C}y_ilog(p(x_{i})), where \\ y_i\\ is label,p(x_i)\\ is\\ predict.\n$$\u003c/p\u003e\n\u003ch4 id=\"bce-loss\"\u003eBCE Loss\u003c/h4\u003e\n\u003cp\u003e$$\nLoss = âˆ’\\sum_{i}^{c}(y_ilog(p(x_i)+(1âˆ’y_i)log(1âˆ’p(x_i)) \\\nwhere \\ y_i \\in [0, 1] \\\u003c/p\u003e\n\u003cp\u003epos_partition = -log(p(x_i))\\\nneg_partition = -log(1-p(x_i))\n$$\u003c/p\u003e\n\u003ch4 id=\"focal-loss\"\u003eFocal Loss\u003c/h4\u003e\n\u003cp\u003e$$\nLoss = -Î±_t(1-p_t)^Î³log(p_t)\\\u003c/p\u003e\n\u003cp\u003e# Multi-Label:\\\n1.\\ pos_loss = Î±(1-p(x_i))^Î³\\ \\ -log(p_t)\\\n2.\\ neg_loss = (1-Î±)p(x_i)^Î³\\ \\ -log(1-p_t)\n$$\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"è®ºæ–‡\"\u003eè®ºæ–‡\u003c/h2\u003e\n\u003ch3 id=\"mlp-mixer---nips-2021\"\u003eMlp-mixer - \u003cem\u003eNIPS 2021\u003c/em\u003e\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003etitle: Mlp-mixer: An all-mlp architecture for vision\u003c/strong\u003e\u003c/p\u003e","title":"æ·±åº¦å­¦ä¹ è®ºæ–‡æ±‡æ€»1"},{"content":"CAM - CVPR 2015 Learning Deep Features for Discriminative Localization\nå¼±ç›‘ç£å¯¹è±¡å®šä½ - ä»…æä¾›Image level label\næœŸæœ›ï¼šæ¯ä¸ªå•å…ƒè¢«å…¶æ„Ÿå—é‡å†…çš„æŸç§è§†è§‰æ¨¡å¼æ¿€æ´»ã€‚å› æ­¤ fk ï¼ˆè¡¨ç¤ºç©ºé—´ä½ç½® (x, y) å¤„æœ€åä¸€ä¸ªå·ç§¯å±‚ä¸­å•å…ƒ k çš„æ¿€æ´»//è¾“å‡ºç‰¹å¾å›¾çš„ä¸€ä¸ªåƒç´ ï¼‰æ˜¯è¯¥è§†è§‰æ¨¡å¼å­˜åœ¨çš„åœ°å›¾ã€‚ç±»æ¿€æ´»å›¾åªæ˜¯è¿™äº›è§†è§‰æ¨¡å¼åœ¨ä¸åŒç©ºé—´ä½ç½®çš„å­˜åœ¨çš„åŠ æƒçº¿æ€§å’Œ\nè®¡ç®—å·ç§¯ç‰¹å¾å›¾å¯¹äºç‰¹å®šè¾“å‡ºå•å…ƒçš„é‡è¦æ€§æ¥å®ç°çš„\nâ­â­â­ç½‘ç»œå¯ä»¥ä¿ç•™å…¶å“è¶Šçš„å®šä½èƒ½åŠ›ï¼Œç›´åˆ°æœ€åä¸€å±‚ =\u0026gt; æ·±å±‚ç‰¹å¾çš„å®šä½èƒ½åŠ›\nâ—â—â—å°½ç®¡æ¥å—äº†å›¾åƒçº§æ ‡ç­¾çš„è®­ç»ƒï¼ŒCNN ä»å…·æœ‰å‡ºè‰²çš„å¯¹è±¡å®šä½èƒ½åŠ›\nç¼ºé™·ï¼šå·ç§¯ç‰¹å¾å›¾â†’å…¨å±€å¹³å‡æ± åŒ–â†’softmaxå±‚ // ç‰¹å®šç½‘ç»œç»“æ„\nåšæ³•å›¾ç¤º\ræ•°å­¦å…¬å¼\råœ¨å·ç§¯ç‰¹å¾å›¾ä¸Šæ‰§è¡Œå…¨å±€å¹³å‡æ± åŒ–ï¼Œå¹¶å°†å®ƒä»¬ç”¨ä½œå…¨è¿æ¥å±‚çš„ç‰¹å¾ï¼Œäº§ç”Ÿæ‰€éœ€çš„è¾“å‡ºåˆ†ç±»;\nâ—â—â—å°†è¾“å‡ºå±‚çš„æƒé‡æŠ•å½±å›å·ç§¯ç‰¹å¾å›¾æ¥è¯†åˆ«å›¾åƒåŒºåŸŸçš„é‡è¦æ€§\nGrad-CAM - ICCV 2017 é€‚ç”¨CNNæ¨¡å‹\nä½†è®ºæ–‡æåˆ°åœ¨CNN+LSTMçš„ä¹Ÿèƒ½å®šä½æœ‰åŒºåˆ«çš„å›¾åƒåŒºåŸŸ\nÎ± æ•è·ç‰¹å¾å›¾ k å¯¹äºç›®æ ‡ç±» c çš„é‡è¦æ€§ // ä¸CAMçš„åˆ†ç±»çº¿æ€§å±‚æƒé‡ä½œç”¨ä¸€è‡´\nReLUçš„ä½œç”¨ï¼Œåªå¯¹å¯¹æ„Ÿå…´è¶£çš„ç±»åˆ«æœ‰ç§¯æå½±å“çš„ç‰¹å¾æ„Ÿå…´è¶£ã€‚è´Ÿåƒç´ å¯èƒ½å±äºå›¾åƒä¸­çš„å…¶ä»–ç±»åˆ«\nä¸Šè¿°æ“ä½œ =\u0026gt; å…·æœ‰ç±»åˆ«åŒºåˆ†æ€§å¹¶ä¸”å¯ä»¥å¾ˆå¥½åœ°å®šä½ç›¸å…³å›¾åƒåŒºåŸŸ - æœ€åç‰¹å¾å›¾æ¯”è¾ƒå°!\nä½†ç¼ºä¹æ˜¾ç¤ºç»†ç²’åº¦é‡è¦æ€§çš„èƒ½åŠ› ï¼ˆèƒ½åŒºåˆ†çŒ«ç‹—ï¼Œä½†å¯¹ä¸ºä»€ä¹ˆè¯†åˆ«ä¸ºçŒ«ï¼Œä¸å¤Ÿç²¾ç¡®ï¼‰\ré€šè¿‡ç‚¹ä¹˜æ³•èåˆ å¼•å¯¼åå‘ä¼ æ’­ å’Œ Grad-CAM =\u0026gt; å¯è§†åŒ–\nGrad-CAM : ç±»åˆ«åŒºåˆ†æ€§\nGuided Backpropï¼š ç»†èŠ‚çº¹ç†é‡è¦ç¨‹åºã€‚ åšæ³•ï¼šå°†æ¢¯åº¦å€¼å°äºç­‰äºé›¶çš„éƒ¨åˆ†ç½®ä¸ºé›¶ï¼Œä¿ç•™æ¢¯åº¦å€¼å¤§äºé›¶çš„éƒ¨åˆ† =\u0026gt; ä»¥çªå‡ºè¾“å…¥å›¾åƒä¸­å¯¹é¢„æµ‹ç»“æœæœ‰ç§¯æå½±å“çš„åŒºåŸŸï¼Œæ¥å®ç°å¯¹ç¥ç»ç½‘ç»œä¸­æ¯ä¸ªåƒç´ å¯¹æœ€ç»ˆé¢„æµ‹ç»“æœçš„å½±å“è¿›è¡Œå¯è§†åŒ–å’Œè§£é‡Š\næµ…å±‚å·ç§¯å…³æ³¨çº¹ç†ç‰¹å¾ï¼Œæ·±å±‚ç½‘ç»œå…³æ³¨æœ¬è´¨çš„é‚£ç§ç‰¹å¾ï¼Ÿ\nDETR - ECCV 2020 â­End-to-Endâ­ Object Detection with Transformers\nä¼ ç»Ÿï¼šè®¾ç½®é”šæ¡† + éæå¤§å€¼æŠ‘åˆ¶(å»é™¤å¤šä½™çš„æ¡†)\nåˆ›æ–°ï¼šé›†åˆé¢„æµ‹(é¢„æµ‹åˆ†ç±» + é”šæ¡†)\nå‰å‘æµç¨‹\ræ¨¡å‹æ¡†æ¶\rCNN backbone - local information fusion\nTransformer encoder - global information fusion\nobject queries - learnable information vector ä½œç”¨ï¼š =\u0026gt; anchor\nFFN: 1. classification =\u0026gt; output class vector 2. box =\u0026gt; output 4 number [center_x, center_y, width, hight]\nobject queries: ä½œç”¨å°±æ˜¯é”šæ¡†ï¼Œå¹¶ä¸”ä¸€æ¬¡æ€§ç”Ÿæˆ100ä¸ª \u0026raquo; å›¾ç‰‡æ£€æµ‹çš„ç‰©ä½“æ•°\nå¦‚ä½•å°†object queries ä¸ groundtrueä¸€ä¸€å¯¹åº”ï¼Ÿ\nåŒˆç‰™åˆ©ç®—æ³• å¯»æ‰¾æœ€ä½³åŒ¹é…\nåŒ¹é…loss = åˆ†ç±»loss(åˆ†ç±»æ­£ç¡®ç‡) + æ¡†loss(æ¡†çš„é‡å åº¦)\n=\u0026gt; åŒˆç‰™åˆ©ç®—æ³• =\u0026gt; å“ªäº›æ¡†ä¸GTæœ€ä½³åŒ¹é…(é¢„æµ‹æ¡†ä¸GTä¸€ä¸€å¯¹åº”)\næœ€ç»ˆå›ä¼ æ¢¯åº¦ä¼˜åŒ–å‚æ•°LOSS = åˆ†ç±»loss(åˆ†ç±»æ­£ç¡®ç‡) + [æ¡†loss + ä¸æ¡†å¤§å°æ— å…³çš„iou loss]\nå› ä¸ºæ¡†ä¹Ÿæ˜¯ç”Ÿæˆçš„ï¼Œä¸”Transformerå®¹æ˜“å‡ºå¤§æ¡†(å…¨å±€å»ºæ¨¡)\nBert - 2018 BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding - Computation and Language\nBidirectional Transformers æ„æ€æ˜¯\nTransformer Encoderä¸­çš„è‡ªæ³¨æ„åŠ›è®¡ç®—æ˜¯å…¨å±€çš„ï¼Œæ¯ä¸ªTokenèƒ½è§‚æµ‹åˆ°å…¶ä½™çš„Tokenåºåˆ—ï¼› è€Œ\nTransformer Decoderä¸­ç”±äºè¿›è¡Œçš„æ˜¯Masked Multi Head Self Attentionï¼Œæ‰€ä»¥åºåˆ—åªèƒ½è§‚æµ‹åˆ°è‡ªå·±ä¸ä¹‹å‰çš„è¯­å¢ƒï¼›\nè¿™å¯¹äºæ–‡æœ¬ä¸Šä¸‹æ–‡è¯­å¢ƒå»ºæ¨¡æ˜¯æœ‰å¼Šç«¯çš„ï¼\n(ç”Ÿæˆå¼æ— ç›‘ç£å­¦ä¹ )\næ€»ä½“ç»“æ„\n[CLS] åˆ†ç±»Tokenï¼Œå‡èšå…¨å±€è¯­ä¹‰ä¿¡æ¯\n[SEP] åˆ†å‰²ç¬¦ï¼Œåˆ’åˆ†å¥å­èŒƒå›´\nç”¨çš„æŸä¸ªè¯­æ–™åº“è¿›è¡Œè¯åµŒå…¥\nâ­è®­ç»ƒæ–¹æ³•\nå®Œå‹å¡«ç©ºï¼šä½¿æŸä¸ªè¯éšæœºè¢« [Mask] å­—ç¬¦é®æŒ¡ï¼›ä¸ºé˜²æ­¢æ¨¡å‹å¯¹[Mask]å­—ç¬¦æ•æ„Ÿï¼Œé®æŒ¡æ—¶ä½¿ç”¨æ¦‚ç‡é®æŒ¡ =\u0026gt; 1. ä»æ›¿æ¢ä¸º[Mask]å­—ç¬¦ 2.éšæœºæ›¿æ¢ä¸ºå…¶ä»–å­—ç¬¦ 3. ä¿æŒä¸å˜ =\u0026gt; è¿«ä½¿æ¨¡å‹å­¦ä¹ ä¸Šä¸‹æ–‡è¯­å¢ƒ [å¥å­å†…ä¿¡æ¯å»ºæ¨¡]\né¢„æµ‹ä¸‹ä¸€å¥ï¼š [å¥å­é—´ä¿¡æ¯å»ºæ¨¡]\nä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼šé€šè¿‡è€ƒè™‘å•è¯çš„å·¦å³ä¸Šä¸‹æ–‡ï¼ŒBERT èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¯ä¹‰å’Œå¥æ³•ç»“æ„ï¼Œè¿™å¯¹äºç†è§£è¯­è¨€çš„å¤æ‚æ€§è‡³å…³é‡è¦ã€‚\nGPT generative pretrain transformer\nåˆç•¥ç‰ˆ\næ¨¡å‹å›¾ï¼š(Transformer Decoder -ä»…Masked Attentionç‰ˆ)\nâ­ input: word =\u0026gt; index(æŸ¥æ‰¾è¯æ±‡è¡¨) =\u0026gt; embedding + position embedding\n[batch, sequence_length, embedding_dim]\t# sequence_length å¯ç”±å¤šä¸ªå¥å­ç»„æˆï¼Œå¯ä»¥ä½¿ç”¨\u0026lt;s\u0026gt;æ ‡è¯†å¥å­ç»“æŸï¼Œ\u0026lt;pad\u0026gt;ç”¨æ¥å¡«å……ï¼Œä½¿å¾—sequence_lengthåœ¨batchå†…é•¿åº¦ä¸€è‡´\nâ­ trainï¼š\nx1 =\u0026gt; x2\nx1, x2 =\u0026gt; x3\nx1, x2, x3 =\u0026gt; x4\nå› ä¸ºæ¯ä¸ªè¯éƒ½è¦é¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼Œæ•…ä½¿ç”¨masked attention ï¼ˆmask-softmaxï¼‰ï¼Œé˜²æ­¢ç­”æ¡ˆæ³„æ¼\nCLIP - 2021 Learning Transferable Visual Models From Natural Language Supervision\nå®ç°zero-shotï¼Œä¸Šæ¸¸å¤§æ•°æ®é›†é¢„è®­ç»ƒå¥½ï¼Œä¸‹æ¸¸ä»»åŠ¡è¿ç§»å­¦ä¹ æ— éœ€æ ·æœ¬å¾®è°ƒ\nå¤šæ¨¡æ€æ¨¡å‹çš„æ€»ä½“ç›®æ ‡å°±æ˜¯ï¼šè®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œä¸€æ–¹é¢èƒ½ç»Ÿä¸€ç‰¹å¾è¡¨è¾¾ï¼Œå¦ä¸€æ–¹é¢åˆèƒ½è®©ä¸åŒæ¨¡æ€ç‰¹å¾é—´å­¦åˆ°ç›¸å…³æ€§\n(åˆ¤åˆ«å¼æ— ç›‘ç£å­¦ä¹ )\nå·¥ä½œç›®çš„ ç—›ç‚¹ï¼š\nåœ¨ç‰¹ç‚¹æ•°æ®é›†ä¸Šè¿›è¡Œæ ‡ç­¾è®­ç»ƒ =\u0026gt; è¾“å…¥æ²¡è§è¿‡çš„ç±»åˆ«ï¼Œé‚£ä¹ˆæ¨¡å‹å°±ä¸èƒ½è¾“å‡ºæ­£ç¡®çš„ç»“æœ\næ•°æ®å‡ºç°åˆ†å¸ƒåç§»ï¼ŒåŠ¨ç‰©å›¾ç‰‡ä¸å¡é€šåŠ¨ç‰©å›¾ç‰‡ =\u0026gt; è¯†åˆ«ä¸å‡ºæ¥\nå›¾ç‰‡ - æ–‡å­—æè¿° ï¼Œ æ¨¡å‹å­¦ä¹ é…å¯¹å…³ç³»\nä¸€ä¸ªå¯¹è±¡çš„ä¸åŒè§†è§’è¡¨ç¤ºï¼šå›¾ç‰‡å’Œæ–‡æœ¬æè¿°\nå¯¹æ¯”å­¦ä¹ æ–¹æ³• ï¼ˆTrainï¼‰ Text Encoder (resnet/vit) å­¦ä¹ æ–‡æœ¬æè¿°çš„ æ·±åº¦ç‰¹å¾ - å•æ¨¡æ€å†…ç‰¹å¾ // T_i == ä¸€ä¸ªæ–‡æœ¬ç‰¹å¾ Image Encoder(transformer) å­¦ä¹ å›¾ç‰‡çš„ æ·±åº¦ç‰¹å¾ - å•æ¨¡æ€å†…ç‰¹å¾ // I_i == ä¸€ä¸ªå›¾åƒç‰¹å¾ å°†å¤šæ¨¡æ€ç‰¹å¾æŠ•å½±åˆ°è·¨æ¨¡æ€ç©ºé—´ // çŸ©é˜µæ˜ å°„ï¼Œ(ç‰¹å¾å‘é‡)åˆ°åŒä¸€çº¬åº¦ è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ­£ç¡®é…å¯¹çš„ä½ç½®ä¸ºå¯¹è§’çº¿ è®¡ç®—Lossï¼š ï¼ˆç›¸ä¼¼åº¦logitä½œä¸ºé¢„æµ‹åˆ†æ•°ï¼‰ æŒ‰è¡Œè®¡ç®—Lossï¼Œåœ¨æ¯ä¸€è¡ŒèŒƒå›´å†…åšsoftmaxï¼Œç„¶åè®¡ç®—cross_entropyï¼ˆè“è‰²æ ¼å­éƒ¨åˆ†æ˜¯çœŸå€¼ï¼‰ã€‚è¿™æ ·è®¡ç®—Lossçš„æ„ä¹‰æ˜¯ï¼šå¯¹äºæ¯ä¸€å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›æ‰¾åˆ°å’Œå®ƒæœ€ç›¸ä¼¼çš„æ–‡å­— æŒ‰åˆ—è®¡ç®—Lossï¼Œåœ¨æ¯ä¸€åˆ—çš„èŒƒå›´å†…åšsoftmaxï¼Œç„¶åè®¡ç®—cross_entropyï¼ˆè“è‰²æ ¼å­éƒ¨åˆ†æ˜¯çœŸå€¼ï¼‰ã€‚è¿™æ ·è®¡ç®—Lossçš„æ„ä¹‰æ˜¯ï¼šå¯¹äºæ¯ä¸€æ®µæ–‡å­—ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›æ‰¾åˆ°å’Œå®ƒæœ€ç›¸ä¼¼çš„å›¾ç‰‡ æœ€åå°†è¿™ä¸¤ä¸ªLossç›¸åŠ å–å¹³å‡ï¼Œä»£è¡¨æˆ‘ä»¬åœ¨æ¨¡å‹ä¼˜åŒ–è¿‡ç¨‹ä¸­è€ƒè™‘äº†â€œå›¾ç‰‡-\u0026gt;æ–‡å­—â€å’Œâ€œæ–‡å­—-\u0026gt;å›¾ç‰‡â€çš„åŒå‘å…³ç³» encoderå‡ä»å¤´å¼€å§‹è®­ç»ƒ\né¢„æµ‹ åˆ›å»ºä¸€ä¸ªæ ‡ç­¾å…¨é›†ï¼Œ [f\u0026rsquo;A photo of a {object}\u0026rsquo; for object in dataset_labels] Text Encoder å­¦ä¹ ä¸Šè¿° æ¨¡æ¿æ–‡å­—æè¿° çš„ æ·±åº¦ç‰¹å¾ Image Encoder å­¦ä¹  å¾…é¢„æµ‹å›¾ç‰‡ çš„ æ·±åº¦ç‰¹å¾ è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ =\u0026gt; å–æœ€é«˜åˆ†ä½œä¸ºé¢„æµ‹ç›®æ ‡ ç¼ºç‚¹ æ¯æ¬¡é¢„æµ‹éœ€è¦æ„å»ºæ ‡ç­¾å…¨é›†æè¿° å¯¹æŠ½è±¡ä»»åŠ¡ï¼Œæ€§èƒ½è¾ƒå·® Two-Stream - 2014 Two-Stream Convolutional Networks for Action Recognition in Videos\nâ­å…ˆå‰å·¥ä½œä¸­é€šè¿‡ä½¿ç”¨å †å è§†é¢‘å¸§ä½œä¸ºç½‘ç»œçš„è¾“å…¥æ¥è§£å†³æ­¤ä»»åŠ¡ï¼Œä½†ç»“æœæ˜æ˜¾æ¯”æœ€å¥½çš„æ‰‹å·¥åˆ¶ä½œçš„æµ…å±‚è¡¨ç¤ºå·®ã€‚ =\u0026gt; è¿™å¯èƒ½è¡¨æ˜å­¦ä¹ çš„æ—¶ç©ºç‰¹å¾ä¸èƒ½å¾ˆå¥½åœ°æ•æ‰è¿åŠ¨ï¼ˆç®€å•å †å  =\u0026gt; è®©æ¨¡å‹ä»åºå¤§çš„æ•°æ®ä¸­å­¦ä¹ âŒå¾ˆéš¾ï¼‰ =\u0026gt; æ¨¡å‹å¾ˆéš¾è¯†åˆ«è¯¥ç±»ç‰¹å¾ =\u0026gt; é¢„å…ˆå¤„ç†æˆæ¨¡å‹æ“…é•¿çš„æ•°æ®å½¢å¼\nâ—â—â—è™½ç„¶å¤šå¸§ä¿¡æ¯å¾ˆé‡è¦ï¼Œä½†ä»¥é€‚å½“çš„æ–¹å¼å°†å…¶å‘ˆç°ç»™ ConvNet ä¹Ÿå¾ˆé‡è¦ï¼ˆé¥±å’Œï¼‰\nä¿¡æ¯æ˜¾å¼å»ºæ¨¡ =\u0026gt; å¯ä»¥ç®€åŒ–å­¦ä¹ è¿‡ç¨‹\nåˆ›æ–°ç‚¹\nç©ºé—´æµä»é™æ­¢è§†é¢‘å¸§æ‰§è¡ŒåŠ¨ä½œè¯†åˆ« æ—¶é—´æµä»¥è¯†åˆ«å¯†é›†å…‰æµå½¢å¼çš„è¿åŠ¨åŠ¨ä½œ =\u0026gt; è´´åˆäººç±»è§†è§‰ï¼šè¯†åˆ«ç‰©ä½“ + è¯†åˆ«è¿åŠ¨ =\u0026gt; â­[ç»“æœè§’åº¦]è¡¨æ˜ä¸¤ä¸ªè¯†åˆ«æµæ˜¯äº’è¡¥çš„\nå…‰æµï¼šå¸§å¸§ä¹‹é—´åƒç´ å˜åŒ–(æè¿°è¿åŠ¨å˜åŒ–çš„æ•°æ®å½¢å¼) | æ°´å¹³æ–¹å‘å’Œå‚ç›´æ–¹å‘ \u0026lt;= æœ‰ç”¨çš„çº¿ç´¢ (ä¸é­”æ”¹æ¨¡å‹ä¸ä¸€æ ·çš„æ€è·¯)\nâ­â­â­æ­¤ç±»è¾“å…¥æ˜ç¡®æè¿°äº†è§†é¢‘å¸§ä¹‹é—´çš„è¿åŠ¨ =\u0026gt; è¿™ä½¿å¾—è¯†åˆ«æ›´å®¹æ˜“ =\u0026gt; å› ä¸ºç½‘ç»œä¸éœ€è¦éšå¼ä¼°è®¡è¿åŠ¨ ï¼ˆæ˜¾ç¤ºå»ºæ¨¡ï¼‰\nå¯ä»¥ä»å…‰æµæ•°æ® =\u0026gt; æ—¶ç©ºå±€éƒ¨ç‰¹å¾ || è¿åŠ¨å­¦ç‰¹å¾ || è¿åŠ¨æ˜¯ä½¿ç”¨å…‰æµä½ç§»åœºæ˜ç¡®è¡¨ç¤ºçš„\næ¨¡å‹æ¡†æ¶ï¼ˆåŒæ¨¡æ€ï¼‰\næé«˜æ¨¡å‹è¿ç§»èƒ½åŠ› ç±»ä¼¼äºCLIPçš„ç›®çš„\nè€ƒè™‘å°†ä¸¤ä¸ªæ•°æ®é›†åˆå¹¶ä¸ºä¸€ä¸ªï¼Œç”±äºç±»é›†ä¹‹é—´çš„äº¤å‰ï¼Œè¿™å¹¶ä¸ç®€å•\n=\u0026gt; å¤šä»»åŠ¡å­¦ä¹  =\u0026gt; æœ€åç”Ÿæˆå¤šä¸ªåˆ†ç±»å¤´ï¼Œå¯¹åº”ä¸¤ä¸ªæ•°æ®é›†åˆ†ç±»ã€‚æ··åˆå¤šä¸ªæ•°æ®é›†è¿›è¡Œå®éªŒ\nMOCO - CVPR 2020 Momentum Contrast for Unsupervised Visual Representation Learning\n(åˆ¤åˆ«å¼æ— ç›‘ç£å­¦ä¹ )\nç›®æ ‡ï¼š\n1ï¸âƒ£ æ„å»ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„åŠ¨æ€è¯å…¸ï¼ŒåŒ…å«è¶³å¤Ÿå¤šçš„è´Ÿæ ·æœ¬ï¼Œä½¿æ¨¡å‹çœŸèƒ½å¤Ÿå­¦åˆ°åˆ¤åˆ«å¼çš„ç‰¹å¾; åœ¨æµ·é‡æ•°æ®ä¸­å­¦åˆ°çœŸæ­£çš„æ ·æœ¬åˆ†å¸ƒ\r2ï¸âƒ£ å› ä¸ºè¯å…¸æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œä¸ºäº†ä½¿è¯å…¸ä¸­çš„è´Ÿæ ·æœ¬ç‰¹å¾å°½å¯èƒ½çš„ä¿æŒä¸€è‡´æ€§(æ¨¡å‹å‚æ•°ä¸åŒï¼Œæ—¶é—´ç»´åº¦ä¸Šï¼Œå¾—åˆ°çš„ç‰¹å¾å‘é‡å­˜åœ¨ä¸ä¸€è‡´æ€§)ï¼Œæå‡ºåŠ¨é‡æ›´æ–° =\u0026gt; åŠ¨é‡æ¨¡å‹çš„ç¼“æ…¢æ›´æ–°ç¡®ä¿äº†å­—å…¸ä¸­çš„ç‰¹å¾ç›¸å¯¹ç¨³å®šï¼Œä»è€Œæä¾›æ›´ä¸€è‡´çš„è´Ÿæ ·æœ¬ï¼Œæå‡å¯¹æ¯”å­¦ä¹ çš„æ•ˆæœã€‚\r$$ Î¸_{k} â†mÎ¸_{k} + (1 âˆ’m)Î¸_{q} $$ m âˆˆ [0, 1) æ˜¯åŠ¨é‡ç³»æ•°ã€‚è®ºæ–‡ä¸­Query Encoder å’ŒKey Encoderæ˜¯ä¸€æ ·é…ç½®æ¶æ„çš„ç¼–ç å™¨ã€‚ ç›®çš„ï¼Œç¼“æ…¢çš„æ›´æ–°Key Encoderï¼Œæ„å»ºä¸€ä¸ªåˆå¤§åˆä¸€è‡´çš„åŠ¨æ€è¯å…¸ã€‚\næ¡†æ¶ä¼ªä»£ç \npretext task ï¼š å®ä¾‹åˆ¤åˆ«ä»»åŠ¡ã€‚ç›®æ ‡æ‹‰è¿‘æ­£æ ·æœ¬å¯¹åœ¨ç‰¹å¾ç©ºé—´çš„è·ç¦»ï¼Œå¹¶ä½¿è´Ÿæ ·æœ¬å¯¹å°½å¯èƒ½çš„è¿œç¦»ã€‚\n1# f_q, f_k: encoder networks for query and key 2# queue: dictionary as a queue of K keys (CxK) 3# m: momentum 4# t: temperature 5f_k.params = f_q.params # initialize 6for x in loader: # load a minibatch x with N samples 7 x_q = aug(x) # a randomly augmented version 8 x_k = aug(x) # another randomly augmented version 9 10 q = f_q.forward(x_q) # queries: NxC 11 k = f_k.forward(x_k) # keys: NxC 12 k = k.detach() # no gradient to keys 13 14 # positive logits: Nx1 15 l_pos = bmm(q.view(N,1,C), k.view(N,C,1)) 16 17 # negative logits: NxK 18 l_neg = mm(q.view(N,C), queue.view(C,K)) 19 20 # logits: Nx(1+K) 21 logits = cat([l_pos, l_neg], dim=1) 22 23 # contrastive loss, Eqn.(1) 24 labels = zeros(N) # positives are the 0-th 25 loss = CrossEntropyLoss(logits/t, labels) 26 27 # SGD update: query network 28 loss.backward() 29 update(f_q.params) 30 31 # momentum update: key network 32 f_k.params = m*f_k.params+(1-m)*f_q.params 33 34 # update dictionary 35 enqueue(queue, k) # enqueue the current minibatch 36 dequeue(queue) # dequeue the earliest minibatch ä¸¤ä¸ªä¸åŒè§†è§’çš„åŒä¸€å¼ å›¾ç‰‡ä¸ºæ­£æ ·æœ¬å¯¹ï¼Œä¸åŒå›¾ç‰‡ä¸ºè´Ÿæ ·æœ¬å¯¹ã€‚\næŠ½ç‰¹å¾ï¼šq, kï¼› æœ€å¤§åŒ–q kç›¸ä¼¼ä¸”ä¸è´Ÿæ ·æœ¬è¿œç¦»\næ›´æ–°Q_Encoder, ä½¿ç”¨Q_Encoderå‚æ•°æ›´æ–°K_Encoderï¼ŒåŠ¨é‡ç¼“æ…¢æ›´æ–°\næ— ç›‘ç£é¢„è®­ç»ƒåå¥½ï¼Œå–Q_Encoderä½œä¸ºæŠ½å–ç‰¹å¾éª¨å¹²ç½‘ç»œï¼Œå†»ç»“å…¶å‚æ•°ï¼Œå¾®è°ƒåˆ†ç±»å¤´ï¼Œåœ¨è¿›è¡Œæ³›åŒ–æµ‹è¯•\nMAE - CVPR2022 Masked Autoencoders Are Scalable Vision Learners\néå¯¹ç§°æ©ç è‡ªåŠ¨ç¼–ç å™¨ï¼›Encoderå’ŒDecoderæ¶æ„å¯ä»¥ä¸åŒ\n(ç”Ÿæˆå¼æ— ç›‘ç£å­¦ä¹ )\nCVé¢†åŸŸçš„Bert\nâ­NLPä¸CVçš„ä¸åŒï¼š\nä¿¡æ¯å¯†åº¦ä¸åŒ\nNLPï¼šå¥å­ä¿¡æ¯è¯­ä¹‰å¾ˆé«˜ï¼Œä¿¡æ¯å¯†åº¦ä¹Ÿé«˜ã€‚ï¼ˆäººç±»è¯­è¨€-äº‹å…ˆæµ“ç¼©è¿‡çš„ä¿¡æ¯ï¼‰\nè§†è§‰ï¼šä¿¡æ¯å¾ˆå†—ä½™ï¼Œä¹Ÿæ²¡é«˜çº§çš„è¯­ä¹‰ï¼ˆè‡ªç„¶ç•Œï¼‰ï¼Œåƒç´ å¯ä»¥è¢«ç›¸é‚»çš„é‡å»ºæ¢å¤\næ¢å¤éš¾åº¦ä¸ä¸€è‡´\næ¢å¤é«˜çº§è¯­ä¹‰å•è¯å’Œæ¢å¤åƒç´ çº§(ä½çº§è¯­ä¹‰)å›¾ç‰‡ï¼Œéš¾åº¦ä¹Ÿä¸ä¸€æ ·ã€‚ æ¡†æ¶ï¼š\nEncoderï¼šä½ç½®ç¼–ç æ‰€æœ‰Patchéƒ½åŠ ä¸Šã€‚ä½†ä»…è¾“å…¥æœªè¢«Maskçš„Patchã€‚å¹¶ä¸”Maskæ¯”ä¾‹å¾ˆé«˜(è®ºæ–‡mask75%patch)ï¼Œè¿«ä½¿æ¨¡å‹å­¦åˆ°é«˜ç»´çš„ç‰¹å¾ï¼Œè€Œéæ·å¾„ã€‚\nDecoderï¼šMask Patchæ˜¯è‡ªå­¦ä¹ çš„å‘é‡ï¼Œå¹¶ä¸”å’ŒEncoded Patchåœ¨ä½ç½®ä¸Šä¸€è‡´ï¼Œå†æ¬¡æ·»åŠ ä½ç½®ä¿¡æ¯ã€‚\nç®€å•å®ç°ï¼ˆshuffleï¼Œæˆªå–å‰é¢çš„ä½œä¸ºEncoderè¾“å…¥ï¼Œåé¢Patchè¢«Maskï¼›å†shuffleé€†æ“ä½œï¼Œå°†Encoded Patchå’Œlearnabel patchä½ç½®å¯¹é½ç»„åˆå¥½è¿›è¡ŒDecoderã€‚å†é‡å»ºåƒç´ ï¼‰\né€šè¿‡é¢„æµ‹æ¯ä¸ªå±è”½è¡¥ä¸çš„åƒç´ å€¼æ¥é‡å»ºè¾“å…¥ã€‚è§£ç å™¨çš„æœ€åä¸€å±‚æ˜¯çº¿æ€§æŠ•å½±ï¼Œå…¶è¾“å‡ºé€šé“çš„æ•°é‡ç­‰äºè¡¥ä¸ä¸­åƒç´ å€¼çš„æ•°é‡ã€‚\næŸå¤±å‡½æ•°è®¡ç®—åƒç´ ç©ºé—´ä¸­é‡å»ºå›¾åƒå’ŒåŸå§‹å›¾åƒä¹‹é—´çš„å‡æ–¹è¯¯å·®ã€‚\né—®é¢˜ï¼š\né¢„è®­ç»ƒçš„è¾“å…¥ä¸­å…·æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ©ç æ ‡è®°ï¼Œè€Œè¿™åœ¨ä¸‹æ¸¸ä»»åŠ¡æœªæŸåçš„å›¾åƒä¸­ä¸å­˜åœ¨ã€‚è¿™ç§å·®è·å¯èƒ½ä¼šé™ä½éƒ¨ç½²çš„å‡†ç¡®æ€§ã€‚\rè‡ªç›‘ç£å­¦ä¹ æ–¹æ³•é€šå¸¸ä¾§é‡äºé¢„è®­ç»ƒçš„ä¸åŒå€Ÿå£ä»»åŠ¡ã€‚\nå¯¹æ¯”å­¦ä¹ å¯¹ä¸¤ä¸ªæˆ–å¤šä¸ªè§†å›¾ä¹‹é—´çš„å›¾åƒç›¸ä¼¼æ€§å’Œç›¸å¼‚æ€§è¿›è¡Œå»ºæ¨¡ã€‚\nwav2vec 2.0 - NeurIPS 2020 wav2vec 2.0: A Framework for Self-Supervised Learning of Speech Representations\næ—¶åºä¿¡å·ç‰ˆæœ¬çš„Bert\n[è‡ªç›‘ç£]å­¦ä¹ é€šç”¨ç‰¹å¾ =\u0026gt; å†å¾®è°ƒä»»åŠ¡å¤´\n(åˆ¤åˆ«å¼æ— ç›‘ç£å­¦ä¹ )\næ€»ä½“æ¡†æ¶ï¼š\n1ï¸âƒ£ åŸå§‹ä¿¡å·[X] =CNN=\u0026gt; æµ…åœ¨ç‰¹å¾è¡¨ç¤º [Z]\n2ï¸âƒ£ æµ…åœ¨ç‰¹å¾è¡¨ç¤º [Z] =Transformer Encoder=\u0026gt; å…¨å±€ä¸Šä¸‹æ–‡ç‰¹å¾è¡¨ç¤º [C]\n3ï¸âƒ£ æµ…åœ¨ç‰¹å¾è¡¨ç¤º [Z] =é‡åŒ–å™¨=\u0026gt; å¯¹æ¯”ç›®æ ‡[Q]\næŠŠåŸæ¥è¿ç»­çš„ç‰¹å¾ç©ºé—´å‡è®¾æ˜¯dç»´ï¼Œæ‹†åˆ†æˆGä¸ªå­ç©ºé—´ï¼ˆcodebookï¼‰ï¼Œæ¯ä¸ªå­ç©ºé—´ç»´åº¦æ˜¯d/Gã€‚ ç„¶ååˆ†åˆ«åœ¨æ¯ä¸ªå­ç©ºé—´é‡Œé¢èšç±»ï¼ˆK-meanä»€ä¹ˆçš„ï¼‰ï¼Œä¸€å…±è·å¾—Vä¸ªä¸­å¿ƒå’Œå…¶ä¸­å¿ƒç‰¹å¾ã€‚ æ¯ä¸ªç±»åˆ«çš„ç‰¹å¾ç”¨å…¶ä¸­å¿ƒç‰¹å¾ä»£æ›¿ã€‚ é‡åŒ–qtå’Œå¯¹åº”ct\nâŒ Quantization module éƒ¨åˆ†ä¸ç†è§£\nMask\néšæœºèµ·ç‚¹ï¼Œé®æŒ¡åé¢tä¸ªæ—¶é—´æ­¥\nå¯¹æ¯”æŸå¤±\nåŒ…æ‹¬ qt å’Œ K ä¸ªå¹²æ‰°é¡¹\nâ—â—â—ç†è§£ä¸å¤ªæ¸…æ™°\nWhisper - 2022 OpenAI Robust Speech Recognition via Large-Scale Weak Supervision\nå¤§åŠ›å‡ºå¥‡è¿¹\næ¨¡å‹ç»“æ„\nå¤šä»»åŠ¡è®­ç»ƒ\n[è‹±æ–‡å£è¯­=\u0026gt; è‹±æ–‡] è¯­éŸ³è¯†åˆ«\n[å¤šè¯­è¨€å£è¯­ =\u0026gt; è‹±æ–‡] è¯­éŸ³è¯†åˆ« +ç¿»è¯‘\n[å¤šè¯­è¨€å£è¯­ =\u0026gt; å¯¹åº”è¯­è¨€æ–‡å­—] è¯­éŸ³è¯†åˆ«\nè¯†åˆ«èƒŒæ™¯éŸ³(æ— å†…å®¹å£°éŸ³)\nâ­â­â­ä¿¡å· =\u0026gt; Log-Mel Spectrogram(é¢‘è°±å›¾)\néŸ³ç´ \nâ­â­â­æ•°æ®é›†\n680kå°æ—¶ï¼Œè¶…å¤§æ•°æ®é›†ã€‚ åœ¨æ­¤åŸºç¡€ä¸Šé¢„è®­ç»ƒï¼Œå¹¶ä¸”0æ ·æœ¬è¿ç§»(æ— éœ€ç‰¹å®šä»»åŠ¡å¾®è°ƒ)\nCPC - Machine Learning 2018 Representation Learning with Contrastive Predictive Coding\nContrastive Predictive Coding - æ— ç›‘ç£å­¦ä¹ \né€šè¿‡é¢„æµ‹æœªæ¥ï¼Œå­¦ä¹ ç‰¹å¾è¡¨ç¤º (å­¦ä¹ å¯¹(é«˜ç»´)ä¿¡å·ä¸åŒéƒ¨åˆ†ä¹‹é—´çš„åº•å±‚å…±äº«ä¿¡æ¯è¿›è¡Œç¼–ç çš„è¡¨ç¤º - å±€éƒ¨å¹³æ»‘åº¦)\nä¸é¢„æµ‹åŸå§‹ä¿¡å·ï¼Œè€Œæ˜¯å¯¹é«˜ç»´åµŒå…¥ä¾èµ–å»ºæ¨¡\n(åˆ¤åˆ«å¼æ— ç›‘ç£å­¦ä¹ )\nCPCæ¡†æ¶\n$$ g_{enc}: local\\ feature\\ learning\\ g_{ar}: global\\ context\\ learning $$\nå¯¹æ¯”å­¦ä¹ \n1# åºåˆ—ï¼š [x1, x2, x3, x4, x5, x6, x7, x8] 2 3# positive sample 4# x1, x2, x3, x4 =\u0026gt; c \u0026lt;=\u0026gt; x5, x6, x7, x8 5 6# negative sample 7# x1, x2, x3, x4 =\u0026gt; c \u0026lt;=\u0026gt; xa, xb, xc, xd (åŒbatchä¸­å…¶ä»–çš„) è¿«ä½¿æ¨¡å‹å­¦ä¹ åºåˆ—é—´çš„high level featureï¼Œå­¦ä¹ è¿™ç§å†…éƒ¨çš„é¡ºåºé€»è¾‘å…³ç³»\näº’ä¿¡æ¯å…¬å¼ - è¡¡é‡ä¸¤ä¸ªéšæœºå˜é‡ä¹‹é—´çš„ç›¸äº’ä¾èµ–ç¨‹åº¦ $$ I(x;c)=\\sum_{x,c}p(x,c)\\log\\frac{p(x|c)}{p(x)}. \\ I(x;c): x ä¸ c çš„äº’ä¿¡æ¯\\ p(x,c): x å’Œ c åŒæ—¶å‘ç”Ÿçš„è”åˆæ¦‚ç‡åˆ†å¸ƒ\\ p(x|c): ç»™å®š c çš„æ¡ä»¶ä¸‹ï¼Œx å‘ç”Ÿçš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ\\ p(x): x çš„è¾¹ç¼˜æ¦‚ç‡åˆ†å¸ƒ $$ InfoNCE Loss\næœ€å°åŒ–CPCå®šä¹‰çš„æŸå¤± =\u0026gt; å®é™…ä¸Šæœ€å¤§åŒ– context c_t å’Œå¾…é¢„æµ‹æ­£æ ·æœ¬ X_t ä¹‹é—´çš„äº’ä¿¡æ¯\nä¼˜åŒ–ç›®æ ‡ï¼šæœ€å¤§åŒ–ä¼¼ç„¶æ¦‚ç‡\næ­£ç›¸å…³\nè¿‘ä¼¼è®¡ç®—äº’ä¿¡æ¯\nLoss\nX = {x1, x2, \u0026hellip;, xN} Nä¸ªè´Ÿæ ·æœ¬ï¼Œä»batchä¸­å…¶ä»–æ•°æ®ä¸­é‡‡æ ·\nE/X è¡¨ç¤ºä¼¼ç„¶æ¦‚ç‡\næœ€å¤§åŒ–äº’ä¿¡æ¯ =\u0026gt; æœ€å°åŒ–Loss (äº’ä¿¡æ¯ä¸‹ç•Œ)\nå®Œæ•´InfoNCE-Loss $$ \\text{InfoNCELoss} = -\\frac{1}{N} \\sum_{i=1}^{N} \\log \\frac{\\text{exp}(s(x_i, x_i^+))}{\\text{exp}(s(x_i, x_i^+)) + \\sum_{j=1}^{K} \\text{exp}(s(x_i, x_j^-))} $$\nä¸å¤ªäº†è§£è¿™ä¸ªæœ€å¤§åŒ–äº’ä¿¡æ¯çš„Loss\nDALLÂ·E 2 - 2022.3 OpenAI Hierarchical Text-Conditional Image Generation with CLIP Latents\nå±‚çº§å¼å›¾ç”Ÿæ–‡\næ¨¡å‹æ¶æ„\næè¿°ï¼š\nè™šçº¿ä¸Šæ˜¯CLIPæ¶æ„(æ–‡æœ¬å’Œå›¾åƒçš„è”åˆè¡¨ç¤ºç©ºé—´)ï¼Œå­¦ä¹ å›¾æ–‡å¯¹çš„å…³è”ä¿¡æ¯ï¼ˆå›¾æ–‡å¯¹å…³è”å…³ç³»ï¼‰ è™šçº¿ä¸‹æ˜¯ç”Ÿæˆæ¡†æ¶ï¼Œprioræ¨¡å‹æ ¹æ®Text Embeddingç”Ÿæˆå‡ºCLIPå¯¹åº”çš„Image Embeddingï¼Œ decoder(diffussion model)æ ¹æ®Image Embeddingè¿›è¡Œé‡å»º â­åˆ†æ­¥è®­ç»ƒ\nè®­ç»ƒpriorç»„ä»¶\nç›®çš„ï¼šç”ŸæˆCLIP image Embedding\nè®­ç»ƒdecoder\næ˜¯æ ¹æ®image Embeddingç”Ÿæˆå›¾ç‰‡ \u0026ndash; å¹¶ä¸”è¿™ä¸ªdecoderæ˜¯å¤šä¸ªå †å ï¼Œå…ˆç”Ÿæˆä½åˆ†è¾¨ç‡ï¼Œå†é«˜æ¸…åŒ– - (diffusion model)\nç®€æ´è¡¨ç¤ºï¼š\ny - æ–‡å­—\nx - å›¾ç‰‡\nzi - å›¾ç‰‡åµŒå…¥ ï¼ˆæ˜¾å¼ç”Ÿæˆå›¾åƒè¡¨ç¤ºå¯ä»¥æé«˜å›¾åƒå¤šæ ·æ€§ï¼ŒåŒæ—¶å°†ç…§ç‰‡çœŸå®æ€§å’Œæ ‡é¢˜ç›¸ä¼¼åº¦çš„æŸå¤±é™è‡³æœ€ä½ï¼‰\ndiffusion model - NeurIPS 2020 Denoising Diffusion Probabilistic Models\næ¡†æ¶ï¼š\nåŠ å™ª + å»å™ª(è¿˜åŸ)\næ­£å‘è¿‡ç¨‹ï¼š\n1ï¸âƒ£ Xt æ˜¯ å‰ä¸€å¼ å›¾ç‰‡åŠ å™ªç”Ÿæˆçš„ï¼ŒZ1æ˜¯æœä»æ­£å¤ªåˆ†å¸ƒçš„å™ªå£°\nÎ²tæ˜¯è¶…å‚æ•°=èŒƒå›´ä¸º[0.0001,0.02]é€’å¢ï¼Œåˆ™Î±t æ˜¯éšæ—¶é—´å‡å°‘ï¼Œ è¡¨ç¤ºå…¬å¼ä¸€ä¸­åŸå›¾ä¿¡æ¯è¶Šæ¥è¶Šå°‘ï¼Œå™ªå£°è¶Šæ¥è¶Šé‡\n2ï¸âƒ£ é€’æ¨å¸¦å…¥ä¸€ä¸‹\næœ€åå¯å¾—Â·Â·Â·\nZt_hat æ˜¯ä¸€ä¸ªæœä»æ­£å¤ªåˆ†å¸ƒçš„éšæœºå™ªå£°ï¼Œat_hat = at*at-1*Â·Â·Â·*a1, å¯ç”±X0ç›´æ¥äº§ç”Ÿä»»æ„æ—¶é—´æ­¥çš„åŠ å™ªå›¾ç‰‡\nåå‘å»å™ªè¿‡ç¨‹ï¼š\næ ¸å¿ƒåŸºç¡€\n1ï¸âƒ£ ç”¨Xtç”ŸæˆXt-1 ï¼ŒæŒ‰è´å¶æ–¯å…¬å¼è½¬æ¢\n2ï¸âƒ£ q(Xt|Xt-1) == q(Xt|Xt-1, X0)ï¼Œ è€Œq(Xt-1) == q(Xt-1|X0) ä»»æ„æ­¥åŠ å™ªå›¾å¯ç”±åŸå›¾ç›´æ¥äº§ç”Ÿ\n3ï¸âƒ£ åè§£å…¬å¼7ï¼Œ X0å¯ç”±Xtè¿›è¡Œä¼°è®¡\n4ï¸âƒ£ å¸¦å…¥å¹¶æ•´ç†\nÂ·Â·Â· å› æ­¤å¯æ ¹æ®Xt =\u0026gt; Xt-1ï¼Œ ä¸‹å¼ä¸ºæœ€ç»ˆçš„å»å™ªå…¬å¼ $$ x = \\frac{1}{\\sqrt{\\alpha}} \\left( x - \\frac{1 - \\alpha}{\\sqrt{1 - \\alpha_{\\text{hat}}}} \\cdot \\text{predicted_noise} \\right) + \\sqrt{\\beta} \\cdot \\text{noise} $$ Î² noise ä¿è¯å¤šæ ·æ€§\nÆÎ¸è¡¨ç¤ºé¢„æµ‹æ¨¡å‹\nä»£ç é€»è¾‘\nè®­ç»ƒï¼š\n1for i, images in enumerate(pbar): 2 images = images.to(device) 3 t = diffusion.sample_timesteps(images.shape[0]).to(device)\t# é‡‡æ ·å‡ ä¸ªæ—¶é—´æ­¥è¿›è¡Œè®­ç»ƒ 4 x_t, noise = diffusion.noise_images(images, t)\t# @ å…¬å¼-7 5 predicted_noise = model(x_t, t)\t# Unet 6 loss = mse(noise, predicted_noise) 7 8 optimizer.zero_grad() 9 loss.backward() 10 optimizer.step() 11 12sampled_images = diffusion.sample(model, n=images.shape[0]) # @ å»å™ªå…¬å¼ é¢„æµ‹æ¨¡å‹\nUnet å¸¦æ—¶é—´ç‚¹åµŒå…¥(ç”¨ä½™å¼¦-ä½ç½®åµŒå…¥å®ç°çš„)\n1def forward(self, x, t): 2 t = t.unsqueeze(-1).type(torch.float) 3 t = self.pos_encoding(t, self.time_dim)\t# åµŒå…¥æ—¶é—´æ­¥é¡ºåº 4 5 x1 = self.inc(x)\t# cnn 6 x2 = self.down1(x1, t) # pooling 7 x2 = self.sa1(x2)\t# self attention 8 x3 = self.down2(x2, t) 9 x3 = self.sa2(x3) 10 x4 = self.down3(x3, t) 11 x4 = self.sa3(x4) 12 13 x4 = self.bot1(x4)\t14 x4 = self.bot2(x4) 15 x4 = self.bot3(x4) 16 17 x = self.up1(x4, x3, t)\t# æ’å€¼ä¸Šé‡‡æ ·ï¼Œå†æ‹¼æ¥skip connect 18 x = self.sa4(x) 19 x = self.up2(x, x2, t) 20 x = self.sa5(x) 21 x = self.up3(x, x1, t) 22 x = self.sa6(x) 23 output = self.outc(x) 24 return output p(Xt-2|Xt-1, t, y) tæ˜¯æ—¶é—´æ­¥åµŒå…¥ï¼Œyæ˜¯æ¡ä»¶åµŒå…¥\næœ€ç®€å•çš„èåˆæ–¹æ³•å°±æ˜¯ç›¸åŠ \nï¼Ÿï¼Ÿï¼Ÿ ç–‘æƒ‘ç‚¹ - åå‘è¿‡ç¨‹æ±‚çš„tæ—¶åˆ»çš„å‡å€¼æ–¹å·®ç”¨åœ¨å“ªäº†ï¼Ÿ\n2025/1/14 æ›´æ–°ï¼š\n// X =\u0026gt; X_noise_t å¯ä»¥ä¸€æ­¥ç”Ÿæˆï¼Œå¯ä»¥æ—¶é—´æ­¥tå¯ä»¥ç›´æ¥ç”Ÿæˆå¯¹åº”tæ—¶é—´æ­¥çš„å™ªå£°å›¾ã€‚\n// ä½¿ç”¨U-neté¢„æµ‹æ—¶é—´æ­¥tçš„å™ªå£° ä½¿ç”¨MSE-Lossè¿›è¡Œè®­ç»ƒ\n1# è®­ç»ƒå¾ªç¯ 2for epoch in range(num_epochs): 3 for x_0 in dataloader: # x_0 æ˜¯åŸå§‹æ•°æ® 4 # 1. éšæœºé€‰æ‹©ä¸€ä¸ªæ—¶é—´æ­¥ t 5 t = torch.randint(0, T, (x_0.size(0),)) # ä¸ºæ¯ä¸ªæ ·æœ¬éšæœºé€‰æ‹©ä¸€ä¸ªæ—¶é—´æ­¥ 6 7 # 2. å‰å‘è¿‡ç¨‹ï¼šæ·»åŠ å™ªå£° 8 epsilon = torch.randn_like(x_0) # é‡‡æ ·å™ªå£° 9 alpha_bar_t_t = alpha_bar_t[t].view(-1, 1, 1, 1) # é€‰æ‹©å¯¹åº”æ—¶é—´æ­¥çš„ alpha_bar_t 10 x_t = torch.sqrt(alpha_bar_t_t) * x_0 + torch.sqrt(1 - alpha_bar_t_t) * epsilon # æ·»åŠ å™ªå£° 11 12 # 3. åå‘è¿‡ç¨‹ï¼šé¢„æµ‹å™ªå£° 13 predicted_epsilon = model(x_t, t) # æ¨¡å‹é¢„æµ‹å™ªå£° 14 15 # 4. è®¡ç®—æŸå¤±å‡½æ•° 16 loss = F.mse_loss(predicted_epsilon, epsilon) # å‡æ–¹è¯¯å·®æŸå¤± 17 18 # 5. åå‘ä¼ æ’­å’Œä¼˜åŒ– 19 optimizer.zero_grad() 20 loss.backward() 21 optimizer.step() // ä¸²è¡Œï¼Œä¸€æ­¥ä¸€æ­¥å»å™ª\n1# ç”Ÿæˆè¿‡ç¨‹ 2def generate_samples(model, num_samples, T, alpha_bar_t): 3 x_T = torch.randn(num_samples, ...) # ä»æ ‡å‡†æ­£æ€åˆ†å¸ƒä¸­é‡‡æ ·åˆå§‹å™ªå£° 4 for t in range(T-1, 0, -1): # ä» T-1 åˆ° 1 5 # é¢„æµ‹å™ªå£° 6 epsilon = model(x_T, t) 7 8 # è®¡ç®—å»å™ªåçš„æ•°æ® \u0026lt;= æ¶ˆé™¤å™ªå£° 9 alpha_t = alpha_bar_t[t] / alpha_bar_t[t-1] 10 x_T = (x_T - torch.sqrt(1 - alpha_t) * epsilon) / torch.sqrt(alpha_t) 11 12 return x_T Time-Frequency Consistency - NeurIPS 2022 Self-Supervised Contrastive Pre-Training for Time Series via Time-Frequency Consistency\næœŸæœ›åŒä¸€ç¤ºä¾‹çš„åŸºäºæ—¶é—´å’ŒåŸºäºé¢‘ç‡çš„è¡¨ç¤ºåœ¨æ—¶é¢‘ç©ºé—´ä¸­é è¿‘åœ¨ä¸€èµ·\n(åˆ¤åˆ«å¼æ— ç›‘ç£å­¦ä¹ )\npretext taskï¼šå®ä¾‹åˆ¤åˆ« (ä¸€å¯¹æ­£æ ·æœ¬ï¼Œå…¶ä½™è´Ÿæ ·æœ¬)\næ¡†æ¶\næ—¶åŸŸå¢å¼ºï¼šåŸºäºæ—¶é—´ç‰¹æ€§ä» xi æ‰©å……ï¼ŒåŒ…æ‹¬æŠ–åŠ¨ã€ç¼©æ”¾ã€æ—¶ç§»å’Œé‚»åŸŸåˆ†æ®µï¼›\né¢‘åŸŸå¢å¼ºï¼šé¢‘è°±ç‰¹å¾æ‰°åŠ¨ xFi çš„å¢å¼ºï¼Œæ·»åŠ æˆ–åˆ é™¤é¢‘ç‡åˆ†é‡æ¥æ‰°åŠ¨é¢‘è°± (ç¡®ä¿æ‰°åŠ¨æ—¶é—´åºåˆ—ä»ç„¶ä¸åŸå§‹æ ·æœ¬åœ¨é¢‘åŸŸå’Œæ—¶åŸŸä»ç›¸ä¼¼)\nLossï¼š\nä½™å¼¦ç›¸ä¼¼åº¦ï¼šè¡¡é‡ä¸¤ä¸ªå‘é‡ä¹‹é—´ç›¸ä¼¼æ€§ï¼ŒèŒƒå›´[-1, 1]\n// è¡¥å…… 2025/1/14\næ ·æœ¬è¶Šç›¸ä¼¼ =\u0026gt; sim(i, j) è¶Šå¤§ =\u0026gt; exp(sim) è¶Šå¤§ =\u0026gt; exp(sim)/\\sum(exp) è¶Šæ¥è¿‘äº1 =\u0026gt; log(Â·)è¶Šæ¥è¿‘äº0\n-log(Â·) å°†å›¾åƒå€’ç½®ï¼Œæ ·æœ¬è¶Šä¸ç›¸ä¼¼ =\u0026gt; exp(sim)/\\sum(exp) è¶Šæ¥è¿‘äº0 =\u0026gt; loss è¶Šå¤§\nCOMET - NeurIPS 2023 Contrast Everything A Hierarchical Contrastive Framework for Medical Time-Series\n(åˆ¤åˆ«å¼æ— ç›‘ç£å­¦ä¹ )\næˆ‘ä»¬çš„æ–¹æ³•æ—¨åœ¨å¼¥åˆæ ‡è®°æ•°æ®çš„æœ‰é™å¯ç”¨æ€§ä¸åŒ»ç–—æ—¶é—´åºåˆ—åˆ†æä¸­ç¨³å¥ä¸”å¯æ¦‚æ‹¬çš„æ¨¡å‹çš„éœ€æ±‚ä¹‹é—´çš„å·®è· å¯¹æ¯”è¡¨ç¤ºå­¦ä¹ èƒŒåçš„å…³é”®æ€æƒ³æ˜¯é€šè¿‡å°†ç›¸ä¼¼çš„æ•°æ®é è¿‘åœ¨ä¸€èµ·å¹¶å°†ä¸ç›¸ä¼¼çš„æ•°æ®è¿›ä¸€æ­¥åˆ†å¼€æ¥æŒ–æ˜æ•°æ®ä¸€è‡´æ€§ å…³é”®æ˜¯è¦åˆ©ç”¨æ‰€æœ‰å¯ç”¨çš„ä¿¡æ¯ï¼›é™¤äº†æ ·æœ¬æ ‡ç­¾ä¹‹å¤–ï¼Œæ•°æ®é›†æ˜¯å¦è¿˜æœ‰å…¶ä»–ä¿¡æ¯ï¼Ÿ(è¡¥å……ä¿¡æ¯)\næ‚£è€…é—´ã€æ‚£è€…å†…è¿›è¡Œæµ‹è¯•(å®šä¹‰æ‰“ä¹±è§„åˆ™)\nâ­â­â­å¤šçº§ä¿¡æ¯\nå¤šçº§å¯¹æ¯”å­¦ä¹ æ¡†æ¶\nä»£ç åˆ†ææ€»ç»“\n1X_train.size == [Batch, channels, segment] # segment length 330, sampling_rate = 250Hz 2y_train # å¿ƒè‚Œæ¢—å¡äºŒåˆ†ç±»æ ‡ç­¾ï¼Œ patient_idï¼Œ segment_id ç»†åˆ†ä¸ºæ ·æœ¬çº§åˆ«(å¿ƒè·³)ï¼Œæ•…å›¾ç¤ºEncoderä¸åŒçº§åˆ«å¯¹æ¯”å­¦ä¹ å¯å¤ç”¨\nå…³é”®ï¼Œè®¡ç®—ä¸åŒçº§åˆ«çš„å¯¹æ¯”Loss\nPatient-Level Loss\n1x = [Batch, channels, segment] 2 3out1 = net(x) 4out2 = net(x) # ? æ¨¡æ‹Ÿæ•°æ®å¢å¼ºåçš„ä¸åŒè§†è§’æˆ–ç‰ˆæœ¬ï¼Œä»¥ä¾¿åœ¨å¯¹æ¯”å­¦ä¹ ä¸­ç”Ÿæˆæœ‰æ•ˆçš„æ­£ä¾‹å’Œè´Ÿä¾‹ 5 6# æ ¹æ®y_train ç—…äººidï¼Œæ„å»ºmaskçŸ©é˜µ 7pid1, pid2 = np.meshgrid(str_pid, str_pid)\t8pid_matrix = pid1 + \u0026#39;-\u0026#39; + pid2\t# æ¯é¡¹ä¸º id_x - id_y\t9# ç›®æ ‡ä½ç½® id_x - id_x 10pids_of_interest = np.unique(str_pid + \u0026#39;-\u0026#39; + str_pid) # unique combinations of pids of interest i.e. matching 11bool_matrix_of_interest = np.zeros((len(str_pid), len(str_pid))) 12for pid in pids_of_interest: 13 bool_matrix_of_interest += pid_matrix == pid 14 15# ä¸Šä¸‰è§’å’Œä¸‹ä¸‰è§’ç›®æ ‡rowï¼Œcol 16rows1, cols1 = np.where(np.triu(bool_matrix_of_interest, 1)) # upper triangle same patient combs 17rows2, cols2 = np.where(np.tril(bool_matrix_of_interest, -1)) # down triangle same patient combs 18 19out1, out2 =\u0026gt; sim_matrix_exp # ä½™å¼¦ç›¸ä¼¼åº¦çŸ©é˜µ 20 21# @@ å¯¹æ¯”å­¦ä¹ ï¼šä¸è€ƒè™‘å¯¹è§’çº¿å…ƒç´ çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºå¯¹è§’çº¿å…ƒç´ è¡¨ç¤ºçš„æ˜¯ç‰¹å¾å‘é‡ä¸å…¶è‡ªèº«çš„ç›¸ä¼¼åº¦ 22# @@ æˆ‘ä»¬å…³æ³¨çš„æ˜¯å¦‚ä½•ä½¿å…·æœ‰ç›¸åŒæ ‡ç­¾çš„ä¸åŒç‰¹å¾å‘é‡ä¹‹é—´æ›´ç›¸è¿‘ï¼Œè€Œä½¿ä¸åŒæ ‡ç­¾çš„ç‰¹å¾å‘é‡ä¹‹é—´æ›´ç–è¿œ 23 24# Loss åˆ†æ¯ï¼Œ æŸæ ·æœ¬ä¸å…¶ä»–æ ·æœ¬ç›¸ä¼¼åº¦ä¹‹å’Œï¼Œ @åˆ†ä¸Šä¸‰è§’å’Œä¸‹ä¸‰è§’ 25triu_sum = torch.sum(sim_matrix_exp, 1) # add column 26tril_sum = torch.sum(sim_matrix_exp, 0) # add row 27 28loss_terms = 0 # å–å¹³å‡ 29if len(rows1) \u0026gt; 0: 30 triu_elements = sim_matrix_exp[rows1, cols1] # row and column for upper triangle same patient combinations 31 loss_triu = -torch.mean(torch.log(triu_elements / triu_sum[rows1])) 32 loss += loss_triu # technically need to add 1 more term for symmetry 33 loss_terms += 1 34... 35 36loss = loss/loss_terms Trial-Level Loss\nåŒä¸Šï¼Œåªä¸è¿‡patient_id =\u0026gt; segment_id\nâŒâŒâŒSample-Level Loss \u0026amp; Observation-Level Loss\nçœ‹ä¸æ‡‚æºç ~ ğŸ˜ğŸ˜­\nTS2Vec - AAAI 22 TS2Vec: Towards Universal Representation of Time Series\n(åˆ¤åˆ«å¼æ— ç›‘ç£å­¦ä¹ )\nç°å­˜å·¥ä½œå±€é™ï¼š\nå®ƒä»¬éƒ½æ²¡æœ‰ä»¥ä¸åŒå°ºåº¦çš„æ—¶é—´åºåˆ—ä¸ºç‰¹å¾æ¥æ•è·å°ºåº¦ä¸å˜çš„ä¿¡æ¯ï¼Œè€Œè¿™å¯¹äºæ—¶é—´åºåˆ—ä»»åŠ¡çš„æˆåŠŸè‡³å…³é‡è¦ã€‚å¤šå°ºåº¦ç‰¹å¾å¯ä»¥æä¾›ä¸åŒçº§åˆ«çš„è¯­ä¹‰å¹¶æé«˜å­¦ä¹ è¡¨ç¤ºçš„æ³›åŒ–èƒ½åŠ› ç²—ç²’åº¦è¡¨ç¤º - æ•´ä¸ªæ—¶é—´åºåˆ—ï¼Œå¯èƒ½æ²¡é‚£ä¹ˆç»†è‡´ ä¹‹å‰å·¥ä½œçš„é—®é¢˜\næ­£æ ·æœ¬å¯¹ä¼šè¯¯åˆ¤\nå½“å­˜åœ¨æ°´å¹³åç§»æ—¶ï¼Œå­ç³»åˆ—ä¸€è‡´æ€§å¾ˆå®¹æ˜“å—åˆ°æ”»å‡» (å·¦å›¾) å½“å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ—¶é—´ä¸€è‡´æ€§å¯èƒ½ä¼šå¼•å…¥è¯¯æŠ¥å¯¹ (å³å›¾) åˆ›æ–°ï¼š\nTS2Vec ä¸­çš„å¯¹æ¯”ç›®æ ‡åŸºäºå¢å¼ºä¸Šä¸‹æ–‡è§†å›¾ï¼Œå³ç›¸åŒå­ç³»åˆ—åœ¨ä¸¤ä¸ªå¢å¼ºä¸Šä¸‹æ–‡ä¸­çš„è¡¨ç¤ºåº”è¯¥æ˜¯ä¸€è‡´çš„ (ä¸Šä¸‹æ–‡è¯­å¢ƒä¸‹) å±‚çº§å¼å¯¹æ¯”Lossï¼Œç”±ç»†ç²’åº¦=\u0026gt;ç²—ç²’åº¦ï¼Œå±€éƒ¨åˆ°å…¨å±€ # å­¦ä¹ å„ç§è¯­ä¹‰çº§åˆ«çš„ä»»æ„å­ç³»åˆ—çš„ä¸Šä¸‹æ–‡è¡¨ç¤ºï¼Œçµæ´»ä¸”é€šç”¨çš„è¡¨ç¤ºã€‚ é¡¶çº§è¯­ä¹‰çº§åˆ«çš„å¯¹æ¯”ä½¿æ¨¡å‹èƒ½å¤Ÿå­¦ä¹ å®ä¾‹(æ ·æœ¬)çº§è¡¨ç¤º æ¡†æ¶\næµç¨‹ï¼š\nå®ä¾‹(ä¸€æ®µä¿¡å·)ï¼Œåˆ†ä¸¤ä¸ªé‡å çš„å­åºåˆ—, [batch, channel, dim_feature] æŠ•å½±ï¼Œ[batch, channel, dim_feature] =\u0026gt; [batch, channel, dim_hidden] éšæœºMaskæ‰éƒ¨åˆ†ä¿¡å· CNN-Encoder â­â­â­ Hierarchical Contrasting Loss\ninstance \u0026amp; temporal contrastive loss *ç”¨ -F.log_softmax(x, dim=-1) å®ç°* z1 = F.max_pool1d(z1.transpose(1, 2), kernel_size=2).transpose(1, 2) z2 = F.max_pool1d(z2.transpose(1, 2), kernel_size=2).transpose(1, 2)\nç¼–ç ç‰¹å¾æµ“ç¼©ï¼Œå¤šå°ºåº¦çš„Contrast loss\nå›¾ç¤ºLossè¿‡ç¨‹\nå­åºåˆ—æ˜¯ä»åŸå§‹ä¿¡å·ä¸­è£å‰ªä¸‹æ¥çš„ï¼Œå¹¶ä¸”æœ‰é‡å éƒ¨åˆ†\nåŒè‰²æ˜¯ç›¸åŒæ ·æœ¬ï¼Œæ·±æµ…è‰²è¡¨ç¤ºåŒä¸€æ ·æœ¬é‡å çš„ä¸¤æ®µ\nTimesURL - AAAI 2024 TimesURL: Self-Supervised Contrastive Learning for Universal Time Series Representation Learning\nä»£ç åœ¨TS2Vecä¸Šä¿®æ”¹\n=\u0026gt; åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¿…é¡»æåˆ°ï¼Œé‡è¦çš„æ—¶é—´å˜åŒ–ä¿¡æ¯ï¼Œä¾‹å¦‚è¶‹åŠ¿å’Œå­£èŠ‚ï¼Œåœ¨å¤šæ¬¡æœ€å¤§æ± åŒ–æ“ä½œåä¼šä¸¢å¤±ï¼Œå› æ­¤é¡¶å±‚å¯¹æ¯”å®é™…ä¸Šæ— æ³•ä¸ºä¸‹æ¸¸ä»»åŠ¡æ•è·è¶³å¤Ÿçš„å®ä¾‹çº§ä¿¡æ¯\n=\u0026gt; æ©ç é‡å»ºè¿›è¡Œå­¦ä¹ å®ä¾‹çº§ä¿¡æ¯\n(åˆ¤åˆ«å¼+ç”Ÿæˆå¼ æ··åˆ æ— ç›‘ç£å­¦ä¹ )\nè§‚å¯Ÿ\n**ç®€å•è´Ÿæ ·æœ¬ï¼š**å¤§å¤šæ•°æ—¶é—´åºåˆ—ç‰‡æ®µå¯ä»¥è¢«è§†ä¸ºå®¹æ˜“è´Ÿæ ·æœ¬ã€‚ è¿™äº›ç‰‡æ®µå¾€å¾€è¡¨ç°å‡ºä¸é”šç‚¹çš„è¯­ä¹‰å·®å¼‚ï¼Œå¹¶ä¸”ä»…è´¡çŒ®è¾ƒå°çš„æ¢¯åº¦ï¼Œå› æ­¤æ— æ³•æä¾›æœ‰ç”¨çš„åŒºåˆ†ä¿¡æ¯\nç¡¬è´Ÿæ ·æœ¬ï¼š ç¡¬è´Ÿæ ·æœ¬å°±æ˜¯ç¦»æ­£æ ·æœ¬å¾ˆè¿‘ï¼Œå¹¶ä¸”æ¨¡å‹å¾ˆéš¾åŒºåˆ«çš„\næ­£æ ·æœ¬-ç¡¬è´Ÿæ ·æœ¬-è´Ÿæ ·æœ¬ï¼šï¼Œè¿™äº›æ ·æœ¬å¦‚æœè®©å…¶è¿œç¦»æ­£æ ·æœ¬å¯ä»¥å¤§å¤§æé«˜æ¨¡å‹æ€§èƒ½ã€‚ å…¶æœ‰æ•ˆæ€§è¢«å¤§é‡çš„ç®€å•è´Ÿæ ·æœ¬æ‰€æ©ç›–ã€‚ï¼ˆç°å­˜æ¡†æ¶æ²¡æœ‰ç‰¹ç‚¹æ˜¾ç¤ºçš„æŒ‡å‡ºï¼‰\nç”±äºæ—¶é—´åºåˆ—ä¸­çš„å±€éƒ¨å¹³æ»‘æ€§å’Œé©¬å°”å¯å¤«ç‰¹æ€§ï¼Œå¤§å¤šæ•°è´Ÿæ ·æœ¬å¾ˆå®¹æ˜“ä¸è¶³ä»¥æ•è·æ—¶é—´ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä»¬ä»æ ¹æœ¬ä¸Šç¼ºä¹é©±åŠ¨å¯¹æ¯”å­¦ä¹ æ‰€éœ€çš„å­¦ä¹ ä¿¡å·ã€‚ ä½œä¸ºå›¾ 2 ä¸­çœŸå®ç¤ºä¾‹ï¼Œå¯¹äºæ¯ä¸ªæ­£é”šç‚¹ï¼ˆçº¢è‰²æ–¹å—ï¼‰ï¼Œç›¸åº”çš„è´Ÿæ ·æœ¬ï¼ˆç°è‰²æ ‡è®°ï¼‰åŒ…å«è®¸å¤šç®€å•çš„è´Ÿæ ·æœ¬å’Œå¾ˆå°‘çš„å›°éš¾è´Ÿæ ·æœ¬ï¼Œå³è®¸å¤šè´Ÿç‰‡å¤ªè¿œï¼Œæ— æ³•é€ æˆå¯¹æ¯”æŸå¤±ã€‚\nå¯¹æ¯”å­¦ä¹ çš„ä¸€ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†æ˜¯é€‰æ‹©é€‚å½“çš„å¢å¼ºï¼Œè¿™äº›å¢å¼ºå¯ä»¥æ–½åŠ ä¸€äº›å…ˆéªŒæ¥æ„å»ºå¯è¡Œçš„æ­£æ ·æœ¬ï¼Œä»¥ä¾¿ç¼–ç å™¨å¯ä»¥è¢«è®­ç»ƒæ¥å­¦ä¹ é²æ£’å’Œæœ‰åŒºåˆ«çš„è¡¨ç¤º\né¢‘ç‡æ··åˆç”¨äºé€šè¿‡å°†é€šè¿‡å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFFTï¼‰è¿ç®—è®¡ç®—å‡ºçš„ä¸€ä¸ªè®­ç»ƒå®ä¾‹ xi ä¸­çš„ä¸€å®šæ¯”ä¾‹çš„é¢‘ç‡åˆ†é‡æ›¿æ¢ä¸ºåŒä¸€æ‰¹æ¬¡ä¸­çš„å¦ä¸€ä¸ªéšæœºè®­ç»ƒå®ä¾‹ xk çš„ç›¸åŒé¢‘ç‡åˆ†é‡æ¥ç”Ÿæˆæ–°çš„ä¸Šä¸‹æ–‡è§†å›¾ ï¼ˆä¿æŒç—…ç†ç›¸åŒï¼‰\néšæœºè£å‰ªã€‚ é‡å ä¸¤ä¸ªå­åºåˆ— - éšæœºè£å‰ªæ˜¯ä¸Šä¸‹æ–‡ä¸€è‡´æ€§ç­–ç•¥çš„å…³é”®æ­¥éª¤ã€‚ å®ƒå¯ä»¥ä¿æŒæ—¶é—´åºåˆ—çš„é‡è¦æ—¶é—´å…³ç³»å’Œè¯­ä¹‰ä¸€è‡´æ€§\nåˆ›æ–°ç‚¹ï¼š\næå‡ºåŒUniversumæ¦‚å¿µï¼Œå°±æ˜¯åˆ©ç”¨Mix-upå¢å¼ºF(x)ï¼Œè¿½åŠ ç¡¬è´Ÿæ ·æœ¬ã€‚ å¯¹æ¯”å­¦ä¹ +è‡ªç›‘ç£æ©ç é‡å»ºï¼Œè”åˆä¼˜åŒ–ï¼Œæ¥æ•è·æ®µçº§å’Œå®ä¾‹çº§ä¿¡æ¯ï¼Œ å®ç°é€šç”¨è¡¨ç¤º â­ ç¬¬ä¸€ç±»åŒ…æ‹¬é¢„æµ‹ã€å¼‚å¸¸æ£€æµ‹å’Œæ’è¡¥ï¼Œå®ƒä»¬æ›´å¤šåœ°ä¾èµ–äºåœ¨åˆ†æ®µçº§åˆ«æ•è·çš„ç»†ç²’åº¦ä¿¡æ¯ï¼Œå› ä¸ºè¿™äº›ä»»åŠ¡éœ€è¦æ¨æ–­ç‰¹å®šçš„æ—¶é—´æˆ³æˆ–å­åºåˆ—ã€‚ç»†ç²’åº¦(å±€éƒ¨)\nâ­ ç¬¬äºŒç±»åŒ…æ‹¬åˆ†ç±»å’Œèšç±»ä¼˜å…ˆè€ƒè™‘å®ä¾‹çº§ä¿¡æ¯ï¼ˆå³ç²—ç²’åº¦ä¿¡æ¯ï¼‰ï¼Œæ—¨åœ¨æ¨æ–­æ•´ä¸ªç³»åˆ—çš„ç›®æ ‡ã€‚ç²—ç²’åº¦(å…¨å±€)\nå®ç° : åˆ†æ®µ(å¯¹æ¯”å­¦ä¹ ï¼Œå­¦ä¹ ç‰‡æ®µ)ï¼Œæ•´å¥(æ©ç é‡å»ºï¼Œå­¦ä¹ æ•´ä½“)\næ¡†æ¶ï¼š\nAUGï¼š\né¢‘ç‡å¢å¼ºï¼Œ**x =\u0026gt; fft() =mask+fusion=\u0026gt; ifft() =\u0026gt; y**ï¼Œâ‘ è¯¥ç¯‡è®ºæ–‡fusionæ˜¯èåˆåŒbatchå…¶ä»–ä¿¡å·çš„æŸäº›éƒ¨åˆ† =\u0026gt; é¢†åŸŸåˆ›æ–° ï¼ˆfusionçš„ä¿¡å·åº”è¯¥å’Œè¿™ä¸ªä¿¡å·ç›¸åŒç—…ç†ï¼Œæ‰©å¼ æ•°æ®åˆ†å¸ƒï¼‰\rDualConvï¼š\nåŸå§‹ä¿¡å·çš„ä¸¤ä¸ªå¢å¼ºå­è§†å›¾ï¼Œz1 = Encoder(x1), z1' = Encoder(x1'), =\u0026gt; mix-up option =\u0026gt; **z1_mix = Î± Ã— z1 + (1-Î±) Ã— z1[torch.randperm(z1.shape[0])]**ï¼Œz1'_mixã€‚ [z1, z1', z1_mix, z1'mix] @ [z1, z1', z1_mix, z1'mix].T =\u0026gt; sim =\u0026gt; **-F.log_softmax(sim)**\rloss: ä¿©è§†å›¾å¯¹åº”æ®µä¸ºæ­£æ ·æœ¬(åˆ†å­)\rè´Ÿæ ·æœ¬åœ¨æ¯åˆ†ï¼Œx_mixåšè´Ÿæ ·æœ¬å¢å¼ºã€‚\nMixup - 2017 Machine Learning mixup: BEYOND EMPIRICAL RISK MINIMIZATION\nä¸€ç§ç®€å•å¹¶ä¸”ä¸éœ€è¦ä¸“ä¸šé¢†åŸŸçŸ¥è¯†çš„æ•°æ®å¢å¼º\nç°å­˜é—®é¢˜è®¨è®ºï¼š\nè¿‡æ‹Ÿåˆ(å¤§æ¨¡å‹ï¼Œç›´æ¥è®°å¿†Train dataï¼Œèµ°æ·å¾„) - overfitting ç²¾å¿ƒè®¾è®¡æ ·æœ¬(å¯¹æŠ—æ€§ä¾‹å­ï¼Œäººéš¾ä»¥å¯Ÿè§‰ï¼Œä½†æ¨¡å‹ä¼šç»™å‡ºé”™è¯¯çš„ç­”æ¡ˆ) - generalize ğŸ‘‡\nERM(ç»éªŒé£é™©æœ€å°åŒ–åŸåˆ™)é—®é¢˜\nä¸€æ–¹é¢ï¼Œå³ä½¿å­˜åœ¨å¼ºæ­£åˆ™åŒ–ï¼ŒERM ä¹Ÿå…è®¸å¤§å‹ç¥ç»ç½‘ç»œè®°å¿†ï¼ˆè€Œä¸æ˜¯å½’çº³ï¼‰è®­ç»ƒæ•°æ® å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨ ERM è®­ç»ƒçš„ç¥ç»ç½‘ç»œåœ¨å¯¹è®­ç»ƒåˆ†å¸ƒä¹‹å¤–çš„ç¤ºä¾‹è¿›è¡Œè¯„ä¼°æ—¶ä¼šæå¤§åœ°æ”¹å˜å…¶é¢„æµ‹ã€‚ CV: å›¾åƒçš„é‚»è¿‘åŒºåŸŸå®šä¹‰ä¸ºå…¶æ°´å¹³åå°„ã€è½»å¾®æ—‹è½¬å’Œè½»å¾®ç¼©æ”¾çš„é›†åˆ\n=\u0026gt; æ•°æ®å¢å¼ºå§‹ç»ˆå¯ä»¥æé«˜æ³›åŒ–èƒ½åŠ›, ä½†è¯¥è¿‡ç¨‹ä¾èµ–äºæ•°æ®é›†ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ä¸“å®¶çŸ¥è¯† ï¼ˆä¸åŒé¢†åŸŸå¢å¼ºä¸ä¸€å®šé€šç”¨ï¼‰\næ•°æ®å¢å¼ºå‡è®¾é‚»è¿‘çš„ç¤ºä¾‹å…±äº«åŒä¸€ç±»ï¼Œå¹¶ä¸”ä¸ä¼šå¯¹ä¸åŒç±»çš„ç¤ºä¾‹ä¹‹é—´çš„é‚»è¿‘å…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚(èšç±»)\n=\u0026gt; é‚»è¿‘é£é™©æœ€å°åŒ– (VRM) åŸåˆ™\nâ­=\u0026gt; ä»è®­ç»ƒæ ·ä¾‹çš„é‚»è¿‘åˆ†å¸ƒä¸­æå–é¢å¤–çš„è™šæ‹Ÿæ ·ä¾‹ï¼Œä»¥æ‰©å¤§è®­ç»ƒåˆ†å¸ƒçš„æ”¯æŒåº¦\næ–¹æ³•ï¼š\næ¡†æ¶ä¼ªä»£ç ï¼š\nå›¾ä¾‹ï¼š\nè™šæ‹Ÿæ•°æ®ï¼Œè®©æ•°æ®è¾¹ç•Œè¿‡æ¸¡ï¼› å½“ä¸åœ¨Trainæ•°æ®çš„åˆ†å¸ƒå‡ºç°æ—¶ï¼Œé™ä½ä¸ç¡®å®šæ€§ã€‚ ç¨å¾®æ¸…æ™°åŒ–è¾¹ç•Œ\nYOLO-v1 - CVPR 2016 You Only Look Once: Unified, Real-Time Object Detection\nâ­å°†ç›®æ ‡æ£€æµ‹è§†ä½œå›å½’é—®é¢˜ =\u0026gt; é¢„æµ‹å‡ºæ¥\nå‰å‘æ¨ç†\nModel:\ninput: [3, 448, 448] =\u0026gt; output: [30, 7, 7]\nç½®ä¿¡åº¦(confidence): è¿™ä¸ªå€¼ä»£è¡¨äº†æ¨¡å‹è®¤ä¸ºé¢„æµ‹çš„è¾¹ç•Œæ¡†å†…å­˜åœ¨å¯¹è±¡çš„æ¦‚ç‡\næ¡†çš„ä¸­å¿ƒåæ ‡ + å®½é«˜\næ¡†ä¸­çš„ç‰©ä½“æ˜¯ä»€ä¹ˆç±»\néæå¤§å€¼æŠ‘åˆ¶ ï¼ˆæœ€ä½³ï¼šæ¯ä¸ªç±»åˆ«ç‹¬ç«‹æ‰§è¡Œéæå¤§å€¼æŠ‘åˆ¶ï¼Œä»è€Œæ›´ç²¾ç¡®åœ°å¤„ç†å¤šç±»åˆ«æƒ…å†µï¼‰\nç½®ä¿¡åº¦æ’åºï¼šé¦–å…ˆå°†æ‰€æœ‰çš„é¢„æµ‹è¾¹ç•Œæ¡†æŒ‰ç…§å®ƒä»¬çš„ç½®ä¿¡åº¦ï¼ˆconfidence scoresï¼‰è¿›è¡Œé™åºæ’åºã€‚ é€‰æ‹©æœ€é«˜ç½®ä¿¡åº¦è¾¹ç•Œæ¡†ï¼šä»æ’åºåçš„åˆ—è¡¨ä¸­é€‰æ‹©ç½®ä¿¡åº¦æœ€é«˜çš„è¾¹ç•Œæ¡†ä½œä¸ºå‚è€ƒæ¡†ï¼ˆreference boxï¼‰ã€‚ è®¡ç®—IOUï¼šè®¡ç®—é€‰ä¸­çš„å‚è€ƒæ¡†ä¸åˆ—è¡¨ä¸­å…¶ä»–æ‰€æœ‰è¾¹ç•Œæ¡†çš„äº¤å¹¶æ¯”ï¼ˆIOUï¼‰ã€‚äº¤å¹¶æ¯”æ˜¯ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„äº¤é›†é¢ç§¯ä¸å®ƒä»¬çš„å¹¶é›†é¢ç§¯çš„æ¯”å€¼ã€‚ æŠ‘åˆ¶ï¼šå¦‚æœå‚è€ƒæ¡†ä¸ä»»ä½•å…¶ä»–è¾¹ç•Œæ¡†çš„IOUè¶…è¿‡é¢„å…ˆè®¾å®šçš„é˜ˆå€¼ï¼ˆé€šå¸¸è®¾ç½®ä¸º0.5ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›è¾¹ç•Œæ¡†ä¼šè¢«è®¤ä¸ºæ˜¯å¤šä½™çš„ï¼Œå¹¶ä»åˆ—è¡¨ä¸­åˆ é™¤ã€‚ é‡å¤æ­¥éª¤ï¼šä»å‰©ä½™çš„è¾¹ç•Œæ¡†åˆ—è¡¨ä¸­å†æ¬¡é€‰æ‹©ç½®ä¿¡åº¦æœ€é«˜çš„è¾¹ç•Œæ¡†ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰çš„è¾¹ç•Œæ¡†éƒ½è¢«å¤„ç†å®Œæ¯•ã€‚ æœ€ç»ˆç»“æœï¼šç»è¿‡éæå¤§å€¼æŠ‘åˆ¶åï¼Œå‰©ä½™çš„è¾¹ç•Œæ¡†è¢«è®¤ä¸ºæ˜¯å¯¹ç›®æ ‡ä½ç½®çš„æœ€ä½³é¢„æµ‹ï¼Œå®ƒä»¬å°†è¢«ç”¨äºæœ€ç»ˆçš„ç›®æ ‡æ£€æµ‹è¾“å‡ºã€‚ è®­ç»ƒï¼š\nÎ»coord = 5, Î»noobj = 0.5, è°ƒæ•´å„ä¸ªéƒ¨åˆ†çš„é‡è¦æ€§ $$ 1_{ij}^{obj}: è¡¨ç¤ºç¬¬ijä¸ªæ ¼å­æœ‰å¯¹è±¡ \\ 1_{ij}^{noobj}: è¡¨ç¤ºç¬¬ijä¸ªæ ¼å­æ²¡æœ‰å¯¹è±¡\\ S^{2}: å›¾ç‰‡åˆ’åˆ†æ ¼å­ \\ B: æ¯ä¸ªæ ¼å­é¢„æµ‹å¤šå°‘ä¸ªæ¡† $$ bounding box loss : ä¸­å¿ƒç‚¹ + æ¡†å®½é«˜\nconfidence: æ ¼å­æ˜¯å¦æœ‰å¯¹è±¡\nclassesï¼šæ ¼å­åˆ†ç±»æ˜¯å¦æ­£ç¡®\nSemi-Supervised Hybrid Loss - Machine Learning 2023 Semi-Supervised End-To-End Contrastive Learning For Time Series Classification\n1ï¸âƒ£æ— æ ‡ç­¾æ•°æ®å¯¹æ¯”å­¦ä¹ (å¢å¼ºè§†å›¾ä¸€è‡´æ€§)ï¼Œ2ï¸âƒ£æœ‰æ ‡ç­¾å¯¹æ¯”å­¦ä¹ (ç›¸åŒç§ç±»ä¸€è‡´æ€§)ï¼Œ3ï¸âƒ£æœ‰æ ‡ç­¾åˆ†ç±»ç›‘ç£å­¦ä¹ \n(åˆ¤åˆ«å¼æ— ç›‘ç£å­¦ä¹  + æœ‰ç›‘ç£å­¦ä¹ )\næ¡†æ¶å¯¹æ¯”\nâ­ End to End\næ¡†æ¶\nUnlabeled Sample : ä½¿ç”¨ä¸¤ä¸ªå¢å¼ºè§†å›¾ä½œä¸ºpositive pairï¼Œä¸å…¶ä»–sampleä¸ºnegative pair (æ ‡å‡†çš„å¯¹æ¯”å­¦ä¹ )\nLabeled Sampleï¼š1ï¸âƒ£ åŒç±»å‹çš„sampleä¸ºpositive pairï¼Œä¸åŒç±»å‹çš„sampleä¸ºnegative pair. 2ï¸âƒ£è¿‡åˆ†ç±»å¤´ï¼Œè®¡ç®—åˆ†ç±»Loss\nâ¤ï¸ æ··åˆä¸Šè¿°ä¸‰ä¸ªLossï¼Œè”åˆä¼˜åŒ–Encoder\nSimCLR - 2020 A Simple Framework for Contrastive Learning of Visual Representations\nè´¡çŒ®ï¼š\næ•°æ®å¢å¼ºå¯¹äºå¯¹æ¯”å­¦ä¹ è‡³å…³é‡è¦ (è£å‰ªç¼©æ”¾ï¼Œç¿»è½¬ï¼Œé¢œè‰²ç´Šä¹±ï¼Œæ—‹è½¬ï¼Œ æ©ç›–ï¼Œ é«˜æ–¯å™ªå£°ï¼Œ é«˜æ–¯æ¨¡ç³Šï¼ŒSobel æ»¤æ³¢) - è£å‰ªç¼©æ”¾+é¢œè‰²ç´Šä¹± æ¯”è¾ƒå¥½\nåœ¨ç»è¿‡Resnetç¼–ç å™¨åï¼Œè¿½åŠ MLPèƒ½å¢å¼ºæ¨¡å‹æ€§èƒ½\næ ·æœ¬xï¼Œå¢å¼ºè§†å›¾xiå’Œxj(æ­£æ ·æœ¬)ï¼Œbatch size =Nï¼Œä¸€å…±2Nçš„å¢å¼ºè§†å›¾ï¼Œå¯¹äºæŸä¸ªæ ·æœ¬xï¼Œxiå’Œxjä¸ºæ­£æ ·æœ¬ï¼Œå’Œbatchä¸­å‰©ä½™çš„æ ·æœ¬çš„å¢å¼ºä¸ºè´Ÿæ ·æœ¬\n(å¤§batchsize, æ€§èƒ½æ›´å¥½ï¼Œ å…¨å±€BN)\næ ·æœ¬è‡ªæˆä¸€ç±»ï¼Œæ¥å°½å¯èƒ½åœ°è®©ç¼–ç å™¨æ‰¾åˆ°å›¾åƒä¸­æœ€é‡è¦çš„ç‰¹å¾\næ¡†æ¶\nå…±äº«å‚æ•° shared weight\nLoss\nä¸Šé¢æ˜¯æ­£æ ·æœ¬å¯¹ï¼Œä¸‹é¢æ˜¯è´Ÿæ ·æœ¬å¯¹ -log_softmax() =\u0026gt; æŒ‘é€‰å‡ºéœ€è¦çš„å€¼\nç®—æ³•\nViLT - 2021 ViLT Vision-and-Language Transformer Without Convolution or Region Supervision\næç®€ç»“æ„çš„å›¾ç‰‡æ–‡å¤šæ¨¡æ€èåˆ\né€Ÿåº¦é™åˆ¶-é—®é¢˜åˆ†æ\nå½’çº³æ€»ç»“ï¼š\n(a) vision embedding å‚æ•°é‡ \u0026gt; Text Embedding \u0026gt; Modality Interaction # ç¼ºç‚¹ï¼Œè§†è§‰åµŒå…¥å¤ªé‡(æ¯”é‡å¤ªå¤§)ï¼Œå¹¶ä¸”èåˆéå¸¸ç®€å•å³ç‚¹ä¹˜ç®—ç›¸ä¼¼åº¦\n(b) vision embeddingå’ŒText embedding å æ¯”å·®ä¸å¤š \u0026gt; Modality Interaction # æ¨¡æ€èåˆä¹‹å‰ï¼Œå·¥ä½œå¤ªç¹æ‚ï¼Œè€Œä¸”å‰æŠ½å–ç‰¹å¾ä¸å¥½ï¼Œé™åˆ¶åé¢èåˆï¼Œå¹¶ä¸”ä¸é‡è§†åé¢çš„æ¨¡æ€èåˆæ“ä½œã€‚\n(c) é‡è§†visual Embedå’ŒåæœŸçš„modality interactionï¼Œ# text å’Œ visionä¸å‡ç­‰ï¼Œé‡è¦æ€§ä¸å¹³è¡¡\n=\u0026gt; ç®€å•æ¡†æ¶ï¼ŒTextè¯åµŒå…¥(bertä¸­çš„BertEmbeddingsåŠ è½½è®­ç»ƒåçš„æƒé‡)ï¼Œvisionç”¨patch projectionï¼Œéƒ½å¾ˆå¿«\nâ­ 1. å›¾åƒå’Œæ–‡æœ¬å‰æœŸåµŒå…¥åº”è¯¥æœ‰ç›¸ä¼¼å‡åŒ€çš„è¡¨è¾¾èƒ½åŠ› 2. è¿™ä¸¤ç§æ¨¡æ€æ˜¯å¦åœ¨æ·±å±‚ç½‘ç»œä¸­ç›¸äº’ä½œç”¨ã€‚\næ¨¡å‹æ¡†æ¶ï¼š\nåˆå§‹åŒ–å‚æ•°-ViTï¼Œè€Œä¸æ˜¯bert\nä¼˜åŒ–ç›®æ ‡(ä¸»è¦)ï¼š\nImage Text Matchingï¼š0.5æ¦‚ç‡å°†å›¾ç‰‡æ›¿æ¢ä¸ºä¸æ–‡æœ¬ä¸åŒ¹é…çš„å›¾ç‰‡ï¼Œé¢„æµ‹ä¸€è‡´æ€§(äºŒåˆ†ç±»é—®é¢˜) Masked Language Modelingï¼šé¢„æµ‹è¢«é®æ©çš„è¯ text cls: é¢„æµ‹å›¾æ–‡æ˜¯å¦ä¸€è‡´ï¼ŒäºŒåˆ†ç±»\ntext token setï¼š å…¨å±€ä¸Šä¸‹æ–‡=\u0026gt;é¢„è¢«æ©è¯\ntext token set å’Œ visual token setï¼šè¿›è¡Œå¯¹é½Loss\nBEIT-v3 2022 Image as a Foreign Language: BEIT Pretraining for All Vision and Vision-Language Tasks\nç»Ÿä¸€Vision å’Œ NLP\nâ­ æ ¸å¿ƒæ€æƒ³æ˜¯å›¾åƒå¯ä»¥è¢«å»ºæ¨¡ä¸ºä¸€é—¨å¤–è¯­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹å›¾åƒã€æ–‡æœ¬å’Œå›¾æ–‡å¯¹è¿›è¡Œç»Ÿä¸€çš„æ©ç â€œè¯­è¨€â€å»ºæ¨¡ã€‚\nç»“æœéå¸¸å¥½\nåŸºç¡€å—\nå…±äº«æ³¨æ„åŠ›çŸ©é˜µ(éƒ½æ˜¯ä¸€ä¸ªç‰©ä½“çš„ä¸åŒè§†è§’)ï¼Œä½†æ˜¯æœ€åçš„FFNå„ä¸ªæ¨¡æ€ä¸“äº«\næ‹“å±•åˆ°ä¸åŒçš„æ¨¡æ€ï¼š\nä»»åŠ¡ï¼š\nå›¾åƒå­—å¹•ä»»åŠ¡ï¼šé‡‡ç”¨äº†ç‰¹æ®Šçš„è‡ªæ³¨æ„åŠ›æ©æ¨¡ã€‚ å›¾åƒæ ‡è®°ï¼ˆå³å›¾åƒå—ï¼‰åªèƒ½åœ¨å›¾åƒåºåˆ—å†…åŒå‘ç›¸äº’å…³æ³¨ã€‚ æ ‡é¢˜çš„æ ‡è®°å¯ä»¥å…³æ³¨å›¾åƒæ ‡è®°ã€å®ƒä»¬çš„å·¦ä¾§æ ‡é¢˜æ ‡è®°ä»¥åŠå®ƒä»¬æœ¬èº«ã€‚ åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éšæœºå±è”½ä¸€å®šæ¯”ä¾‹çš„æ ‡é¢˜æ ‡è®°ã€‚ è¯¥æ¨¡å‹ç»è¿‡è®­ç»ƒï¼Œå¯ä»¥æ ¹æ®å›¾åƒçš„çº¿ç´¢åŠå…¶å·¦ä¾§æ ‡é¢˜ä¸Šä¸‹æ–‡æ¥æ¢å¤è¿™äº›æ ‡è®°ã€‚ æˆ‘ä»¬è¿˜å±è”½äº†ç‰¹æ®Šçš„è¾¹ç•Œæ ‡è®° [SEP]ï¼Œä»¥å¸®åŠ©æ¨¡å‹å­¦ä¹ ç»ˆæ­¢ç”Ÿæˆ\nè§†è§‰é—®ç­”ï¼š å°†ä»»åŠ¡è¡¨è¿°ä¸ºåˆ†ç±»é—®é¢˜ã€‚ è¯¥æ¨¡å‹ç»è¿‡è®­ç»ƒï¼Œå¯ä»¥ä»è®­ç»ƒé›†ä¸­ 3129 ä¸ªæœ€å¸¸è§çš„å€™é€‰ç­”æ¡ˆä¸­é¢„æµ‹ç­”æ¡ˆã€‚æˆ‘ä»¬å°†ç»™å®šé—®é¢˜å’Œå›¾åƒçš„åµŒå…¥è¿æ¥èµ·æ¥ï¼Œç„¶åå°†è¾“å…¥åµŒå…¥è¾“å…¥å¤šè·¯è½¬æ¢å™¨ä»¥è”åˆç¼–ç å›¾åƒ-é—®é¢˜å¯¹ã€‚ æœ€ç»ˆçš„æ± åŒ–è¾“å‡ºè¢«è¾“å…¥åˆ°åˆ†ç±»å™¨å±‚æ¥é¢„æµ‹ç­”æ¡ˆã€‚\n**å›¾åƒæ–‡æœ¬æ£€ç´¢ä»»åŠ¡ï¼š**æ˜¯æµ‹é‡å›¾åƒå’Œæ–‡æœ¬ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚ æ ¹æ®æ£€ç´¢ç›®æ ‡çš„æ¨¡æ€ï¼Œæœ‰ä¸¤ä¸ªæ–¹å‘ï¼šå›¾åƒåˆ°æ–‡æœ¬æ£€ç´¢å’Œæ–‡æœ¬åˆ°å›¾åƒæ£€ç´¢ã€‚ åŒç¼–ç å™¨æ¨¡å‹åˆ†åˆ«å¯¹å›¾åƒå’Œæ–‡æœ¬è¿›è¡Œç¼–ç ä»¥è·å¾—å®ƒä»¬çš„è¡¨ç¤ºã€‚ ç„¶åæˆ‘ä»¬è®¡ç®—è¿™äº›è¡¨ç¤ºçš„ä½™å¼¦ç›¸ä¼¼åº¦åˆ†æ•°ã€‚\nå›¾åƒåˆ†ç±»ï¼š å°†è¯¥ä»»åŠ¡åˆ¶å®šä¸ºå›¾åƒåˆ°æ–‡æœ¬æ£€ç´¢ä»»åŠ¡ã€‚ æˆ‘ä»¬ä½¿ç”¨ç±»åˆ«åç§°ä½œä¸ºæ–‡æœ¬æ¥æ„å»ºå›¾åƒ-æ–‡æœ¬å¯¹ã€‚ BEIT-3 è¢«è®­ç»ƒä¸ºåŒç¼–ç å™¨ï¼Œä»¥æ‰¾åˆ°å›¾åƒæœ€ç›¸å…³çš„æ ‡ç­¾ã€‚ åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—å¯èƒ½çš„ç±»åçš„ç‰¹å¾åµŒå…¥å’Œå›¾åƒçš„ç‰¹å¾åµŒå…¥ã€‚ ç„¶åè®¡ç®—å®ƒä»¬çš„ä½™å¼¦ç›¸ä¼¼åº¦åˆ†æ•°ä»¥é¢„æµ‹æ¯ä¸ªå›¾åƒæœ€å¯èƒ½çš„æ ‡ç­¾ã€‚\nALBEF - 2021 Align before Fuse: Vision and Language Representation Learning with Momentum Distillation\nç°å­˜é—®é¢˜ï¼šå¤§å¤šæ•°ç°æœ‰æ–¹æ³•é‡‡ç”¨åŸºäºå˜å‹å™¨çš„å¤šæ¨¡æ€ç¼–ç å™¨æ¥è”åˆå»ºæ¨¡-è§†è§‰Tokenï¼ˆåŸºäºåŒºåŸŸçš„å›¾åƒç‰¹å¾ï¼‰å’Œæ–‡æœ¬Tokenã€‚ ç”±äºè§†è§‰æ ‡è®°å’Œå•è¯æ ‡è®°æœªå¯¹é½ï¼Œå› æ­¤å¤šæ¨¡æ€ç¼–ç å™¨å­¦ä¹ å›¾åƒæ–‡æœ¬äº¤äº’å…·æœ‰æŒ‘æˆ˜æ€§ã€‚\nï¼ˆ1ï¼‰å›¾åƒç‰¹å¾å’Œæ–‡æœ¬ç¬¦å·æ˜ å°„ä»ç„¶åœç•™åœ¨ä»–ä»¬è‡ªå·±çš„ç©ºé—´ï¼Œä½¿å¾—å¤šæ¨¡æ€ç¼–ç å™¨å¾ˆéš¾å­¦ä¹ å»ºæ¨¡ä»–ä»¬ä¹‹é—´çš„äº¤äº’ï¼›\nï¼ˆ2ï¼‰ç‰©ä½“æ£€æµ‹å™¨ \u0026mdash; æ ‡æ³¨è´¹é’±ï¼Œä½¿ç”¨è´¹ç®—åŠ› \u0026mdash; åœ¨é¢„è®­ç»ƒé˜¶æ®µéœ€è¦æ ‡æ³¨çŸ©å½¢æ¡†ï¼Œåœ¨æ¨ç†é˜¶æ®µé«˜åˆ†è¾¨ç‡å›¾åƒï¼Œå¦‚ 600*1000ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼›\nï¼ˆ3ï¼‰å¹¿æ³›ä½¿ç”¨çš„ image-text æ•°æ®é›†å‡æ˜¯ä»ç½‘ä¸Šæœé›†çš„å¸¦æœ‰ä¸¥é‡å™ªå£°çš„æ•°æ®ï¼Œç°æœ‰çš„é¢„è®­ç»ƒç›®æ ‡ï¼Œå¦‚ MLM å¯èƒ½è¿‡æ‹Ÿåˆåˆ°æ–‡æœ¬æ•°æ®ï¼Œé™ä½äº†æ¨¡å‹çš„æ³›åŒ–æ€§èƒ½ã€‚\næ¡†æ¶ï¼š\nimage encoder: ViT(ImageNeté¢„è®­ç»ƒå‚æ•°) - CLS token\ntext encoder: Bert(é¢„è®­ç»ƒå‚æ•°) - CLS token\nmultimodal encoder: Bert(é¢„è®­ç»ƒå‚æ•°) + cross-attention\nâ­ **åœ¨ä¼ å…¥multi-modal encoderå‰ï¼Œä½¿ç”¨ITCè¿«ä½¿æ¨¡å‹è¿›è¡Œå¯¹é½ ** align before fuseçš„align\nå¯¹é½å›¾åƒç‰¹å¾å’Œæ–‡æœ¬ç‰¹å¾ï¼Œä½¿å¤šæ¨¡æ€èåˆç¼–ç å™¨æ›´å®¹æ˜“æ‰§è¡Œè·¨æ¨¡æ€å­¦ä¹  æ”¹è¿›äº†å•æ¨¡æ€ç¼–ç å™¨ï¼Œä»¥æ›´å¥½åœ°ç†è§£å›¾åƒå’Œæ–‡æœ¬çš„è¯­ä¹‰ å®ƒå­¦ä¹ ä¸€ä¸ªå…±åŒçš„ä½ç»´ç©ºé—´æ¥åµŒå…¥å›¾åƒå’Œæ–‡æœ¬ï¼Œè¿™ä½¿å¾—å›¾åƒæ–‡æœ¬åŒ¹é…ç›®æ ‡èƒ½å¤Ÿé€šè¿‡æˆ‘ä»¬çš„å¯¹æ¯”ç¡¬è´ŸæŒ–æ˜æ‰¾åˆ°æ›´å¤šä¿¡æ¯æ ·æœ¬ã€‚ Image-Text Contrastive Lossï¼š\næ­£æ ·æœ¬å¯¹ï¼šé…å¯¹çš„Image-Text\nè´Ÿæ ·æœ¬å¯¹ï¼šQueueå­˜å‚¨ç€çš„æ ·æœ¬è¡¨ç¤º\nImage =\u0026gt; åŒ¹é…Text-Queue(Momentum)\nText =\u0026gt; åŒ¹é…Image-Queue(Momentum)\n(ä»£ç ä¸­åˆ©ç”¨äº†Momentum Distillation \u0026hellip;)\nImage-Text Matching:\næœ‰äº†multi-modal encoderè¾“å‡ºçš„ embed token (æ­£ç¡®æ ·æœ¬çš„è¡¨å¾) =\u0026gt; å³å–‚å…¥Multi-modal encoderçš„ text embed = (positive), Image embed = (positive), æ‹¿èåˆçš„CLSä½œä¸ºæœ€ç»ˆè¡¨å¾ï¼Œè¿‡MLP =\u0026gt; äºŒåˆ†ç±»é¢„æµ‹æ˜¯å¦åŒ¹é…ï¼›è¿™éƒ¨åˆ†Targets=(1, 1, \u0026hellip;, 1)\nä»åŒbatchä¸­ï¼ŒæŒ‰ç›¸ä¼¼æ€§å¤§å°éšæœºæŒ‘é€‰ä¸€ä¸ª(hard)è´Ÿæ ·æœ¬ï¼Œ\nç„¶åï¼Œtext embed = (positive, \u0026hellip;, negetive, \u0026hellip;) , Image embed = (negetive, \u0026hellip;, positive)\nmulti-modal encoder =\u0026gt; CLS =\u0026gt; MLP =\u0026gt; two probability\nTargets = (0, 0, \u0026hellip;, 0)\n// é‡æ–°æ¢³ç†å¦‚ä¸‹ï¼š\n1# å›¾åƒi-æ–‡æœ¬j =\u0026gt; å¤šæ¨¡æ€ç¼–ç å™¨ =\u0026gt; æ˜¯å¦åŒ¹é…ï¼› 2å›¾åƒ 1-æ–‡æœ¬ 1 : åŒ¹é…å¯¹ 3å›¾åƒ 2-æ–‡æœ¬ 2 : åŒ¹é…å¯¹ 4å›¾åƒ 1-æ–‡æœ¬ 2 : ä¸åŒ¹é… // è¿™é‡Œä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦é€‰å–æœ€å›°éš¾çš„æ ·æœ¬ 5å›¾åƒ 2-æ–‡æœ¬ 1 : ä¸åŒ¹é… // è¿™é‡Œä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦é€‰å–æœ€å›°éš¾çš„æ ·æœ¬ Masked Language Modeling:\nå±è”½æ‰ä¸€äº›è¯ï¼Œé€šè¿‡ä»å›¾ç‰‡æ¨¡æ€ä¿¡æ¯ä¸­é¢„æµ‹æ‰è¢«å±è”½çš„è¯(å¤šåˆ†ç±»Loss)\nè¿™é‡Œä¹Ÿå€ŸåŠ©äº†å›¾åƒçš„ä¿¡æ¯å»æ›´å¥½çš„æ¢å¤è¢«maskæ‰çš„å•è¯\nã€è¿™é‡Œåªå¯¹åŒ¹é…çš„å¯¹è®¡ç®— æ©ç Lossã€‘\nç›®çš„ï¼šç¼“è§£noisy web dataçš„ä¸è¶³ï¼ŒçœŸæ­£çš„labelä¸ä¸€å®šæœ‰momentumçš„å¥½\nçœŸå®labelä¸ä¸€å®šæ¯”momentum modelç»™å‡ºçš„predict labelå¥½ï¼Œ=\u0026gt; ä½¿ç”¨KLæ•£åº¦è¿›è¡Œçº¦æŸ ä¸€è‡´æ€§\næœ€å¤§åŒ–äº’ä¿¡æ¯è§†è§’è§£é‡Šï¼š\nåœ¨è‡ªç›‘ç£å­¦ä¹ ä¸­ï¼Œa å’Œ b æ˜¯åŒä¸€å›¾åƒçš„ä¸¤ä¸ªå¢å¼ºã€‚ åœ¨è§†è§‰è¯­è¨€è¡¨ç¤ºå­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å°† a å’Œ b è§†ä¸ºæ•è·å…¶è¯­ä¹‰çš„å›¾åƒæ–‡æœ¬å¯¹çš„ä¸åŒå˜ä½“ã€‚ æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å­¦ä¹ å¯¹è§‚ç‚¹å˜åŒ–ä¸å˜çš„è¡¨å¾ã€‚\næœ€å°åŒ–Loss =\u0026gt; æœ€å¤§åŒ–äº’ä¿¡æ¯çš„ä¸‹é™(æœ€å¤§åŒ–äº†å›¾åƒ-æ–‡æœ¬å¯¹çš„**ä¸åŒâ€œè§†å›¾â€**ä¹‹é—´çš„äº’ä¿¡æ¯ï¼ˆMIï¼‰çš„ä¸‹é™)\nInfoNCE Loss\nImage-Text Contrastive Loss\næœ€å¤§åŒ–Textå’ŒImageä¸­çš„äº’ä¿¡æ¯ï¼Œ ITC å°†ä¸¤ä¸ªå•ç‹¬çš„æ¨¡æ€ï¼ˆå³ I å’Œ Tï¼‰è§†ä¸ºå›¾åƒ-æ–‡æœ¬å¯¹çš„ä¸¤ä¸ªè§†å›¾\nMLM:\nMLM å°†å›¾åƒ-æ–‡æœ¬å¯¹çš„ä¸¤ä¸ªè§†å›¾è§†ä¸ºï¼š(1) éšæœºé€‰æ‹©çš„å•è¯æ ‡è®°ï¼Œä»¥åŠ (2) å›¾åƒ + å¸¦æœ‰è¯¥å•è¯å±è”½çš„ä¸Šä¸‹æ–‡æ–‡æœ¬ã€‚\nInstance discrimination - 2018 Unsupervised Feature Learning via Non-Parametric Instance Discrimination\né¦–æ¬¡æå‡ºä¸ªä½“åˆ¤åˆ«ä»»åŠ¡ï¼\nè§‚å¯Ÿï¼š\nåœ¨ç›‘ç£å­¦ä¹ ä¸­ã€‚åœ¨é¢„æµ‹\u0026rsquo;èŠ±è±¹\u0026rsquo;æ—¶ï¼Œé¢„æµ‹æ¦‚ç‡é™¤äº†\u0026rsquo;èŠ±è±¹\u0026rsquo;ï¼Œå‰©ä½™é¢„æµ‹å¾—åˆ†æ¯”è¾ƒé«˜çš„æ˜¯\u0026rsquo;ç¾æ´²è™\u0026rsquo;ã€\u0026lsquo;çŒè±¹\u0026rsquo;ï¼› æœ€ä¸ç›¸ä¼¼çš„æ˜¯\u0026rsquo;æ•‘ç”Ÿè‰‡\u0026rsquo;ã€\u0026lsquo;è´­ç‰©è½¦\u0026rsquo;ã€\u0026lsquo;ä¹¦æŸœ\u0026rsquo;;\næœ€é«˜å“åº”çš„ç±»éƒ½æ˜¯è§†è§‰ç›¸å…³çš„\nâ­ å¹¶ä¸æ˜¯è¯­ä¹‰æ ‡ç­¾ï¼Œè€Œæ˜¯æ•°æ®æœ¬èº«çš„æ˜æ˜¾ç›¸ä¼¼æ€§ä½¿æŸäº›ç±»æ¯”å…¶ä»–ç±»æ›´æ¥è¿‘ï¼›\nâ—â—â— ä¸ªä½“åˆ¤åˆ«ï¼šå°†ç±»ç›‘ç£å‘æŒ¥åˆ°äº†æè‡´ï¼Œå¹¶å­¦ä¹ äº†åŒºåˆ†å„ä¸ªå®ä¾‹çš„ç‰¹å¾è¡¨ç¤ºã€‚\nè¿™äº›è§‚å¯Ÿç»“æœè¡¨æ˜ï¼Œå…¸å‹çš„åˆ¤åˆ«å­¦ä¹ æ–¹æ³•å¯ä»¥è‡ªåŠ¨å‘ç°è¯­ä¹‰ç±»åˆ«ä¹‹é—´çš„æ˜æ˜¾ç›¸ä¼¼æ€§ï¼Œè€Œæ— éœ€æ˜ç¡®æŒ‡å¯¼è¿™æ ·åšã€‚\næˆ‘ä»¬èƒ½å¦é€šè¿‡çº¯ç²¹çš„åˆ¤åˆ«å­¦ä¹ æ¥å­¦ä¹ åæ˜ å®ä¾‹ä¹‹é—´æ˜æ˜¾ç›¸ä¼¼æ€§çš„æœ‰æ„ä¹‰çš„åº¦é‡ï¼Ÿ å›¾åƒæœ¬èº«å°±æ˜¯ç‹¬ç‰¹çš„ï¼Œå¹¶ä¸”æ¯ä¸ªå›¾åƒéƒ½å¯èƒ½ä¸åŒä¸€è¯­ä¹‰ç±»åˆ«ä¸­çš„å…¶ä»–å›¾åƒæ˜¾ç€ä¸åŒã€‚å¦‚æœæˆ‘ä»¬å­¦ä¼šåœ¨æ²¡æœ‰ä»»ä½•è¯­ä¹‰ç±»åˆ«æ¦‚å¿µçš„æƒ…å†µä¸‹åŒºåˆ†å„ä¸ªå®ä¾‹ï¼Œæˆ‘ä»¬æœ€ç»ˆå¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªæ•è·å®ä¾‹ä¹‹é—´æ˜æ˜¾ç›¸ä¼¼æ€§çš„è¡¨ç¤ºï¼Œå°±åƒç±»æ˜æ™ºçš„ç›‘ç£å­¦ä¹ å¦‚ä½•ä»ç„¶ä¿ç•™ç±»ä¹‹é—´çš„æ˜æ˜¾ç›¸ä¼¼æ€§ä¸€æ ·ã€‚\nç›®æ ‡:\nåœ¨æ²¡æœ‰ç›‘ç£çš„æƒ…å†µä¸‹å­¦ä¹ åµŒå…¥å‡½æ•° v = fÎ¸(x)ã€‚ fÎ¸ æ˜¯ä¸€ä¸ªå…·æœ‰å‚æ•° Î¸ çš„æ·±åº¦ç¥ç»ç½‘ç»œï¼Œå°†å›¾åƒ x æ˜ å°„åˆ°ç‰¹å¾ vã€‚è¿™ç§åµŒå…¥å°†åœ¨å›¾åƒç©ºé—´ä¸Šäº§ç”Ÿä¸€ä¸ªåº¦é‡ï¼Œå¯¹äºå®ä¾‹ x å’Œ y, dÎ¸(x, y) = |fÎ¸(x) âˆ’ fÎ¸(y)|ã€‚ è‰¯å¥½çš„åµŒå…¥åº”è¯¥å°†è§†è§‰ä¸Šç›¸ä¼¼çš„å›¾åƒæ˜ å°„å¾—å½¼æ­¤æ›´æ¥è¿‘ã€‚ æˆ‘ä»¬æ–°é¢–çš„æ— ç›‘ç£ç‰¹å¾å­¦ä¹ æ–¹æ³•æ˜¯å®ä¾‹çº§åŒºåˆ†ã€‚ æˆ‘ä»¬å°†æ¯ä¸ªå›¾åƒå®ä¾‹è§†ä¸ºå…¶è‡ªå·±çš„ä¸åŒç±»ï¼Œå¹¶è®­ç»ƒåˆ†ç±»å™¨æ¥åŒºåˆ†å„ä¸ªå®ä¾‹ç±»ã€‚\ræ–¹æ³•ï¼š\nç”¨ä¸€ä¸ªmemory bankå­˜å‚¨4096ä¸ªæ ·æœ¬embed feature(128-dimention) éšç€ç½‘ç»œæ›´æ–°, ç›®çš„æ˜¯è®©ç‰¹å¾åœ¨åµŒå…¥ç©ºé—´ä¸­è¿œç¦»(æ¯ä¸€ä¸ªæ ·æœ¬éƒ½æ˜¯ä¸€ä¸ªç±»)ï¼Œå­¦ä¹ é‚£ç§æœ‰ç›‘ç£æ—¶ç±»å’Œç±»ä¹‹é—´ç›¸ä¼¼èšé›†çš„ç°è±¡ã€‚\nBYOL - 2020/6 Bootstrap Your Own Latent A New Approach to Self-Supervised Learning\n1æ— ç›‘ç£å­¦ä¹ ï¼š { 2 åˆ¤åˆ«å¼ï¼šä»å¢å¼ºè§†å›¾çš„è¡¨ç¤ºä¸­ï¼Œä»–ä»¬å­¦ä¼šåŒºåˆ†åŒä¸€å›¾åƒçš„å¦ä¸€ä¸ªå¢å¼ºè§†å›¾çš„è¡¨ç¤ºå’Œä¸åŒå›¾åƒçš„å¢å¼ºè§†å›¾çš„è¡¨ç¤º =\u0026gt; è¿™ç§åˆ¤åˆ«æ–¹æ³•é€šå¸¸éœ€è¦å°†å¢å¼ºè§†å›¾çš„æ¯ä¸ªè¡¨ç¤ºä¸è®¸å¤šåä¾‹è¿›è¡Œæ¯”è¾ƒã€‚ 3 ç”Ÿæˆå¼ï¼šé€šè¿‡é¢„æµ‹åŒä¸€å›¾åƒçš„ä¸åŒè§†å›¾ï¼ˆä¾‹å¦‚ï¼Œä¸åŒçš„éšæœºè£å‰ªï¼‰æ¥å­¦ä¹ è¡¨ç¤º =\u0026gt; å›¾åƒçš„å¢å¼ºè§†å›¾çš„è¡¨ç¤ºåº”è¯¥èƒ½å¤Ÿé¢„æµ‹åŒä¸€å›¾åƒçš„å¦ä¸€ä¸ªå¢å¼ºè§†å›¾çš„è¡¨ç¤ºã€‚ 4} æ–¹æ³•ï¼š\nåœ¨çº¿ç½‘ç»œÎ¸ + ç›®æ ‡ç½‘ç»œÎ³(æä¾›å›å½’ç›®æ ‡ï¼ŒÎ³ = Î±Ã—Î³ + (1-Î±)Ã—Î¸ ï¼ŒæŒ‡æ•°ç§»åŠ¨å¹³å‡ )\nyÎ¸æ˜¯ç›®æ ‡ç¼–ç å™¨ï¼Œå…¶ä½™çš„è®­ç»ƒå¥½åä¸¢æ‰\nâ­ä¸€å¼ å›¾ç‰‡çš„ä¸¤ä¸ªå¢å¼ºè¡¨ç¤ºçš„ç›¸åŒçš„è¯­ä¹‰ =\u0026gt; åœ¨é«˜ç»´çš„åµŒå…¥è¡¨ç¤ºä¸­ï¼Œåº”è¯¥å¯ä»¥é¢„æµ‹å¯¹æ–¹(ç›¸è¿‘)\n1yÎ¸ï¼šEncoder 2zÎ¸ï¼šProjection head 3qÎ¸ï¼šPrediction head Loss: $$ æ³¨æ„å›¾åƒå¢å¼ºt(x)å’Œt^{}xä¼šå¯¹ç­‰çš„ä¼ ç»™online\\ net å’Œ target\\ net\\\\\rLoss: 1/2 Ã— ( || q_{Î¸}(z_{Î¸}) - z^{}{Î¾}||^{2} + || q{Î¸}(z_{Î¸}) - z^{`}_{Î¾}||^{2} ) $$ Train: $$ Î¸ï¼šonline\\ net\\ parameters\\ Î¾ï¼štarget\\ net\\ parameters\\ Î¸ \u0026lt;- optimizer(Î¸),\\ \\ \\ Î¾ \u0026lt;- Î±Î¾ + (1-Î±)Î¸ $$\nDINO - 2021 Emerging Properties in Self-Supervised Vision Transformers\nViTæœ€åçš„CLSæ³¨æ„åŠ›å›¾ç¤ºâ­â­â­\næ¢è®¨ï¼šè´¨ç–‘è‡ªç›‘ç£å­¦ä¹ æ˜¯å¦ä¸º Vision Transformer (ViT) æä¾›äº†æ¯”å·ç§¯ç½‘ç»œ (convnets) æ›´çªå‡ºçš„æ–°å±æ€§ï¼Ÿ\næ¡†æ¶ï¼š(å€Ÿé‰´BYOL)\næ•™å¸ˆæ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åŠ¨æ€æ„å»ºçš„ã€‚çŸ¥è¯†è’¸é¦å°±ä¸å†è¢«ç”¨ä½œè‡ªç›‘ç£é¢„è®­ç»ƒçš„åå¤„ç†æ­¥éª¤ï¼Œè€Œæ˜¯ç›´æ¥ä½œä¸ºè‡ªç›‘ç£ç›®æ ‡ã€‚\nå…¶ä¸­å­¦ç”Ÿå’Œæ•™å¸ˆå…·æœ‰ç›¸åŒçš„æ¶æ„å¹¶åœ¨è®­ç»ƒæœŸé—´ä½¿ç”¨è’¸é¦ã€‚\næ•™å¸ˆåœ¨æˆ‘ä»¬å·¥ä½œä¸­ç”¨å­¦ç”Ÿçš„åŠ¨é‡å¹³å‡å€¼è¿›è¡Œæ›´æ–°ã€‚\nå¢å¼ºç­–ç•¥ï¼š\n1. å¤šè£å‰ªç­–ç•¥æ„å»ºå›¾åƒçš„ä¸åŒæ‰­æ›²è§†å›¾æˆ–è£å‰ªã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œæ ¹æ®ç»™å®šçš„å›¾åƒï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€ç»„ V çš„ä¸åŒè§†å›¾ã€‚ è¯¥é›†åˆåŒ…å«ä¸¤ä¸ªå…¨å±€è§†å›¾ xg 1 å’Œ xg 2 ä»¥åŠå‡ ä¸ªåˆ†è¾¨ç‡è¾ƒå°çš„å±€éƒ¨è§†å›¾ã€‚\r1. æ‰€æœ‰çš„è£å‰ªéƒ½é€šè¿‡å­¦ç”Ÿä¼ é€’ï¼Œè€Œåªæœ‰å…¨å±€è§‚ç‚¹é€šè¿‡è€å¸ˆä¼ é€’ï¼Œå› æ­¤é¼“åŠ±â€œå±€éƒ¨åˆ°å…¨å±€â€çš„å¯¹åº”ã€‚\rä¼ªä»£ç ï¼š\né˜²æ­¢æ¨¡å‹åå¡Œï¼š\n1. *å¯¹åŠ¨é‡æ•™å¸ˆè¾“å‡ºè¿›è¡Œå±…ä¸­å’Œé”åŒ–ï¼Œä»¥é¿å…æ¨¡å‹å´©æºƒã€‚*\r2. **å±…ä¸­ï¼ˆCenteringï¼‰**ï¼šå¯¹åŠ¨é‡æ•™å¸ˆçš„è¾“å‡ºè¿›è¡Œå±…ä¸­æ“ä½œæ˜¯ä¸ºäº†å‡å°‘æ‰¹æ¬¡ä¹‹é—´çš„åå·®ï¼Œå¢åŠ è¾“å‡ºçš„ç¨³å®šæ€§ã€‚å…·ä½“åšæ³•æ˜¯ä»æ¯ä¸ªè¾“å‡ºä¸­å‡å»å…¶å‡å€¼ï¼Œç¡®ä¿è¾“å‡ºå›´ç»•é›¶åˆ†å¸ƒï¼Œè¿™æœ‰åŠ©äºé¿å…ç½‘ç»œè¾“å‡ºåœ¨ç‰¹å¾ç©ºé—´å†…åå‘æŸä¸€æ–¹å‘ï¼Œä»è€Œé™ä½äº†æ¨¡å‹åå¡Œçš„é£é™©ã€‚\r3. **é”åŒ–ï¼ˆSharpeningï¼‰**ï¼šé”åŒ–æ˜¯é€šè¿‡å¢åŠ è¾“å‡ºåˆ†å¸ƒçš„å³°å€¼æ¥å®ç°çš„ï¼Œç›®çš„æ˜¯ä½¿æ¨¡å‹çš„è¾“å‡ºæ›´åŠ åŒºåˆ†æ˜æ˜¾ï¼Œå³ä½¿ä¸åŒç±»åˆ«ä¹‹é—´çš„åŒºåˆ«æ›´åŠ æ¸…æ™°ã€‚è¿™é€šå¸¸é€šè¿‡æé«˜è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒçš„ç†µæ¥å®ç°ï¼Œæ¯”å¦‚å¯ä»¥é‡‡ç”¨æ¸©åº¦è°ƒæ•´ï¼ˆtemperature scalingï¼‰ç­‰æ–¹æ³•æ¥è°ƒæ•´æ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å¾—ä¸»è¦çš„æ¦‚ç‡å€¼æ›´åŠ çªå‡ºï¼Œè€Œå…¶ä»–çš„æ¦‚ç‡å€¼åˆ™ç›¸å¯¹é™ä½ã€‚\rå›¾ç¤ºï¼š\nä¸åŒé¢œè‰²æ˜¯ä¸åŒçš„æ³¨æ„åŠ›å¤´\næ— ç›‘ç£æ³¨æ„åŠ›æ›´èƒ½å­¦åˆ°æœ¬è´¨ï¼\nSimSiam - CVPR 2021 Exploring Simple Siamese Representation Learning\nç®€å•è®¾è®¡çš„Siamese(å­ªç”Ÿ)ç½‘ç»œã€‚ æˆ‘ä»¬çš„æç®€ä¸»ä¹‰æ–¹æ³•çš„ç«äº‰åŠ›è¡¨æ˜\n1ï¸âƒ£ â€œæ²¡æœ‰åŠ¨é‡ç¼–ç å™¨çš„ BYOLâ€\n2ï¸âƒ£ â€œæ²¡æœ‰è´Ÿæ ·æœ¬çš„ SimCLRâ€œ + stop-grad(â­è¿™ä¸ªéå¸¸å…³é”®ï¼Œ è¿™ä¸ªå¯¹é˜²æ­¢æ¨¡å‹åå¡Œå¾ˆå…³é”®)\næ–¹æ³•ï¼š\nä¸€å¹…å›¾åƒçš„ä¸¤ä¸ªå¢å¼ºè§†å›¾ç”±åŒä¸€ç¼–ç å™¨ç½‘ç»œ fï¼ˆä¸»å¹²ç½‘ç»œåŠ æŠ•å½± MLPï¼‰å¤„ç†ã€‚ ç„¶ååœ¨ä¸€ä¾§åº”ç”¨é¢„æµ‹ MLP-hï¼Œåœ¨å¦ä¸€ä¾§åº”ç”¨åœæ­¢æ¢¯åº¦æ“ä½œã€‚ è¯¥æ¨¡å‹æœ€å¤§åŒ–äº†åŒæ–¹ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚ å®ƒæ—¢ä¸ä½¿ç”¨è´Ÿå¯¹ä¹Ÿä¸ä½¿ç”¨åŠ¨é‡ç¼–ç å™¨ã€‚\nä¼ªä»£ç ï¼š\næ¶ˆè\nLoss:\nè´Ÿçš„ä½™å¼¦ç›¸ä¼¼åº¦ å’Œ äº¤å‰ç†µ\nç›¸ä¼¼åº¦ï¼š\näº¤å‰ç†µï¼š\nBatchNormçš„å½±å“ï¼š\nBatchSizeçš„å½±å“ï¼š\né¢„æµ‹å¤´çš„å½±å“ï¼š\nLossçš„å¯¹ç§°æ€§ï¼š\nsymå¯¹ç§°ï¼›asyméå¯¹ç§°ï¼›asym. 2Ã—(æ¯ä¸ªå›¾åƒé‡‡æ ·ä¸¤å¯¹æ¥ç²—ç•¥åœ°è¡¥å¿å¯¹ç§°æ€§)\nSegment Anything å³æ—¶åˆ†å‰²\næ¨¡å‹ç»„ä»¶\næ¨¡å‹æ¡†æ¶ï¼š\nprompt encoderï¼š\nSparse prompts: point: point =\u0026gt; 256 dimensional vectorial embedding. è¿™ä¸ªä½¿ç”¨indexå»ç´¢å¼•ä½ç½®åµŒå…¥åƒSwin-Tï¼Œ foreground or backgroud embeddingï¼ˆè‡ªå­¦ä¹ ï¼‰. to add together. box: å·¦ä¸Šè§’ä½ç½®ç¼–ç  + å·¦ä¸Šè§’çš„å­¦ä¹ åµŒå…¥ï¼›å·¦ä¸Šè§’ä½ç½®ç¼–ç +â€œå³ä¸‹è§’â€çš„å­¦ä¹ åµŒå…¥ text: clipçš„text encoder. dense prompts: mask: CNN =\u0026gt; 256 ç‰¹å¾å‘é‡ã€‚æœ‰åˆ™åŠ maskï¼Œæ²¡æœ‰å°±åŠ å¯å­¦ä¹ çš„è¡¨ç¤ºæ— maskçš„å­¦ä¹ åµŒå…¥ mask decoderï¼š\nKNN(K-Nearest Neighbors) K-è¿‘é‚»ç®—æ³•\næ ¸å¿ƒæ€æƒ³ï¼šç›¸ä¼¼çš„æ ·æœ¬å…·æœ‰ç›¸ä¼¼çš„è¾“å‡ºã€‚\n=\u0026gt; KNNé€šè¿‡è®¡ç®—è¾“å…¥æ ·æœ¬ä¸è®­ç»ƒæ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬çš„è·ç¦»ï¼Œæ‰¾åˆ°è·ç¦»æœ€è¿‘çš„Kä¸ªæ ·æœ¬ï¼Œç„¶åæ ¹æ®è¿™äº›æ ·æœ¬çš„ç±»åˆ«æ¥å†³å®šè¾“å…¥æ ·æœ¬çš„ç±»åˆ«\nä¸»è¦æ­¥éª¤:\né€‰æ‹©Kå€¼ï¼šé€‰æ‹©ä¸€ä¸ªæ­£æ•´æ•°Kï¼Œä»£è¡¨ä½ è¦æ¯”è¾ƒçš„é‚»å±…æ•°é‡ã€‚\nè®¡ç®—è·ç¦»ï¼šå¯¹æ¯ä¸ªå¾…åˆ†ç±»æ ·æœ¬ï¼Œè®¡ç®—å®ƒä¸è®­ç»ƒæ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬çš„è·ç¦»ã€‚å¸¸ç”¨çš„è·ç¦»åº¦é‡æœ‰æ¬§æ°è·ç¦»ã€æ›¼å“ˆé¡¿è·ç¦»å’Œä½™å¼¦ç›¸ä¼¼åº¦ç­‰ã€‚\n$$ \\textbf{æ¬§æ°è·ç¦»}: d(x, x_i) = \\sqrt{\\sum_{j=1}^{m}(x_j-x_{ij})^2} $$ é€‰æ‹©æœ€è¿‘çš„Kä¸ªé‚»å±…ï¼šæ ¹æ®è®¡ç®—å¾—åˆ°çš„è·ç¦»ï¼Œä»è®­ç»ƒæ•°æ®é›†ä¸­é€‰æ‹©è·ç¦»å¾…åˆ†ç±»æ ·æœ¬æœ€è¿‘çš„Kä¸ªæ ·æœ¬\næŠ•ç¥¨æˆ–åŠ æƒï¼šåœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼ŒKä¸ªé‚»å±…ä¸­æœ€å¤šçš„ç±»åˆ«å³ä¸ºå¾…åˆ†ç±»æ ·æœ¬çš„é¢„æµ‹ç±»åˆ«ã€‚åœ¨å›å½’ä»»åŠ¡ä¸­ï¼Œå¯ä»¥å¯¹Kä¸ªé‚»å±…çš„æ•°å€¼è¿›è¡Œå¹³å‡æˆ–è€…åŠ æƒå¹³å‡ã€‚\nè¾“å‡ºç»“æœï¼šè¾“å‡ºæŠ•ç¥¨æˆ–åŠ æƒåçš„ç»“æœä½œä¸ºå¾…åˆ†ç±»æ ·æœ¬çš„é¢„æµ‹ç»“æœã€‚\nPatchTST - ICLR 2023 Patchify .\næœ‰ç›‘ç£ =\u0026gt; å¯ä»¥é‡å  è‡ªç›‘ç£ =\u0026gt; ä¸å¯ä»¥é‡å ï¼Œé¿å…ç½‘ç»œå¯ä»¥ä»é‡å åŒºåŸŸèµ°æ·å¾„å­¦ä¹  å¤šå˜é‡ç‹¬ç«‹ï¼š\næ¯ä¸ªæ—¶é—´åºåˆ—å°†æœ‰è‡ªå·±çš„æ½œåœ¨è¡¨ç¤ºï¼Œé€šè¿‡å…±äº«æƒé‡æœºåˆ¶äº¤å‰å­¦ä¹  ï¼Ÿï¼Ÿï¼Ÿ\nå…±äº«Encoderæƒé‡ï¼Œä¸åŒé€šé“ä½¿ç”¨ç›¸åŒçš„æ¨¡å‹å‚æ•°ã€‚è¿™ç§æ–¹æ³•å…è®¸æ¨¡å‹åœ¨ä¸åŒçš„ä»»åŠ¡ä¹‹é—´å…±äº«çŸ¥è¯†\nOverview\n1x = [batch, channel, length] 2x = [batch, channel, num_token, len_token] 3x = [batch*channel, num_sample, dim_hidden] 4 5=\u0026gt; Transformer Encoder but residual attn # 6 7=\u0026gt; Linear head =\u0026gt; CrossFormer - ICLR 2023 TRANSFORMER UTILIZING CROSSDIMENSION DEPENDENCY FOR MULTIVARIATE TIME SERIES FORECASTING\nåˆ›æ–°ç‚¹ï¼š\næ˜¾ç¤ºå»ºæ¨¡æ—¶é—´ä¾èµ–å…³ç³» + é€šé“ä¾èµ–å…³ç³» ä¸¤é˜¶æ®µæ³¨æ„åŠ› ï¼ˆæ—¶é—´ï¼šMHSAï¼Œé€šé“ï¼šRouter MHSAï¼‰ åµŒå…¥æ–¹å¼ and ä¾æ®ï¼š\nè‡ªæ³¨æ„åŠ›å‘ˆç°å°å±€éƒ¨ä¸€è‡´æ€§ï¼Œä¸€å¨è€Œä¸æ˜¯ä¸€ä¸ªã€‚\nä¿æŒé€šé“ç‹¬ç«‹ âœ”ï¸ æ³¨æ„åŠ›ä¼˜åŒ– âœ”ï¸ TwoStageAttention\n1# Step 1. Time Dependency 2x = [batch, channel, length] 3x = [batch, channel, num_patch, dim_patch] # \u0026lt;= DSW (Dimension-Segment-Wise) 4x = [batch*channel, num_patch, dim_patch] 5y = TransformerEncoer(x, x, x) # \u0026lt;= capture time dependency 6 7# Step 2. Channel Dependency 8y = [batch, channel, num_patch, dim_patch] 9y = [batch*num_patch, channel, dim_patch] 10router = [1, num_router, dim_patch] # \u0026lt;= router 11router =\u0026gt; repeat =\u0026gt; [*, num_router, dim_patch] 12z = TransformerEncoder(router, y, y) # \u0026lt;= capture channel dependency 13z = TransformerEncoder(y, router, router) 14 15# save per stage output 16=\u0026gt; Unet Decoder =\u0026gt; to predict ECGä¸å¤šå˜é‡çš„å¼‚åŒï¼š\nç›¸ä¼¼ç‚¹ ä¸åŒé€šé“è´¡çŒ®ä¸åŒ =\u0026gt; DSW-patch, èƒ½å¤Ÿæ›´åŠ ç»†ç²’åº¦ç¼–ç å±€éƒ¨æ³¢å½¢ == å¤šå˜é‡(é€šé“) patchåŒ–çš„æˆåŠŸï¼ï¼ï¼ ä¸åŒç‚¹ ç”±äºæ˜¯å¯¹å¿ƒè„ç”µæ´»åŠ¨çš„åŒä¸€æ—¶é—´ä¸åŒè§’åº¦çš„è§‚å¯Ÿ =\u0026gt; ç—…ç†ä½ç½®ç›¸åŒ =\u0026gt;æ˜¯å¦èƒ½å¤Ÿé€šè¿‡å…±äº«ç­–ç•¥ é™ä½è®¡ç®—æˆæœ¬ğŸ¤”â“ Informer - AAAI 2021 Best \u0026ndash; TopK-Q\nè§‚å¯Ÿï¼š(Q\u0026amp;K æ˜¯ç­‰ä»·çš„)\næ³¨æ„åŠ›å‘ˆç°é•¿å°¾åˆ†å¸ƒï¼š\nQueryåˆ†ä¸ºæ´»è·ƒäºæƒ°æ€§Token\nè¡¡é‡æŒ‡æ ‡ï¼š\næ³¨æ„åŠ›ä¼˜åŒ–ï¼š\n1Q, K, V 2# probe 3K = [batch, num_head, len_token, dim_head] 4K_sample = [batch, num_head, random_len, dim_head] 5Q_K_sample = [batch, num_head, len_token, random_len] 6M = Q_K_sample.max(-1)[0] - torch.div(Q_K_sample.sum(-1), L_K) # è¡¡é‡æŒ‡æ ‡ 7M_top = M.topk(n_top, sorted=False)[1] 8 9Q_reduce = Q[:, :, M_top, :] 10attn_active = softmax(torch.matmul(Q_reduce, K.transpose(-2, -1))*scale) 11 12contex = V.sum(-2).expand() =\u0026gt; [batch, num_head, len_token, dim_head] # å‡åŒ€åˆ†å¸ƒçš„å°±ç›´æ¥å–Vçš„å‡å€¼ 13contex[:, :, M_top, :] = attn_active@V ç»“æ„ä¼˜åŒ–ï¼š\n1# Encoder: 2for num_layer ...: 3 x = attn(x) 4 x = conv_layer(x) # \u0026lt;- maxpool(act(norm(conv()))) 5return enc_out 1# Decoder: 2cross = enc_out 3x = # é¢„æµ‹å¼•å¯¼ 4for num_layer ...: 5 x = layer(x, cross, x_mask=x_mask, cross_mask=cross_mask) # Noteï¼šMasked MHSA-ProbeAttn æ¡†æ¶é€»è¾‘\n1Class Exp_Basic(Object): 2 def __init__(): 3 def _build_model(): 4 def _acquire_device(): 5 def _get_data(): 6 def train(): 7 def vali(): 8 def test(self): 9 10Class Exp_Model(Exp_Basic): 11 def _select_optimizer(): 12 def _select_criterion(): 13 def _process_on_batch(): 1# data_loader.py 2Class Dataset_XXX(Dataset): 3 def __init__(): 4 def __read_data__(self): 5 def __getitem__(self, index): 6 def __len__(self): 1# main.py 2 3parser = argparse.ArgumentParser(description=\u0026#39;[Model] Task\u0026#39;) 4... 5args = parser.parse_args() 6setting = ...args 7 8exp = Exp_Model(args) 9exp.train(setting) 10exp.test(setting) Adaptive Token Dictionary - CVPR2024 Transcending the Limit of Local Window: Advanced Super-Resolution Transformer with Adaptive Token Dictionary\næ‰©å±•å±€éƒ¨çª—å£çš„é™åˆ¶\nwindow-based self-attention token dictionary cross-attention =\u0026gt; Attention(Q(XW),K(TW), V(TW)) åŸºäº2çš„Attnï¼Œå°†token mapæ’åºåˆ†group(ç±»)ï¼Œè¿›è¡Œgroupå†…éƒ¨çš„Attention Architecture\nPoly Kernel Inception - CVPR 2024 Poly Kernel Inception Network for Remote Sensing Detection\né¥æ„Ÿå›¾åƒä¸­çš„ç›®æ ‡æ£€æµ‹é¢ä¸´ç€å¤šç§æŒ‘æˆ˜ï¼ŒåŒ…æ‹¬ç›®æ ‡å°ºåº¦å˜åŒ–å¤§ã€æµ‹è·ç¯å¢ƒå¤šæ ·ç­‰ã€‚ç°æœ‰çš„æ–¹æ³•è¯•å›¾é€šè¿‡å¤§æ ¸å·ç§¯æˆ–æ‰©å¼ å·ç§¯æ¥æ‰©å±•è„ŠæŸ±çš„ç©ºé—´æ„Ÿå—é‡æ¥è§£å†³è¿™äº›æŒ‘æˆ˜ã€‚ç„¶è€Œï¼Œå‰è€…é€šå¸¸ä¼šå¼•å…¥ç›¸å½“å¤§çš„èƒŒæ™¯å™ªå£°ï¼Œè€Œåè€…åˆ™æœ‰ç”Ÿæˆè¿‡åº¦ç¨€ç–çš„ç‰¹å¾è¡¨ç¤ºçš„é£é™©ã€‚æœ¬æ–‡æå‡ºäº†ä¸€ç§å¤šæ ¸åˆå§‹åŒ–ç½‘ç»œï¼ˆPKINetï¼‰æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚PKINeté‡‡ç”¨æ— è†¨èƒ€çš„å¤šå°ºåº¦å·ç§¯æ ¸æ¥æå–ä¸åŒå°ºåº¦çš„å¯¹è±¡ç‰¹å¾å¹¶æ•è·å±€éƒ¨ä¸Šä¸‹æ–‡ã€‚æ­¤å¤–ï¼Œä¸€ä¸ªä¸Šä¸‹æ–‡é”šæ³¨æ„ï¼ˆCAAï¼‰æ¨¡å—å¹¶è¡Œå¼•å…¥æ•è·è¿œç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚\nä¸åŒå°ºåº¦-å±€éƒ¨ä¸Šä¸‹æ–‡ å¹¶è¡Œå¼•å…¥æ•è·è¿œç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯ 1# åå­—æ¶å‹æ±‡èš =\u0026gt; è¿‘ä¼¼æ ‡å‡†çš„DWConvKxK =\u0026gt; é™ä½å‚æ•°é‡ 2agg = Conv1x1(AvgPool(X)) 3agg = Conv1x1(DWConvKx1(DWConv1xK(agg))) 4attn = Sigmoid(agg) DANet - CVPR 2019 Dual Attention Network for Scene Segmentation\nAt the end of the model, we use the dual attention mechanism to explicitly capture position and channel dependencies.\n1class PAM_Module(Module): 2 \u0026#34;\u0026#34;\u0026#34; Position attention module\u0026#34;\u0026#34;\u0026#34; 3 #Ref from SAGAN 4 def __init__(self, in_dim): 5 super(PAM_Module, self).__init__() 6 self.chanel_in = in_dim 7 8 self.query_conv = Conv2d(in_channels=in_dim, out_channels=in_dim//8, kernel_size=1) 9 self.key_conv = Conv2d(in_channels=in_dim, out_channels=in_dim//8, kernel_size=1) 10 self.value_conv = Conv2d(in_channels=in_dim, out_channels=in_dim, kernel_size=1) 11 self.gamma = Parameter(torch.zeros(1)) 12 13 self.softmax = Softmax(dim=-1) 14 def forward(self, x): 15 \u0026#34;\u0026#34;\u0026#34; 16 inputs : 17 x : input feature maps( B X C X H X W) 18 returns : 19 out : attention value + input feature 20 attention: B X (HxW) X (HxW) 21 \u0026#34;\u0026#34;\u0026#34; 22 m_batchsize, C, height, width = x.size() 23 proj_query = self.query_conv(x).view(m_batchsize, -1, width*height).permute(0, 2, 1) 24 proj_key = self.key_conv(x).view(m_batchsize, -1, width*height) 25 energy = torch.bmm(proj_query, proj_key) 26 attention = self.softmax(energy) 27 proj_value = self.value_conv(x).view(m_batchsize, -1, width*height) 28 29 out = torch.bmm(proj_value, attention.permute(0, 2, 1)) 30 out = out.view(m_batchsize, C, height, width) 31 32 out = self.gamma*out + x 33 return out 34 35 36class CAM_Module(Module): 37 \u0026#34;\u0026#34;\u0026#34; Channel attention module\u0026#34;\u0026#34;\u0026#34; 38 def __init__(self, in_dim): 39 super(CAM_Module, self).__init__() 40 self.chanel_in = in_dim 41 42 43 self.gamma = Parameter(torch.zeros(1)) 44 self.softmax = Softmax(dim=-1) 45 def forward(self,x): 46 \u0026#34;\u0026#34;\u0026#34; 47 inputs : 48 x : input feature maps( B X C X H X W) 49 returns : 50 out : attention value + input feature 51 attention: B X C X C 52 \u0026#34;\u0026#34;\u0026#34; 53 m_batchsize, C, height, width = x.size() 54 proj_query = x.view(m_batchsize, C, -1) 55 proj_key = x.view(m_batchsize, C, -1).permute(0, 2, 1) 56 energy = torch.bmm(proj_query, proj_key) 57 energy_new = torch.max(energy, -1, keepdim=True)[0].expand_as(energy)-energy 58 attention = self.softmax(energy_new) 59 proj_value = x.view(m_batchsize, C, -1) 60 61 out = torch.bmm(attention, proj_value) 62 out = out.view(m_batchsize, C, height, width) 63 64 out = self.gamma*out + x 65 return out MixNet MixConv: Mixed Depthwise Convolutional Kernels\nconvulution =\u0026gt; capture local pattern\nearly stages: edges later stages: objectsâ­ è¿™é¡¹ç ”ç©¶è¡¨æ˜äº†å•ä¸ªå†…æ ¸å¤§å°çš„å±€é™æ€§ï¼šæˆ‘ä»¬æ—¢éœ€è¦å¤§å†…æ ¸æ¥æ•è·é«˜åˆ†è¾¨ç‡æ¨¡å¼ï¼Œä¹Ÿéœ€è¦å°å†…æ ¸æ¥æ•è·ä½åˆ†è¾¨ç‡æ¨¡å¼ï¼Œä»¥è·å¾—æ›´å¥½çš„æ¨¡å‹ç²¾åº¦å’Œæ•ˆç‡\nåœ¨å•ä¸€æœºåˆ¶ä¸‹å®ç°å¤šç§æ•ˆæœï¼Œè¿›è¡Œå¢å¼º\nMultimodal Learning Multimodal Learning With Transformers: A Survey\nèåˆç­–ç•¥\nDual Aggregation Transformer Dual Aggregation Transformer for Image Super-Resolution\nMotivation: ç°æœ‰æ–¹æ³•åˆ©ç”¨è‡ªæˆ‘æ³¨æ„æ²¿ç€ä¸åŒçš„ç»´åº¦ï¼Œç©ºé—´æˆ–é€šé“ï¼Œå¹¶å–å¾—äº†ä»¤äººå°è±¡æ·±åˆ»çš„æ€§èƒ½ã€‚è¿™å¯å‘æˆ‘ä»¬å°†Transformerä¸­çš„ä¸¤ä¸ªç»´åº¦ç»“åˆèµ·æ¥ï¼Œä»¥è·å¾—æ›´å¼ºå¤§çš„è¡¨ç¤ºèƒ½åŠ›ã€‚\nDual Vision Transformer ç ”ç©¶å…¨å±€è¯­ä¹‰å’Œæ›´ç²¾ç»†çš„åƒç´ çº§ç‰¹å¾ä¹‹é—´çš„ä¾èµ–å…³ç³» =\u0026gt; pixel-level token \u0026amp; semantic token\nåˆ†è§£å’Œé›†æˆçš„å…¨å±€è¯­ä¹‰å’Œæœ¬åœ°åŠŸèƒ½\nFish-Speech Tech-report Text-to-Speech End2End Model\nä¸¤é˜¶æ®µè®­ç»ƒç­–ç•¥ï¼š\nStage 1:\nAudio:Mel Spectrogram =\u0026gt; ã€Encoderã€‘ =\u0026gt; Embedding =\u0026gt; Quantize Tokens =\u0026gt; ã€â­Decoderâ­ã€‘=\u0026gt; Audio\r**â­é‡æ„ç›®æ ‡â­**\rStage 2:\nText:Quantize Tokens =\u0026gt; ã€âœ¨AR Modelâœ¨ã€‘=\u0026gt; Quantize Tokens â­**Text:Audioä¸€è‡´æ€§ + è‡ªå›å½’é¢„æµ‹Next**â­\rInference:\nText:Prompt-Tokens =\u0026gt; ã€âœ¨AR Modelâœ¨ã€‘=\u0026gt; Quantize Tokens =\u0026gt; ã€â­Decoderâ­ã€‘=\u0026gt; Audio\rVector Quantize Tech:\nExampleï¼š\n1æœ‰ä¸€ç»„è¿ç»­çš„æ¸©åº¦æ•°æ®ï¼ˆå¦‚ 20.3Â°C, 21.7Â°C, 22.5Â°C, 19.8Â°Cï¼‰ï¼Œä½ æƒ³å°†å…¶ç¦»æ•£åŒ–ä¸ºå‡ ä¸ªç±»åˆ«: 21.ä½æ¸©: 15Â°C - 20Â°C 32.ä¸­æ¸©: 20Â°C - 25Â°C 43.é«˜æ¸©: 25Â°C - 30Â°C 5=\u0026gt; 620.3Â°C â†’ ä¸­æ¸© 721.7Â°C â†’ ä¸­æ¸© 822.5Â°C â†’ ä¸­æ¸© 919.8Â°C â†’ ä½æ¸© 10 11å‡è®¾ç¼–ç æœ¬æœ‰ 512 ä¸ªå‘é‡ Shape:[512, dim] 12Encoderå¾—åˆ°çš„Embedding Shape:[T, dim] 13å¯¹äº Encoder è¾“å‡ºçš„æ¯ä¸ªæ—¶é—´æ­¥çš„ç‰¹å¾å‘é‡ï¼ŒVQ ä¼šæ‰¾åˆ°ç¼–ç æœ¬ä¸­ä¸ä¹‹æœ€æ¥è¿‘çš„å‘é‡ï¼Œå¹¶ç”¨å…¶ç´¢å¼•è¡¨ç¤ºã€‚ 14æœ€ç»ˆè¾“å‡ºæ˜¯ä¸€ä¸ªç¦»æ•£çš„ç´¢å¼•åºåˆ—ï¼Œä¾‹å¦‚ [42, 123, 87, ...]ï¼Œæ¯ä¸ªç´¢å¼•å¯¹åº”ç¼–ç æœ¬ä¸­çš„ä¸€ä¸ªå‘é‡ã€‚ 15 16ç¼–ç æœ¬éšæœºåˆå§‹åŒ–ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç¼–ç æœ¬ä¼šé€šè¿‡æ¢¯åº¦ä¸‹é™å’Œä¼˜åŒ–ç®—æ³•ï¼ˆå¦‚ Adamï¼‰ä¸æ–­æ›´æ–°ï¼š 17æœ€è¿‘é‚»æœç´¢ =\u0026gt; é‡åŒ–è¯¯å·®è®¡ç®— =\u0026gt; æ¢¯åº¦æ›´æ–°,BP 18ç¼–ç æœ¬çš„ä½œç”¨ =\u0026gt; é™ç»´ä¸å‹ç¼© + ç¦»æ•£åŒ–è¡¨ç¤º + æå‡ç”Ÿæˆè´¨é‡(é€šè¿‡ç¦»æ•£åŒ–å‡å°‘ç”Ÿæˆè¿‡ç¨‹ä¸­çš„æ¨¡ç³Šæ€§ï¼Œæå‡ç”Ÿæˆè¯­éŸ³çš„è‡ªç„¶åº¦s) Blip Image-2-Text ä»»åŠ¡ä¹‹ä¸€ Bootstrapping Language-Image Pre-training for Unified Vision-Language Understanding and Generation Architecture\nç›¸åŒé¢œè‰²å…±äº«å‚æ•°\nStage 1ï¼š\nImage =\u0026gt; ã€Image Encoder:ViTã€‘ =\u0026gt; image Embedding\nText =\u0026gt; ã€Text Encoder:Bertã€‘ =\u0026gt; text Embedding\nç›®æ ‡ï¼šå›¾æ–‡ä¸€è‡´æ€§, è®­ç»ƒEncoder\nStage 2ï¼š\nImage =\u0026gt; ã€Image Encoder:ViT:FreezeğŸ¥¶ã€‘ =\u0026gt; image Embedding\nText =\u0026gt; ã€Text Encoder:Bert:FreezeğŸ¥¶ + Cross-Attention:image EmbeddingğŸ¥µã€‘ =\u0026gt; Linear:2class\nç›®æ ‡ï¼šå›¾æ–‡æ˜¯å¦åŒ¹é…-2åˆ†ç±», è®­ç»ƒCross-Attentionéƒ¨åˆ†\nStage 3:\nImage =\u0026gt; ã€Image Encoder:ViT:FreezeğŸ¥¶ã€‘ =\u0026gt; image Embedding\nText =\u0026gt; ã€Text Decoder:GPTğŸ¥µ + Cross-Attention:image Embedding:FreezeğŸ¥¶ã€‘ =\u0026gt; Linear:multi-class\nç›®æ ‡ï¼šImage Embedding + text è‡ªå›å½’é¢„æµ‹Next\nInference\nImage =\u0026gt; ã€â­Image Encoderâ­ã€‘ =\u0026gt; image Embedding\nPrompt-Text =\u0026gt; ã€â­Text Decoder:GPTâ­ + Cross-Attention:image Embedding:â­ã€‘ =\u0026gt; Linear:multi-class =\u0026gt; Next-Token\nå®ç°Image =\u0026gt; Text\nBEVFormer BEVFormer: Learning Birdâ€™s-Eye-View Representation from Multi-Camera Images via Spatiotemporal Transformers\nç½‘ç»œæ¶æ„ä¿¡æ¯æµæ€è·¯ï¼š\nå…·ä½“ï¼š\nä¸€ç»„å¯å­¦ä¹ çš„BEV Queriesï¼ŒäºŒç»´ç½‘æ ¼ï¼Œæ¨¡æ‹Ÿé¸Ÿç°å›¾ï¼› Spatial Cross Attentionï¼Œæ¯ä¸ªè§†å›¾ç»è¿‡backoneæå–ï¼Œæ‹¿å…¶ä¸­å¤šä¸ªå±‚çº§çš„è¾“å‡ºï¼Œæ‹¼æ¥ä¸ºå¤šå°ºåº¦ç‰¹å¾(å¤šä¸ªå±‚çš„ç‰¹å¾å›¾ï¼Œæ ¡å‡†é€šé“)ã€‚ç„¶åæ¯ä¸ªä½ç½®çš„qï¼ŒåªæŸ¥è¯¢å¯¹åº”å‡ ä¸ªè§†å›¾çš„å‘¨è¾¹å‡ ä¸ªkï¼› Temporal Attentionï¼Œtæ—¶åˆ»çš„BEVä¸­çš„qï¼ŒæŸ¥è¯¢t-1æ—¶åˆ»ï¼Œç›¸åº”ä½ç½®å‘¨è¾¹çš„å‡ ä¸ªkã€‚ è¿™é‡Œçš„t-1æ—¶åˆ»çš„BEVç‰¹å¾ï¼Œéœ€è¦é€šè¿‡ä¸€ä¸ªè§’åº¦è¿˜æ˜¯å•¥æ ¡å‡†ç©ºé—´å¯¹é½ï¼› Deformable DETR architecture figureï¼š\nAttn figureï¼š\n1# ä¼ªä»£ç  - å•å°ºåº¦çš„ 2import torch 3import torch.nn as nn 4import torch.nn.functional as F 5 6class DeformableAttention(nn.Module): 7 def __init__(self, embed_dim, num_heads, num_points): 8 super().__init__() 9 self.embed_dim = embed_dim 10 self.num_heads = num_heads 11 self.num_points = num_points 12 13 # ç”¨äºé¢„æµ‹é‡‡æ ·åç§»çš„çº¿æ€§å±‚ 14 self.offset_proj = nn.Linear(embed_dim, num_heads * num_points * 2) 15 16 # ç”¨äºè®¡ç®—æ³¨æ„åŠ›æƒé‡çš„çº¿æ€§å±‚ 17 self.attn_proj = nn.Linear(embed_dim, num_heads * num_points) 18 19 # è¾“å‡ºæŠ•å½±å±‚ 20 self.out_proj = nn.Linear(embed_dim, embed_dim) 21\t22 # reference_points, æ¯ä¸ªé‡‡æ ·ç‚¹åˆå§‹ï¼Œå…±ç”¨åŒä¸€ä¸ªreference_pointï¼Œé offsetè¿›è¡Œå±€éƒ¨ä½ç½®åç§» 23 def forward(self, query, reference_points, value): 24 B, N, C = query.shape 25 H, W = value.shape[-2:] 26 27 # é¢„æµ‹é‡‡æ ·åç§» 28 offsets = self.offset_proj(query).view(B, N, self.num_heads, self.num_points, 2) 29 30 # ç”Ÿæˆé‡‡æ ·ç‚¹ 31 sampling_points = reference_points.unsqueeze(2) + offsets 32 33 # åŒçº¿æ€§æ’å€¼é‡‡æ ·ç‰¹å¾å€¼ 34 sampled_value = F.grid_sample( 35 value, 36 sampling_points.view(B, -1, H, W, 2), 37 mode=\u0026#39;bilinear\u0026#39;, 38 align_corners=True 39 ).view(B, N, self.num_heads, self.num_points, C // self.num_heads) 40 41 # è®¡ç®—æ³¨æ„åŠ›æƒé‡ 42 attn_weights = self.attn_proj(query).view(B, N, self.num_heads, self.num_points) 43 attn_weights = F.softmax(attn_weights, dim=-1) 44 45 # åŠ æƒæ±‚å’Œ 46 output = (sampled_value * attn_weights.unsqueeze(-1)).sum(dim=3) 47 output = output.view(B, N, C) 48 49 # è¾“å‡ºæŠ•å½± 50 output = self.out_proj(output) 51 52 return output ","permalink":"http://longcoding.top/posts/learning/paper_reading2/","summary":"\u003ch3 id=\"cam----cvpr-2015\"\u003e\u003cstrong\u003eCAM\u003c/strong\u003e  - CVPR 2015\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003eLearning Deep Features for Discriminative Localization\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå¼±ç›‘ç£å¯¹è±¡å®šä½\u003c/strong\u003e  - ä»…æä¾›Image level label\u003c/p\u003e\n\u003cp\u003eæœŸæœ›ï¼šæ¯ä¸ªå•å…ƒè¢«å…¶æ„Ÿå—é‡å†…çš„æŸç§è§†è§‰æ¨¡å¼æ¿€æ´»ã€‚å› æ­¤ fk ï¼ˆè¡¨ç¤ºç©ºé—´ä½ç½® (x, y) å¤„æœ€åä¸€ä¸ªå·ç§¯å±‚ä¸­å•å…ƒ k çš„æ¿€æ´»//è¾“å‡ºç‰¹å¾å›¾çš„ä¸€ä¸ªåƒç´ ï¼‰æ˜¯è¯¥è§†è§‰æ¨¡å¼å­˜åœ¨çš„åœ°å›¾ã€‚ç±»æ¿€æ´»å›¾åªæ˜¯è¿™äº›è§†è§‰æ¨¡å¼åœ¨ä¸åŒç©ºé—´ä½ç½®çš„å­˜åœ¨çš„åŠ æƒçº¿æ€§å’Œ\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eè®¡ç®—å·ç§¯ç‰¹å¾å›¾å¯¹äºç‰¹å®šè¾“å‡ºå•å…ƒçš„é‡è¦æ€§æ¥å®ç°çš„\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eâ­â­â­ç½‘ç»œå¯ä»¥ä¿ç•™å…¶å“è¶Šçš„å®šä½èƒ½åŠ›ï¼Œç›´åˆ°æœ€åä¸€å±‚   =\u0026gt; æ·±å±‚ç‰¹å¾çš„å®šä½èƒ½åŠ›\u003c/p\u003e\n\u003cp\u003eâ—â—â—å°½ç®¡æ¥å—äº†å›¾åƒçº§æ ‡ç­¾çš„è®­ç»ƒï¼ŒCNN ä»å…·æœ‰å‡ºè‰²çš„å¯¹è±¡å®šä½èƒ½åŠ›\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eç¼ºé™·\u003c/strong\u003eï¼šå·ç§¯ç‰¹å¾å›¾â†’å…¨å±€å¹³å‡æ± åŒ–â†’softmaxå±‚  // ç‰¹å®šç½‘ç»œç»“æ„\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240322134603157\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FizSzlSfuX9fZOO_3HduKDclEzcI\"\u003e\u003c/p\u003e\n\u003ccenter style=\"color: red; font-weight: bold;\"\u003eåšæ³•å›¾ç¤º\u003c/center\u003e\r\n\u003cp\u003e\u003cimg alt=\"image-20240322134441902\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FiBRel9zde6IJ3STCIWgQtDspaZx\"\u003e\u003c/p\u003e\n\u003ccenter style=\"color: red; font-weight: bold;\"\u003eæ•°å­¦å…¬å¼\u003c/center\u003e\r\n\u003cp\u003eåœ¨å·ç§¯ç‰¹å¾å›¾ä¸Šæ‰§è¡Œå…¨å±€å¹³å‡æ± åŒ–ï¼Œå¹¶å°†å®ƒä»¬ç”¨ä½œå…¨è¿æ¥å±‚çš„ç‰¹å¾ï¼Œäº§ç”Ÿæ‰€éœ€çš„è¾“å‡ºåˆ†ç±»;\u003c/p\u003e\n\u003cp\u003eâ—â—â—å°†è¾“å‡ºå±‚çš„æƒé‡æŠ•å½±å›å·ç§¯ç‰¹å¾å›¾æ¥è¯†åˆ«å›¾åƒåŒºåŸŸçš„é‡è¦æ€§\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"grad-cam----iccv-2017\"\u003eGrad-CAM  - ICCV 2017\u003c/h3\u003e\n\u003cp\u003eé€‚ç”¨CNNæ¨¡å‹\u003c/p\u003e\n\u003cp\u003eä½†è®ºæ–‡æåˆ°åœ¨CNN+LSTMçš„ä¹Ÿèƒ½å®šä½æœ‰åŒºåˆ«çš„å›¾åƒåŒºåŸŸ\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240322141249072\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FjU70VichK5n125Mrm0J9kJnVy43\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240322141305661\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FpssA7XV30OJ4BKmn1aDL-1GNYSa\"\u003e\u003c/p\u003e\n\u003cp\u003eÎ± æ•è·\u003cstrong\u003eç‰¹å¾å›¾\u003c/strong\u003e k å¯¹äºç›®æ ‡\u003cstrong\u003eç±»\u003c/strong\u003e c çš„\u003cstrong\u003eé‡è¦æ€§\u003c/strong\u003e  // ä¸CAMçš„åˆ†ç±»çº¿æ€§å±‚æƒé‡ä½œç”¨ä¸€è‡´\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240322141314248\" loading=\"lazy\" src=\"http://sthda9dn6.hd-bkt.clouddn.com/FoLeKuhJnfw8veLYf18fRWRhEy09\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eReLU\u003c/strong\u003eçš„ä½œç”¨ï¼Œåªå¯¹å¯¹æ„Ÿå…´è¶£çš„ç±»åˆ«æœ‰ç§¯æå½±å“çš„ç‰¹å¾æ„Ÿå…´è¶£ã€‚è´Ÿåƒç´ å¯èƒ½å±äºå›¾åƒä¸­çš„å…¶ä»–ç±»åˆ«\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eä¸Šè¿°æ“ä½œ =\u0026gt; å…·æœ‰\u003cstrong\u003eç±»åˆ«åŒºåˆ†æ€§\u003c/strong\u003eå¹¶ä¸”å¯ä»¥å¾ˆå¥½åœ°å®šä½ç›¸å…³å›¾åƒåŒºåŸŸ\u003c/em\u003e   - æœ€åç‰¹å¾å›¾æ¯”è¾ƒå°!\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\t\t\t\t  ä½†ç¼ºä¹æ˜¾ç¤ºç»†ç²’åº¦é‡è¦æ€§çš„èƒ½åŠ› ï¼ˆèƒ½åŒºåˆ†çŒ«ç‹—ï¼Œä½†å¯¹ä¸ºä»€ä¹ˆè¯†åˆ«ä¸ºçŒ«ï¼Œä¸å¤Ÿç²¾ç¡®ï¼‰\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eé€šè¿‡ç‚¹ä¹˜æ³•èåˆ \u003cstrong\u003eå¼•å¯¼åå‘ä¼ æ’­\u003c/strong\u003e å’Œ \u003cstrong\u003eGrad-CAM\u003c/strong\u003e =\u0026gt; å¯è§†åŒ–\u003c/p\u003e","title":"æ·±åº¦å­¦ä¹ è®ºæ–‡æ±‡æ€»2"},{"content":"Hi!\n","permalink":"http://longcoding.top/about/","summary":"about","title":"About Me"}]